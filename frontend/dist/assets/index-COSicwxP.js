(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))p(_);new MutationObserver(_=>{for(const T of _)if(T.type==="childList")for(const v of T.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&p(v)}).observe(document,{childList:!0,subtree:!0});function l(_){const T={};return _.integrity&&(T.integrity=_.integrity),_.referrerPolicy&&(T.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?T.credentials="include":_.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function p(_){if(_.ep)return;_.ep=!0;const T=l(_);fetch(_.href,T)}})();var x2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qv(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Zv={exports:{}},Tp={},Hv={exports:{}},jt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lh=Symbol.for("react.element"),v2=Symbol.for("react.portal"),w2=Symbol.for("react.fragment"),b2=Symbol.for("react.strict_mode"),S2=Symbol.for("react.profiler"),T2=Symbol.for("react.provider"),E2=Symbol.for("react.context"),k2=Symbol.for("react.forward_ref"),I2=Symbol.for("react.suspense"),C2=Symbol.for("react.memo"),P2=Symbol.for("react.lazy"),_x=Symbol.iterator;function A2(r){return r===null||typeof r!="object"?null:(r=_x&&r[_x]||r["@@iterator"],typeof r=="function"?r:null)}var Gv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Wv=Object.assign,Xv={};function cu(r,s,l){this.props=r,this.context=s,this.refs=Xv,this.updater=l||Gv}cu.prototype.isReactComponent={};cu.prototype.setState=function(r,s){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,s,"setState")};cu.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function Kv(){}Kv.prototype=cu.prototype;function Fg(r,s,l){this.props=r,this.context=s,this.refs=Xv,this.updater=l||Gv}var Og=Fg.prototype=new Kv;Og.constructor=Fg;Wv(Og,cu.prototype);Og.isPureReactComponent=!0;var xx=Array.isArray,Jv=Object.prototype.hasOwnProperty,Bg={current:null},Yv={key:!0,ref:!0,__self:!0,__source:!0};function Qv(r,s,l){var p,_={},T=null,v=null;if(s!=null)for(p in s.ref!==void 0&&(v=s.ref),s.key!==void 0&&(T=""+s.key),s)Jv.call(s,p)&&!Yv.hasOwnProperty(p)&&(_[p]=s[p]);var d=arguments.length-2;if(d===1)_.children=l;else if(1<d){for(var N=Array(d),Z=0;Z<d;Z++)N[Z]=arguments[Z+2];_.children=N}if(r&&r.defaultProps)for(p in d=r.defaultProps,d)_[p]===void 0&&(_[p]=d[p]);return{$$typeof:lh,type:r,key:T,ref:v,props:_,_owner:Bg.current}}function M2(r,s){return{$$typeof:lh,type:r.type,key:s,ref:r.ref,props:r.props,_owner:r._owner}}function Ng(r){return typeof r=="object"&&r!==null&&r.$$typeof===lh}function z2(r){var s={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(l){return s[l]})}var vx=/\/+/g;function am(r,s){return typeof r=="object"&&r!==null&&r.key!=null?z2(""+r.key):s.toString(36)}function Bd(r,s,l,p,_){var T=typeof r;(T==="undefined"||T==="boolean")&&(r=null);var v=!1;if(r===null)v=!0;else switch(T){case"string":case"number":v=!0;break;case"object":switch(r.$$typeof){case lh:case v2:v=!0}}if(v)return v=r,_=_(v),r=p===""?"."+am(v,0):p,xx(_)?(l="",r!=null&&(l=r.replace(vx,"$&/")+"/"),Bd(_,s,l,"",function(Z){return Z})):_!=null&&(Ng(_)&&(_=M2(_,l+(!_.key||v&&v.key===_.key?"":(""+_.key).replace(vx,"$&/")+"/")+r)),s.push(_)),1;if(v=0,p=p===""?".":p+":",xx(r))for(var d=0;d<r.length;d++){T=r[d];var N=p+am(T,d);v+=Bd(T,s,l,N,_)}else if(N=A2(r),typeof N=="function")for(r=N.call(r),d=0;!(T=r.next()).done;)T=T.value,N=p+am(T,d++),v+=Bd(T,s,l,N,_);else if(T==="object")throw s=String(r),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return v}function vd(r,s,l){if(r==null)return r;var p=[],_=0;return Bd(r,p,"","",function(T){return s.call(l,T,_++)}),p}function R2(r){if(r._status===-1){var s=r._result;s=s(),s.then(function(l){(r._status===0||r._status===-1)&&(r._status=1,r._result=l)},function(l){(r._status===0||r._status===-1)&&(r._status=2,r._result=l)}),r._status===-1&&(r._status=0,r._result=s)}if(r._status===1)return r._result.default;throw r._result}var Xn={current:null},Nd={transition:null},D2={ReactCurrentDispatcher:Xn,ReactCurrentBatchConfig:Nd,ReactCurrentOwner:Bg};function e0(){throw Error("act(...) is not supported in production builds of React.")}jt.Children={map:vd,forEach:function(r,s,l){vd(r,function(){s.apply(this,arguments)},l)},count:function(r){var s=0;return vd(r,function(){s++}),s},toArray:function(r){return vd(r,function(s){return s})||[]},only:function(r){if(!Ng(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};jt.Component=cu;jt.Fragment=w2;jt.Profiler=S2;jt.PureComponent=Fg;jt.StrictMode=b2;jt.Suspense=I2;jt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D2;jt.act=e0;jt.cloneElement=function(r,s,l){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var p=Wv({},r.props),_=r.key,T=r.ref,v=r._owner;if(s!=null){if(s.ref!==void 0&&(T=s.ref,v=Bg.current),s.key!==void 0&&(_=""+s.key),r.type&&r.type.defaultProps)var d=r.type.defaultProps;for(N in s)Jv.call(s,N)&&!Yv.hasOwnProperty(N)&&(p[N]=s[N]===void 0&&d!==void 0?d[N]:s[N])}var N=arguments.length-2;if(N===1)p.children=l;else if(1<N){d=Array(N);for(var Z=0;Z<N;Z++)d[Z]=arguments[Z+2];p.children=d}return{$$typeof:lh,type:r.type,key:_,ref:T,props:p,_owner:v}};jt.createContext=function(r){return r={$$typeof:E2,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:T2,_context:r},r.Consumer=r};jt.createElement=Qv;jt.createFactory=function(r){var s=Qv.bind(null,r);return s.type=r,s};jt.createRef=function(){return{current:null}};jt.forwardRef=function(r){return{$$typeof:k2,render:r}};jt.isValidElement=Ng;jt.lazy=function(r){return{$$typeof:P2,_payload:{_status:-1,_result:r},_init:R2}};jt.memo=function(r,s){return{$$typeof:C2,type:r,compare:s===void 0?null:s}};jt.startTransition=function(r){var s=Nd.transition;Nd.transition={};try{r()}finally{Nd.transition=s}};jt.unstable_act=e0;jt.useCallback=function(r,s){return Xn.current.useCallback(r,s)};jt.useContext=function(r){return Xn.current.useContext(r)};jt.useDebugValue=function(){};jt.useDeferredValue=function(r){return Xn.current.useDeferredValue(r)};jt.useEffect=function(r,s){return Xn.current.useEffect(r,s)};jt.useId=function(){return Xn.current.useId()};jt.useImperativeHandle=function(r,s,l){return Xn.current.useImperativeHandle(r,s,l)};jt.useInsertionEffect=function(r,s){return Xn.current.useInsertionEffect(r,s)};jt.useLayoutEffect=function(r,s){return Xn.current.useLayoutEffect(r,s)};jt.useMemo=function(r,s){return Xn.current.useMemo(r,s)};jt.useReducer=function(r,s,l){return Xn.current.useReducer(r,s,l)};jt.useRef=function(r){return Xn.current.useRef(r)};jt.useState=function(r){return Xn.current.useState(r)};jt.useSyncExternalStore=function(r,s,l){return Xn.current.useSyncExternalStore(r,s,l)};jt.useTransition=function(){return Xn.current.useTransition()};jt.version="18.3.1";Hv.exports=jt;var We=Hv.exports;const L2=qv(We);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F2=We,O2=Symbol.for("react.element"),B2=Symbol.for("react.fragment"),N2=Object.prototype.hasOwnProperty,j2=F2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,V2={key:!0,ref:!0,__self:!0,__source:!0};function t0(r,s,l){var p,_={},T=null,v=null;l!==void 0&&(T=""+l),s.key!==void 0&&(T=""+s.key),s.ref!==void 0&&(v=s.ref);for(p in s)N2.call(s,p)&&!V2.hasOwnProperty(p)&&(_[p]=s[p]);if(r&&r.defaultProps)for(p in s=r.defaultProps,s)_[p]===void 0&&(_[p]=s[p]);return{$$typeof:O2,type:r,key:T,ref:v,props:_,_owner:j2.current}}Tp.Fragment=B2;Tp.jsx=t0;Tp.jsxs=t0;Zv.exports=Tp;var he=Zv.exports,Nm={},r0={exports:{}},Ri={},n0={exports:{}},i0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function s(Ze,ft){var gt=Ze.length;Ze.push(ft);e:for(;0<gt;){var wt=gt-1>>>1,Pt=Ze[wt];if(0<_(Pt,ft))Ze[wt]=ft,Ze[gt]=Pt,gt=wt;else break e}}function l(Ze){return Ze.length===0?null:Ze[0]}function p(Ze){if(Ze.length===0)return null;var ft=Ze[0],gt=Ze.pop();if(gt!==ft){Ze[0]=gt;e:for(var wt=0,Pt=Ze.length,ar=Pt>>>1;wt<ar;){var mr=2*(wt+1)-1,Cr=Ze[mr],Yt=mr+1,Pr=Ze[Yt];if(0>_(Cr,gt))Yt<Pt&&0>_(Pr,Cr)?(Ze[wt]=Pr,Ze[Yt]=gt,wt=Yt):(Ze[wt]=Cr,Ze[mr]=gt,wt=mr);else if(Yt<Pt&&0>_(Pr,gt))Ze[wt]=Pr,Ze[Yt]=gt,wt=Yt;else break e}}return ft}function _(Ze,ft){var gt=Ze.sortIndex-ft.sortIndex;return gt!==0?gt:Ze.id-ft.id}if(typeof performance=="object"&&typeof performance.now=="function"){var T=performance;r.unstable_now=function(){return T.now()}}else{var v=Date,d=v.now();r.unstable_now=function(){return v.now()-d}}var N=[],Z=[],te=1,q=null,U=3,ke=!1,ue=!1,_e=!1,Pe=typeof setTimeout=="function"?setTimeout:null,oe=typeof clearTimeout=="function"?clearTimeout:null,re=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ce(Ze){for(var ft=l(Z);ft!==null;){if(ft.callback===null)p(Z);else if(ft.startTime<=Ze)p(Z),ft.sortIndex=ft.expirationTime,s(N,ft);else break;ft=l(Z)}}function Ce(Ze){if(_e=!1,ce(Ze),!ue)if(l(N)!==null)ue=!0,nr(De);else{var ft=l(Z);ft!==null&&Or(Ce,ft.startTime-Ze)}}function De(Ze,ft){ue=!1,_e&&(_e=!1,oe(Qe),Qe=-1),ke=!0;var gt=U;try{for(ce(ft),q=l(N);q!==null&&(!(q.expirationTime>ft)||Ze&&!pt());){var wt=q.callback;if(typeof wt=="function"){q.callback=null,U=q.priorityLevel;var Pt=wt(q.expirationTime<=ft);ft=r.unstable_now(),typeof Pt=="function"?q.callback=Pt:q===l(N)&&p(N),ce(ft)}else p(N);q=l(N)}if(q!==null)var ar=!0;else{var mr=l(Z);mr!==null&&Or(Ce,mr.startTime-ft),ar=!1}return ar}finally{q=null,U=gt,ke=!1}}var Ue=!1,Oe=null,Qe=-1,_t=5,mt=-1;function pt(){return!(r.unstable_now()-mt<_t)}function Xt(){if(Oe!==null){var Ze=r.unstable_now();mt=Ze;var ft=!0;try{ft=Oe(!0,Ze)}finally{ft?Dt():(Ue=!1,Oe=null)}}else Ue=!1}var Dt;if(typeof re=="function")Dt=function(){re(Xt)};else if(typeof MessageChannel<"u"){var Lt=new MessageChannel,fr=Lt.port2;Lt.port1.onmessage=Xt,Dt=function(){fr.postMessage(null)}}else Dt=function(){Pe(Xt,0)};function nr(Ze){Oe=Ze,Ue||(Ue=!0,Dt())}function Or(Ze,ft){Qe=Pe(function(){Ze(r.unstable_now())},ft)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Ze){Ze.callback=null},r.unstable_continueExecution=function(){ue||ke||(ue=!0,nr(De))},r.unstable_forceFrameRate=function(Ze){0>Ze||125<Ze?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_t=0<Ze?Math.floor(1e3/Ze):5},r.unstable_getCurrentPriorityLevel=function(){return U},r.unstable_getFirstCallbackNode=function(){return l(N)},r.unstable_next=function(Ze){switch(U){case 1:case 2:case 3:var ft=3;break;default:ft=U}var gt=U;U=ft;try{return Ze()}finally{U=gt}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(Ze,ft){switch(Ze){case 1:case 2:case 3:case 4:case 5:break;default:Ze=3}var gt=U;U=Ze;try{return ft()}finally{U=gt}},r.unstable_scheduleCallback=function(Ze,ft,gt){var wt=r.unstable_now();switch(typeof gt=="object"&&gt!==null?(gt=gt.delay,gt=typeof gt=="number"&&0<gt?wt+gt:wt):gt=wt,Ze){case 1:var Pt=-1;break;case 2:Pt=250;break;case 5:Pt=1073741823;break;case 4:Pt=1e4;break;default:Pt=5e3}return Pt=gt+Pt,Ze={id:te++,callback:ft,priorityLevel:Ze,startTime:gt,expirationTime:Pt,sortIndex:-1},gt>wt?(Ze.sortIndex=gt,s(Z,Ze),l(N)===null&&Ze===l(Z)&&(_e?(oe(Qe),Qe=-1):_e=!0,Or(Ce,gt-wt))):(Ze.sortIndex=Pt,s(N,Ze),ue||ke||(ue=!0,nr(De))),Ze},r.unstable_shouldYield=pt,r.unstable_wrapCallback=function(Ze){var ft=U;return function(){var gt=U;U=ft;try{return Ze.apply(this,arguments)}finally{U=gt}}}})(i0);n0.exports=i0;var U2=n0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $2=We,zi=U2;function Le(r){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+r,l=1;l<arguments.length;l++)s+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s0=new Set,Zc={};function Va(r,s){ru(r,s),ru(r+"Capture",s)}function ru(r,s){for(Zc[r]=s,r=0;r<s.length;r++)s0.add(s[r])}var Gs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),jm=Object.prototype.hasOwnProperty,q2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wx={},bx={};function Z2(r){return jm.call(bx,r)?!0:jm.call(wx,r)?!1:q2.test(r)?bx[r]=!0:(wx[r]=!0,!1)}function H2(r,s,l,p){if(l!==null&&l.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return p?!1:l!==null?!l.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function G2(r,s,l,p){if(s===null||typeof s>"u"||H2(r,s,l,p))return!0;if(p)return!1;if(l!==null)switch(l.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function Kn(r,s,l,p,_,T,v){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=p,this.attributeNamespace=_,this.mustUseProperty=l,this.propertyName=r,this.type=s,this.sanitizeURL=T,this.removeEmptyString=v}var bn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){bn[r]=new Kn(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var s=r[0];bn[s]=new Kn(s,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){bn[r]=new Kn(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){bn[r]=new Kn(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){bn[r]=new Kn(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){bn[r]=new Kn(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){bn[r]=new Kn(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){bn[r]=new Kn(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){bn[r]=new Kn(r,5,!1,r.toLowerCase(),null,!1,!1)});var jg=/[\-:]([a-z])/g;function Vg(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var s=r.replace(jg,Vg);bn[s]=new Kn(s,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var s=r.replace(jg,Vg);bn[s]=new Kn(s,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var s=r.replace(jg,Vg);bn[s]=new Kn(s,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){bn[r]=new Kn(r,1,!1,r.toLowerCase(),null,!1,!1)});bn.xlinkHref=new Kn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){bn[r]=new Kn(r,1,!1,r.toLowerCase(),null,!0,!0)});function Ug(r,s,l,p){var _=bn.hasOwnProperty(s)?bn[s]:null;(_!==null?_.type!==0:p||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(G2(s,l,_,p)&&(l=null),p||_===null?Z2(s)&&(l===null?r.removeAttribute(s):r.setAttribute(s,""+l)):_.mustUseProperty?r[_.propertyName]=l===null?_.type===3?!1:"":l:(s=_.attributeName,p=_.attributeNamespace,l===null?r.removeAttribute(s):(_=_.type,l=_===3||_===4&&l===!0?"":""+l,p?r.setAttributeNS(p,s,l):r.setAttribute(s,l))))}var Js=$2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,wd=Symbol.for("react.element"),Bl=Symbol.for("react.portal"),Nl=Symbol.for("react.fragment"),$g=Symbol.for("react.strict_mode"),Vm=Symbol.for("react.profiler"),o0=Symbol.for("react.provider"),a0=Symbol.for("react.context"),qg=Symbol.for("react.forward_ref"),Um=Symbol.for("react.suspense"),$m=Symbol.for("react.suspense_list"),Zg=Symbol.for("react.memo"),Ro=Symbol.for("react.lazy"),l0=Symbol.for("react.offscreen"),Sx=Symbol.iterator;function bc(r){return r===null||typeof r!="object"?null:(r=Sx&&r[Sx]||r["@@iterator"],typeof r=="function"?r:null)}var Lr=Object.assign,lm;function Mc(r){if(lm===void 0)try{throw Error()}catch(l){var s=l.stack.trim().match(/\n( *(at )?)/);lm=s&&s[1]||""}return`
`+lm+r}var um=!1;function cm(r,s){if(!r||um)return"";um=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(Z){var p=Z}Reflect.construct(r,[],s)}else{try{s.call()}catch(Z){p=Z}r.call(s.prototype)}else{try{throw Error()}catch(Z){p=Z}r()}}catch(Z){if(Z&&p&&typeof Z.stack=="string"){for(var _=Z.stack.split(`
`),T=p.stack.split(`
`),v=_.length-1,d=T.length-1;1<=v&&0<=d&&_[v]!==T[d];)d--;for(;1<=v&&0<=d;v--,d--)if(_[v]!==T[d]){if(v!==1||d!==1)do if(v--,d--,0>d||_[v]!==T[d]){var N=`
`+_[v].replace(" at new "," at ");return r.displayName&&N.includes("<anonymous>")&&(N=N.replace("<anonymous>",r.displayName)),N}while(1<=v&&0<=d);break}}}finally{um=!1,Error.prepareStackTrace=l}return(r=r?r.displayName||r.name:"")?Mc(r):""}function W2(r){switch(r.tag){case 5:return Mc(r.type);case 16:return Mc("Lazy");case 13:return Mc("Suspense");case 19:return Mc("SuspenseList");case 0:case 2:case 15:return r=cm(r.type,!1),r;case 11:return r=cm(r.type.render,!1),r;case 1:return r=cm(r.type,!0),r;default:return""}}function qm(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Nl:return"Fragment";case Bl:return"Portal";case Vm:return"Profiler";case $g:return"StrictMode";case Um:return"Suspense";case $m:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case a0:return(r.displayName||"Context")+".Consumer";case o0:return(r._context.displayName||"Context")+".Provider";case qg:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case Zg:return s=r.displayName||null,s!==null?s:qm(r.type)||"Memo";case Ro:s=r._payload,r=r._init;try{return qm(r(s))}catch{}}return null}function X2(r){var s=r.type;switch(r.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=s.render,r=r.displayName||r.name||"",s.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return qm(s);case 8:return s===$g?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function Go(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function u0(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function K2(r){var s=u0(r)?"checked":"value",l=Object.getOwnPropertyDescriptor(r.constructor.prototype,s),p=""+r[s];if(!r.hasOwnProperty(s)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var _=l.get,T=l.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return _.call(this)},set:function(v){p=""+v,T.call(this,v)}}),Object.defineProperty(r,s,{enumerable:l.enumerable}),{getValue:function(){return p},setValue:function(v){p=""+v},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function bd(r){r._valueTracker||(r._valueTracker=K2(r))}function c0(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var l=s.getValue(),p="";return r&&(p=u0(r)?r.checked?"true":"false":r.value),r=p,r!==l?(s.setValue(r),!0):!1}function Qd(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function Zm(r,s){var l=s.checked;return Lr({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??r._wrapperState.initialChecked})}function Tx(r,s){var l=s.defaultValue==null?"":s.defaultValue,p=s.checked!=null?s.checked:s.defaultChecked;l=Go(s.value!=null?s.value:l),r._wrapperState={initialChecked:p,initialValue:l,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function h0(r,s){s=s.checked,s!=null&&Ug(r,"checked",s,!1)}function Hm(r,s){h0(r,s);var l=Go(s.value),p=s.type;if(l!=null)p==="number"?(l===0&&r.value===""||r.value!=l)&&(r.value=""+l):r.value!==""+l&&(r.value=""+l);else if(p==="submit"||p==="reset"){r.removeAttribute("value");return}s.hasOwnProperty("value")?Gm(r,s.type,l):s.hasOwnProperty("defaultValue")&&Gm(r,s.type,Go(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(r.defaultChecked=!!s.defaultChecked)}function Ex(r,s,l){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var p=s.type;if(!(p!=="submit"&&p!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+r._wrapperState.initialValue,l||s===r.value||(r.value=s),r.defaultValue=s}l=r.name,l!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,l!==""&&(r.name=l)}function Gm(r,s,l){(s!=="number"||Qd(r.ownerDocument)!==r)&&(l==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+l&&(r.defaultValue=""+l))}var zc=Array.isArray;function Kl(r,s,l,p){if(r=r.options,s){s={};for(var _=0;_<l.length;_++)s["$"+l[_]]=!0;for(l=0;l<r.length;l++)_=s.hasOwnProperty("$"+r[l].value),r[l].selected!==_&&(r[l].selected=_),_&&p&&(r[l].defaultSelected=!0)}else{for(l=""+Go(l),s=null,_=0;_<r.length;_++){if(r[_].value===l){r[_].selected=!0,p&&(r[_].defaultSelected=!0);return}s!==null||r[_].disabled||(s=r[_])}s!==null&&(s.selected=!0)}}function Wm(r,s){if(s.dangerouslySetInnerHTML!=null)throw Error(Le(91));return Lr({},s,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function kx(r,s){var l=s.value;if(l==null){if(l=s.children,s=s.defaultValue,l!=null){if(s!=null)throw Error(Le(92));if(zc(l)){if(1<l.length)throw Error(Le(93));l=l[0]}s=l}s==null&&(s=""),l=s}r._wrapperState={initialValue:Go(l)}}function d0(r,s){var l=Go(s.value),p=Go(s.defaultValue);l!=null&&(l=""+l,l!==r.value&&(r.value=l),s.defaultValue==null&&r.defaultValue!==l&&(r.defaultValue=l)),p!=null&&(r.defaultValue=""+p)}function Ix(r){var s=r.textContent;s===r._wrapperState.initialValue&&s!==""&&s!==null&&(r.value=s)}function p0(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Xm(r,s){return r==null||r==="http://www.w3.org/1999/xhtml"?p0(s):r==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var Sd,f0=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,l,p,_){MSApp.execUnsafeLocalFunction(function(){return r(s,l,p,_)})}:r}(function(r,s){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=s;else{for(Sd=Sd||document.createElement("div"),Sd.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=Sd.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;s.firstChild;)r.appendChild(s.firstChild)}});function Hc(r,s){if(s){var l=r.firstChild;if(l&&l===r.lastChild&&l.nodeType===3){l.nodeValue=s;return}}r.textContent=s}var Lc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},J2=["Webkit","ms","Moz","O"];Object.keys(Lc).forEach(function(r){J2.forEach(function(s){s=s+r.charAt(0).toUpperCase()+r.substring(1),Lc[s]=Lc[r]})});function m0(r,s,l){return s==null||typeof s=="boolean"||s===""?"":l||typeof s!="number"||s===0||Lc.hasOwnProperty(r)&&Lc[r]?(""+s).trim():s+"px"}function g0(r,s){r=r.style;for(var l in s)if(s.hasOwnProperty(l)){var p=l.indexOf("--")===0,_=m0(l,s[l],p);l==="float"&&(l="cssFloat"),p?r.setProperty(l,_):r[l]=_}}var Y2=Lr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Km(r,s){if(s){if(Y2[r]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(Le(137,r));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(Le(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(Le(61))}if(s.style!=null&&typeof s.style!="object")throw Error(Le(62))}}function Jm(r,s){if(r.indexOf("-")===-1)return typeof s.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ym=null;function Hg(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Qm=null,Jl=null,Yl=null;function Cx(r){if(r=hh(r)){if(typeof Qm!="function")throw Error(Le(280));var s=r.stateNode;s&&(s=Pp(s),Qm(r.stateNode,r.type,s))}}function y0(r){Jl?Yl?Yl.push(r):Yl=[r]:Jl=r}function _0(){if(Jl){var r=Jl,s=Yl;if(Yl=Jl=null,Cx(r),s)for(r=0;r<s.length;r++)Cx(s[r])}}function x0(r,s){return r(s)}function v0(){}var hm=!1;function w0(r,s,l){if(hm)return r(s,l);hm=!0;try{return x0(r,s,l)}finally{hm=!1,(Jl!==null||Yl!==null)&&(v0(),_0())}}function Gc(r,s){var l=r.stateNode;if(l===null)return null;var p=Pp(l);if(p===null)return null;l=p[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(r=r.type,p=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!p;break e;default:r=!1}if(r)return null;if(l&&typeof l!="function")throw Error(Le(231,s,typeof l));return l}var eg=!1;if(Gs)try{var Sc={};Object.defineProperty(Sc,"passive",{get:function(){eg=!0}}),window.addEventListener("test",Sc,Sc),window.removeEventListener("test",Sc,Sc)}catch{eg=!1}function Q2(r,s,l,p,_,T,v,d,N){var Z=Array.prototype.slice.call(arguments,3);try{s.apply(l,Z)}catch(te){this.onError(te)}}var Fc=!1,ep=null,tp=!1,tg=null,eS={onError:function(r){Fc=!0,ep=r}};function tS(r,s,l,p,_,T,v,d,N){Fc=!1,ep=null,Q2.apply(eS,arguments)}function rS(r,s,l,p,_,T,v,d,N){if(tS.apply(this,arguments),Fc){if(Fc){var Z=ep;Fc=!1,ep=null}else throw Error(Le(198));tp||(tp=!0,tg=Z)}}function Ua(r){var s=r,l=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,s.flags&4098&&(l=s.return),r=s.return;while(r)}return s.tag===3?l:null}function b0(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function Px(r){if(Ua(r)!==r)throw Error(Le(188))}function nS(r){var s=r.alternate;if(!s){if(s=Ua(r),s===null)throw Error(Le(188));return s!==r?null:r}for(var l=r,p=s;;){var _=l.return;if(_===null)break;var T=_.alternate;if(T===null){if(p=_.return,p!==null){l=p;continue}break}if(_.child===T.child){for(T=_.child;T;){if(T===l)return Px(_),r;if(T===p)return Px(_),s;T=T.sibling}throw Error(Le(188))}if(l.return!==p.return)l=_,p=T;else{for(var v=!1,d=_.child;d;){if(d===l){v=!0,l=_,p=T;break}if(d===p){v=!0,p=_,l=T;break}d=d.sibling}if(!v){for(d=T.child;d;){if(d===l){v=!0,l=T,p=_;break}if(d===p){v=!0,p=T,l=_;break}d=d.sibling}if(!v)throw Error(Le(189))}}if(l.alternate!==p)throw Error(Le(190))}if(l.tag!==3)throw Error(Le(188));return l.stateNode.current===l?r:s}function S0(r){return r=nS(r),r!==null?T0(r):null}function T0(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var s=T0(r);if(s!==null)return s;r=r.sibling}return null}var E0=zi.unstable_scheduleCallback,Ax=zi.unstable_cancelCallback,iS=zi.unstable_shouldYield,sS=zi.unstable_requestPaint,Zr=zi.unstable_now,oS=zi.unstable_getCurrentPriorityLevel,Gg=zi.unstable_ImmediatePriority,k0=zi.unstable_UserBlockingPriority,rp=zi.unstable_NormalPriority,aS=zi.unstable_LowPriority,I0=zi.unstable_IdlePriority,Ep=null,bs=null;function lS(r){if(bs&&typeof bs.onCommitFiberRoot=="function")try{bs.onCommitFiberRoot(Ep,r,void 0,(r.current.flags&128)===128)}catch{}}var ss=Math.clz32?Math.clz32:hS,uS=Math.log,cS=Math.LN2;function hS(r){return r>>>=0,r===0?32:31-(uS(r)/cS|0)|0}var Td=64,Ed=4194304;function Rc(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function np(r,s){var l=r.pendingLanes;if(l===0)return 0;var p=0,_=r.suspendedLanes,T=r.pingedLanes,v=l&268435455;if(v!==0){var d=v&~_;d!==0?p=Rc(d):(T&=v,T!==0&&(p=Rc(T)))}else v=l&~_,v!==0?p=Rc(v):T!==0&&(p=Rc(T));if(p===0)return 0;if(s!==0&&s!==p&&!(s&_)&&(_=p&-p,T=s&-s,_>=T||_===16&&(T&4194240)!==0))return s;if(p&4&&(p|=l&16),s=r.entangledLanes,s!==0)for(r=r.entanglements,s&=p;0<s;)l=31-ss(s),_=1<<l,p|=r[l],s&=~_;return p}function dS(r,s){switch(r){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function pS(r,s){for(var l=r.suspendedLanes,p=r.pingedLanes,_=r.expirationTimes,T=r.pendingLanes;0<T;){var v=31-ss(T),d=1<<v,N=_[v];N===-1?(!(d&l)||d&p)&&(_[v]=dS(d,s)):N<=s&&(r.expiredLanes|=d),T&=~d}}function rg(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function C0(){var r=Td;return Td<<=1,!(Td&4194240)&&(Td=64),r}function dm(r){for(var s=[],l=0;31>l;l++)s.push(r);return s}function uh(r,s,l){r.pendingLanes|=s,s!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,s=31-ss(s),r[s]=l}function fS(r,s){var l=r.pendingLanes&~s;r.pendingLanes=s,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=s,r.mutableReadLanes&=s,r.entangledLanes&=s,s=r.entanglements;var p=r.eventTimes;for(r=r.expirationTimes;0<l;){var _=31-ss(l),T=1<<_;s[_]=0,p[_]=-1,r[_]=-1,l&=~T}}function Wg(r,s){var l=r.entangledLanes|=s;for(r=r.entanglements;l;){var p=31-ss(l),_=1<<p;_&s|r[p]&s&&(r[p]|=s),l&=~_}}var or=0;function P0(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var A0,Xg,M0,z0,R0,ng=!1,kd=[],No=null,jo=null,Vo=null,Wc=new Map,Xc=new Map,Lo=[],mS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Mx(r,s){switch(r){case"focusin":case"focusout":No=null;break;case"dragenter":case"dragleave":jo=null;break;case"mouseover":case"mouseout":Vo=null;break;case"pointerover":case"pointerout":Wc.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xc.delete(s.pointerId)}}function Tc(r,s,l,p,_,T){return r===null||r.nativeEvent!==T?(r={blockedOn:s,domEventName:l,eventSystemFlags:p,nativeEvent:T,targetContainers:[_]},s!==null&&(s=hh(s),s!==null&&Xg(s)),r):(r.eventSystemFlags|=p,s=r.targetContainers,_!==null&&s.indexOf(_)===-1&&s.push(_),r)}function gS(r,s,l,p,_){switch(s){case"focusin":return No=Tc(No,r,s,l,p,_),!0;case"dragenter":return jo=Tc(jo,r,s,l,p,_),!0;case"mouseover":return Vo=Tc(Vo,r,s,l,p,_),!0;case"pointerover":var T=_.pointerId;return Wc.set(T,Tc(Wc.get(T)||null,r,s,l,p,_)),!0;case"gotpointercapture":return T=_.pointerId,Xc.set(T,Tc(Xc.get(T)||null,r,s,l,p,_)),!0}return!1}function D0(r){var s=Ca(r.target);if(s!==null){var l=Ua(s);if(l!==null){if(s=l.tag,s===13){if(s=b0(l),s!==null){r.blockedOn=s,R0(r.priority,function(){M0(l)});return}}else if(s===3&&l.stateNode.current.memoizedState.isDehydrated){r.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}r.blockedOn=null}function jd(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var l=ig(r.domEventName,r.eventSystemFlags,s[0],r.nativeEvent);if(l===null){l=r.nativeEvent;var p=new l.constructor(l.type,l);Ym=p,l.target.dispatchEvent(p),Ym=null}else return s=hh(l),s!==null&&Xg(s),r.blockedOn=l,!1;s.shift()}return!0}function zx(r,s,l){jd(r)&&l.delete(s)}function yS(){ng=!1,No!==null&&jd(No)&&(No=null),jo!==null&&jd(jo)&&(jo=null),Vo!==null&&jd(Vo)&&(Vo=null),Wc.forEach(zx),Xc.forEach(zx)}function Ec(r,s){r.blockedOn===s&&(r.blockedOn=null,ng||(ng=!0,zi.unstable_scheduleCallback(zi.unstable_NormalPriority,yS)))}function Kc(r){function s(_){return Ec(_,r)}if(0<kd.length){Ec(kd[0],r);for(var l=1;l<kd.length;l++){var p=kd[l];p.blockedOn===r&&(p.blockedOn=null)}}for(No!==null&&Ec(No,r),jo!==null&&Ec(jo,r),Vo!==null&&Ec(Vo,r),Wc.forEach(s),Xc.forEach(s),l=0;l<Lo.length;l++)p=Lo[l],p.blockedOn===r&&(p.blockedOn=null);for(;0<Lo.length&&(l=Lo[0],l.blockedOn===null);)D0(l),l.blockedOn===null&&Lo.shift()}var Ql=Js.ReactCurrentBatchConfig,ip=!0;function _S(r,s,l,p){var _=or,T=Ql.transition;Ql.transition=null;try{or=1,Kg(r,s,l,p)}finally{or=_,Ql.transition=T}}function xS(r,s,l,p){var _=or,T=Ql.transition;Ql.transition=null;try{or=4,Kg(r,s,l,p)}finally{or=_,Ql.transition=T}}function Kg(r,s,l,p){if(ip){var _=ig(r,s,l,p);if(_===null)bm(r,s,p,sp,l),Mx(r,p);else if(gS(_,r,s,l,p))p.stopPropagation();else if(Mx(r,p),s&4&&-1<mS.indexOf(r)){for(;_!==null;){var T=hh(_);if(T!==null&&A0(T),T=ig(r,s,l,p),T===null&&bm(r,s,p,sp,l),T===_)break;_=T}_!==null&&p.stopPropagation()}else bm(r,s,p,null,l)}}var sp=null;function ig(r,s,l,p){if(sp=null,r=Hg(p),r=Ca(r),r!==null)if(s=Ua(r),s===null)r=null;else if(l=s.tag,l===13){if(r=b0(s),r!==null)return r;r=null}else if(l===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null);return sp=r,null}function L0(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(oS()){case Gg:return 1;case k0:return 4;case rp:case aS:return 16;case I0:return 536870912;default:return 16}default:return 16}}var Oo=null,Jg=null,Vd=null;function F0(){if(Vd)return Vd;var r,s=Jg,l=s.length,p,_="value"in Oo?Oo.value:Oo.textContent,T=_.length;for(r=0;r<l&&s[r]===_[r];r++);var v=l-r;for(p=1;p<=v&&s[l-p]===_[T-p];p++);return Vd=_.slice(r,1<p?1-p:void 0)}function Ud(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function Id(){return!0}function Rx(){return!1}function Di(r){function s(l,p,_,T,v){this._reactName=l,this._targetInst=_,this.type=p,this.nativeEvent=T,this.target=v,this.currentTarget=null;for(var d in r)r.hasOwnProperty(d)&&(l=r[d],this[d]=l?l(T):T[d]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?Id:Rx,this.isPropagationStopped=Rx,this}return Lr(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Id)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Id)},persist:function(){},isPersistent:Id}),s}var hu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Yg=Di(hu),ch=Lr({},hu,{view:0,detail:0}),vS=Di(ch),pm,fm,kc,kp=Lr({},ch,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Qg,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==kc&&(kc&&r.type==="mousemove"?(pm=r.screenX-kc.screenX,fm=r.screenY-kc.screenY):fm=pm=0,kc=r),pm)},movementY:function(r){return"movementY"in r?r.movementY:fm}}),Dx=Di(kp),wS=Lr({},kp,{dataTransfer:0}),bS=Di(wS),SS=Lr({},ch,{relatedTarget:0}),mm=Di(SS),TS=Lr({},hu,{animationName:0,elapsedTime:0,pseudoElement:0}),ES=Di(TS),kS=Lr({},hu,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),IS=Di(kS),CS=Lr({},hu,{data:0}),Lx=Di(CS),PS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},AS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},MS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zS(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=MS[r])?!!s[r]:!1}function Qg(){return zS}var RS=Lr({},ch,{key:function(r){if(r.key){var s=PS[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=Ud(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?AS[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Qg,charCode:function(r){return r.type==="keypress"?Ud(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Ud(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),DS=Di(RS),LS=Lr({},kp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fx=Di(LS),FS=Lr({},ch,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Qg}),OS=Di(FS),BS=Lr({},hu,{propertyName:0,elapsedTime:0,pseudoElement:0}),NS=Di(BS),jS=Lr({},kp,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),VS=Di(jS),US=[9,13,27,32],ey=Gs&&"CompositionEvent"in window,Oc=null;Gs&&"documentMode"in document&&(Oc=document.documentMode);var $S=Gs&&"TextEvent"in window&&!Oc,O0=Gs&&(!ey||Oc&&8<Oc&&11>=Oc),Ox=" ",Bx=!1;function B0(r,s){switch(r){case"keyup":return US.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function N0(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var jl=!1;function qS(r,s){switch(r){case"compositionend":return N0(s);case"keypress":return s.which!==32?null:(Bx=!0,Ox);case"textInput":return r=s.data,r===Ox&&Bx?null:r;default:return null}}function ZS(r,s){if(jl)return r==="compositionend"||!ey&&B0(r,s)?(r=F0(),Vd=Jg=Oo=null,jl=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return O0&&s.locale!=="ko"?null:s.data;default:return null}}var HS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Nx(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!HS[r.type]:s==="textarea"}function j0(r,s,l,p){y0(p),s=op(s,"onChange"),0<s.length&&(l=new Yg("onChange","change",null,l,p),r.push({event:l,listeners:s}))}var Bc=null,Jc=null;function GS(r){J0(r,0)}function Ip(r){var s=$l(r);if(c0(s))return r}function WS(r,s){if(r==="change")return s}var V0=!1;if(Gs){var gm;if(Gs){var ym="oninput"in document;if(!ym){var jx=document.createElement("div");jx.setAttribute("oninput","return;"),ym=typeof jx.oninput=="function"}gm=ym}else gm=!1;V0=gm&&(!document.documentMode||9<document.documentMode)}function Vx(){Bc&&(Bc.detachEvent("onpropertychange",U0),Jc=Bc=null)}function U0(r){if(r.propertyName==="value"&&Ip(Jc)){var s=[];j0(s,Jc,r,Hg(r)),w0(GS,s)}}function XS(r,s,l){r==="focusin"?(Vx(),Bc=s,Jc=l,Bc.attachEvent("onpropertychange",U0)):r==="focusout"&&Vx()}function KS(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Ip(Jc)}function JS(r,s){if(r==="click")return Ip(s)}function YS(r,s){if(r==="input"||r==="change")return Ip(s)}function QS(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var as=typeof Object.is=="function"?Object.is:QS;function Yc(r,s){if(as(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var l=Object.keys(r),p=Object.keys(s);if(l.length!==p.length)return!1;for(p=0;p<l.length;p++){var _=l[p];if(!jm.call(s,_)||!as(r[_],s[_]))return!1}return!0}function Ux(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function $x(r,s){var l=Ux(r);r=0;for(var p;l;){if(l.nodeType===3){if(p=r+l.textContent.length,r<=s&&p>=s)return{node:l,offset:s-r};r=p}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Ux(l)}}function $0(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?$0(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function q0(){for(var r=window,s=Qd();s instanceof r.HTMLIFrameElement;){try{var l=typeof s.contentWindow.location.href=="string"}catch{l=!1}if(l)r=s.contentWindow;else break;s=Qd(r.document)}return s}function ty(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}function eT(r){var s=q0(),l=r.focusedElem,p=r.selectionRange;if(s!==l&&l&&l.ownerDocument&&$0(l.ownerDocument.documentElement,l)){if(p!==null&&ty(l)){if(s=p.start,r=p.end,r===void 0&&(r=s),"selectionStart"in l)l.selectionStart=s,l.selectionEnd=Math.min(r,l.value.length);else if(r=(s=l.ownerDocument||document)&&s.defaultView||window,r.getSelection){r=r.getSelection();var _=l.textContent.length,T=Math.min(p.start,_);p=p.end===void 0?T:Math.min(p.end,_),!r.extend&&T>p&&(_=p,p=T,T=_),_=$x(l,T);var v=$x(l,p);_&&v&&(r.rangeCount!==1||r.anchorNode!==_.node||r.anchorOffset!==_.offset||r.focusNode!==v.node||r.focusOffset!==v.offset)&&(s=s.createRange(),s.setStart(_.node,_.offset),r.removeAllRanges(),T>p?(r.addRange(s),r.extend(v.node,v.offset)):(s.setEnd(v.node,v.offset),r.addRange(s)))}}for(s=[],r=l;r=r.parentNode;)r.nodeType===1&&s.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<s.length;l++)r=s[l],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var tT=Gs&&"documentMode"in document&&11>=document.documentMode,Vl=null,sg=null,Nc=null,og=!1;function qx(r,s,l){var p=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;og||Vl==null||Vl!==Qd(p)||(p=Vl,"selectionStart"in p&&ty(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Nc&&Yc(Nc,p)||(Nc=p,p=op(sg,"onSelect"),0<p.length&&(s=new Yg("onSelect","select",null,s,l),r.push({event:s,listeners:p}),s.target=Vl)))}function Cd(r,s){var l={};return l[r.toLowerCase()]=s.toLowerCase(),l["Webkit"+r]="webkit"+s,l["Moz"+r]="moz"+s,l}var Ul={animationend:Cd("Animation","AnimationEnd"),animationiteration:Cd("Animation","AnimationIteration"),animationstart:Cd("Animation","AnimationStart"),transitionend:Cd("Transition","TransitionEnd")},_m={},Z0={};Gs&&(Z0=document.createElement("div").style,"AnimationEvent"in window||(delete Ul.animationend.animation,delete Ul.animationiteration.animation,delete Ul.animationstart.animation),"TransitionEvent"in window||delete Ul.transitionend.transition);function Cp(r){if(_m[r])return _m[r];if(!Ul[r])return r;var s=Ul[r],l;for(l in s)if(s.hasOwnProperty(l)&&l in Z0)return _m[r]=s[l];return r}var H0=Cp("animationend"),G0=Cp("animationiteration"),W0=Cp("animationstart"),X0=Cp("transitionend"),K0=new Map,Zx="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Xo(r,s){K0.set(r,s),Va(s,[r])}for(var xm=0;xm<Zx.length;xm++){var vm=Zx[xm],rT=vm.toLowerCase(),nT=vm[0].toUpperCase()+vm.slice(1);Xo(rT,"on"+nT)}Xo(H0,"onAnimationEnd");Xo(G0,"onAnimationIteration");Xo(W0,"onAnimationStart");Xo("dblclick","onDoubleClick");Xo("focusin","onFocus");Xo("focusout","onBlur");Xo(X0,"onTransitionEnd");ru("onMouseEnter",["mouseout","mouseover"]);ru("onMouseLeave",["mouseout","mouseover"]);ru("onPointerEnter",["pointerout","pointerover"]);ru("onPointerLeave",["pointerout","pointerover"]);Va("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Va("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Va("onBeforeInput",["compositionend","keypress","textInput","paste"]);Va("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Va("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Va("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),iT=new Set("cancel close invalid load scroll toggle".split(" ").concat(Dc));function Hx(r,s,l){var p=r.type||"unknown-event";r.currentTarget=l,rS(p,s,void 0,r),r.currentTarget=null}function J0(r,s){s=(s&4)!==0;for(var l=0;l<r.length;l++){var p=r[l],_=p.event;p=p.listeners;e:{var T=void 0;if(s)for(var v=p.length-1;0<=v;v--){var d=p[v],N=d.instance,Z=d.currentTarget;if(d=d.listener,N!==T&&_.isPropagationStopped())break e;Hx(_,d,Z),T=N}else for(v=0;v<p.length;v++){if(d=p[v],N=d.instance,Z=d.currentTarget,d=d.listener,N!==T&&_.isPropagationStopped())break e;Hx(_,d,Z),T=N}}}if(tp)throw r=tg,tp=!1,tg=null,r}function br(r,s){var l=s[hg];l===void 0&&(l=s[hg]=new Set);var p=r+"__bubble";l.has(p)||(Y0(s,r,2,!1),l.add(p))}function wm(r,s,l){var p=0;s&&(p|=4),Y0(l,r,p,s)}var Pd="_reactListening"+Math.random().toString(36).slice(2);function Qc(r){if(!r[Pd]){r[Pd]=!0,s0.forEach(function(l){l!=="selectionchange"&&(iT.has(l)||wm(l,!1,r),wm(l,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[Pd]||(s[Pd]=!0,wm("selectionchange",!1,s))}}function Y0(r,s,l,p){switch(L0(s)){case 1:var _=_S;break;case 4:_=xS;break;default:_=Kg}l=_.bind(null,s,l,r),_=void 0,!eg||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(_=!0),p?_!==void 0?r.addEventListener(s,l,{capture:!0,passive:_}):r.addEventListener(s,l,!0):_!==void 0?r.addEventListener(s,l,{passive:_}):r.addEventListener(s,l,!1)}function bm(r,s,l,p,_){var T=p;if(!(s&1)&&!(s&2)&&p!==null)e:for(;;){if(p===null)return;var v=p.tag;if(v===3||v===4){var d=p.stateNode.containerInfo;if(d===_||d.nodeType===8&&d.parentNode===_)break;if(v===4)for(v=p.return;v!==null;){var N=v.tag;if((N===3||N===4)&&(N=v.stateNode.containerInfo,N===_||N.nodeType===8&&N.parentNode===_))return;v=v.return}for(;d!==null;){if(v=Ca(d),v===null)return;if(N=v.tag,N===5||N===6){p=T=v;continue e}d=d.parentNode}}p=p.return}w0(function(){var Z=T,te=Hg(l),q=[];e:{var U=K0.get(r);if(U!==void 0){var ke=Yg,ue=r;switch(r){case"keypress":if(Ud(l)===0)break e;case"keydown":case"keyup":ke=DS;break;case"focusin":ue="focus",ke=mm;break;case"focusout":ue="blur",ke=mm;break;case"beforeblur":case"afterblur":ke=mm;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ke=Dx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ke=bS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ke=OS;break;case H0:case G0:case W0:ke=ES;break;case X0:ke=NS;break;case"scroll":ke=vS;break;case"wheel":ke=VS;break;case"copy":case"cut":case"paste":ke=IS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ke=Fx}var _e=(s&4)!==0,Pe=!_e&&r==="scroll",oe=_e?U!==null?U+"Capture":null:U;_e=[];for(var re=Z,ce;re!==null;){ce=re;var Ce=ce.stateNode;if(ce.tag===5&&Ce!==null&&(ce=Ce,oe!==null&&(Ce=Gc(re,oe),Ce!=null&&_e.push(eh(re,Ce,ce)))),Pe)break;re=re.return}0<_e.length&&(U=new ke(U,ue,null,l,te),q.push({event:U,listeners:_e}))}}if(!(s&7)){e:{if(U=r==="mouseover"||r==="pointerover",ke=r==="mouseout"||r==="pointerout",U&&l!==Ym&&(ue=l.relatedTarget||l.fromElement)&&(Ca(ue)||ue[Ws]))break e;if((ke||U)&&(U=te.window===te?te:(U=te.ownerDocument)?U.defaultView||U.parentWindow:window,ke?(ue=l.relatedTarget||l.toElement,ke=Z,ue=ue?Ca(ue):null,ue!==null&&(Pe=Ua(ue),ue!==Pe||ue.tag!==5&&ue.tag!==6)&&(ue=null)):(ke=null,ue=Z),ke!==ue)){if(_e=Dx,Ce="onMouseLeave",oe="onMouseEnter",re="mouse",(r==="pointerout"||r==="pointerover")&&(_e=Fx,Ce="onPointerLeave",oe="onPointerEnter",re="pointer"),Pe=ke==null?U:$l(ke),ce=ue==null?U:$l(ue),U=new _e(Ce,re+"leave",ke,l,te),U.target=Pe,U.relatedTarget=ce,Ce=null,Ca(te)===Z&&(_e=new _e(oe,re+"enter",ue,l,te),_e.target=ce,_e.relatedTarget=Pe,Ce=_e),Pe=Ce,ke&&ue)t:{for(_e=ke,oe=ue,re=0,ce=_e;ce;ce=Ol(ce))re++;for(ce=0,Ce=oe;Ce;Ce=Ol(Ce))ce++;for(;0<re-ce;)_e=Ol(_e),re--;for(;0<ce-re;)oe=Ol(oe),ce--;for(;re--;){if(_e===oe||oe!==null&&_e===oe.alternate)break t;_e=Ol(_e),oe=Ol(oe)}_e=null}else _e=null;ke!==null&&Gx(q,U,ke,_e,!1),ue!==null&&Pe!==null&&Gx(q,Pe,ue,_e,!0)}}e:{if(U=Z?$l(Z):window,ke=U.nodeName&&U.nodeName.toLowerCase(),ke==="select"||ke==="input"&&U.type==="file")var De=WS;else if(Nx(U))if(V0)De=YS;else{De=KS;var Ue=XS}else(ke=U.nodeName)&&ke.toLowerCase()==="input"&&(U.type==="checkbox"||U.type==="radio")&&(De=JS);if(De&&(De=De(r,Z))){j0(q,De,l,te);break e}Ue&&Ue(r,U,Z),r==="focusout"&&(Ue=U._wrapperState)&&Ue.controlled&&U.type==="number"&&Gm(U,"number",U.value)}switch(Ue=Z?$l(Z):window,r){case"focusin":(Nx(Ue)||Ue.contentEditable==="true")&&(Vl=Ue,sg=Z,Nc=null);break;case"focusout":Nc=sg=Vl=null;break;case"mousedown":og=!0;break;case"contextmenu":case"mouseup":case"dragend":og=!1,qx(q,l,te);break;case"selectionchange":if(tT)break;case"keydown":case"keyup":qx(q,l,te)}var Oe;if(ey)e:{switch(r){case"compositionstart":var Qe="onCompositionStart";break e;case"compositionend":Qe="onCompositionEnd";break e;case"compositionupdate":Qe="onCompositionUpdate";break e}Qe=void 0}else jl?B0(r,l)&&(Qe="onCompositionEnd"):r==="keydown"&&l.keyCode===229&&(Qe="onCompositionStart");Qe&&(O0&&l.locale!=="ko"&&(jl||Qe!=="onCompositionStart"?Qe==="onCompositionEnd"&&jl&&(Oe=F0()):(Oo=te,Jg="value"in Oo?Oo.value:Oo.textContent,jl=!0)),Ue=op(Z,Qe),0<Ue.length&&(Qe=new Lx(Qe,r,null,l,te),q.push({event:Qe,listeners:Ue}),Oe?Qe.data=Oe:(Oe=N0(l),Oe!==null&&(Qe.data=Oe)))),(Oe=$S?qS(r,l):ZS(r,l))&&(Z=op(Z,"onBeforeInput"),0<Z.length&&(te=new Lx("onBeforeInput","beforeinput",null,l,te),q.push({event:te,listeners:Z}),te.data=Oe))}J0(q,s)})}function eh(r,s,l){return{instance:r,listener:s,currentTarget:l}}function op(r,s){for(var l=s+"Capture",p=[];r!==null;){var _=r,T=_.stateNode;_.tag===5&&T!==null&&(_=T,T=Gc(r,l),T!=null&&p.unshift(eh(r,T,_)),T=Gc(r,s),T!=null&&p.push(eh(r,T,_))),r=r.return}return p}function Ol(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function Gx(r,s,l,p,_){for(var T=s._reactName,v=[];l!==null&&l!==p;){var d=l,N=d.alternate,Z=d.stateNode;if(N!==null&&N===p)break;d.tag===5&&Z!==null&&(d=Z,_?(N=Gc(l,T),N!=null&&v.unshift(eh(l,N,d))):_||(N=Gc(l,T),N!=null&&v.push(eh(l,N,d)))),l=l.return}v.length!==0&&r.push({event:s,listeners:v})}var sT=/\r\n?/g,oT=/\u0000|\uFFFD/g;function Wx(r){return(typeof r=="string"?r:""+r).replace(sT,`
`).replace(oT,"")}function Ad(r,s,l){if(s=Wx(s),Wx(r)!==s&&l)throw Error(Le(425))}function ap(){}var ag=null,lg=null;function ug(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var cg=typeof setTimeout=="function"?setTimeout:void 0,aT=typeof clearTimeout=="function"?clearTimeout:void 0,Xx=typeof Promise=="function"?Promise:void 0,lT=typeof queueMicrotask=="function"?queueMicrotask:typeof Xx<"u"?function(r){return Xx.resolve(null).then(r).catch(uT)}:cg;function uT(r){setTimeout(function(){throw r})}function Sm(r,s){var l=s,p=0;do{var _=l.nextSibling;if(r.removeChild(l),_&&_.nodeType===8)if(l=_.data,l==="/$"){if(p===0){r.removeChild(_),Kc(s);return}p--}else l!=="$"&&l!=="$?"&&l!=="$!"||p++;l=_}while(l);Kc(s)}function Uo(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return r}function Kx(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var l=r.data;if(l==="$"||l==="$!"||l==="$?"){if(s===0)return r;s--}else l==="/$"&&s++}r=r.previousSibling}return null}var du=Math.random().toString(36).slice(2),ws="__reactFiber$"+du,th="__reactProps$"+du,Ws="__reactContainer$"+du,hg="__reactEvents$"+du,cT="__reactListeners$"+du,hT="__reactHandles$"+du;function Ca(r){var s=r[ws];if(s)return s;for(var l=r.parentNode;l;){if(s=l[Ws]||l[ws]){if(l=s.alternate,s.child!==null||l!==null&&l.child!==null)for(r=Kx(r);r!==null;){if(l=r[ws])return l;r=Kx(r)}return s}r=l,l=r.parentNode}return null}function hh(r){return r=r[ws]||r[Ws],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function $l(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(Le(33))}function Pp(r){return r[th]||null}var dg=[],ql=-1;function Ko(r){return{current:r}}function Sr(r){0>ql||(r.current=dg[ql],dg[ql]=null,ql--)}function xr(r,s){ql++,dg[ql]=r.current,r.current=s}var Wo={},On=Ko(Wo),ci=Ko(!1),La=Wo;function nu(r,s){var l=r.type.contextTypes;if(!l)return Wo;var p=r.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===s)return p.__reactInternalMemoizedMaskedChildContext;var _={},T;for(T in l)_[T]=s[T];return p&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=s,r.__reactInternalMemoizedMaskedChildContext=_),_}function hi(r){return r=r.childContextTypes,r!=null}function lp(){Sr(ci),Sr(On)}function Jx(r,s,l){if(On.current!==Wo)throw Error(Le(168));xr(On,s),xr(ci,l)}function Q0(r,s,l){var p=r.stateNode;if(s=s.childContextTypes,typeof p.getChildContext!="function")return l;p=p.getChildContext();for(var _ in p)if(!(_ in s))throw Error(Le(108,X2(r)||"Unknown",_));return Lr({},l,p)}function up(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Wo,La=On.current,xr(On,r),xr(ci,ci.current),!0}function Yx(r,s,l){var p=r.stateNode;if(!p)throw Error(Le(169));l?(r=Q0(r,s,La),p.__reactInternalMemoizedMergedChildContext=r,Sr(ci),Sr(On),xr(On,r)):Sr(ci),xr(ci,l)}var $s=null,Ap=!1,Tm=!1;function e1(r){$s===null?$s=[r]:$s.push(r)}function dT(r){Ap=!0,e1(r)}function Jo(){if(!Tm&&$s!==null){Tm=!0;var r=0,s=or;try{var l=$s;for(or=1;r<l.length;r++){var p=l[r];do p=p(!0);while(p!==null)}$s=null,Ap=!1}catch(_){throw $s!==null&&($s=$s.slice(r+1)),E0(Gg,Jo),_}finally{or=s,Tm=!1}}return null}var Zl=[],Hl=0,cp=null,hp=0,Ui=[],$i=0,Fa=null,qs=1,Zs="";function ka(r,s){Zl[Hl++]=hp,Zl[Hl++]=cp,cp=r,hp=s}function t1(r,s,l){Ui[$i++]=qs,Ui[$i++]=Zs,Ui[$i++]=Fa,Fa=r;var p=qs;r=Zs;var _=32-ss(p)-1;p&=~(1<<_),l+=1;var T=32-ss(s)+_;if(30<T){var v=_-_%5;T=(p&(1<<v)-1).toString(32),p>>=v,_-=v,qs=1<<32-ss(s)+_|l<<_|p,Zs=T+r}else qs=1<<T|l<<_|p,Zs=r}function ry(r){r.return!==null&&(ka(r,1),t1(r,1,0))}function ny(r){for(;r===cp;)cp=Zl[--Hl],Zl[Hl]=null,hp=Zl[--Hl],Zl[Hl]=null;for(;r===Fa;)Fa=Ui[--$i],Ui[$i]=null,Zs=Ui[--$i],Ui[$i]=null,qs=Ui[--$i],Ui[$i]=null}var Mi=null,Ai=null,Ir=!1,is=null;function r1(r,s){var l=qi(5,null,null,0);l.elementType="DELETED",l.stateNode=s,l.return=r,s=r.deletions,s===null?(r.deletions=[l],r.flags|=16):s.push(l)}function Qx(r,s){switch(r.tag){case 5:var l=r.type;return s=s.nodeType!==1||l.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(r.stateNode=s,Mi=r,Ai=Uo(s.firstChild),!0):!1;case 6:return s=r.pendingProps===""||s.nodeType!==3?null:s,s!==null?(r.stateNode=s,Mi=r,Ai=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(l=Fa!==null?{id:qs,overflow:Zs}:null,r.memoizedState={dehydrated:s,treeContext:l,retryLane:1073741824},l=qi(18,null,null,0),l.stateNode=s,l.return=r,r.child=l,Mi=r,Ai=null,!0):!1;default:return!1}}function pg(r){return(r.mode&1)!==0&&(r.flags&128)===0}function fg(r){if(Ir){var s=Ai;if(s){var l=s;if(!Qx(r,s)){if(pg(r))throw Error(Le(418));s=Uo(l.nextSibling);var p=Mi;s&&Qx(r,s)?r1(p,l):(r.flags=r.flags&-4097|2,Ir=!1,Mi=r)}}else{if(pg(r))throw Error(Le(418));r.flags=r.flags&-4097|2,Ir=!1,Mi=r}}}function ev(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Mi=r}function Md(r){if(r!==Mi)return!1;if(!Ir)return ev(r),Ir=!0,!1;var s;if((s=r.tag!==3)&&!(s=r.tag!==5)&&(s=r.type,s=s!=="head"&&s!=="body"&&!ug(r.type,r.memoizedProps)),s&&(s=Ai)){if(pg(r))throw n1(),Error(Le(418));for(;s;)r1(r,s),s=Uo(s.nextSibling)}if(ev(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Le(317));e:{for(r=r.nextSibling,s=0;r;){if(r.nodeType===8){var l=r.data;if(l==="/$"){if(s===0){Ai=Uo(r.nextSibling);break e}s--}else l!=="$"&&l!=="$!"&&l!=="$?"||s++}r=r.nextSibling}Ai=null}}else Ai=Mi?Uo(r.stateNode.nextSibling):null;return!0}function n1(){for(var r=Ai;r;)r=Uo(r.nextSibling)}function iu(){Ai=Mi=null,Ir=!1}function iy(r){is===null?is=[r]:is.push(r)}var pT=Js.ReactCurrentBatchConfig;function Ic(r,s,l){if(r=l.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(Le(309));var p=l.stateNode}if(!p)throw Error(Le(147,r));var _=p,T=""+r;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===T?s.ref:(s=function(v){var d=_.refs;v===null?delete d[T]:d[T]=v},s._stringRef=T,s)}if(typeof r!="string")throw Error(Le(284));if(!l._owner)throw Error(Le(290,r))}return r}function zd(r,s){throw r=Object.prototype.toString.call(s),Error(Le(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r))}function tv(r){var s=r._init;return s(r._payload)}function i1(r){function s(oe,re){if(r){var ce=oe.deletions;ce===null?(oe.deletions=[re],oe.flags|=16):ce.push(re)}}function l(oe,re){if(!r)return null;for(;re!==null;)s(oe,re),re=re.sibling;return null}function p(oe,re){for(oe=new Map;re!==null;)re.key!==null?oe.set(re.key,re):oe.set(re.index,re),re=re.sibling;return oe}function _(oe,re){return oe=Ho(oe,re),oe.index=0,oe.sibling=null,oe}function T(oe,re,ce){return oe.index=ce,r?(ce=oe.alternate,ce!==null?(ce=ce.index,ce<re?(oe.flags|=2,re):ce):(oe.flags|=2,re)):(oe.flags|=1048576,re)}function v(oe){return r&&oe.alternate===null&&(oe.flags|=2),oe}function d(oe,re,ce,Ce){return re===null||re.tag!==6?(re=Mm(ce,oe.mode,Ce),re.return=oe,re):(re=_(re,ce),re.return=oe,re)}function N(oe,re,ce,Ce){var De=ce.type;return De===Nl?te(oe,re,ce.props.children,Ce,ce.key):re!==null&&(re.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===Ro&&tv(De)===re.type)?(Ce=_(re,ce.props),Ce.ref=Ic(oe,re,ce),Ce.return=oe,Ce):(Ce=Xd(ce.type,ce.key,ce.props,null,oe.mode,Ce),Ce.ref=Ic(oe,re,ce),Ce.return=oe,Ce)}function Z(oe,re,ce,Ce){return re===null||re.tag!==4||re.stateNode.containerInfo!==ce.containerInfo||re.stateNode.implementation!==ce.implementation?(re=zm(ce,oe.mode,Ce),re.return=oe,re):(re=_(re,ce.children||[]),re.return=oe,re)}function te(oe,re,ce,Ce,De){return re===null||re.tag!==7?(re=Ra(ce,oe.mode,Ce,De),re.return=oe,re):(re=_(re,ce),re.return=oe,re)}function q(oe,re,ce){if(typeof re=="string"&&re!==""||typeof re=="number")return re=Mm(""+re,oe.mode,ce),re.return=oe,re;if(typeof re=="object"&&re!==null){switch(re.$$typeof){case wd:return ce=Xd(re.type,re.key,re.props,null,oe.mode,ce),ce.ref=Ic(oe,null,re),ce.return=oe,ce;case Bl:return re=zm(re,oe.mode,ce),re.return=oe,re;case Ro:var Ce=re._init;return q(oe,Ce(re._payload),ce)}if(zc(re)||bc(re))return re=Ra(re,oe.mode,ce,null),re.return=oe,re;zd(oe,re)}return null}function U(oe,re,ce,Ce){var De=re!==null?re.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number")return De!==null?null:d(oe,re,""+ce,Ce);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case wd:return ce.key===De?N(oe,re,ce,Ce):null;case Bl:return ce.key===De?Z(oe,re,ce,Ce):null;case Ro:return De=ce._init,U(oe,re,De(ce._payload),Ce)}if(zc(ce)||bc(ce))return De!==null?null:te(oe,re,ce,Ce,null);zd(oe,ce)}return null}function ke(oe,re,ce,Ce,De){if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number")return oe=oe.get(ce)||null,d(re,oe,""+Ce,De);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case wd:return oe=oe.get(Ce.key===null?ce:Ce.key)||null,N(re,oe,Ce,De);case Bl:return oe=oe.get(Ce.key===null?ce:Ce.key)||null,Z(re,oe,Ce,De);case Ro:var Ue=Ce._init;return ke(oe,re,ce,Ue(Ce._payload),De)}if(zc(Ce)||bc(Ce))return oe=oe.get(ce)||null,te(re,oe,Ce,De,null);zd(re,Ce)}return null}function ue(oe,re,ce,Ce){for(var De=null,Ue=null,Oe=re,Qe=re=0,_t=null;Oe!==null&&Qe<ce.length;Qe++){Oe.index>Qe?(_t=Oe,Oe=null):_t=Oe.sibling;var mt=U(oe,Oe,ce[Qe],Ce);if(mt===null){Oe===null&&(Oe=_t);break}r&&Oe&&mt.alternate===null&&s(oe,Oe),re=T(mt,re,Qe),Ue===null?De=mt:Ue.sibling=mt,Ue=mt,Oe=_t}if(Qe===ce.length)return l(oe,Oe),Ir&&ka(oe,Qe),De;if(Oe===null){for(;Qe<ce.length;Qe++)Oe=q(oe,ce[Qe],Ce),Oe!==null&&(re=T(Oe,re,Qe),Ue===null?De=Oe:Ue.sibling=Oe,Ue=Oe);return Ir&&ka(oe,Qe),De}for(Oe=p(oe,Oe);Qe<ce.length;Qe++)_t=ke(Oe,oe,Qe,ce[Qe],Ce),_t!==null&&(r&&_t.alternate!==null&&Oe.delete(_t.key===null?Qe:_t.key),re=T(_t,re,Qe),Ue===null?De=_t:Ue.sibling=_t,Ue=_t);return r&&Oe.forEach(function(pt){return s(oe,pt)}),Ir&&ka(oe,Qe),De}function _e(oe,re,ce,Ce){var De=bc(ce);if(typeof De!="function")throw Error(Le(150));if(ce=De.call(ce),ce==null)throw Error(Le(151));for(var Ue=De=null,Oe=re,Qe=re=0,_t=null,mt=ce.next();Oe!==null&&!mt.done;Qe++,mt=ce.next()){Oe.index>Qe?(_t=Oe,Oe=null):_t=Oe.sibling;var pt=U(oe,Oe,mt.value,Ce);if(pt===null){Oe===null&&(Oe=_t);break}r&&Oe&&pt.alternate===null&&s(oe,Oe),re=T(pt,re,Qe),Ue===null?De=pt:Ue.sibling=pt,Ue=pt,Oe=_t}if(mt.done)return l(oe,Oe),Ir&&ka(oe,Qe),De;if(Oe===null){for(;!mt.done;Qe++,mt=ce.next())mt=q(oe,mt.value,Ce),mt!==null&&(re=T(mt,re,Qe),Ue===null?De=mt:Ue.sibling=mt,Ue=mt);return Ir&&ka(oe,Qe),De}for(Oe=p(oe,Oe);!mt.done;Qe++,mt=ce.next())mt=ke(Oe,oe,Qe,mt.value,Ce),mt!==null&&(r&&mt.alternate!==null&&Oe.delete(mt.key===null?Qe:mt.key),re=T(mt,re,Qe),Ue===null?De=mt:Ue.sibling=mt,Ue=mt);return r&&Oe.forEach(function(Xt){return s(oe,Xt)}),Ir&&ka(oe,Qe),De}function Pe(oe,re,ce,Ce){if(typeof ce=="object"&&ce!==null&&ce.type===Nl&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case wd:e:{for(var De=ce.key,Ue=re;Ue!==null;){if(Ue.key===De){if(De=ce.type,De===Nl){if(Ue.tag===7){l(oe,Ue.sibling),re=_(Ue,ce.props.children),re.return=oe,oe=re;break e}}else if(Ue.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===Ro&&tv(De)===Ue.type){l(oe,Ue.sibling),re=_(Ue,ce.props),re.ref=Ic(oe,Ue,ce),re.return=oe,oe=re;break e}l(oe,Ue);break}else s(oe,Ue);Ue=Ue.sibling}ce.type===Nl?(re=Ra(ce.props.children,oe.mode,Ce,ce.key),re.return=oe,oe=re):(Ce=Xd(ce.type,ce.key,ce.props,null,oe.mode,Ce),Ce.ref=Ic(oe,re,ce),Ce.return=oe,oe=Ce)}return v(oe);case Bl:e:{for(Ue=ce.key;re!==null;){if(re.key===Ue)if(re.tag===4&&re.stateNode.containerInfo===ce.containerInfo&&re.stateNode.implementation===ce.implementation){l(oe,re.sibling),re=_(re,ce.children||[]),re.return=oe,oe=re;break e}else{l(oe,re);break}else s(oe,re);re=re.sibling}re=zm(ce,oe.mode,Ce),re.return=oe,oe=re}return v(oe);case Ro:return Ue=ce._init,Pe(oe,re,Ue(ce._payload),Ce)}if(zc(ce))return ue(oe,re,ce,Ce);if(bc(ce))return _e(oe,re,ce,Ce);zd(oe,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"?(ce=""+ce,re!==null&&re.tag===6?(l(oe,re.sibling),re=_(re,ce),re.return=oe,oe=re):(l(oe,re),re=Mm(ce,oe.mode,Ce),re.return=oe,oe=re),v(oe)):l(oe,re)}return Pe}var su=i1(!0),s1=i1(!1),dp=Ko(null),pp=null,Gl=null,sy=null;function oy(){sy=Gl=pp=null}function ay(r){var s=dp.current;Sr(dp),r._currentValue=s}function mg(r,s,l){for(;r!==null;){var p=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,p!==null&&(p.childLanes|=s)):p!==null&&(p.childLanes&s)!==s&&(p.childLanes|=s),r===l)break;r=r.return}}function eu(r,s){pp=r,sy=Gl=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&s&&(ui=!0),r.firstContext=null)}function Hi(r){var s=r._currentValue;if(sy!==r)if(r={context:r,memoizedValue:s,next:null},Gl===null){if(pp===null)throw Error(Le(308));Gl=r,pp.dependencies={lanes:0,firstContext:r}}else Gl=Gl.next=r;return s}var Pa=null;function ly(r){Pa===null?Pa=[r]:Pa.push(r)}function o1(r,s,l,p){var _=s.interleaved;return _===null?(l.next=l,ly(s)):(l.next=_.next,_.next=l),s.interleaved=l,Xs(r,p)}function Xs(r,s){r.lanes|=s;var l=r.alternate;for(l!==null&&(l.lanes|=s),l=r,r=r.return;r!==null;)r.childLanes|=s,l=r.alternate,l!==null&&(l.childLanes|=s),l=r,r=r.return;return l.tag===3?l.stateNode:null}var Do=!1;function uy(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function a1(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Hs(r,s){return{eventTime:r,lane:s,tag:0,payload:null,callback:null,next:null}}function $o(r,s,l){var p=r.updateQueue;if(p===null)return null;if(p=p.shared,Wt&2){var _=p.pending;return _===null?s.next=s:(s.next=_.next,_.next=s),p.pending=s,Xs(r,l)}return _=p.interleaved,_===null?(s.next=s,ly(p)):(s.next=_.next,_.next=s),p.interleaved=s,Xs(r,l)}function $d(r,s,l){if(s=s.updateQueue,s!==null&&(s=s.shared,(l&4194240)!==0)){var p=s.lanes;p&=r.pendingLanes,l|=p,s.lanes=l,Wg(r,l)}}function rv(r,s){var l=r.updateQueue,p=r.alternate;if(p!==null&&(p=p.updateQueue,l===p)){var _=null,T=null;if(l=l.firstBaseUpdate,l!==null){do{var v={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};T===null?_=T=v:T=T.next=v,l=l.next}while(l!==null);T===null?_=T=s:T=T.next=s}else _=T=s;l={baseState:p.baseState,firstBaseUpdate:_,lastBaseUpdate:T,shared:p.shared,effects:p.effects},r.updateQueue=l;return}r=l.lastBaseUpdate,r===null?l.firstBaseUpdate=s:r.next=s,l.lastBaseUpdate=s}function fp(r,s,l,p){var _=r.updateQueue;Do=!1;var T=_.firstBaseUpdate,v=_.lastBaseUpdate,d=_.shared.pending;if(d!==null){_.shared.pending=null;var N=d,Z=N.next;N.next=null,v===null?T=Z:v.next=Z,v=N;var te=r.alternate;te!==null&&(te=te.updateQueue,d=te.lastBaseUpdate,d!==v&&(d===null?te.firstBaseUpdate=Z:d.next=Z,te.lastBaseUpdate=N))}if(T!==null){var q=_.baseState;v=0,te=Z=N=null,d=T;do{var U=d.lane,ke=d.eventTime;if((p&U)===U){te!==null&&(te=te.next={eventTime:ke,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var ue=r,_e=d;switch(U=s,ke=l,_e.tag){case 1:if(ue=_e.payload,typeof ue=="function"){q=ue.call(ke,q,U);break e}q=ue;break e;case 3:ue.flags=ue.flags&-65537|128;case 0:if(ue=_e.payload,U=typeof ue=="function"?ue.call(ke,q,U):ue,U==null)break e;q=Lr({},q,U);break e;case 2:Do=!0}}d.callback!==null&&d.lane!==0&&(r.flags|=64,U=_.effects,U===null?_.effects=[d]:U.push(d))}else ke={eventTime:ke,lane:U,tag:d.tag,payload:d.payload,callback:d.callback,next:null},te===null?(Z=te=ke,N=q):te=te.next=ke,v|=U;if(d=d.next,d===null){if(d=_.shared.pending,d===null)break;U=d,d=U.next,U.next=null,_.lastBaseUpdate=U,_.shared.pending=null}}while(!0);if(te===null&&(N=q),_.baseState=N,_.firstBaseUpdate=Z,_.lastBaseUpdate=te,s=_.shared.interleaved,s!==null){_=s;do v|=_.lane,_=_.next;while(_!==s)}else T===null&&(_.shared.lanes=0);Ba|=v,r.lanes=v,r.memoizedState=q}}function nv(r,s,l){if(r=s.effects,s.effects=null,r!==null)for(s=0;s<r.length;s++){var p=r[s],_=p.callback;if(_!==null){if(p.callback=null,p=l,typeof _!="function")throw Error(Le(191,_));_.call(p)}}}var dh={},Ss=Ko(dh),rh=Ko(dh),nh=Ko(dh);function Aa(r){if(r===dh)throw Error(Le(174));return r}function cy(r,s){switch(xr(nh,s),xr(rh,r),xr(Ss,dh),r=s.nodeType,r){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:Xm(null,"");break;default:r=r===8?s.parentNode:s,s=r.namespaceURI||null,r=r.tagName,s=Xm(s,r)}Sr(Ss),xr(Ss,s)}function ou(){Sr(Ss),Sr(rh),Sr(nh)}function l1(r){Aa(nh.current);var s=Aa(Ss.current),l=Xm(s,r.type);s!==l&&(xr(rh,r),xr(Ss,l))}function hy(r){rh.current===r&&(Sr(Ss),Sr(rh))}var Rr=Ko(0);function mp(r){for(var s=r;s!==null;){if(s.tag===13){var l=s.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Em=[];function dy(){for(var r=0;r<Em.length;r++)Em[r]._workInProgressVersionPrimary=null;Em.length=0}var qd=Js.ReactCurrentDispatcher,km=Js.ReactCurrentBatchConfig,Oa=0,Dr=null,tn=null,dn=null,gp=!1,jc=!1,ih=0,fT=0;function Rn(){throw Error(Le(321))}function py(r,s){if(s===null)return!1;for(var l=0;l<s.length&&l<r.length;l++)if(!as(r[l],s[l]))return!1;return!0}function fy(r,s,l,p,_,T){if(Oa=T,Dr=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,qd.current=r===null||r.memoizedState===null?_T:xT,r=l(p,_),jc){T=0;do{if(jc=!1,ih=0,25<=T)throw Error(Le(301));T+=1,dn=tn=null,s.updateQueue=null,qd.current=vT,r=l(p,_)}while(jc)}if(qd.current=yp,s=tn!==null&&tn.next!==null,Oa=0,dn=tn=Dr=null,gp=!1,s)throw Error(Le(300));return r}function my(){var r=ih!==0;return ih=0,r}function vs(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return dn===null?Dr.memoizedState=dn=r:dn=dn.next=r,dn}function Gi(){if(tn===null){var r=Dr.alternate;r=r!==null?r.memoizedState:null}else r=tn.next;var s=dn===null?Dr.memoizedState:dn.next;if(s!==null)dn=s,tn=r;else{if(r===null)throw Error(Le(310));tn=r,r={memoizedState:tn.memoizedState,baseState:tn.baseState,baseQueue:tn.baseQueue,queue:tn.queue,next:null},dn===null?Dr.memoizedState=dn=r:dn=dn.next=r}return dn}function sh(r,s){return typeof s=="function"?s(r):s}function Im(r){var s=Gi(),l=s.queue;if(l===null)throw Error(Le(311));l.lastRenderedReducer=r;var p=tn,_=p.baseQueue,T=l.pending;if(T!==null){if(_!==null){var v=_.next;_.next=T.next,T.next=v}p.baseQueue=_=T,l.pending=null}if(_!==null){T=_.next,p=p.baseState;var d=v=null,N=null,Z=T;do{var te=Z.lane;if((Oa&te)===te)N!==null&&(N=N.next={lane:0,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null}),p=Z.hasEagerState?Z.eagerState:r(p,Z.action);else{var q={lane:te,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null};N===null?(d=N=q,v=p):N=N.next=q,Dr.lanes|=te,Ba|=te}Z=Z.next}while(Z!==null&&Z!==T);N===null?v=p:N.next=d,as(p,s.memoizedState)||(ui=!0),s.memoizedState=p,s.baseState=v,s.baseQueue=N,l.lastRenderedState=p}if(r=l.interleaved,r!==null){_=r;do T=_.lane,Dr.lanes|=T,Ba|=T,_=_.next;while(_!==r)}else _===null&&(l.lanes=0);return[s.memoizedState,l.dispatch]}function Cm(r){var s=Gi(),l=s.queue;if(l===null)throw Error(Le(311));l.lastRenderedReducer=r;var p=l.dispatch,_=l.pending,T=s.memoizedState;if(_!==null){l.pending=null;var v=_=_.next;do T=r(T,v.action),v=v.next;while(v!==_);as(T,s.memoizedState)||(ui=!0),s.memoizedState=T,s.baseQueue===null&&(s.baseState=T),l.lastRenderedState=T}return[T,p]}function u1(){}function c1(r,s){var l=Dr,p=Gi(),_=s(),T=!as(p.memoizedState,_);if(T&&(p.memoizedState=_,ui=!0),p=p.queue,gy(p1.bind(null,l,p,r),[r]),p.getSnapshot!==s||T||dn!==null&&dn.memoizedState.tag&1){if(l.flags|=2048,oh(9,d1.bind(null,l,p,_,s),void 0,null),pn===null)throw Error(Le(349));Oa&30||h1(l,s,_)}return _}function h1(r,s,l){r.flags|=16384,r={getSnapshot:s,value:l},s=Dr.updateQueue,s===null?(s={lastEffect:null,stores:null},Dr.updateQueue=s,s.stores=[r]):(l=s.stores,l===null?s.stores=[r]:l.push(r))}function d1(r,s,l,p){s.value=l,s.getSnapshot=p,f1(s)&&m1(r)}function p1(r,s,l){return l(function(){f1(s)&&m1(r)})}function f1(r){var s=r.getSnapshot;r=r.value;try{var l=s();return!as(r,l)}catch{return!0}}function m1(r){var s=Xs(r,1);s!==null&&os(s,r,1,-1)}function iv(r){var s=vs();return typeof r=="function"&&(r=r()),s.memoizedState=s.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:sh,lastRenderedState:r},s.queue=r,r=r.dispatch=yT.bind(null,Dr,r),[s.memoizedState,r]}function oh(r,s,l,p){return r={tag:r,create:s,destroy:l,deps:p,next:null},s=Dr.updateQueue,s===null?(s={lastEffect:null,stores:null},Dr.updateQueue=s,s.lastEffect=r.next=r):(l=s.lastEffect,l===null?s.lastEffect=r.next=r:(p=l.next,l.next=r,r.next=p,s.lastEffect=r)),r}function g1(){return Gi().memoizedState}function Zd(r,s,l,p){var _=vs();Dr.flags|=r,_.memoizedState=oh(1|s,l,void 0,p===void 0?null:p)}function Mp(r,s,l,p){var _=Gi();p=p===void 0?null:p;var T=void 0;if(tn!==null){var v=tn.memoizedState;if(T=v.destroy,p!==null&&py(p,v.deps)){_.memoizedState=oh(s,l,T,p);return}}Dr.flags|=r,_.memoizedState=oh(1|s,l,T,p)}function sv(r,s){return Zd(8390656,8,r,s)}function gy(r,s){return Mp(2048,8,r,s)}function y1(r,s){return Mp(4,2,r,s)}function _1(r,s){return Mp(4,4,r,s)}function x1(r,s){if(typeof s=="function")return r=r(),s(r),function(){s(null)};if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function v1(r,s,l){return l=l!=null?l.concat([r]):null,Mp(4,4,x1.bind(null,s,r),l)}function yy(){}function w1(r,s){var l=Gi();s=s===void 0?null:s;var p=l.memoizedState;return p!==null&&s!==null&&py(s,p[1])?p[0]:(l.memoizedState=[r,s],r)}function b1(r,s){var l=Gi();s=s===void 0?null:s;var p=l.memoizedState;return p!==null&&s!==null&&py(s,p[1])?p[0]:(r=r(),l.memoizedState=[r,s],r)}function S1(r,s,l){return Oa&21?(as(l,s)||(l=C0(),Dr.lanes|=l,Ba|=l,r.baseState=!0),s):(r.baseState&&(r.baseState=!1,ui=!0),r.memoizedState=l)}function mT(r,s){var l=or;or=l!==0&&4>l?l:4,r(!0);var p=km.transition;km.transition={};try{r(!1),s()}finally{or=l,km.transition=p}}function T1(){return Gi().memoizedState}function gT(r,s,l){var p=Zo(r);if(l={lane:p,action:l,hasEagerState:!1,eagerState:null,next:null},E1(r))k1(s,l);else if(l=o1(r,s,l,p),l!==null){var _=Wn();os(l,r,p,_),I1(l,s,p)}}function yT(r,s,l){var p=Zo(r),_={lane:p,action:l,hasEagerState:!1,eagerState:null,next:null};if(E1(r))k1(s,_);else{var T=r.alternate;if(r.lanes===0&&(T===null||T.lanes===0)&&(T=s.lastRenderedReducer,T!==null))try{var v=s.lastRenderedState,d=T(v,l);if(_.hasEagerState=!0,_.eagerState=d,as(d,v)){var N=s.interleaved;N===null?(_.next=_,ly(s)):(_.next=N.next,N.next=_),s.interleaved=_;return}}catch{}finally{}l=o1(r,s,_,p),l!==null&&(_=Wn(),os(l,r,p,_),I1(l,s,p))}}function E1(r){var s=r.alternate;return r===Dr||s!==null&&s===Dr}function k1(r,s){jc=gp=!0;var l=r.pending;l===null?s.next=s:(s.next=l.next,l.next=s),r.pending=s}function I1(r,s,l){if(l&4194240){var p=s.lanes;p&=r.pendingLanes,l|=p,s.lanes=l,Wg(r,l)}}var yp={readContext:Hi,useCallback:Rn,useContext:Rn,useEffect:Rn,useImperativeHandle:Rn,useInsertionEffect:Rn,useLayoutEffect:Rn,useMemo:Rn,useReducer:Rn,useRef:Rn,useState:Rn,useDebugValue:Rn,useDeferredValue:Rn,useTransition:Rn,useMutableSource:Rn,useSyncExternalStore:Rn,useId:Rn,unstable_isNewReconciler:!1},_T={readContext:Hi,useCallback:function(r,s){return vs().memoizedState=[r,s===void 0?null:s],r},useContext:Hi,useEffect:sv,useImperativeHandle:function(r,s,l){return l=l!=null?l.concat([r]):null,Zd(4194308,4,x1.bind(null,s,r),l)},useLayoutEffect:function(r,s){return Zd(4194308,4,r,s)},useInsertionEffect:function(r,s){return Zd(4,2,r,s)},useMemo:function(r,s){var l=vs();return s=s===void 0?null:s,r=r(),l.memoizedState=[r,s],r},useReducer:function(r,s,l){var p=vs();return s=l!==void 0?l(s):s,p.memoizedState=p.baseState=s,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:s},p.queue=r,r=r.dispatch=gT.bind(null,Dr,r),[p.memoizedState,r]},useRef:function(r){var s=vs();return r={current:r},s.memoizedState=r},useState:iv,useDebugValue:yy,useDeferredValue:function(r){return vs().memoizedState=r},useTransition:function(){var r=iv(!1),s=r[0];return r=mT.bind(null,r[1]),vs().memoizedState=r,[s,r]},useMutableSource:function(){},useSyncExternalStore:function(r,s,l){var p=Dr,_=vs();if(Ir){if(l===void 0)throw Error(Le(407));l=l()}else{if(l=s(),pn===null)throw Error(Le(349));Oa&30||h1(p,s,l)}_.memoizedState=l;var T={value:l,getSnapshot:s};return _.queue=T,sv(p1.bind(null,p,T,r),[r]),p.flags|=2048,oh(9,d1.bind(null,p,T,l,s),void 0,null),l},useId:function(){var r=vs(),s=pn.identifierPrefix;if(Ir){var l=Zs,p=qs;l=(p&~(1<<32-ss(p)-1)).toString(32)+l,s=":"+s+"R"+l,l=ih++,0<l&&(s+="H"+l.toString(32)),s+=":"}else l=fT++,s=":"+s+"r"+l.toString(32)+":";return r.memoizedState=s},unstable_isNewReconciler:!1},xT={readContext:Hi,useCallback:w1,useContext:Hi,useEffect:gy,useImperativeHandle:v1,useInsertionEffect:y1,useLayoutEffect:_1,useMemo:b1,useReducer:Im,useRef:g1,useState:function(){return Im(sh)},useDebugValue:yy,useDeferredValue:function(r){var s=Gi();return S1(s,tn.memoizedState,r)},useTransition:function(){var r=Im(sh)[0],s=Gi().memoizedState;return[r,s]},useMutableSource:u1,useSyncExternalStore:c1,useId:T1,unstable_isNewReconciler:!1},vT={readContext:Hi,useCallback:w1,useContext:Hi,useEffect:gy,useImperativeHandle:v1,useInsertionEffect:y1,useLayoutEffect:_1,useMemo:b1,useReducer:Cm,useRef:g1,useState:function(){return Cm(sh)},useDebugValue:yy,useDeferredValue:function(r){var s=Gi();return tn===null?s.memoizedState=r:S1(s,tn.memoizedState,r)},useTransition:function(){var r=Cm(sh)[0],s=Gi().memoizedState;return[r,s]},useMutableSource:u1,useSyncExternalStore:c1,useId:T1,unstable_isNewReconciler:!1};function rs(r,s){if(r&&r.defaultProps){s=Lr({},s),r=r.defaultProps;for(var l in r)s[l]===void 0&&(s[l]=r[l]);return s}return s}function gg(r,s,l,p){s=r.memoizedState,l=l(p,s),l=l==null?s:Lr({},s,l),r.memoizedState=l,r.lanes===0&&(r.updateQueue.baseState=l)}var zp={isMounted:function(r){return(r=r._reactInternals)?Ua(r)===r:!1},enqueueSetState:function(r,s,l){r=r._reactInternals;var p=Wn(),_=Zo(r),T=Hs(p,_);T.payload=s,l!=null&&(T.callback=l),s=$o(r,T,_),s!==null&&(os(s,r,_,p),$d(s,r,_))},enqueueReplaceState:function(r,s,l){r=r._reactInternals;var p=Wn(),_=Zo(r),T=Hs(p,_);T.tag=1,T.payload=s,l!=null&&(T.callback=l),s=$o(r,T,_),s!==null&&(os(s,r,_,p),$d(s,r,_))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var l=Wn(),p=Zo(r),_=Hs(l,p);_.tag=2,s!=null&&(_.callback=s),s=$o(r,_,p),s!==null&&(os(s,r,p,l),$d(s,r,p))}};function ov(r,s,l,p,_,T,v){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(p,T,v):s.prototype&&s.prototype.isPureReactComponent?!Yc(l,p)||!Yc(_,T):!0}function C1(r,s,l){var p=!1,_=Wo,T=s.contextType;return typeof T=="object"&&T!==null?T=Hi(T):(_=hi(s)?La:On.current,p=s.contextTypes,T=(p=p!=null)?nu(r,_):Wo),s=new s(l,T),r.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=zp,r.stateNode=s,s._reactInternals=r,p&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=_,r.__reactInternalMemoizedMaskedChildContext=T),s}function av(r,s,l,p){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(l,p),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(l,p),s.state!==r&&zp.enqueueReplaceState(s,s.state,null)}function yg(r,s,l,p){var _=r.stateNode;_.props=l,_.state=r.memoizedState,_.refs={},uy(r);var T=s.contextType;typeof T=="object"&&T!==null?_.context=Hi(T):(T=hi(s)?La:On.current,_.context=nu(r,T)),_.state=r.memoizedState,T=s.getDerivedStateFromProps,typeof T=="function"&&(gg(r,s,T,l),_.state=r.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(s=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),s!==_.state&&zp.enqueueReplaceState(_,_.state,null),fp(r,l,_,p),_.state=r.memoizedState),typeof _.componentDidMount=="function"&&(r.flags|=4194308)}function au(r,s){try{var l="",p=s;do l+=W2(p),p=p.return;while(p);var _=l}catch(T){_=`
Error generating stack: `+T.message+`
`+T.stack}return{value:r,source:s,stack:_,digest:null}}function Pm(r,s,l){return{value:r,source:null,stack:l??null,digest:s??null}}function _g(r,s){try{console.error(s.value)}catch(l){setTimeout(function(){throw l})}}var wT=typeof WeakMap=="function"?WeakMap:Map;function P1(r,s,l){l=Hs(-1,l),l.tag=3,l.payload={element:null};var p=s.value;return l.callback=function(){xp||(xp=!0,Cg=p),_g(r,s)},l}function A1(r,s,l){l=Hs(-1,l),l.tag=3;var p=r.type.getDerivedStateFromError;if(typeof p=="function"){var _=s.value;l.payload=function(){return p(_)},l.callback=function(){_g(r,s)}}var T=r.stateNode;return T!==null&&typeof T.componentDidCatch=="function"&&(l.callback=function(){_g(r,s),typeof p!="function"&&(qo===null?qo=new Set([this]):qo.add(this));var v=s.stack;this.componentDidCatch(s.value,{componentStack:v!==null?v:""})}),l}function lv(r,s,l){var p=r.pingCache;if(p===null){p=r.pingCache=new wT;var _=new Set;p.set(s,_)}else _=p.get(s),_===void 0&&(_=new Set,p.set(s,_));_.has(l)||(_.add(l),r=LT.bind(null,r,s,l),s.then(r,r))}function uv(r){do{var s;if((s=r.tag===13)&&(s=r.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return r;r=r.return}while(r!==null);return null}function cv(r,s,l,p,_){return r.mode&1?(r.flags|=65536,r.lanes=_,r):(r===s?r.flags|=65536:(r.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(s=Hs(-1,1),s.tag=2,$o(l,s,1))),l.lanes|=1),r)}var bT=Js.ReactCurrentOwner,ui=!1;function Gn(r,s,l,p){s.child=r===null?s1(s,null,l,p):su(s,r.child,l,p)}function hv(r,s,l,p,_){l=l.render;var T=s.ref;return eu(s,_),p=fy(r,s,l,p,T,_),l=my(),r!==null&&!ui?(s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~_,Ks(r,s,_)):(Ir&&l&&ry(s),s.flags|=1,Gn(r,s,p,_),s.child)}function dv(r,s,l,p,_){if(r===null){var T=l.type;return typeof T=="function"&&!Ey(T)&&T.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(s.tag=15,s.type=T,M1(r,s,T,p,_)):(r=Xd(l.type,null,p,s,s.mode,_),r.ref=s.ref,r.return=s,s.child=r)}if(T=r.child,!(r.lanes&_)){var v=T.memoizedProps;if(l=l.compare,l=l!==null?l:Yc,l(v,p)&&r.ref===s.ref)return Ks(r,s,_)}return s.flags|=1,r=Ho(T,p),r.ref=s.ref,r.return=s,s.child=r}function M1(r,s,l,p,_){if(r!==null){var T=r.memoizedProps;if(Yc(T,p)&&r.ref===s.ref)if(ui=!1,s.pendingProps=p=T,(r.lanes&_)!==0)r.flags&131072&&(ui=!0);else return s.lanes=r.lanes,Ks(r,s,_)}return xg(r,s,l,p,_)}function z1(r,s,l){var p=s.pendingProps,_=p.children,T=r!==null?r.memoizedState:null;if(p.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},xr(Xl,Pi),Pi|=l;else{if(!(l&1073741824))return r=T!==null?T.baseLanes|l:l,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:r,cachePool:null,transitions:null},s.updateQueue=null,xr(Xl,Pi),Pi|=r,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=T!==null?T.baseLanes:l,xr(Xl,Pi),Pi|=p}else T!==null?(p=T.baseLanes|l,s.memoizedState=null):p=l,xr(Xl,Pi),Pi|=p;return Gn(r,s,_,l),s.child}function R1(r,s){var l=s.ref;(r===null&&l!==null||r!==null&&r.ref!==l)&&(s.flags|=512,s.flags|=2097152)}function xg(r,s,l,p,_){var T=hi(l)?La:On.current;return T=nu(s,T),eu(s,_),l=fy(r,s,l,p,T,_),p=my(),r!==null&&!ui?(s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~_,Ks(r,s,_)):(Ir&&p&&ry(s),s.flags|=1,Gn(r,s,l,_),s.child)}function pv(r,s,l,p,_){if(hi(l)){var T=!0;up(s)}else T=!1;if(eu(s,_),s.stateNode===null)Hd(r,s),C1(s,l,p),yg(s,l,p,_),p=!0;else if(r===null){var v=s.stateNode,d=s.memoizedProps;v.props=d;var N=v.context,Z=l.contextType;typeof Z=="object"&&Z!==null?Z=Hi(Z):(Z=hi(l)?La:On.current,Z=nu(s,Z));var te=l.getDerivedStateFromProps,q=typeof te=="function"||typeof v.getSnapshotBeforeUpdate=="function";q||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(d!==p||N!==Z)&&av(s,v,p,Z),Do=!1;var U=s.memoizedState;v.state=U,fp(s,p,v,_),N=s.memoizedState,d!==p||U!==N||ci.current||Do?(typeof te=="function"&&(gg(s,l,te,p),N=s.memoizedState),(d=Do||ov(s,l,d,p,U,N,Z))?(q||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(s.flags|=4194308)):(typeof v.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=p,s.memoizedState=N),v.props=p,v.state=N,v.context=Z,p=d):(typeof v.componentDidMount=="function"&&(s.flags|=4194308),p=!1)}else{v=s.stateNode,a1(r,s),d=s.memoizedProps,Z=s.type===s.elementType?d:rs(s.type,d),v.props=Z,q=s.pendingProps,U=v.context,N=l.contextType,typeof N=="object"&&N!==null?N=Hi(N):(N=hi(l)?La:On.current,N=nu(s,N));var ke=l.getDerivedStateFromProps;(te=typeof ke=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(d!==q||U!==N)&&av(s,v,p,N),Do=!1,U=s.memoizedState,v.state=U,fp(s,p,v,_);var ue=s.memoizedState;d!==q||U!==ue||ci.current||Do?(typeof ke=="function"&&(gg(s,l,ke,p),ue=s.memoizedState),(Z=Do||ov(s,l,Z,p,U,ue,N)||!1)?(te||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(p,ue,N),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(p,ue,N)),typeof v.componentDidUpdate=="function"&&(s.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof v.componentDidUpdate!="function"||d===r.memoizedProps&&U===r.memoizedState||(s.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||d===r.memoizedProps&&U===r.memoizedState||(s.flags|=1024),s.memoizedProps=p,s.memoizedState=ue),v.props=p,v.state=ue,v.context=N,p=Z):(typeof v.componentDidUpdate!="function"||d===r.memoizedProps&&U===r.memoizedState||(s.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||d===r.memoizedProps&&U===r.memoizedState||(s.flags|=1024),p=!1)}return vg(r,s,l,p,T,_)}function vg(r,s,l,p,_,T){R1(r,s);var v=(s.flags&128)!==0;if(!p&&!v)return _&&Yx(s,l,!1),Ks(r,s,T);p=s.stateNode,bT.current=s;var d=v&&typeof l.getDerivedStateFromError!="function"?null:p.render();return s.flags|=1,r!==null&&v?(s.child=su(s,r.child,null,T),s.child=su(s,null,d,T)):Gn(r,s,d,T),s.memoizedState=p.state,_&&Yx(s,l,!0),s.child}function D1(r){var s=r.stateNode;s.pendingContext?Jx(r,s.pendingContext,s.pendingContext!==s.context):s.context&&Jx(r,s.context,!1),cy(r,s.containerInfo)}function fv(r,s,l,p,_){return iu(),iy(_),s.flags|=256,Gn(r,s,l,p),s.child}var wg={dehydrated:null,treeContext:null,retryLane:0};function bg(r){return{baseLanes:r,cachePool:null,transitions:null}}function L1(r,s,l){var p=s.pendingProps,_=Rr.current,T=!1,v=(s.flags&128)!==0,d;if((d=v)||(d=r!==null&&r.memoizedState===null?!1:(_&2)!==0),d?(T=!0,s.flags&=-129):(r===null||r.memoizedState!==null)&&(_|=1),xr(Rr,_&1),r===null)return fg(s),r=s.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(s.mode&1?r.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(v=p.children,r=p.fallback,T?(p=s.mode,T=s.child,v={mode:"hidden",children:v},!(p&1)&&T!==null?(T.childLanes=0,T.pendingProps=v):T=Lp(v,p,0,null),r=Ra(r,p,l,null),T.return=s,r.return=s,T.sibling=r,s.child=T,s.child.memoizedState=bg(l),s.memoizedState=wg,r):_y(s,v));if(_=r.memoizedState,_!==null&&(d=_.dehydrated,d!==null))return ST(r,s,v,p,d,_,l);if(T){T=p.fallback,v=s.mode,_=r.child,d=_.sibling;var N={mode:"hidden",children:p.children};return!(v&1)&&s.child!==_?(p=s.child,p.childLanes=0,p.pendingProps=N,s.deletions=null):(p=Ho(_,N),p.subtreeFlags=_.subtreeFlags&14680064),d!==null?T=Ho(d,T):(T=Ra(T,v,l,null),T.flags|=2),T.return=s,p.return=s,p.sibling=T,s.child=p,p=T,T=s.child,v=r.child.memoizedState,v=v===null?bg(l):{baseLanes:v.baseLanes|l,cachePool:null,transitions:v.transitions},T.memoizedState=v,T.childLanes=r.childLanes&~l,s.memoizedState=wg,p}return T=r.child,r=T.sibling,p=Ho(T,{mode:"visible",children:p.children}),!(s.mode&1)&&(p.lanes=l),p.return=s,p.sibling=null,r!==null&&(l=s.deletions,l===null?(s.deletions=[r],s.flags|=16):l.push(r)),s.child=p,s.memoizedState=null,p}function _y(r,s){return s=Lp({mode:"visible",children:s},r.mode,0,null),s.return=r,r.child=s}function Rd(r,s,l,p){return p!==null&&iy(p),su(s,r.child,null,l),r=_y(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function ST(r,s,l,p,_,T,v){if(l)return s.flags&256?(s.flags&=-257,p=Pm(Error(Le(422))),Rd(r,s,v,p)):s.memoizedState!==null?(s.child=r.child,s.flags|=128,null):(T=p.fallback,_=s.mode,p=Lp({mode:"visible",children:p.children},_,0,null),T=Ra(T,_,v,null),T.flags|=2,p.return=s,T.return=s,p.sibling=T,s.child=p,s.mode&1&&su(s,r.child,null,v),s.child.memoizedState=bg(v),s.memoizedState=wg,T);if(!(s.mode&1))return Rd(r,s,v,null);if(_.data==="$!"){if(p=_.nextSibling&&_.nextSibling.dataset,p)var d=p.dgst;return p=d,T=Error(Le(419)),p=Pm(T,p,void 0),Rd(r,s,v,p)}if(d=(v&r.childLanes)!==0,ui||d){if(p=pn,p!==null){switch(v&-v){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(p.suspendedLanes|v)?0:_,_!==0&&_!==T.retryLane&&(T.retryLane=_,Xs(r,_),os(p,r,_,-1))}return Ty(),p=Pm(Error(Le(421))),Rd(r,s,v,p)}return _.data==="$?"?(s.flags|=128,s.child=r.child,s=FT.bind(null,r),_._reactRetry=s,null):(r=T.treeContext,Ai=Uo(_.nextSibling),Mi=s,Ir=!0,is=null,r!==null&&(Ui[$i++]=qs,Ui[$i++]=Zs,Ui[$i++]=Fa,qs=r.id,Zs=r.overflow,Fa=s),s=_y(s,p.children),s.flags|=4096,s)}function mv(r,s,l){r.lanes|=s;var p=r.alternate;p!==null&&(p.lanes|=s),mg(r.return,s,l)}function Am(r,s,l,p,_){var T=r.memoizedState;T===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:p,tail:l,tailMode:_}:(T.isBackwards=s,T.rendering=null,T.renderingStartTime=0,T.last=p,T.tail=l,T.tailMode=_)}function F1(r,s,l){var p=s.pendingProps,_=p.revealOrder,T=p.tail;if(Gn(r,s,p.children,l),p=Rr.current,p&2)p=p&1|2,s.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&mv(r,l,s);else if(r.tag===19)mv(r,l,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}p&=1}if(xr(Rr,p),!(s.mode&1))s.memoizedState=null;else switch(_){case"forwards":for(l=s.child,_=null;l!==null;)r=l.alternate,r!==null&&mp(r)===null&&(_=l),l=l.sibling;l=_,l===null?(_=s.child,s.child=null):(_=l.sibling,l.sibling=null),Am(s,!1,_,l,T);break;case"backwards":for(l=null,_=s.child,s.child=null;_!==null;){if(r=_.alternate,r!==null&&mp(r)===null){s.child=_;break}r=_.sibling,_.sibling=l,l=_,_=r}Am(s,!0,l,null,T);break;case"together":Am(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Hd(r,s){!(s.mode&1)&&r!==null&&(r.alternate=null,s.alternate=null,s.flags|=2)}function Ks(r,s,l){if(r!==null&&(s.dependencies=r.dependencies),Ba|=s.lanes,!(l&s.childLanes))return null;if(r!==null&&s.child!==r.child)throw Error(Le(153));if(s.child!==null){for(r=s.child,l=Ho(r,r.pendingProps),s.child=l,l.return=s;r.sibling!==null;)r=r.sibling,l=l.sibling=Ho(r,r.pendingProps),l.return=s;l.sibling=null}return s.child}function TT(r,s,l){switch(s.tag){case 3:D1(s),iu();break;case 5:l1(s);break;case 1:hi(s.type)&&up(s);break;case 4:cy(s,s.stateNode.containerInfo);break;case 10:var p=s.type._context,_=s.memoizedProps.value;xr(dp,p._currentValue),p._currentValue=_;break;case 13:if(p=s.memoizedState,p!==null)return p.dehydrated!==null?(xr(Rr,Rr.current&1),s.flags|=128,null):l&s.child.childLanes?L1(r,s,l):(xr(Rr,Rr.current&1),r=Ks(r,s,l),r!==null?r.sibling:null);xr(Rr,Rr.current&1);break;case 19:if(p=(l&s.childLanes)!==0,r.flags&128){if(p)return F1(r,s,l);s.flags|=128}if(_=s.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),xr(Rr,Rr.current),p)break;return null;case 22:case 23:return s.lanes=0,z1(r,s,l)}return Ks(r,s,l)}var O1,Sg,B1,N1;O1=function(r,s){for(var l=s.child;l!==null;){if(l.tag===5||l.tag===6)r.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===s)break;for(;l.sibling===null;){if(l.return===null||l.return===s)return;l=l.return}l.sibling.return=l.return,l=l.sibling}};Sg=function(){};B1=function(r,s,l,p){var _=r.memoizedProps;if(_!==p){r=s.stateNode,Aa(Ss.current);var T=null;switch(l){case"input":_=Zm(r,_),p=Zm(r,p),T=[];break;case"select":_=Lr({},_,{value:void 0}),p=Lr({},p,{value:void 0}),T=[];break;case"textarea":_=Wm(r,_),p=Wm(r,p),T=[];break;default:typeof _.onClick!="function"&&typeof p.onClick=="function"&&(r.onclick=ap)}Km(l,p);var v;l=null;for(Z in _)if(!p.hasOwnProperty(Z)&&_.hasOwnProperty(Z)&&_[Z]!=null)if(Z==="style"){var d=_[Z];for(v in d)d.hasOwnProperty(v)&&(l||(l={}),l[v]="")}else Z!=="dangerouslySetInnerHTML"&&Z!=="children"&&Z!=="suppressContentEditableWarning"&&Z!=="suppressHydrationWarning"&&Z!=="autoFocus"&&(Zc.hasOwnProperty(Z)?T||(T=[]):(T=T||[]).push(Z,null));for(Z in p){var N=p[Z];if(d=_!=null?_[Z]:void 0,p.hasOwnProperty(Z)&&N!==d&&(N!=null||d!=null))if(Z==="style")if(d){for(v in d)!d.hasOwnProperty(v)||N&&N.hasOwnProperty(v)||(l||(l={}),l[v]="");for(v in N)N.hasOwnProperty(v)&&d[v]!==N[v]&&(l||(l={}),l[v]=N[v])}else l||(T||(T=[]),T.push(Z,l)),l=N;else Z==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,d=d?d.__html:void 0,N!=null&&d!==N&&(T=T||[]).push(Z,N)):Z==="children"?typeof N!="string"&&typeof N!="number"||(T=T||[]).push(Z,""+N):Z!=="suppressContentEditableWarning"&&Z!=="suppressHydrationWarning"&&(Zc.hasOwnProperty(Z)?(N!=null&&Z==="onScroll"&&br("scroll",r),T||d===N||(T=[])):(T=T||[]).push(Z,N))}l&&(T=T||[]).push("style",l);var Z=T;(s.updateQueue=Z)&&(s.flags|=4)}};N1=function(r,s,l,p){l!==p&&(s.flags|=4)};function Cc(r,s){if(!Ir)switch(r.tailMode){case"hidden":s=r.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?r.tail=null:l.sibling=null;break;case"collapsed":l=r.tail;for(var p=null;l!==null;)l.alternate!==null&&(p=l),l=l.sibling;p===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:p.sibling=null}}function Dn(r){var s=r.alternate!==null&&r.alternate.child===r.child,l=0,p=0;if(s)for(var _=r.child;_!==null;)l|=_.lanes|_.childLanes,p|=_.subtreeFlags&14680064,p|=_.flags&14680064,_.return=r,_=_.sibling;else for(_=r.child;_!==null;)l|=_.lanes|_.childLanes,p|=_.subtreeFlags,p|=_.flags,_.return=r,_=_.sibling;return r.subtreeFlags|=p,r.childLanes=l,s}function ET(r,s,l){var p=s.pendingProps;switch(ny(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Dn(s),null;case 1:return hi(s.type)&&lp(),Dn(s),null;case 3:return p=s.stateNode,ou(),Sr(ci),Sr(On),dy(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(r===null||r.child===null)&&(Md(s)?s.flags|=4:r===null||r.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,is!==null&&(Mg(is),is=null))),Sg(r,s),Dn(s),null;case 5:hy(s);var _=Aa(nh.current);if(l=s.type,r!==null&&s.stateNode!=null)B1(r,s,l,p,_),r.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!p){if(s.stateNode===null)throw Error(Le(166));return Dn(s),null}if(r=Aa(Ss.current),Md(s)){p=s.stateNode,l=s.type;var T=s.memoizedProps;switch(p[ws]=s,p[th]=T,r=(s.mode&1)!==0,l){case"dialog":br("cancel",p),br("close",p);break;case"iframe":case"object":case"embed":br("load",p);break;case"video":case"audio":for(_=0;_<Dc.length;_++)br(Dc[_],p);break;case"source":br("error",p);break;case"img":case"image":case"link":br("error",p),br("load",p);break;case"details":br("toggle",p);break;case"input":Tx(p,T),br("invalid",p);break;case"select":p._wrapperState={wasMultiple:!!T.multiple},br("invalid",p);break;case"textarea":kx(p,T),br("invalid",p)}Km(l,T),_=null;for(var v in T)if(T.hasOwnProperty(v)){var d=T[v];v==="children"?typeof d=="string"?p.textContent!==d&&(T.suppressHydrationWarning!==!0&&Ad(p.textContent,d,r),_=["children",d]):typeof d=="number"&&p.textContent!==""+d&&(T.suppressHydrationWarning!==!0&&Ad(p.textContent,d,r),_=["children",""+d]):Zc.hasOwnProperty(v)&&d!=null&&v==="onScroll"&&br("scroll",p)}switch(l){case"input":bd(p),Ex(p,T,!0);break;case"textarea":bd(p),Ix(p);break;case"select":case"option":break;default:typeof T.onClick=="function"&&(p.onclick=ap)}p=_,s.updateQueue=p,p!==null&&(s.flags|=4)}else{v=_.nodeType===9?_:_.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=p0(l)),r==="http://www.w3.org/1999/xhtml"?l==="script"?(r=v.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof p.is=="string"?r=v.createElement(l,{is:p.is}):(r=v.createElement(l),l==="select"&&(v=r,p.multiple?v.multiple=!0:p.size&&(v.size=p.size))):r=v.createElementNS(r,l),r[ws]=s,r[th]=p,O1(r,s,!1,!1),s.stateNode=r;e:{switch(v=Jm(l,p),l){case"dialog":br("cancel",r),br("close",r),_=p;break;case"iframe":case"object":case"embed":br("load",r),_=p;break;case"video":case"audio":for(_=0;_<Dc.length;_++)br(Dc[_],r);_=p;break;case"source":br("error",r),_=p;break;case"img":case"image":case"link":br("error",r),br("load",r),_=p;break;case"details":br("toggle",r),_=p;break;case"input":Tx(r,p),_=Zm(r,p),br("invalid",r);break;case"option":_=p;break;case"select":r._wrapperState={wasMultiple:!!p.multiple},_=Lr({},p,{value:void 0}),br("invalid",r);break;case"textarea":kx(r,p),_=Wm(r,p),br("invalid",r);break;default:_=p}Km(l,_),d=_;for(T in d)if(d.hasOwnProperty(T)){var N=d[T];T==="style"?g0(r,N):T==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,N!=null&&f0(r,N)):T==="children"?typeof N=="string"?(l!=="textarea"||N!=="")&&Hc(r,N):typeof N=="number"&&Hc(r,""+N):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(Zc.hasOwnProperty(T)?N!=null&&T==="onScroll"&&br("scroll",r):N!=null&&Ug(r,T,N,v))}switch(l){case"input":bd(r),Ex(r,p,!1);break;case"textarea":bd(r),Ix(r);break;case"option":p.value!=null&&r.setAttribute("value",""+Go(p.value));break;case"select":r.multiple=!!p.multiple,T=p.value,T!=null?Kl(r,!!p.multiple,T,!1):p.defaultValue!=null&&Kl(r,!!p.multiple,p.defaultValue,!0);break;default:typeof _.onClick=="function"&&(r.onclick=ap)}switch(l){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}}p&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return Dn(s),null;case 6:if(r&&s.stateNode!=null)N1(r,s,r.memoizedProps,p);else{if(typeof p!="string"&&s.stateNode===null)throw Error(Le(166));if(l=Aa(nh.current),Aa(Ss.current),Md(s)){if(p=s.stateNode,l=s.memoizedProps,p[ws]=s,(T=p.nodeValue!==l)&&(r=Mi,r!==null))switch(r.tag){case 3:Ad(p.nodeValue,l,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Ad(p.nodeValue,l,(r.mode&1)!==0)}T&&(s.flags|=4)}else p=(l.nodeType===9?l:l.ownerDocument).createTextNode(p),p[ws]=s,s.stateNode=p}return Dn(s),null;case 13:if(Sr(Rr),p=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(Ir&&Ai!==null&&s.mode&1&&!(s.flags&128))n1(),iu(),s.flags|=98560,T=!1;else if(T=Md(s),p!==null&&p.dehydrated!==null){if(r===null){if(!T)throw Error(Le(318));if(T=s.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(Le(317));T[ws]=s}else iu(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;Dn(s),T=!1}else is!==null&&(Mg(is),is=null),T=!0;if(!T)return s.flags&65536?s:null}return s.flags&128?(s.lanes=l,s):(p=p!==null,p!==(r!==null&&r.memoizedState!==null)&&p&&(s.child.flags|=8192,s.mode&1&&(r===null||Rr.current&1?rn===0&&(rn=3):Ty())),s.updateQueue!==null&&(s.flags|=4),Dn(s),null);case 4:return ou(),Sg(r,s),r===null&&Qc(s.stateNode.containerInfo),Dn(s),null;case 10:return ay(s.type._context),Dn(s),null;case 17:return hi(s.type)&&lp(),Dn(s),null;case 19:if(Sr(Rr),T=s.memoizedState,T===null)return Dn(s),null;if(p=(s.flags&128)!==0,v=T.rendering,v===null)if(p)Cc(T,!1);else{if(rn!==0||r!==null&&r.flags&128)for(r=s.child;r!==null;){if(v=mp(r),v!==null){for(s.flags|=128,Cc(T,!1),p=v.updateQueue,p!==null&&(s.updateQueue=p,s.flags|=4),s.subtreeFlags=0,p=l,l=s.child;l!==null;)T=l,r=p,T.flags&=14680066,v=T.alternate,v===null?(T.childLanes=0,T.lanes=r,T.child=null,T.subtreeFlags=0,T.memoizedProps=null,T.memoizedState=null,T.updateQueue=null,T.dependencies=null,T.stateNode=null):(T.childLanes=v.childLanes,T.lanes=v.lanes,T.child=v.child,T.subtreeFlags=0,T.deletions=null,T.memoizedProps=v.memoizedProps,T.memoizedState=v.memoizedState,T.updateQueue=v.updateQueue,T.type=v.type,r=v.dependencies,T.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),l=l.sibling;return xr(Rr,Rr.current&1|2),s.child}r=r.sibling}T.tail!==null&&Zr()>lu&&(s.flags|=128,p=!0,Cc(T,!1),s.lanes=4194304)}else{if(!p)if(r=mp(v),r!==null){if(s.flags|=128,p=!0,l=r.updateQueue,l!==null&&(s.updateQueue=l,s.flags|=4),Cc(T,!0),T.tail===null&&T.tailMode==="hidden"&&!v.alternate&&!Ir)return Dn(s),null}else 2*Zr()-T.renderingStartTime>lu&&l!==1073741824&&(s.flags|=128,p=!0,Cc(T,!1),s.lanes=4194304);T.isBackwards?(v.sibling=s.child,s.child=v):(l=T.last,l!==null?l.sibling=v:s.child=v,T.last=v)}return T.tail!==null?(s=T.tail,T.rendering=s,T.tail=s.sibling,T.renderingStartTime=Zr(),s.sibling=null,l=Rr.current,xr(Rr,p?l&1|2:l&1),s):(Dn(s),null);case 22:case 23:return Sy(),p=s.memoizedState!==null,r!==null&&r.memoizedState!==null!==p&&(s.flags|=8192),p&&s.mode&1?Pi&1073741824&&(Dn(s),s.subtreeFlags&6&&(s.flags|=8192)):Dn(s),null;case 24:return null;case 25:return null}throw Error(Le(156,s.tag))}function kT(r,s){switch(ny(s),s.tag){case 1:return hi(s.type)&&lp(),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return ou(),Sr(ci),Sr(On),dy(),r=s.flags,r&65536&&!(r&128)?(s.flags=r&-65537|128,s):null;case 5:return hy(s),null;case 13:if(Sr(Rr),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(Le(340));iu()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return Sr(Rr),null;case 4:return ou(),null;case 10:return ay(s.type._context),null;case 22:case 23:return Sy(),null;case 24:return null;default:return null}}var Dd=!1,Ln=!1,IT=typeof WeakSet=="function"?WeakSet:Set,at=null;function Wl(r,s){var l=r.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(p){$r(r,s,p)}else l.current=null}function Tg(r,s,l){try{l()}catch(p){$r(r,s,p)}}var gv=!1;function CT(r,s){if(ag=ip,r=q0(),ty(r)){if("selectionStart"in r)var l={start:r.selectionStart,end:r.selectionEnd};else e:{l=(l=r.ownerDocument)&&l.defaultView||window;var p=l.getSelection&&l.getSelection();if(p&&p.rangeCount!==0){l=p.anchorNode;var _=p.anchorOffset,T=p.focusNode;p=p.focusOffset;try{l.nodeType,T.nodeType}catch{l=null;break e}var v=0,d=-1,N=-1,Z=0,te=0,q=r,U=null;t:for(;;){for(var ke;q!==l||_!==0&&q.nodeType!==3||(d=v+_),q!==T||p!==0&&q.nodeType!==3||(N=v+p),q.nodeType===3&&(v+=q.nodeValue.length),(ke=q.firstChild)!==null;)U=q,q=ke;for(;;){if(q===r)break t;if(U===l&&++Z===_&&(d=v),U===T&&++te===p&&(N=v),(ke=q.nextSibling)!==null)break;q=U,U=q.parentNode}q=ke}l=d===-1||N===-1?null:{start:d,end:N}}else l=null}l=l||{start:0,end:0}}else l=null;for(lg={focusedElem:r,selectionRange:l},ip=!1,at=s;at!==null;)if(s=at,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,at=r;else for(;at!==null;){s=at;try{var ue=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(ue!==null){var _e=ue.memoizedProps,Pe=ue.memoizedState,oe=s.stateNode,re=oe.getSnapshotBeforeUpdate(s.elementType===s.type?_e:rs(s.type,_e),Pe);oe.__reactInternalSnapshotBeforeUpdate=re}break;case 3:var ce=s.stateNode.containerInfo;ce.nodeType===1?ce.textContent="":ce.nodeType===9&&ce.documentElement&&ce.removeChild(ce.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Le(163))}}catch(Ce){$r(s,s.return,Ce)}if(r=s.sibling,r!==null){r.return=s.return,at=r;break}at=s.return}return ue=gv,gv=!1,ue}function Vc(r,s,l){var p=s.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var _=p=p.next;do{if((_.tag&r)===r){var T=_.destroy;_.destroy=void 0,T!==void 0&&Tg(s,l,T)}_=_.next}while(_!==p)}}function Rp(r,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var l=s=s.next;do{if((l.tag&r)===r){var p=l.create;l.destroy=p()}l=l.next}while(l!==s)}}function Eg(r){var s=r.ref;if(s!==null){var l=r.stateNode;switch(r.tag){case 5:r=l;break;default:r=l}typeof s=="function"?s(r):s.current=r}}function j1(r){var s=r.alternate;s!==null&&(r.alternate=null,j1(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&(delete s[ws],delete s[th],delete s[hg],delete s[cT],delete s[hT])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function V1(r){return r.tag===5||r.tag===3||r.tag===4}function yv(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||V1(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function kg(r,s,l){var p=r.tag;if(p===5||p===6)r=r.stateNode,s?l.nodeType===8?l.parentNode.insertBefore(r,s):l.insertBefore(r,s):(l.nodeType===8?(s=l.parentNode,s.insertBefore(r,l)):(s=l,s.appendChild(r)),l=l._reactRootContainer,l!=null||s.onclick!==null||(s.onclick=ap));else if(p!==4&&(r=r.child,r!==null))for(kg(r,s,l),r=r.sibling;r!==null;)kg(r,s,l),r=r.sibling}function Ig(r,s,l){var p=r.tag;if(p===5||p===6)r=r.stateNode,s?l.insertBefore(r,s):l.appendChild(r);else if(p!==4&&(r=r.child,r!==null))for(Ig(r,s,l),r=r.sibling;r!==null;)Ig(r,s,l),r=r.sibling}var vn=null,ns=!1;function zo(r,s,l){for(l=l.child;l!==null;)U1(r,s,l),l=l.sibling}function U1(r,s,l){if(bs&&typeof bs.onCommitFiberUnmount=="function")try{bs.onCommitFiberUnmount(Ep,l)}catch{}switch(l.tag){case 5:Ln||Wl(l,s);case 6:var p=vn,_=ns;vn=null,zo(r,s,l),vn=p,ns=_,vn!==null&&(ns?(r=vn,l=l.stateNode,r.nodeType===8?r.parentNode.removeChild(l):r.removeChild(l)):vn.removeChild(l.stateNode));break;case 18:vn!==null&&(ns?(r=vn,l=l.stateNode,r.nodeType===8?Sm(r.parentNode,l):r.nodeType===1&&Sm(r,l),Kc(r)):Sm(vn,l.stateNode));break;case 4:p=vn,_=ns,vn=l.stateNode.containerInfo,ns=!0,zo(r,s,l),vn=p,ns=_;break;case 0:case 11:case 14:case 15:if(!Ln&&(p=l.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){_=p=p.next;do{var T=_,v=T.destroy;T=T.tag,v!==void 0&&(T&2||T&4)&&Tg(l,s,v),_=_.next}while(_!==p)}zo(r,s,l);break;case 1:if(!Ln&&(Wl(l,s),p=l.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=l.memoizedProps,p.state=l.memoizedState,p.componentWillUnmount()}catch(d){$r(l,s,d)}zo(r,s,l);break;case 21:zo(r,s,l);break;case 22:l.mode&1?(Ln=(p=Ln)||l.memoizedState!==null,zo(r,s,l),Ln=p):zo(r,s,l);break;default:zo(r,s,l)}}function _v(r){var s=r.updateQueue;if(s!==null){r.updateQueue=null;var l=r.stateNode;l===null&&(l=r.stateNode=new IT),s.forEach(function(p){var _=OT.bind(null,r,p);l.has(p)||(l.add(p),p.then(_,_))})}}function ts(r,s){var l=s.deletions;if(l!==null)for(var p=0;p<l.length;p++){var _=l[p];try{var T=r,v=s,d=v;e:for(;d!==null;){switch(d.tag){case 5:vn=d.stateNode,ns=!1;break e;case 3:vn=d.stateNode.containerInfo,ns=!0;break e;case 4:vn=d.stateNode.containerInfo,ns=!0;break e}d=d.return}if(vn===null)throw Error(Le(160));U1(T,v,_),vn=null,ns=!1;var N=_.alternate;N!==null&&(N.return=null),_.return=null}catch(Z){$r(_,s,Z)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)$1(s,r),s=s.sibling}function $1(r,s){var l=r.alternate,p=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(ts(s,r),xs(r),p&4){try{Vc(3,r,r.return),Rp(3,r)}catch(_e){$r(r,r.return,_e)}try{Vc(5,r,r.return)}catch(_e){$r(r,r.return,_e)}}break;case 1:ts(s,r),xs(r),p&512&&l!==null&&Wl(l,l.return);break;case 5:if(ts(s,r),xs(r),p&512&&l!==null&&Wl(l,l.return),r.flags&32){var _=r.stateNode;try{Hc(_,"")}catch(_e){$r(r,r.return,_e)}}if(p&4&&(_=r.stateNode,_!=null)){var T=r.memoizedProps,v=l!==null?l.memoizedProps:T,d=r.type,N=r.updateQueue;if(r.updateQueue=null,N!==null)try{d==="input"&&T.type==="radio"&&T.name!=null&&h0(_,T),Jm(d,v);var Z=Jm(d,T);for(v=0;v<N.length;v+=2){var te=N[v],q=N[v+1];te==="style"?g0(_,q):te==="dangerouslySetInnerHTML"?f0(_,q):te==="children"?Hc(_,q):Ug(_,te,q,Z)}switch(d){case"input":Hm(_,T);break;case"textarea":d0(_,T);break;case"select":var U=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!T.multiple;var ke=T.value;ke!=null?Kl(_,!!T.multiple,ke,!1):U!==!!T.multiple&&(T.defaultValue!=null?Kl(_,!!T.multiple,T.defaultValue,!0):Kl(_,!!T.multiple,T.multiple?[]:"",!1))}_[th]=T}catch(_e){$r(r,r.return,_e)}}break;case 6:if(ts(s,r),xs(r),p&4){if(r.stateNode===null)throw Error(Le(162));_=r.stateNode,T=r.memoizedProps;try{_.nodeValue=T}catch(_e){$r(r,r.return,_e)}}break;case 3:if(ts(s,r),xs(r),p&4&&l!==null&&l.memoizedState.isDehydrated)try{Kc(s.containerInfo)}catch(_e){$r(r,r.return,_e)}break;case 4:ts(s,r),xs(r);break;case 13:ts(s,r),xs(r),_=r.child,_.flags&8192&&(T=_.memoizedState!==null,_.stateNode.isHidden=T,!T||_.alternate!==null&&_.alternate.memoizedState!==null||(wy=Zr())),p&4&&_v(r);break;case 22:if(te=l!==null&&l.memoizedState!==null,r.mode&1?(Ln=(Z=Ln)||te,ts(s,r),Ln=Z):ts(s,r),xs(r),p&8192){if(Z=r.memoizedState!==null,(r.stateNode.isHidden=Z)&&!te&&r.mode&1)for(at=r,te=r.child;te!==null;){for(q=at=te;at!==null;){switch(U=at,ke=U.child,U.tag){case 0:case 11:case 14:case 15:Vc(4,U,U.return);break;case 1:Wl(U,U.return);var ue=U.stateNode;if(typeof ue.componentWillUnmount=="function"){p=U,l=U.return;try{s=p,ue.props=s.memoizedProps,ue.state=s.memoizedState,ue.componentWillUnmount()}catch(_e){$r(p,l,_e)}}break;case 5:Wl(U,U.return);break;case 22:if(U.memoizedState!==null){vv(q);continue}}ke!==null?(ke.return=U,at=ke):vv(q)}te=te.sibling}e:for(te=null,q=r;;){if(q.tag===5){if(te===null){te=q;try{_=q.stateNode,Z?(T=_.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none"):(d=q.stateNode,N=q.memoizedProps.style,v=N!=null&&N.hasOwnProperty("display")?N.display:null,d.style.display=m0("display",v))}catch(_e){$r(r,r.return,_e)}}}else if(q.tag===6){if(te===null)try{q.stateNode.nodeValue=Z?"":q.memoizedProps}catch(_e){$r(r,r.return,_e)}}else if((q.tag!==22&&q.tag!==23||q.memoizedState===null||q===r)&&q.child!==null){q.child.return=q,q=q.child;continue}if(q===r)break e;for(;q.sibling===null;){if(q.return===null||q.return===r)break e;te===q&&(te=null),q=q.return}te===q&&(te=null),q.sibling.return=q.return,q=q.sibling}}break;case 19:ts(s,r),xs(r),p&4&&_v(r);break;case 21:break;default:ts(s,r),xs(r)}}function xs(r){var s=r.flags;if(s&2){try{e:{for(var l=r.return;l!==null;){if(V1(l)){var p=l;break e}l=l.return}throw Error(Le(160))}switch(p.tag){case 5:var _=p.stateNode;p.flags&32&&(Hc(_,""),p.flags&=-33);var T=yv(r);Ig(r,T,_);break;case 3:case 4:var v=p.stateNode.containerInfo,d=yv(r);kg(r,d,v);break;default:throw Error(Le(161))}}catch(N){$r(r,r.return,N)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function PT(r,s,l){at=r,q1(r)}function q1(r,s,l){for(var p=(r.mode&1)!==0;at!==null;){var _=at,T=_.child;if(_.tag===22&&p){var v=_.memoizedState!==null||Dd;if(!v){var d=_.alternate,N=d!==null&&d.memoizedState!==null||Ln;d=Dd;var Z=Ln;if(Dd=v,(Ln=N)&&!Z)for(at=_;at!==null;)v=at,N=v.child,v.tag===22&&v.memoizedState!==null?wv(_):N!==null?(N.return=v,at=N):wv(_);for(;T!==null;)at=T,q1(T),T=T.sibling;at=_,Dd=d,Ln=Z}xv(r)}else _.subtreeFlags&8772&&T!==null?(T.return=_,at=T):xv(r)}}function xv(r){for(;at!==null;){var s=at;if(s.flags&8772){var l=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:Ln||Rp(5,s);break;case 1:var p=s.stateNode;if(s.flags&4&&!Ln)if(l===null)p.componentDidMount();else{var _=s.elementType===s.type?l.memoizedProps:rs(s.type,l.memoizedProps);p.componentDidUpdate(_,l.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var T=s.updateQueue;T!==null&&nv(s,T,p);break;case 3:var v=s.updateQueue;if(v!==null){if(l=null,s.child!==null)switch(s.child.tag){case 5:l=s.child.stateNode;break;case 1:l=s.child.stateNode}nv(s,v,l)}break;case 5:var d=s.stateNode;if(l===null&&s.flags&4){l=d;var N=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":N.autoFocus&&l.focus();break;case"img":N.src&&(l.src=N.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var Z=s.alternate;if(Z!==null){var te=Z.memoizedState;if(te!==null){var q=te.dehydrated;q!==null&&Kc(q)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Le(163))}Ln||s.flags&512&&Eg(s)}catch(U){$r(s,s.return,U)}}if(s===r){at=null;break}if(l=s.sibling,l!==null){l.return=s.return,at=l;break}at=s.return}}function vv(r){for(;at!==null;){var s=at;if(s===r){at=null;break}var l=s.sibling;if(l!==null){l.return=s.return,at=l;break}at=s.return}}function wv(r){for(;at!==null;){var s=at;try{switch(s.tag){case 0:case 11:case 15:var l=s.return;try{Rp(4,s)}catch(N){$r(s,l,N)}break;case 1:var p=s.stateNode;if(typeof p.componentDidMount=="function"){var _=s.return;try{p.componentDidMount()}catch(N){$r(s,_,N)}}var T=s.return;try{Eg(s)}catch(N){$r(s,T,N)}break;case 5:var v=s.return;try{Eg(s)}catch(N){$r(s,v,N)}}}catch(N){$r(s,s.return,N)}if(s===r){at=null;break}var d=s.sibling;if(d!==null){d.return=s.return,at=d;break}at=s.return}}var AT=Math.ceil,_p=Js.ReactCurrentDispatcher,xy=Js.ReactCurrentOwner,Zi=Js.ReactCurrentBatchConfig,Wt=0,pn=null,Jr=null,wn=0,Pi=0,Xl=Ko(0),rn=0,ah=null,Ba=0,Dp=0,vy=0,Uc=null,li=null,wy=0,lu=1/0,Us=null,xp=!1,Cg=null,qo=null,Ld=!1,Bo=null,vp=0,$c=0,Pg=null,Gd=-1,Wd=0;function Wn(){return Wt&6?Zr():Gd!==-1?Gd:Gd=Zr()}function Zo(r){return r.mode&1?Wt&2&&wn!==0?wn&-wn:pT.transition!==null?(Wd===0&&(Wd=C0()),Wd):(r=or,r!==0||(r=window.event,r=r===void 0?16:L0(r.type)),r):1}function os(r,s,l,p){if(50<$c)throw $c=0,Pg=null,Error(Le(185));uh(r,l,p),(!(Wt&2)||r!==pn)&&(r===pn&&(!(Wt&2)&&(Dp|=l),rn===4&&Fo(r,wn)),di(r,p),l===1&&Wt===0&&!(s.mode&1)&&(lu=Zr()+500,Ap&&Jo()))}function di(r,s){var l=r.callbackNode;pS(r,s);var p=np(r,r===pn?wn:0);if(p===0)l!==null&&Ax(l),r.callbackNode=null,r.callbackPriority=0;else if(s=p&-p,r.callbackPriority!==s){if(l!=null&&Ax(l),s===1)r.tag===0?dT(bv.bind(null,r)):e1(bv.bind(null,r)),lT(function(){!(Wt&6)&&Jo()}),l=null;else{switch(P0(p)){case 1:l=Gg;break;case 4:l=k0;break;case 16:l=rp;break;case 536870912:l=I0;break;default:l=rp}l=Y1(l,Z1.bind(null,r))}r.callbackPriority=s,r.callbackNode=l}}function Z1(r,s){if(Gd=-1,Wd=0,Wt&6)throw Error(Le(327));var l=r.callbackNode;if(tu()&&r.callbackNode!==l)return null;var p=np(r,r===pn?wn:0);if(p===0)return null;if(p&30||p&r.expiredLanes||s)s=wp(r,p);else{s=p;var _=Wt;Wt|=2;var T=G1();(pn!==r||wn!==s)&&(Us=null,lu=Zr()+500,za(r,s));do try{RT();break}catch(d){H1(r,d)}while(!0);oy(),_p.current=T,Wt=_,Jr!==null?s=0:(pn=null,wn=0,s=rn)}if(s!==0){if(s===2&&(_=rg(r),_!==0&&(p=_,s=Ag(r,_))),s===1)throw l=ah,za(r,0),Fo(r,p),di(r,Zr()),l;if(s===6)Fo(r,p);else{if(_=r.current.alternate,!(p&30)&&!MT(_)&&(s=wp(r,p),s===2&&(T=rg(r),T!==0&&(p=T,s=Ag(r,T))),s===1))throw l=ah,za(r,0),Fo(r,p),di(r,Zr()),l;switch(r.finishedWork=_,r.finishedLanes=p,s){case 0:case 1:throw Error(Le(345));case 2:Ia(r,li,Us);break;case 3:if(Fo(r,p),(p&130023424)===p&&(s=wy+500-Zr(),10<s)){if(np(r,0)!==0)break;if(_=r.suspendedLanes,(_&p)!==p){Wn(),r.pingedLanes|=r.suspendedLanes&_;break}r.timeoutHandle=cg(Ia.bind(null,r,li,Us),s);break}Ia(r,li,Us);break;case 4:if(Fo(r,p),(p&4194240)===p)break;for(s=r.eventTimes,_=-1;0<p;){var v=31-ss(p);T=1<<v,v=s[v],v>_&&(_=v),p&=~T}if(p=_,p=Zr()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*AT(p/1960))-p,10<p){r.timeoutHandle=cg(Ia.bind(null,r,li,Us),p);break}Ia(r,li,Us);break;case 5:Ia(r,li,Us);break;default:throw Error(Le(329))}}}return di(r,Zr()),r.callbackNode===l?Z1.bind(null,r):null}function Ag(r,s){var l=Uc;return r.current.memoizedState.isDehydrated&&(za(r,s).flags|=256),r=wp(r,s),r!==2&&(s=li,li=l,s!==null&&Mg(s)),r}function Mg(r){li===null?li=r:li.push.apply(li,r)}function MT(r){for(var s=r;;){if(s.flags&16384){var l=s.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var p=0;p<l.length;p++){var _=l[p],T=_.getSnapshot;_=_.value;try{if(!as(T(),_))return!1}catch{return!1}}}if(l=s.child,s.subtreeFlags&16384&&l!==null)l.return=s,s=l;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Fo(r,s){for(s&=~vy,s&=~Dp,r.suspendedLanes|=s,r.pingedLanes&=~s,r=r.expirationTimes;0<s;){var l=31-ss(s),p=1<<l;r[l]=-1,s&=~p}}function bv(r){if(Wt&6)throw Error(Le(327));tu();var s=np(r,0);if(!(s&1))return di(r,Zr()),null;var l=wp(r,s);if(r.tag!==0&&l===2){var p=rg(r);p!==0&&(s=p,l=Ag(r,p))}if(l===1)throw l=ah,za(r,0),Fo(r,s),di(r,Zr()),l;if(l===6)throw Error(Le(345));return r.finishedWork=r.current.alternate,r.finishedLanes=s,Ia(r,li,Us),di(r,Zr()),null}function by(r,s){var l=Wt;Wt|=1;try{return r(s)}finally{Wt=l,Wt===0&&(lu=Zr()+500,Ap&&Jo())}}function Na(r){Bo!==null&&Bo.tag===0&&!(Wt&6)&&tu();var s=Wt;Wt|=1;var l=Zi.transition,p=or;try{if(Zi.transition=null,or=1,r)return r()}finally{or=p,Zi.transition=l,Wt=s,!(Wt&6)&&Jo()}}function Sy(){Pi=Xl.current,Sr(Xl)}function za(r,s){r.finishedWork=null,r.finishedLanes=0;var l=r.timeoutHandle;if(l!==-1&&(r.timeoutHandle=-1,aT(l)),Jr!==null)for(l=Jr.return;l!==null;){var p=l;switch(ny(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&lp();break;case 3:ou(),Sr(ci),Sr(On),dy();break;case 5:hy(p);break;case 4:ou();break;case 13:Sr(Rr);break;case 19:Sr(Rr);break;case 10:ay(p.type._context);break;case 22:case 23:Sy()}l=l.return}if(pn=r,Jr=r=Ho(r.current,null),wn=Pi=s,rn=0,ah=null,vy=Dp=Ba=0,li=Uc=null,Pa!==null){for(s=0;s<Pa.length;s++)if(l=Pa[s],p=l.interleaved,p!==null){l.interleaved=null;var _=p.next,T=l.pending;if(T!==null){var v=T.next;T.next=_,p.next=v}l.pending=p}Pa=null}return r}function H1(r,s){do{var l=Jr;try{if(oy(),qd.current=yp,gp){for(var p=Dr.memoizedState;p!==null;){var _=p.queue;_!==null&&(_.pending=null),p=p.next}gp=!1}if(Oa=0,dn=tn=Dr=null,jc=!1,ih=0,xy.current=null,l===null||l.return===null){rn=1,ah=s,Jr=null;break}e:{var T=r,v=l.return,d=l,N=s;if(s=wn,d.flags|=32768,N!==null&&typeof N=="object"&&typeof N.then=="function"){var Z=N,te=d,q=te.tag;if(!(te.mode&1)&&(q===0||q===11||q===15)){var U=te.alternate;U?(te.updateQueue=U.updateQueue,te.memoizedState=U.memoizedState,te.lanes=U.lanes):(te.updateQueue=null,te.memoizedState=null)}var ke=uv(v);if(ke!==null){ke.flags&=-257,cv(ke,v,d,T,s),ke.mode&1&&lv(T,Z,s),s=ke,N=Z;var ue=s.updateQueue;if(ue===null){var _e=new Set;_e.add(N),s.updateQueue=_e}else ue.add(N);break e}else{if(!(s&1)){lv(T,Z,s),Ty();break e}N=Error(Le(426))}}else if(Ir&&d.mode&1){var Pe=uv(v);if(Pe!==null){!(Pe.flags&65536)&&(Pe.flags|=256),cv(Pe,v,d,T,s),iy(au(N,d));break e}}T=N=au(N,d),rn!==4&&(rn=2),Uc===null?Uc=[T]:Uc.push(T),T=v;do{switch(T.tag){case 3:T.flags|=65536,s&=-s,T.lanes|=s;var oe=P1(T,N,s);rv(T,oe);break e;case 1:d=N;var re=T.type,ce=T.stateNode;if(!(T.flags&128)&&(typeof re.getDerivedStateFromError=="function"||ce!==null&&typeof ce.componentDidCatch=="function"&&(qo===null||!qo.has(ce)))){T.flags|=65536,s&=-s,T.lanes|=s;var Ce=A1(T,d,s);rv(T,Ce);break e}}T=T.return}while(T!==null)}X1(l)}catch(De){s=De,Jr===l&&l!==null&&(Jr=l=l.return);continue}break}while(!0)}function G1(){var r=_p.current;return _p.current=yp,r===null?yp:r}function Ty(){(rn===0||rn===3||rn===2)&&(rn=4),pn===null||!(Ba&268435455)&&!(Dp&268435455)||Fo(pn,wn)}function wp(r,s){var l=Wt;Wt|=2;var p=G1();(pn!==r||wn!==s)&&(Us=null,za(r,s));do try{zT();break}catch(_){H1(r,_)}while(!0);if(oy(),Wt=l,_p.current=p,Jr!==null)throw Error(Le(261));return pn=null,wn=0,rn}function zT(){for(;Jr!==null;)W1(Jr)}function RT(){for(;Jr!==null&&!iS();)W1(Jr)}function W1(r){var s=J1(r.alternate,r,Pi);r.memoizedProps=r.pendingProps,s===null?X1(r):Jr=s,xy.current=null}function X1(r){var s=r;do{var l=s.alternate;if(r=s.return,s.flags&32768){if(l=kT(l,s),l!==null){l.flags&=32767,Jr=l;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{rn=6,Jr=null;return}}else if(l=ET(l,s,Pi),l!==null){Jr=l;return}if(s=s.sibling,s!==null){Jr=s;return}Jr=s=r}while(s!==null);rn===0&&(rn=5)}function Ia(r,s,l){var p=or,_=Zi.transition;try{Zi.transition=null,or=1,DT(r,s,l,p)}finally{Zi.transition=_,or=p}return null}function DT(r,s,l,p){do tu();while(Bo!==null);if(Wt&6)throw Error(Le(327));l=r.finishedWork;var _=r.finishedLanes;if(l===null)return null;if(r.finishedWork=null,r.finishedLanes=0,l===r.current)throw Error(Le(177));r.callbackNode=null,r.callbackPriority=0;var T=l.lanes|l.childLanes;if(fS(r,T),r===pn&&(Jr=pn=null,wn=0),!(l.subtreeFlags&2064)&&!(l.flags&2064)||Ld||(Ld=!0,Y1(rp,function(){return tu(),null})),T=(l.flags&15990)!==0,l.subtreeFlags&15990||T){T=Zi.transition,Zi.transition=null;var v=or;or=1;var d=Wt;Wt|=4,xy.current=null,CT(r,l),$1(l,r),eT(lg),ip=!!ag,lg=ag=null,r.current=l,PT(l),sS(),Wt=d,or=v,Zi.transition=T}else r.current=l;if(Ld&&(Ld=!1,Bo=r,vp=_),T=r.pendingLanes,T===0&&(qo=null),lS(l.stateNode),di(r,Zr()),s!==null)for(p=r.onRecoverableError,l=0;l<s.length;l++)_=s[l],p(_.value,{componentStack:_.stack,digest:_.digest});if(xp)throw xp=!1,r=Cg,Cg=null,r;return vp&1&&r.tag!==0&&tu(),T=r.pendingLanes,T&1?r===Pg?$c++:($c=0,Pg=r):$c=0,Jo(),null}function tu(){if(Bo!==null){var r=P0(vp),s=Zi.transition,l=or;try{if(Zi.transition=null,or=16>r?16:r,Bo===null)var p=!1;else{if(r=Bo,Bo=null,vp=0,Wt&6)throw Error(Le(331));var _=Wt;for(Wt|=4,at=r.current;at!==null;){var T=at,v=T.child;if(at.flags&16){var d=T.deletions;if(d!==null){for(var N=0;N<d.length;N++){var Z=d[N];for(at=Z;at!==null;){var te=at;switch(te.tag){case 0:case 11:case 15:Vc(8,te,T)}var q=te.child;if(q!==null)q.return=te,at=q;else for(;at!==null;){te=at;var U=te.sibling,ke=te.return;if(j1(te),te===Z){at=null;break}if(U!==null){U.return=ke,at=U;break}at=ke}}}var ue=T.alternate;if(ue!==null){var _e=ue.child;if(_e!==null){ue.child=null;do{var Pe=_e.sibling;_e.sibling=null,_e=Pe}while(_e!==null)}}at=T}}if(T.subtreeFlags&2064&&v!==null)v.return=T,at=v;else e:for(;at!==null;){if(T=at,T.flags&2048)switch(T.tag){case 0:case 11:case 15:Vc(9,T,T.return)}var oe=T.sibling;if(oe!==null){oe.return=T.return,at=oe;break e}at=T.return}}var re=r.current;for(at=re;at!==null;){v=at;var ce=v.child;if(v.subtreeFlags&2064&&ce!==null)ce.return=v,at=ce;else e:for(v=re;at!==null;){if(d=at,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:Rp(9,d)}}catch(De){$r(d,d.return,De)}if(d===v){at=null;break e}var Ce=d.sibling;if(Ce!==null){Ce.return=d.return,at=Ce;break e}at=d.return}}if(Wt=_,Jo(),bs&&typeof bs.onPostCommitFiberRoot=="function")try{bs.onPostCommitFiberRoot(Ep,r)}catch{}p=!0}return p}finally{or=l,Zi.transition=s}}return!1}function Sv(r,s,l){s=au(l,s),s=P1(r,s,1),r=$o(r,s,1),s=Wn(),r!==null&&(uh(r,1,s),di(r,s))}function $r(r,s,l){if(r.tag===3)Sv(r,r,l);else for(;s!==null;){if(s.tag===3){Sv(s,r,l);break}else if(s.tag===1){var p=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(qo===null||!qo.has(p))){r=au(l,r),r=A1(s,r,1),s=$o(s,r,1),r=Wn(),s!==null&&(uh(s,1,r),di(s,r));break}}s=s.return}}function LT(r,s,l){var p=r.pingCache;p!==null&&p.delete(s),s=Wn(),r.pingedLanes|=r.suspendedLanes&l,pn===r&&(wn&l)===l&&(rn===4||rn===3&&(wn&130023424)===wn&&500>Zr()-wy?za(r,0):vy|=l),di(r,s)}function K1(r,s){s===0&&(r.mode&1?(s=Ed,Ed<<=1,!(Ed&130023424)&&(Ed=4194304)):s=1);var l=Wn();r=Xs(r,s),r!==null&&(uh(r,s,l),di(r,l))}function FT(r){var s=r.memoizedState,l=0;s!==null&&(l=s.retryLane),K1(r,l)}function OT(r,s){var l=0;switch(r.tag){case 13:var p=r.stateNode,_=r.memoizedState;_!==null&&(l=_.retryLane);break;case 19:p=r.stateNode;break;default:throw Error(Le(314))}p!==null&&p.delete(s),K1(r,l)}var J1;J1=function(r,s,l){if(r!==null)if(r.memoizedProps!==s.pendingProps||ci.current)ui=!0;else{if(!(r.lanes&l)&&!(s.flags&128))return ui=!1,TT(r,s,l);ui=!!(r.flags&131072)}else ui=!1,Ir&&s.flags&1048576&&t1(s,hp,s.index);switch(s.lanes=0,s.tag){case 2:var p=s.type;Hd(r,s),r=s.pendingProps;var _=nu(s,On.current);eu(s,l),_=fy(null,s,p,r,_,l);var T=my();return s.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,hi(p)?(T=!0,up(s)):T=!1,s.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,uy(s),_.updater=zp,s.stateNode=_,_._reactInternals=s,yg(s,p,r,l),s=vg(null,s,p,!0,T,l)):(s.tag=0,Ir&&T&&ry(s),Gn(null,s,_,l),s=s.child),s;case 16:p=s.elementType;e:{switch(Hd(r,s),r=s.pendingProps,_=p._init,p=_(p._payload),s.type=p,_=s.tag=NT(p),r=rs(p,r),_){case 0:s=xg(null,s,p,r,l);break e;case 1:s=pv(null,s,p,r,l);break e;case 11:s=hv(null,s,p,r,l);break e;case 14:s=dv(null,s,p,rs(p.type,r),l);break e}throw Error(Le(306,p,""))}return s;case 0:return p=s.type,_=s.pendingProps,_=s.elementType===p?_:rs(p,_),xg(r,s,p,_,l);case 1:return p=s.type,_=s.pendingProps,_=s.elementType===p?_:rs(p,_),pv(r,s,p,_,l);case 3:e:{if(D1(s),r===null)throw Error(Le(387));p=s.pendingProps,T=s.memoizedState,_=T.element,a1(r,s),fp(s,p,null,l);var v=s.memoizedState;if(p=v.element,T.isDehydrated)if(T={element:p,isDehydrated:!1,cache:v.cache,pendingSuspenseBoundaries:v.pendingSuspenseBoundaries,transitions:v.transitions},s.updateQueue.baseState=T,s.memoizedState=T,s.flags&256){_=au(Error(Le(423)),s),s=fv(r,s,p,l,_);break e}else if(p!==_){_=au(Error(Le(424)),s),s=fv(r,s,p,l,_);break e}else for(Ai=Uo(s.stateNode.containerInfo.firstChild),Mi=s,Ir=!0,is=null,l=s1(s,null,p,l),s.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(iu(),p===_){s=Ks(r,s,l);break e}Gn(r,s,p,l)}s=s.child}return s;case 5:return l1(s),r===null&&fg(s),p=s.type,_=s.pendingProps,T=r!==null?r.memoizedProps:null,v=_.children,ug(p,_)?v=null:T!==null&&ug(p,T)&&(s.flags|=32),R1(r,s),Gn(r,s,v,l),s.child;case 6:return r===null&&fg(s),null;case 13:return L1(r,s,l);case 4:return cy(s,s.stateNode.containerInfo),p=s.pendingProps,r===null?s.child=su(s,null,p,l):Gn(r,s,p,l),s.child;case 11:return p=s.type,_=s.pendingProps,_=s.elementType===p?_:rs(p,_),hv(r,s,p,_,l);case 7:return Gn(r,s,s.pendingProps,l),s.child;case 8:return Gn(r,s,s.pendingProps.children,l),s.child;case 12:return Gn(r,s,s.pendingProps.children,l),s.child;case 10:e:{if(p=s.type._context,_=s.pendingProps,T=s.memoizedProps,v=_.value,xr(dp,p._currentValue),p._currentValue=v,T!==null)if(as(T.value,v)){if(T.children===_.children&&!ci.current){s=Ks(r,s,l);break e}}else for(T=s.child,T!==null&&(T.return=s);T!==null;){var d=T.dependencies;if(d!==null){v=T.child;for(var N=d.firstContext;N!==null;){if(N.context===p){if(T.tag===1){N=Hs(-1,l&-l),N.tag=2;var Z=T.updateQueue;if(Z!==null){Z=Z.shared;var te=Z.pending;te===null?N.next=N:(N.next=te.next,te.next=N),Z.pending=N}}T.lanes|=l,N=T.alternate,N!==null&&(N.lanes|=l),mg(T.return,l,s),d.lanes|=l;break}N=N.next}}else if(T.tag===10)v=T.type===s.type?null:T.child;else if(T.tag===18){if(v=T.return,v===null)throw Error(Le(341));v.lanes|=l,d=v.alternate,d!==null&&(d.lanes|=l),mg(v,l,s),v=T.sibling}else v=T.child;if(v!==null)v.return=T;else for(v=T;v!==null;){if(v===s){v=null;break}if(T=v.sibling,T!==null){T.return=v.return,v=T;break}v=v.return}T=v}Gn(r,s,_.children,l),s=s.child}return s;case 9:return _=s.type,p=s.pendingProps.children,eu(s,l),_=Hi(_),p=p(_),s.flags|=1,Gn(r,s,p,l),s.child;case 14:return p=s.type,_=rs(p,s.pendingProps),_=rs(p.type,_),dv(r,s,p,_,l);case 15:return M1(r,s,s.type,s.pendingProps,l);case 17:return p=s.type,_=s.pendingProps,_=s.elementType===p?_:rs(p,_),Hd(r,s),s.tag=1,hi(p)?(r=!0,up(s)):r=!1,eu(s,l),C1(s,p,_),yg(s,p,_,l),vg(null,s,p,!0,r,l);case 19:return F1(r,s,l);case 22:return z1(r,s,l)}throw Error(Le(156,s.tag))};function Y1(r,s){return E0(r,s)}function BT(r,s,l,p){this.tag=r,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qi(r,s,l,p){return new BT(r,s,l,p)}function Ey(r){return r=r.prototype,!(!r||!r.isReactComponent)}function NT(r){if(typeof r=="function")return Ey(r)?1:0;if(r!=null){if(r=r.$$typeof,r===qg)return 11;if(r===Zg)return 14}return 2}function Ho(r,s){var l=r.alternate;return l===null?(l=qi(r.tag,s,r.key,r.mode),l.elementType=r.elementType,l.type=r.type,l.stateNode=r.stateNode,l.alternate=r,r.alternate=l):(l.pendingProps=s,l.type=r.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=r.flags&14680064,l.childLanes=r.childLanes,l.lanes=r.lanes,l.child=r.child,l.memoizedProps=r.memoizedProps,l.memoizedState=r.memoizedState,l.updateQueue=r.updateQueue,s=r.dependencies,l.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},l.sibling=r.sibling,l.index=r.index,l.ref=r.ref,l}function Xd(r,s,l,p,_,T){var v=2;if(p=r,typeof r=="function")Ey(r)&&(v=1);else if(typeof r=="string")v=5;else e:switch(r){case Nl:return Ra(l.children,_,T,s);case $g:v=8,_|=8;break;case Vm:return r=qi(12,l,s,_|2),r.elementType=Vm,r.lanes=T,r;case Um:return r=qi(13,l,s,_),r.elementType=Um,r.lanes=T,r;case $m:return r=qi(19,l,s,_),r.elementType=$m,r.lanes=T,r;case l0:return Lp(l,_,T,s);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case o0:v=10;break e;case a0:v=9;break e;case qg:v=11;break e;case Zg:v=14;break e;case Ro:v=16,p=null;break e}throw Error(Le(130,r==null?r:typeof r,""))}return s=qi(v,l,s,_),s.elementType=r,s.type=p,s.lanes=T,s}function Ra(r,s,l,p){return r=qi(7,r,p,s),r.lanes=l,r}function Lp(r,s,l,p){return r=qi(22,r,p,s),r.elementType=l0,r.lanes=l,r.stateNode={isHidden:!1},r}function Mm(r,s,l){return r=qi(6,r,null,s),r.lanes=l,r}function zm(r,s,l){return s=qi(4,r.children!==null?r.children:[],r.key,s),s.lanes=l,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}function jT(r,s,l,p,_){this.tag=s,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=dm(0),this.expirationTimes=dm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=dm(0),this.identifierPrefix=p,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function ky(r,s,l,p,_,T,v,d,N){return r=new jT(r,s,l,d,N),s===1?(s=1,T===!0&&(s|=8)):s=0,T=qi(3,null,null,s),r.current=T,T.stateNode=r,T.memoizedState={element:p,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},uy(T),r}function VT(r,s,l){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Bl,key:p==null?null:""+p,children:r,containerInfo:s,implementation:l}}function Q1(r){if(!r)return Wo;r=r._reactInternals;e:{if(Ua(r)!==r||r.tag!==1)throw Error(Le(170));var s=r;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(hi(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(Le(171))}if(r.tag===1){var l=r.type;if(hi(l))return Q0(r,l,s)}return s}function ew(r,s,l,p,_,T,v,d,N){return r=ky(l,p,!0,r,_,T,v,d,N),r.context=Q1(null),l=r.current,p=Wn(),_=Zo(l),T=Hs(p,_),T.callback=s??null,$o(l,T,_),r.current.lanes=_,uh(r,_,p),di(r,p),r}function Fp(r,s,l,p){var _=s.current,T=Wn(),v=Zo(_);return l=Q1(l),s.context===null?s.context=l:s.pendingContext=l,s=Hs(T,v),s.payload={element:r},p=p===void 0?null:p,p!==null&&(s.callback=p),r=$o(_,s,v),r!==null&&(os(r,_,v,T),$d(r,_,v)),v}function bp(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function Tv(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var l=r.retryLane;r.retryLane=l!==0&&l<s?l:s}}function Iy(r,s){Tv(r,s),(r=r.alternate)&&Tv(r,s)}function UT(){return null}var tw=typeof reportError=="function"?reportError:function(r){console.error(r)};function Cy(r){this._internalRoot=r}Op.prototype.render=Cy.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(Le(409));Fp(r,s,null,null)};Op.prototype.unmount=Cy.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;Na(function(){Fp(null,r,null,null)}),s[Ws]=null}};function Op(r){this._internalRoot=r}Op.prototype.unstable_scheduleHydration=function(r){if(r){var s=z0();r={blockedOn:null,target:r,priority:s};for(var l=0;l<Lo.length&&s!==0&&s<Lo[l].priority;l++);Lo.splice(l,0,r),l===0&&D0(r)}};function Py(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Bp(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function Ev(){}function $T(r,s,l,p,_){if(_){if(typeof p=="function"){var T=p;p=function(){var Z=bp(v);T.call(Z)}}var v=ew(s,p,r,0,null,!1,!1,"",Ev);return r._reactRootContainer=v,r[Ws]=v.current,Qc(r.nodeType===8?r.parentNode:r),Na(),v}for(;_=r.lastChild;)r.removeChild(_);if(typeof p=="function"){var d=p;p=function(){var Z=bp(N);d.call(Z)}}var N=ky(r,0,!1,null,null,!1,!1,"",Ev);return r._reactRootContainer=N,r[Ws]=N.current,Qc(r.nodeType===8?r.parentNode:r),Na(function(){Fp(s,N,l,p)}),N}function Np(r,s,l,p,_){var T=l._reactRootContainer;if(T){var v=T;if(typeof _=="function"){var d=_;_=function(){var N=bp(v);d.call(N)}}Fp(s,v,r,_)}else v=$T(l,s,r,_,p);return bp(v)}A0=function(r){switch(r.tag){case 3:var s=r.stateNode;if(s.current.memoizedState.isDehydrated){var l=Rc(s.pendingLanes);l!==0&&(Wg(s,l|1),di(s,Zr()),!(Wt&6)&&(lu=Zr()+500,Jo()))}break;case 13:Na(function(){var p=Xs(r,1);if(p!==null){var _=Wn();os(p,r,1,_)}}),Iy(r,1)}};Xg=function(r){if(r.tag===13){var s=Xs(r,134217728);if(s!==null){var l=Wn();os(s,r,134217728,l)}Iy(r,134217728)}};M0=function(r){if(r.tag===13){var s=Zo(r),l=Xs(r,s);if(l!==null){var p=Wn();os(l,r,s,p)}Iy(r,s)}};z0=function(){return or};R0=function(r,s){var l=or;try{return or=r,s()}finally{or=l}};Qm=function(r,s,l){switch(s){case"input":if(Hm(r,l),s=l.name,l.type==="radio"&&s!=null){for(l=r;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<l.length;s++){var p=l[s];if(p!==r&&p.form===r.form){var _=Pp(p);if(!_)throw Error(Le(90));c0(p),Hm(p,_)}}}break;case"textarea":d0(r,l);break;case"select":s=l.value,s!=null&&Kl(r,!!l.multiple,s,!1)}};x0=by;v0=Na;var qT={usingClientEntryPoint:!1,Events:[hh,$l,Pp,y0,_0,by]},Pc={findFiberByHostInstance:Ca,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ZT={bundleType:Pc.bundleType,version:Pc.version,rendererPackageName:Pc.rendererPackageName,rendererConfig:Pc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Js.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=S0(r),r===null?null:r.stateNode},findFiberByHostInstance:Pc.findFiberByHostInstance||UT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Fd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Fd.isDisabled&&Fd.supportsFiber)try{Ep=Fd.inject(ZT),bs=Fd}catch{}}Ri.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=qT;Ri.createPortal=function(r,s){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Py(s))throw Error(Le(200));return VT(r,s,null,l)};Ri.createRoot=function(r,s){if(!Py(r))throw Error(Le(299));var l=!1,p="",_=tw;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(p=s.identifierPrefix),s.onRecoverableError!==void 0&&(_=s.onRecoverableError)),s=ky(r,1,!1,null,null,l,!1,p,_),r[Ws]=s.current,Qc(r.nodeType===8?r.parentNode:r),new Cy(s)};Ri.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(Le(188)):(r=Object.keys(r).join(","),Error(Le(268,r)));return r=S0(s),r=r===null?null:r.stateNode,r};Ri.flushSync=function(r){return Na(r)};Ri.hydrate=function(r,s,l){if(!Bp(s))throw Error(Le(200));return Np(null,r,s,!0,l)};Ri.hydrateRoot=function(r,s,l){if(!Py(r))throw Error(Le(405));var p=l!=null&&l.hydratedSources||null,_=!1,T="",v=tw;if(l!=null&&(l.unstable_strictMode===!0&&(_=!0),l.identifierPrefix!==void 0&&(T=l.identifierPrefix),l.onRecoverableError!==void 0&&(v=l.onRecoverableError)),s=ew(s,null,r,1,l??null,_,!1,T,v),r[Ws]=s.current,Qc(r),p)for(r=0;r<p.length;r++)l=p[r],_=l._getVersion,_=_(l._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[l,_]:s.mutableSourceEagerHydrationData.push(l,_);return new Op(s)};Ri.render=function(r,s,l){if(!Bp(s))throw Error(Le(200));return Np(null,r,s,!1,l)};Ri.unmountComponentAtNode=function(r){if(!Bp(r))throw Error(Le(40));return r._reactRootContainer?(Na(function(){Np(null,null,r,!1,function(){r._reactRootContainer=null,r[Ws]=null})}),!0):!1};Ri.unstable_batchedUpdates=by;Ri.unstable_renderSubtreeIntoContainer=function(r,s,l,p){if(!Bp(l))throw Error(Le(200));if(r==null||r._reactInternals===void 0)throw Error(Le(38));return Np(r,s,l,!1,p)};Ri.version="18.3.1-next-f1338f8080-20240426";function rw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(rw)}catch(r){console.error(r)}}rw(),r0.exports=Ri;var HT=r0.exports,kv=HT;Nm.createRoot=kv.createRoot,Nm.hydrateRoot=kv.hydrateRoot;var nw={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(r,s){(function(l,p){r.exports=p()})(x2,function(){var l={},p={};function _(v,d,N){if(p[v]=N,v==="index"){var Z="var sharedModule = {}; ("+p.shared+")(sharedModule); ("+p.worker+")(sharedModule);",te={};return p.shared(te),p.index(l,te),typeof window<"u"&&l.setWorkerUrl(window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"}))),l}}_("shared",["exports"],function(v){function d(n,t,i,a){return new(i||(i=Promise))(function(h,g){function y(k){try{b(a.next(k))}catch(I){g(I)}}function x(k){try{b(a.throw(k))}catch(I){g(I)}}function b(k){var I;k.done?h(k.value):(I=k.value,I instanceof i?I:new i(function(P){P(I)})).then(y,x)}b((a=a.apply(n,t||[])).next())})}function N(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}typeof SuppressedError=="function"&&SuppressedError;var Z=te;function te(n,t){this.x=n,this.y=t}te.prototype={clone:function(){return new te(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,i=n.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),i=Math.sin(n),a=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=a,this},_rotateAround:function(n,t){var i=Math.cos(n),a=Math.sin(n),h=t.y+a*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-a*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},te.convert=function(n){return n instanceof te?n:Array.isArray(n)?new te(n[0],n[1]):n};var q=N(Z),U=ke;function ke(n,t,i,a){this.cx=3*n,this.bx=3*(i-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=i,this.p2y=a}ke.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var i=n,a=0;a<8;a++){var h=this.sampleCurveX(i)-n;if(Math.abs(h)<t)return i;var g=this.sampleCurveDerivativeX(i);if(Math.abs(g)<1e-6)break;i-=h/g}var y=0,x=1;for(i=n,a=0;a<20&&(h=this.sampleCurveX(i),!(Math.abs(h-n)<t));a++)n>h?y=i:x=i,i=.5*(x-y)+y;return i},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var ue=N(U);let _e,Pe;function oe(){return _e==null&&(_e=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),_e}function re(){if(Pe==null&&(Pe=!1,oe())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<5*5;a++){const h=4*a;t.fillStyle=`rgb(${h},${h+1},${h+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}const i=t.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&i[a]!==a){Pe=!0;break}}}return Pe||!1}function ce(n,t,i,a){const h=new ue(n,t,i,a);return g=>h.solve(g)}const Ce=ce(.25,.1,.25,1);function De(n,t,i){return Math.min(i,Math.max(t,n))}function Ue(n,t,i){const a=i-t,h=((n-t)%a+a)%a+t;return h===t?i:h}function Oe(n,...t){for(const i of t)for(const a in i)n[a]=i[a];return n}let Qe=1;function _t(n,t,i){const a={};for(const h in n)a[h]=t.call(this,n[h],h,n);return a}function mt(n,t,i){const a={};for(const h in n)t.call(this,n[h],h,n)&&(a[h]=n[h]);return a}function pt(n){return Array.isArray(n)?n.map(pt):typeof n=="object"&&n?_t(n,pt):n}const Xt={};function Dt(n){Xt[n]||(typeof console<"u"&&console.warn(n),Xt[n]=!0)}function Lt(n,t,i){return(i.y-n.y)*(t.x-n.x)>(t.y-n.y)*(i.x-n.x)}function fr(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let nr=null;function Or(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const Ze="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ft(n,t,i,a,h){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(n,{timestamp:0});try{const y=g==null?void 0:g.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const x=y.startsWith("BGR"),b=new Uint8ClampedArray(a*h*4);if(yield g.copyTo(b,function(k,I,P,z,L){const O=4*Math.max(-I,0),j=(Math.max(0,P)-P)*z*4+O,X=4*z,J=Math.max(0,I),me=Math.max(0,P);return{rect:{x:J,y:me,width:Math.min(k.width,I+z)-J,height:Math.min(k.height,P+L)-me},layout:[{offset:j,stride:X}]}}(n,t,i,a,h)),x)for(let k=0;k<b.length;k+=4){const I=b[k];b[k]=b[k+2],b[k+2]=I}return b}finally{g.close()}})}let gt,wt;const Pt="AbortError";function ar(){return new Error(Pt)}const mr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Cr(n){return mr.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const Yt="global-dispatcher";class Pr extends Error{constructor(t,i,a,h){super(`AJAXError: ${i} (${t}): ${a}`),this.status=t,this.statusText=i,this.url=a,this.body=h}}const Sn=()=>fr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Wi=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const a=Cr(n.url);if(a)return a(n,t);if(fr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:Yt},t)}if(!(/^file:/.test(i=n.url)||/^file:/.test(Sn())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(a,h){return d(this,void 0,void 0,function*(){const g=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:Sn(),signal:h.signal});a.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");const y=yield fetch(g);if(!y.ok){const k=yield y.blob();throw new Pr(y.status,y.statusText,a.url,k)}let x;x=a.type==="arrayBuffer"||a.type==="image"?y.arrayBuffer():a.type==="json"?y.json():y.text();const b=yield x;if(h.signal.aborted)throw ar();return{data:b,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}})}(n,t);if(fr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:Yt},t)}var i;return function(a,h){return new Promise((g,y)=>{var x;const b=new XMLHttpRequest;b.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(b.responseType="arraybuffer");for(const k in a.headers)b.setRequestHeader(k,a.headers[k]);a.type==="json"&&(b.responseType="text",!((x=a.headers)===null||x===void 0)&&x.Accept||b.setRequestHeader("Accept","application/json")),b.withCredentials=a.credentials==="include",b.onerror=()=>{y(new Error(b.statusText))},b.onload=()=>{if(!h.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let k=b.response;if(a.type==="json")try{k=JSON.parse(b.response)}catch(I){return void y(I)}g({data:k,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{const k=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});y(new Pr(b.status,b.statusText,a.url,k))}},h.signal.addEventListener("abort",()=>{b.abort(),y(ar())}),b.send(a.body)})}(n,t)};function Hr(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),i=window.location;return t.protocol===i.protocol&&t.host===i.host}function Jn(n,t,i){i[n]&&i[n].indexOf(t)!==-1||(i[n]=i[n]||[],i[n].push(t))}function Br(n,t,i){if(i&&i[n]){const a=i[n].indexOf(t);a!==-1&&i[n].splice(a,1)}}class Yn{constructor(t,i={}){Oe(this,i),this.type=t}}class mi extends Yn{constructor(t,i={}){super("error",Oe({error:t},i))}}class us{on(t,i){return this._listeners=this._listeners||{},Jn(t,i,this._listeners),this}off(t,i){return Br(t,i,this._listeners),Br(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Jn(t,i,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,i){typeof t=="string"&&(t=new Yn(t,i||{}));const a=t.type;if(this.listens(a)){t.target=this;const h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const x of h)x.call(this,t);const g=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const x of g)Br(a,x,this._oneTimeListeners),x.call(this,t);const y=this._eventedParent;y&&(Oe(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(t))}else t instanceof mi&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Xi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function cs(n,t){const i={};for(const a in n)a!=="ref"&&(i[a]=n[a]);return Xi.forEach(a=>{a in t&&(i[a]=t[a])}),i}function Ft(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let i=0;i<n.length;i++)if(!Ft(n[i],t[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const i in n)if(!Ft(n[i],t[i]))return!1;return!0}return n===t}function gr(n,t){n.push(t)}function Ts(n,t,i){gr(i,{command:"addSource",args:[n,t[n]]})}function gi(n,t,i){gr(t,{command:"removeSource",args:[n]}),i[n]=!0}function Qn(n,t,i,a){gi(n,i,a),Ts(n,t,i)}function it(n,t,i){let a;for(a in n[i])if(Object.prototype.hasOwnProperty.call(n[i],a)&&a!=="data"&&!Ft(n[i][a],t[i][a]))return!1;for(a in t[i])if(Object.prototype.hasOwnProperty.call(t[i],a)&&a!=="data"&&!Ft(n[i][a],t[i][a]))return!1;return!0}function Tt(n,t,i,a,h,g){n=n||{},t=t||{};for(const y in n)Object.prototype.hasOwnProperty.call(n,y)&&(Ft(n[y],t[y])||i.push({command:g,args:[a,y,t[y],h]}));for(const y in t)Object.prototype.hasOwnProperty.call(t,y)&&!Object.prototype.hasOwnProperty.call(n,y)&&(Ft(n[y],t[y])||i.push({command:g,args:[a,y,t[y],h]}))}function Ht(n){return n.id}function ut(n,t){return n[t.id]=t,n}class Ie{constructor(t,i,a,h){this.message=(t?`${t}: `:"")+a,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function Vt(n,...t){for(const i of t)for(const a in i)n[a]=i[a];return n}class Ot extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}class lr{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[a,h]of i)this.bindings[a]=h}concat(t){return new lr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Nr={kind:"null"},Me={kind:"number"},yt={kind:"string"},st={kind:"boolean"},_r={kind:"color"},Ar={kind:"object"},ht={kind:"value"},Gt={kind:"collator"},Tn={kind:"formatted"},Bn={kind:"padding"},fn={kind:"resolvedImage"},G={kind:"variableAnchorOffsetCollection"};function R(n,t){return{kind:"array",itemType:n,N:t}}function D(n){if(n.kind==="array"){const t=D(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const B=[Nr,Me,yt,st,_r,Tn,Ar,R(ht),Bn,fn,G];function H(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!H(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const i of B)if(!H(i,t))return null}}return`Expected ${D(n)} but found ${D(t)} instead.`}function ie(n,t){return t.some(i=>i.kind===n.kind)}function ae(n,t){return t.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}function pe(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const ee=.96422,ve=.82521,Te=4/29,ye=6/29,Re=3*ye*ye,Xe=ye*ye*ye,lt=Math.PI/180,Bt=180/Math.PI;function St(n){return(n%=360)<0&&(n+=360),n}function Nt([n,t,i,a]){let h,g;const y=jr((.2225045*(n=At(n))+.7168786*(t=At(t))+.0606169*(i=At(i)))/1);n===t&&t===i?h=g=y:(h=jr((.4360747*n+.3850649*t+.1430804*i)/ee),g=jr((.0139322*n+.0971045*t+.7141733*i)/ve));const x=116*y-16;return[x<0?0:x,500*(h-y),200*(y-g),a]}function At(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function jr(n){return n>Xe?Math.pow(n,1/3):n/Re+Te}function vr([n,t,i,a]){let h=(n+16)/116,g=isNaN(t)?h:h+t/500,y=isNaN(i)?h:h-i/200;return h=1*Kt(h),g=ee*Kt(g),y=ve*Kt(y),[It(3.1338561*g-1.6168667*h-.4906146*y),It(-.9787684*g+1.9161415*h+.033454*y),It(.0719453*g-.2289914*h+1.4052427*y),a]}function It(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Kt(n){return n>ye?n*n*n:Re*(n-Te)}function yr(n){return parseInt(n.padEnd(2,n),16)/255}function Gr(n,t){return Yr(t?n/100:n,0,1)}function Yr(n,t,i){return Math.min(Math.max(t,n),i)}function mn(n){return!n.some(Number.isNaN)}const Ys={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Jt{constructor(t,i,a,h=1,g=!0){this.r=t,this.g=i,this.b=a,this.a=h,g||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,i,a,h]))}static parse(t){if(t instanceof Jt)return t;if(typeof t!="string")return;const i=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Ys[a];if(h){const[y,x,b]=h;return[y/255,x/255,b/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const y=a.length<6?1:2;let x=1;return[yr(a.slice(x,x+=y)),yr(a.slice(x,x+=y)),yr(a.slice(x,x+=y)),yr(a.slice(x,x+y)||"ff")]}if(a.startsWith("rgb")){const y=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[x,b,k,I,P,z,L,O,j,X,J,me]=y,se=[I||" ",L||" ",X].join("");if(se==="  "||se==="  /"||se===",,"||se===",,,"){const fe=[k,z,j].join(""),we=fe==="%%%"?100:fe===""?255:0;if(we){const Ae=[Yr(+b/we,0,1),Yr(+P/we,0,1),Yr(+O/we,0,1),J?Gr(+J,me):1];if(mn(Ae))return Ae}}return}}const g=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[y,x,b,k,I,P,z,L,O]=g,j=[b||" ",I||" ",z].join("");if(j==="  "||j==="  /"||j===",,"||j===",,,"){const X=[+x,Yr(+k,0,100),Yr(+P,0,100),L?Gr(+L,O):1];if(mn(X))return function([J,me,se,fe]){function we(Ae){const He=(Ae+J/30)%12,ct=me*Math.min(se,1-se);return se-ct*Math.max(-1,Math.min(He-3,9-He,1))}return J=St(J),me/=100,se/=100,[we(0),we(8),we(4),fe]}(X)}}}(t);return i?new Jt(...i,!1):void 0}get rgb(){const{r:t,g:i,b:a,a:h}=this,g=h||1/0;return this.overwriteGetter("rgb",[t/g,i/g,a/g,h])}get hcl(){return this.overwriteGetter("hcl",function(t){const[i,a,h,g]=Nt(t),y=Math.sqrt(a*a+h*h);return[Math.round(1e4*y)?St(Math.atan2(h,a)*Bt):NaN,y,i,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Nt(this.rgb))}overwriteGetter(t,i){return Object.defineProperty(this,t,{value:i}),i}toString(){const[t,i,a,h]=this.rgb;return`rgba(${[t,i,a].map(g=>Math.round(255*g)).join(",")},${h})`}}Jt.black=new Jt(0,0,0,1),Jt.white=new Jt(1,1,1,1),Jt.transparent=new Jt(0,0,0,0),Jt.red=new Jt(1,0,0,1);class fu{constructor(t,i,a){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class mu{constructor(t,i,a,h,g){this.text=t,this.image=i,this.scale=a,this.fontStack=h,this.textColor=g}}class Nn{constructor(t){this.sections=t}static fromString(t){return new Nn([new mu(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Nn?t:Nn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class jn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof jn)return t;if(typeof t=="number")return new jn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const i of t)if(typeof i!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new jn(t)}}toString(){return JSON.stringify(this.values)}}const Zp=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ei{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ei)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let i=0;i<t.length;i+=2){const a=t[i],h=t[i+1];if(typeof a!="string"||!Zp.has(a)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new ei(t)}}toString(){return JSON.stringify(this.values)}}class Vn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Vn({name:t,available:!1}):null}}function Qs(n,t,i,a){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,t,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,t,i,a]:[n,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Es(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Jt||n instanceof fu||n instanceof Nn||n instanceof jn||n instanceof ei||n instanceof Vn)return!0;if(Array.isArray(n)){for(const t of n)if(!Es(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!Es(n[t]))return!1;return!0}return!1}function Vr(n){if(n===null)return Nr;if(typeof n=="string")return yt;if(typeof n=="boolean")return st;if(typeof n=="number")return Me;if(n instanceof Jt)return _r;if(n instanceof fu)return Gt;if(n instanceof Nn)return Tn;if(n instanceof jn)return Bn;if(n instanceof ei)return G;if(n instanceof Vn)return fn;if(Array.isArray(n)){const t=n.length;let i;for(const a of n){const h=Vr(a);if(i){if(i===h)continue;i=ht;break}i=h}return R(i||ht,t)}return Ar}function Yo(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof Jt||n instanceof Nn||n instanceof jn||n instanceof ei||n instanceof Vn?n.toString():JSON.stringify(n)}class yi{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Es(t[1]))return i.error("invalid value");const a=t[1];let h=Vr(a);const g=i.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new yi(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Mr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const $a={string:yt,number:Me,boolean:st,object:Ar};class _i{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let a,h=1;const g=t[0];if(g==="array"){let x,b;if(t.length>2){const k=t[1];if(typeof k!="string"||!(k in $a)||k==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=$a[k],h++}else x=ht;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=t[2],h++}a=R(x,b)}else{if(!$a[g])throw new Error(`Types doesn't contain name = ${g}`);a=$a[g]}const y=[];for(;h<t.length;h++){const x=i.parse(t[h],h,ht);if(!x)return null;y.push(x)}return new _i(a,y)}evaluate(t){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(t);if(!H(this.type,Vr(a)))return a;if(i===this.args.length-1)throw new Mr(`Expected value to be of type ${D(this.type)}, but found ${D(Vr(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const gu={"to-boolean":st,"to-color":_r,"to-number":Me,"to-string":yt};class xi{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const a=t[0];if(!gu[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return i.error("Expected one argument.");const h=gu[a],g=[];for(let y=1;y<t.length;y++){const x=i.parse(t[y],y,ht);if(!x)return null;g.push(x)}return new xi(h,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let i,a;for(const h of this.args){if(i=h.evaluate(t),a=null,i instanceof Jt)return i;if(typeof i=="string"){const g=t.parseColor(i);if(g)return g}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Qs(i[0],i[1],i[2],i[3]),!a))return new Jt(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Mr(a||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const a of this.args){i=a.evaluate(t);const h=jn.parse(i);if(h)return h}throw new Mr(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const a of this.args){i=a.evaluate(t);const h=ei.parse(i);if(h)return h}throw new Mr(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const a of this.args){if(i=a.evaluate(t),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new Mr(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return Nn.fromString(Yo(this.args[0].evaluate(t)));case"resolvedImage":return Vn.fromString(Yo(this.args[0].evaluate(t)));default:return Yo(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Hp=["Unknown","Point","LineString","Polygon"];class qa{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Hp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let i=this._parseColorCache[t];return i||(i=this._parseColorCache[t]=Jt.parse(t)),i}}class ks{constructor(t,i,a=[],h,g=new lr,y=[]){this.registry=t,this.path=a,this.key=a.map(x=>`[${x}]`).join(""),this.scope=g,this.errors=y,this.expectedType=h,this._isConstant=i}parse(t,i,a,h,g={}){return i?this.concat(i,a,h)._parse(t,g):this._parse(t,g)}_parse(t,i){function a(h,g,y){return y==="assert"?new _i(g,[h]):y==="coerce"?new xi(g,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[h];if(g){let y=g.parse(t,this);if(!y)return null;if(this.expectedType){const x=this.expectedType,b=y.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||b.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string")if(x.kind!=="padding"||b.kind!=="value"&&b.kind!=="number"&&b.kind!=="array")if(x.kind!=="variableAnchorOffsetCollection"||b.kind!=="value"&&b.kind!=="array"){if(this.checkSubtype(x,b))return null}else y=a(y,x,i.typeAnnotation||"coerce");else y=a(y,x,i.typeAnnotation||"coerce");else y=a(y,x,i.typeAnnotation||"coerce");else y=a(y,x,i.typeAnnotation||"assert")}if(!(y instanceof yi)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const x=new qa;try{y=new yi(y.type,y.evaluate(x))}catch(b){return this.error(b.message),null}}return y}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,a){const h=typeof t=="number"?this.path.concat(t):this.path,g=a?this.scope.concat(a):this.scope;return new ks(this.registry,this._isConstant,h,i||null,g,this.errors)}error(t,...i){const a=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new Ot(a,t))}checkSubtype(t,i){const a=H(t,i);return a&&this.error(a),a}}class hs{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let g=1;g<t.length-1;g+=2){const y=t[g];if(typeof y!="string")return i.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return i.error("Variable names must contain only alphanumeric characters or '_'.",g);const x=i.parse(t[g+1],g+1);if(!x)return null;a.push([y,x])}const h=i.parse(t[t.length-1],t.length-1,i.expectedType,a);return h?new hs(a,h):null}outputDefined(){return this.result.outputDefined()}}class qt{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=t[1];return i.scope.has(a)?new qt(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class yu{constructor(t,i,a){this.type=t,this.index=i,this.input=a}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,Me),h=i.parse(t[2],2,R(i.expectedType||ht));return a&&h?new yu(h.type.itemType,a,h):null}evaluate(t){const i=this.index.evaluate(t),a=this.input.evaluate(t);if(i<0)throw new Mr(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new Mr(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new Mr(`Array index must be an integer, but found ${i} instead.`);return a[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class _u{constructor(t,i){this.type=st,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,ht),h=i.parse(t[2],2,ht);return a&&h?ie(a.type,[st,yt,Me,Nr,ht])?new _u(a,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(a.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!ae(i,["boolean","string","number","null"]))throw new Mr(`Expected first argument to be of type boolean, string, number or null, but found ${D(Vr(i))} instead.`);if(!ae(a,["string","array"]))throw new Mr(`Expected second argument to be of type array or string, but found ${D(Vr(a))} instead.`);return a.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class eo{constructor(t,i,a){this.type=Me,this.needle=t,this.haystack=i,this.fromIndex=a}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,ht),h=i.parse(t[2],2,ht);if(!a||!h)return null;if(!ie(a.type,[st,yt,Me,Nr,ht]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(a.type)} instead`);if(t.length===4){const g=i.parse(t[3],3,Me);return g?new eo(a,h,g):null}return new eo(a,h)}evaluate(t){const i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!ae(i,["boolean","string","number","null"]))throw new Mr(`Expected first argument to be of type boolean, string, number or null, but found ${D(Vr(i))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(t)),ae(a,["string"])){const g=a.indexOf(i,h);return g===-1?-1:[...a.slice(0,g)].length}if(ae(a,["array"]))return a.indexOf(i,h);throw new Mr(`Expected second argument to be of type array or string, but found ${D(Vr(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class xu{constructor(t,i,a,h,g,y){this.inputType=t,this.type=i,this.input=a,this.cases=h,this.outputs=g,this.otherwise=y}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let a,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const g={},y=[];for(let k=2;k<t.length-1;k+=2){let I=t[k];const P=t[k+1];Array.isArray(I)||(I=[I]);const z=i.concat(k);if(I.length===0)return z.error("Expected at least one branch label.");for(const O of I){if(typeof O!="number"&&typeof O!="string")return z.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return z.error("Numeric branch labels must be integer values.");if(a){if(z.checkSubtype(a,Vr(O)))return null}else a=Vr(O);if(g[String(O)]!==void 0)return z.error("Branch labels must be unique.");g[String(O)]=y.length}const L=i.parse(P,k,h);if(!L)return null;h=h||L.type,y.push(L)}const x=i.parse(t[1],1,ht);if(!x)return null;const b=i.parse(t[t.length-1],t.length-1,h);return b?x.type.kind!=="value"&&i.concat(1).checkSubtype(a,x.type)?null:new xu(a,h,x,g,y,b):null}evaluate(t){const i=this.input.evaluate(t);return(Vr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Za{constructor(t,i,a){this.type=t,this.branches=i,this.otherwise=a}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const h=[];for(let y=1;y<t.length-1;y+=2){const x=i.parse(t[y],y,st);if(!x)return null;const b=i.parse(t[y+1],y+1,a);if(!b)return null;h.push([x,b]),a=a||b.type}const g=i.parse(t[t.length-1],t.length-1,a);if(!g)return null;if(!a)throw new Error("Can't infer output type");return new Za(a,h,g)}evaluate(t){for(const[i,a]of this.branches)if(i.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,a]of this.branches)t(i),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}}class Qo{constructor(t,i,a,h){this.type=t,this.input=i,this.beginIndex=a,this.endIndex=h}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,ht),h=i.parse(t[2],2,Me);if(!a||!h)return null;if(!ie(a.type,[R(ht),yt,ht]))return i.error(`Expected first argument to be of type array or string, but found ${D(a.type)} instead`);if(t.length===4){const g=i.parse(t[3],3,Me);return g?new Qo(a.type,a,h,g):null}return new Qo(a.type,a,h)}evaluate(t){const i=this.input.evaluate(t),a=this.beginIndex.evaluate(t);let h;if(this.endIndex&&(h=this.endIndex.evaluate(t)),ae(i,["string"]))return[...i].slice(a,h).join("");if(ae(i,["array"]))return i.slice(a,h);throw new Mr(`Expected first argument to be of type array or string, but found ${D(Vr(i))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ha(n,t){const i=n.length-1;let a,h,g=0,y=i,x=0;for(;g<=y;)if(x=Math.floor((g+y)/2),a=n[x],h=n[x+1],a<=t){if(x===i||t<h)return x;g=x+1}else{if(!(a>t))throw new Mr("Input is not a number.");y=x-1}return 0}class to{constructor(t,i,a){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[h,g]of a)this.labels.push(h),this.outputs.push(g)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(t[1],1,Me);if(!a)return null;const h=[];let g=null;i.expectedType&&i.expectedType.kind!=="value"&&(g=i.expectedType);for(let y=1;y<t.length;y+=2){const x=y===1?-1/0:t[y],b=t[y+1],k=y,I=y+1;if(typeof x!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(h.length&&h[h.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const P=i.parse(b,I,g);if(!P)return null;g=g||P.type,h.push([x,P])}return new to(g,a,h)}evaluate(t){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return a[0].evaluate(t);const g=i.length;return h>=i[g-1]?a[g-1].evaluate(t):a[Ha(i,h)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function _h(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Gp=xh;function xh(n,t,i,a){this.cx=3*n,this.bx=3*(i-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=i,this.p2y=a}xh.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var i=n,a=0;a<8;a++){var h=this.sampleCurveX(i)-n;if(Math.abs(h)<t)return i;var g=this.sampleCurveDerivativeX(i);if(Math.abs(g)<1e-6)break;i-=h/g}var y=0,x=1;for(i=n,a=0;a<20&&(h=this.sampleCurveX(i),!(Math.abs(h-n)<t));a++)n>h?y=i:x=i,i=.5*(x-y)+y;return i},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var Wp=_h(Gp);function Is(n,t,i){return n+i*(t-n)}function ea(n,t,i){return n.map((a,h)=>Is(a,t[h],i))}const En={number:Is,color:function(n,t,i,a="rgb"){switch(a){case"rgb":{const[h,g,y,x]=ea(n.rgb,t.rgb,i);return new Jt(h,g,y,x,!1)}case"hcl":{const[h,g,y,x]=n.hcl,[b,k,I,P]=t.hcl;let z,L;if(isNaN(h)||isNaN(b))isNaN(h)?isNaN(b)?z=NaN:(z=b,y!==1&&y!==0||(L=k)):(z=h,I!==1&&I!==0||(L=g));else{let me=b-h;b>h&&me>180?me-=360:b<h&&h-b>180&&(me+=360),z=h+i*me}const[O,j,X,J]=function([me,se,fe,we]){return me=isNaN(me)?0:me*lt,vr([fe,Math.cos(me)*se,Math.sin(me)*se,we])}([z,L??Is(g,k,i),Is(y,I,i),Is(x,P,i)]);return new Jt(O,j,X,J,!1)}case"lab":{const[h,g,y,x]=vr(ea(n.lab,t.lab,i));return new Jt(h,g,y,x,!1)}}},array:ea,padding:function(n,t,i){return new jn(ea(n.values,t.values,i))},variableAnchorOffsetCollection:function(n,t,i){const a=n.values,h=t.values;if(a.length!==h.length)throw new Mr(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${t.toString()}`);const g=[];for(let y=0;y<a.length;y+=2){if(a[y]!==h[y])throw new Mr(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${a[y]}, to[${y}]: ${h[y]}`);g.push(a[y]);const[x,b]=a[y+1],[k,I]=h[y+1];g.push([Is(x,k,i),Is(b,I,i)])}return new ei(g)}};class kn{constructor(t,i,a,h,g){this.type=t,this.operator=i,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(const[y,x]of g)this.labels.push(y),this.outputs.push(x)}static interpolationFactor(t,i,a,h){let g=0;if(t.name==="exponential")g=Ga(i,t.base,a,h);else if(t.name==="linear")g=Ga(i,1,a,h);else if(t.name==="cubic-bezier"){const y=t.controlPoints;g=new Wp(y[0],y[1],y[2],y[3]).solve(Ga(i,1,a,h))}return g}static parse(t,i){let[a,h,g,...y]=t;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const k=h[1];if(typeof k!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:k}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const k=h.slice(1);if(k.length!==4||k.some(I=>typeof I!="number"||I<0||I>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:k}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(g=i.parse(g,2,Me),!g)return null;const x=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=_r:i.expectedType&&i.expectedType.kind!=="value"&&(b=i.expectedType);for(let k=0;k<y.length;k+=2){const I=y[k],P=y[k+1],z=k+3,L=k+4;if(typeof I!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(x.length&&x[x.length-1][0]>=I)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const O=i.parse(P,L,b);if(!O)return null;b=b||O.type,x.push([I,O])}return pe(b,Me)||pe(b,_r)||pe(b,Bn)||pe(b,G)||pe(b,R(Me))?new kn(b,a,h,g,x):i.error(`Type ${D(b)} is not interpolatable.`)}evaluate(t){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return a[0].evaluate(t);const g=i.length;if(h>=i[g-1])return a[g-1].evaluate(t);const y=Ha(i,h),x=kn.interpolationFactor(this.interpolation,h,i[y],i[y+1]),b=a[y].evaluate(t),k=a[y+1].evaluate(t);switch(this.operator){case"interpolate":return En[this.type.kind](b,k,x);case"interpolate-hcl":return En.color(b,k,x,"hcl");case"interpolate-lab":return En.color(b,k,x,"lab")}}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ga(n,t,i,a){const h=a-i,g=n-i;return h===0?0:t===1?g/h:(Math.pow(t,g)-1)/(Math.pow(t,h)-1)}class Wa{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let a=null;const h=i.expectedType;h&&h.kind!=="value"&&(a=h);const g=[];for(const x of t.slice(1)){const b=i.parse(x,1+g.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,g.push(b)}if(!a)throw new Error("No output type");const y=h&&g.some(x=>H(h,x.type));return new Wa(y?ht:a,g)}evaluate(t){let i,a=null,h=0;for(const g of this.args)if(h++,a=g.evaluate(t),a&&a instanceof Vn&&!a.available&&(i||(i=a.name),a=null,h===this.args.length&&(a=i)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Xa(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function vh(n,t,i,a){return a.compare(t,i)===0}function ro(n,t,i){const a=n!=="=="&&n!=="!=";return class iw{constructor(g,y,x){this.type=st,this.lhs=g,this.rhs=y,this.collator=x,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const x=g[0];let b=y.parse(g[1],1,ht);if(!b)return null;if(!Xa(x,b.type))return y.concat(1).error(`"${x}" comparisons are not supported for type '${D(b.type)}'.`);let k=y.parse(g[2],2,ht);if(!k)return null;if(!Xa(x,k.type))return y.concat(2).error(`"${x}" comparisons are not supported for type '${D(k.type)}'.`);if(b.type.kind!==k.type.kind&&b.type.kind!=="value"&&k.type.kind!=="value")return y.error(`Cannot compare types '${D(b.type)}' and '${D(k.type)}'.`);a&&(b.type.kind==="value"&&k.type.kind!=="value"?b=new _i(k.type,[b]):b.type.kind!=="value"&&k.type.kind==="value"&&(k=new _i(b.type,[k])));let I=null;if(g.length===4){if(b.type.kind!=="string"&&k.type.kind!=="string"&&b.type.kind!=="value"&&k.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(I=y.parse(g[3],3,Gt),!I)return null}return new iw(b,k,I)}evaluate(g){const y=this.lhs.evaluate(g),x=this.rhs.evaluate(g);if(a&&this.hasUntypedArgument){const b=Vr(y),k=Vr(x);if(b.kind!==k.kind||b.kind!=="string"&&b.kind!=="number")throw new Mr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${k.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=Vr(y),k=Vr(x);if(b.kind!=="string"||k.kind!=="string")return t(g,y,x)}return this.collator?i(g,y,x,this.collator.evaluate(g)):t(g,y,x)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const Xp=ro("==",function(n,t,i){return t===i},vh),wh=ro("!=",function(n,t,i){return t!==i},function(n,t,i,a){return!vh(0,t,i,a)}),bh=ro("<",function(n,t,i){return t<i},function(n,t,i,a){return a.compare(t,i)<0}),Kp=ro(">",function(n,t,i){return t>i},function(n,t,i,a){return a.compare(t,i)>0}),Jp=ro("<=",function(n,t,i){return t<=i},function(n,t,i,a){return a.compare(t,i)<=0}),Sh=ro(">=",function(n,t,i){return t>=i},function(n,t,i,a){return a.compare(t,i)>=0});class ta{constructor(t,i,a){this.type=Gt,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");const a=t[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const h=i.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,st);if(!h)return null;const g=i.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,st);if(!g)return null;let y=null;return a.locale&&(y=i.parse(a.locale,1,yt),!y)?null:new ta(h,g,y)}evaluate(t){return new fu(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class vu{constructor(t,i,a,h,g){this.type=yt,this.number=t,this.locale=i,this.currency=a,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");const a=i.parse(t[1],1,Me);if(!a)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=i.parse(h.locale,1,yt),!g))return null;let y=null;if(h.currency&&(y=i.parse(h.currency,1,yt),!y))return null;let x=null;if(h["min-fraction-digits"]&&(x=i.parse(h["min-fraction-digits"],1,Me),!x))return null;let b=null;return h["max-fraction-digits"]&&(b=i.parse(h["max-fraction-digits"],1,Me),!b)?null:new vu(a,g,y,x,b)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ka{constructor(t){this.type=Tn,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const h=[];let g=!1;for(let y=1;y<=t.length-1;++y){const x=t[y];if(g&&typeof x=="object"&&!Array.isArray(x)){g=!1;let b=null;if(x["font-scale"]&&(b=i.parse(x["font-scale"],1,Me),!b))return null;let k=null;if(x["text-font"]&&(k=i.parse(x["text-font"],1,R(yt)),!k))return null;let I=null;if(x["text-color"]&&(I=i.parse(x["text-color"],1,_r),!I))return null;const P=h[h.length-1];P.scale=b,P.font=k,P.textColor=I}else{const b=i.parse(t[y],1,ht);if(!b)return null;const k=b.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new Ka(h)}evaluate(t){return new Nn(this.sections.map(i=>{const a=i.content.evaluate(t);return Vr(a)===fn?new mu("",a,null,null,null):new mu(Yo(a),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)}))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}}class wu{constructor(t){this.type=fn,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected two arguments.");const a=i.parse(t[1],1,yt);return a?new wu(a):i.error("No image name provided.")}evaluate(t){const i=this.input.evaluate(t),a=Vn.fromString(i);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(i)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class bu{constructor(t){this.type=Me,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=i.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${D(a.type)} instead.`):new bu(a):null}evaluate(t){const i=this.input.evaluate(t);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new Mr(`Expected value to be of type string or array, but found ${D(Vr(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Li=8192;function Yp(n,t){const i=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(i*h*Li),Math.round(a*h*Li)]}function Su(n,t){const i=Math.pow(2,t.z);return[(h=(n[0]/Li+t.x)/i,360*h-180),(a=(n[1]/Li+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,h}function Cs(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function ds(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Zt(n,t,i){const a=n[0]-t[0],h=n[1]-t[1],g=n[0]-i[0],y=n[1]-i[1];return a*y-g*h==0&&a*g<=0&&h*y<=0}function Ja(n,t,i,a){return(h=[a[0]-i[0],a[1]-i[1]])[0]*(g=[t[0]-n[0],t[1]-n[1]])[1]-h[1]*g[0]!=0&&!(!Eh(n,t,i,a)||!Eh(i,a,n,t));var h,g}function Qp(n,t,i){for(const a of i)for(let h=0;h<a.length-1;++h)if(Ja(n,t,a[h],a[h+1]))return!0;return!1}function no(n,t,i=!1){let a=!1;for(const x of t)for(let b=0;b<x.length-1;b++){if(Zt(n,x[b],x[b+1]))return i;(g=x[b])[1]>(h=n)[1]!=(y=x[b+1])[1]>h[1]&&h[0]<(y[0]-g[0])*(h[1]-g[1])/(y[1]-g[1])+g[0]&&(a=!a)}var h,g,y;return a}function ef(n,t){for(const i of t)if(no(n,i))return!0;return!1}function Th(n,t){for(const i of n)if(!no(i,t))return!1;for(let i=0;i<n.length-1;++i)if(Qp(n[i],n[i+1],t))return!1;return!0}function tf(n,t){for(const i of t)if(Th(n,i))return!0;return!1}function Eh(n,t,i,a){const h=a[0]-i[0],g=a[1]-i[1],y=(n[0]-i[0])*g-h*(n[1]-i[1]),x=(t[0]-i[0])*g-h*(t[1]-i[1]);return y>0&&x<0||y<0&&x>0}function Tu(n,t,i){const a=[];for(let h=0;h<n.length;h++){const g=[];for(let y=0;y<n[h].length;y++){const x=Yp(n[h][y],i);Cs(t,x),g.push(x)}a.push(g)}return a}function kh(n,t,i){const a=[];for(let h=0;h<n.length;h++){const g=Tu(n[h],t,i);a.push(g)}return a}function Ih(n,t,i,a){if(n[0]<i[0]||n[0]>i[2]){const h=.5*a;let g=n[0]-i[0]>h?-a:i[0]-n[0]>h?a:0;g===0&&(g=n[0]-i[2]>h?-a:i[2]-n[0]>h?a:0),n[0]+=g}Cs(t,n)}function Ch(n,t,i,a){const h=Math.pow(2,a.z)*Li,g=[a.x*Li,a.y*Li],y=[];for(const x of n)for(const b of x){const k=[b.x+g[0],b.y+g[1]];Ih(k,t,i,h),y.push(k)}return y}function Ph(n,t,i,a){const h=Math.pow(2,a.z)*Li,g=[a.x*Li,a.y*Li],y=[];for(const b of n){const k=[];for(const I of b){const P=[I.x+g[0],I.y+g[1]];Cs(t,P),k.push(P)}y.push(k)}if(t[2]-t[0]<=h/2){(x=t)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const b of y)for(const k of b)Ih(k,t,i,h)}var x;return y}class Ps{constructor(t,i){this.type=st,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Es(t[1])){const a=t[1];if(a.type==="FeatureCollection"){const h=[];for(const g of a.features){const{type:y,coordinates:x}=g.geometry;y==="Polygon"&&h.push(x),y==="MultiPolygon"&&h.push(...x)}if(h.length)return new Ps(a,{type:"MultiPolygon",coordinates:h})}else if(a.type==="Feature"){const h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Ps(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Ps(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,a){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=i.canonicalID();if(a.type==="Polygon"){const x=Tu(a.coordinates,g,y),b=Ch(i.geometry(),h,g,y);if(!ds(h,g))return!1;for(const k of b)if(!no(k,x))return!1}if(a.type==="MultiPolygon"){const x=kh(a.coordinates,g,y),b=Ch(i.geometry(),h,g,y);if(!ds(h,g))return!1;for(const k of b)if(!ef(k,x))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,a){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=i.canonicalID();if(a.type==="Polygon"){const x=Tu(a.coordinates,g,y),b=Ph(i.geometry(),h,g,y);if(!ds(h,g))return!1;for(const k of b)if(!Th(k,x))return!1}if(a.type==="MultiPolygon"){const x=kh(a.coordinates,g,y),b=Ph(i.geometry(),h,g,y);if(!ds(h,g))return!1;for(const k of b)if(!tf(k,x))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ah=class{constructor(n=[],t=(i,a)=>i<a?-1:i>a?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:i}=this,a=t[n];for(;n>0;){const h=n-1>>1,g=t[h];if(i(a,g)>=0)break;t[n]=g,n=h}t[n]=a}_down(n){const{data:t,compare:i}=this,a=this.length>>1,h=t[n];for(;n<a;){let g=1+(n<<1);const y=g+1;if(y<this.length&&i(t[y],t[g])<0&&(g=y),i(t[g],h)>=0)break;t[n]=t[g],n=g}t[n]=h}};function rf(n,t,i,a,h){Mh(n,t,i,a||n.length-1,h||nf)}function Mh(n,t,i,a,h){for(;a>i;){if(a-i>600){var g=a-i+1,y=t-i+1,x=Math.log(g),b=.5*Math.exp(2*x/3),k=.5*Math.sqrt(x*b*(g-b)/g)*(y-g/2<0?-1:1);Mh(n,t,Math.max(i,Math.floor(t-y*b/g+k)),Math.min(a,Math.floor(t+(g-y)*b/g+k)),h)}var I=n[t],P=i,z=a;for(ra(n,i,t),h(n[a],I)>0&&ra(n,i,a);P<z;){for(ra(n,P,z),P++,z--;h(n[P],I)<0;)P++;for(;h(n[z],I)>0;)z--}h(n[i],I)===0?ra(n,i,z):ra(n,++z,a),z<=t&&(i=z+1),t<=z&&(a=z-1)}}function ra(n,t,i){var a=n[t];n[t]=n[i],n[i]=a}function nf(n,t){return n<t?-1:n>t?1:0}function Ya(n,t){if(n.length<=1)return[n];const i=[];let a,h;for(const g of n){const y=of(g);y!==0&&(g.area=Math.abs(y),h===void 0&&(h=y<0),h===y<0?(a&&i.push(a),a=[g]):a.push(g))}if(a&&i.push(a),t>1)for(let g=0;g<i.length;g++)i[g].length<=t||(rf(i[g],t,1,i[g].length-1,sf),i[g]=i[g].slice(0,t));return i}function sf(n,t){return t.area-n.area}function of(n){let t=0;for(let i,a,h=0,g=n.length,y=g-1;h<g;y=h++)i=n[h],a=n[y],t+=(a.x-i.x)*(i.y+a.y);return t}const zh=1/298.257223563,Rh=zh*(2-zh),Dh=Math.PI/180;class Eu{constructor(t){const i=6378.137*Dh*1e3,a=Math.cos(t*Dh),h=1/(1-Rh*(1-a*a)),g=Math.sqrt(h);this.kx=i*g*a,this.ky=i*g*h*(1-Rh)}distance(t,i){const a=this.wrap(t[0]-i[0])*this.kx,h=(t[1]-i[1])*this.ky;return Math.sqrt(a*a+h*h)}pointOnLine(t,i){let a,h,g,y,x=1/0;for(let b=0;b<t.length-1;b++){let k=t[b][0],I=t[b][1],P=this.wrap(t[b+1][0]-k)*this.kx,z=(t[b+1][1]-I)*this.ky,L=0;P===0&&z===0||(L=(this.wrap(i[0]-k)*this.kx*P+(i[1]-I)*this.ky*z)/(P*P+z*z),L>1?(k=t[b+1][0],I=t[b+1][1]):L>0&&(k+=P/this.kx*L,I+=z/this.ky*L)),P=this.wrap(i[0]-k)*this.kx,z=(i[1]-I)*this.ky;const O=P*P+z*z;O<x&&(x=O,a=k,h=I,g=b,y=L)}return{point:[a,h],index:g,t:Math.max(0,Math.min(1,y))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Lh(n,t){return t[0]-n[0]}function Qa(n){return n[1]-n[0]+1}function Ki(n,t){return n[1]>=n[0]&&n[1]<t}function ku(n,t){if(n[0]>n[1])return[null,null];const i=Qa(n);if(t){if(i===2)return[n,null];const h=Math.floor(i/2);return[[n[0],n[0]+h],[n[0]+h,n[1]]]}if(i===1)return[n,null];const a=Math.floor(i/2)-1;return[[n[0],n[0]+a],[n[0]+a+1,n[1]]]}function Iu(n,t){if(!Ki(t,n.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)Cs(i,n[a]);return i}function Cu(n){const t=[1/0,1/0,-1/0,-1/0];for(const i of n)for(const a of i)Cs(t,a);return t}function el(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Pu(n,t,i){if(!el(n)||!el(t))return NaN;let a=0,h=0;return n[2]<t[0]&&(a=t[0]-n[2]),n[0]>t[2]&&(a=n[0]-t[2]),n[1]>t[3]&&(h=n[1]-t[3]),n[3]<t[1]&&(h=t[1]-n[3]),i.distance([0,0],[a,h])}function As(n,t,i){const a=i.pointOnLine(t,n);return i.distance(n,a.point)}function Au(n,t,i,a,h){const g=Math.min(As(n,[i,a],h),As(t,[i,a],h)),y=Math.min(As(i,[n,t],h),As(a,[n,t],h));return Math.min(g,y)}function af(n,t,i,a,h){if(!Ki(t,n.length)||!Ki(a,i.length))return 1/0;let g=1/0;for(let y=t[0];y<t[1];++y){const x=n[y],b=n[y+1];for(let k=a[0];k<a[1];++k){const I=i[k],P=i[k+1];if(Ja(x,b,I,P))return 0;g=Math.min(g,Au(x,b,I,P,h))}}return g}function Tr(n,t,i,a,h){if(!Ki(t,n.length)||!Ki(a,i.length))return NaN;let g=1/0;for(let y=t[0];y<=t[1];++y)for(let x=a[0];x<=a[1];++x)if(g=Math.min(g,h.distance(n[y],i[x])),g===0)return g;return g}function lf(n,t,i){if(no(n,t,!0))return 0;let a=1/0;for(const h of t){const g=h[0],y=h[h.length-1];if(g!==y&&(a=Math.min(a,As(n,[y,g],i)),a===0))return a;const x=i.pointOnLine(h,n);if(a=Math.min(a,i.distance(n,x.point)),a===0)return a}return a}function Ct(n,t,i,a){if(!Ki(t,n.length))return NaN;for(let g=t[0];g<=t[1];++g)if(no(n[g],i,!0))return 0;let h=1/0;for(let g=t[0];g<t[1];++g){const y=n[g],x=n[g+1];for(const b of i)for(let k=0,I=b.length,P=I-1;k<I;P=k++){const z=b[P],L=b[k];if(Ja(y,x,z,L))return 0;h=Math.min(h,Au(y,x,z,L,a))}}return h}function tl(n,t){for(const i of n)for(const a of i)if(no(a,t,!0))return!0;return!1}function ir(n,t,i,a=1/0){const h=Cu(n),g=Cu(t);if(a!==1/0&&Pu(h,g,i)>=a)return a;if(ds(h,g)){if(tl(n,t))return 0}else if(tl(t,n))return 0;let y=1/0;for(const x of n)for(let b=0,k=x.length,I=k-1;b<k;I=b++){const P=x[I],z=x[b];for(const L of t)for(let O=0,j=L.length,X=j-1;O<j;X=O++){const J=L[X],me=L[O];if(Ja(P,z,J,me))return 0;y=Math.min(y,Au(P,z,J,me,i))}}return y}function Qt(n,t,i,a,h,g){if(!g)return;const y=Pu(Iu(a,g),h,i);y<t&&n.push([y,g,[0,0]])}function Ms(n,t,i,a,h,g,y){if(!g||!y)return;const x=Pu(Iu(a,g),Iu(h,y),i);x<t&&n.push([x,g,y])}function na(n,t,i,a,h=1/0){let g=Math.min(a.distance(n[0],i[0][0]),h);if(g===0)return g;const y=new Ah([[0,[0,n.length-1],[0,0]]],Lh),x=Cu(i);for(;y.length>0;){const b=y.pop();if(b[0]>=g)continue;const k=b[1],I=t?50:100;if(Qa(k)<=I){if(!Ki(k,n.length))return NaN;if(t){const P=Ct(n,k,i,a);if(isNaN(P)||P===0)return P;g=Math.min(g,P)}else for(let P=k[0];P<=k[1];++P){const z=lf(n[P],i,a);if(g=Math.min(g,z),g===0)return 0}}else{const P=ku(k,t);Qt(y,g,a,n,x,P[0]),Qt(y,g,a,n,x,P[1])}}return g}function ia(n,t,i,a,h,g=1/0){let y=Math.min(g,h.distance(n[0],i[0]));if(y===0)return y;const x=new Ah([[0,[0,n.length-1],[0,i.length-1]]],Lh);for(;x.length>0;){const b=x.pop();if(b[0]>=y)continue;const k=b[1],I=b[2],P=t?50:100,z=a?50:100;if(Qa(k)<=P&&Qa(I)<=z){if(!Ki(k,n.length)&&Ki(I,i.length))return NaN;let L;if(t&&a)L=af(n,k,i,I,h),y=Math.min(y,L);else if(t&&!a){const O=n.slice(k[0],k[1]+1);for(let j=I[0];j<=I[1];++j)if(L=As(i[j],O,h),y=Math.min(y,L),y===0)return y}else if(!t&&a){const O=i.slice(I[0],I[1]+1);for(let j=k[0];j<=k[1];++j)if(L=As(n[j],O,h),y=Math.min(y,L),y===0)return y}else L=Tr(n,k,i,I,h),y=Math.min(y,L)}else{const L=ku(k,t),O=ku(I,a);Ms(x,y,h,n,i,L[0],O[0]),Ms(x,y,h,n,i,L[0],O[1]),Ms(x,y,h,n,i,L[1],O[0]),Ms(x,y,h,n,i,L[1],O[1])}}return y}function Mu(n){return n.type==="MultiPolygon"?n.coordinates.map(t=>({type:"Polygon",coordinates:t})):n.type==="MultiLineString"?n.coordinates.map(t=>({type:"LineString",coordinates:t})):n.type==="MultiPoint"?n.coordinates.map(t=>({type:"Point",coordinates:t})):[n]}class zs{constructor(t,i){this.type=Me,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Es(t[1])){const a=t[1];if(a.type==="FeatureCollection")return new zs(a,a.features.map(h=>Mu(h.geometry)).flat());if(a.type==="Feature")return new zs(a,Mu(a.geometry));if("type"in a&&"coordinates"in a)return new zs(a,Mu(a))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,a){const h=i.geometry(),g=h.flat().map(b=>Su([b.x,b.y],i.canonical));if(h.length===0)return NaN;const y=new Eu(g[0][1]);let x=1/0;for(const b of a){switch(b.type){case"Point":x=Math.min(x,ia(g,!1,[b.coordinates],!1,y,x));break;case"LineString":x=Math.min(x,ia(g,!1,b.coordinates,!0,y,x));break;case"Polygon":x=Math.min(x,na(g,!1,b.coordinates,y,x))}if(x===0)return x}return x}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,a){const h=i.geometry(),g=h.flat().map(b=>Su([b.x,b.y],i.canonical));if(h.length===0)return NaN;const y=new Eu(g[0][1]);let x=1/0;for(const b of a){switch(b.type){case"Point":x=Math.min(x,ia(g,!0,[b.coordinates],!1,y,x));break;case"LineString":x=Math.min(x,ia(g,!0,b.coordinates,!0,y,x));break;case"Polygon":x=Math.min(x,na(g,!0,b.coordinates,y,x))}if(x===0)return x}return x}(t,this.geometries);if(t.geometryType()==="Polygon")return function(i,a){const h=i.geometry();if(h.length===0||h[0].length===0)return NaN;const g=Ya(h,0).map(b=>b.map(k=>k.map(I=>Su([I.x,I.y],i.canonical)))),y=new Eu(g[0][0][0][1]);let x=1/0;for(const b of a)for(const k of g){switch(b.type){case"Point":x=Math.min(x,na([b.coordinates],!1,k,y,x));break;case"LineString":x=Math.min(x,na(b.coordinates,!0,k,y,x));break;case"Polygon":x=Math.min(x,ir(k,b.coordinates,y,x))}if(x===0)return x}return x}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const io={"==":Xp,"!=":wh,">":Kp,"<":bh,">=":Sh,"<=":Jp,array:_i,at:yu,boolean:_i,case:Za,coalesce:Wa,collator:ta,format:Ka,image:wu,in:_u,"index-of":eo,interpolate:kn,"interpolate-hcl":kn,"interpolate-lab":kn,length:bu,let:hs,literal:yi,match:xu,number:_i,"number-format":vu,object:_i,slice:Qo,step:to,string:_i,"to-boolean":xi,"to-color":xi,"to-number":xi,"to-string":xi,var:qt,within:Ps,distance:zs};class ti{constructor(t,i,a,h){this.name=t,this.type=i,this._evaluate=a,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,i){const a=t[0],h=ti.definitions[a];if(!h)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=y.filter(([k])=>!Array.isArray(k)||k.length===t.length-1);let b=null;for(const[k,I]of x){b=new ks(i.registry,sa,i.path,null,i.scope);const P=[];let z=!1;for(let L=1;L<t.length;L++){const O=t[L],j=Array.isArray(k)?k[L-1]:k.type,X=b.parse(O,1+P.length,j);if(!X){z=!0;break}P.push(X)}if(!z)if(Array.isArray(k)&&k.length!==P.length)b.error(`Expected ${k.length} arguments, but found ${P.length} instead.`);else{for(let L=0;L<P.length;L++){const O=Array.isArray(k)?k[L]:k.type,j=P[L];b.concat(L+1).checkSubtype(O,j.type)}if(b.errors.length===0)return new ti(a,g,I,P)}}if(x.length===1)i.errors.push(...b.errors);else{const k=(x.length?x:y).map(([P])=>{return z=P,Array.isArray(z)?`(${z.map(D).join(", ")})`:`(${D(z.type)}...)`;var z}).join(" | "),I=[];for(let P=1;P<t.length;P++){const z=i.parse(t[P],1+I.length);if(!z)return null;I.push(D(z.type))}i.error(`Expected arguments of type ${k}, but found (${I.join(", ")}) instead.`)}return null}static register(t,i){ti.definitions=i;for(const a in i)t[a]=ti}}function zu(n,[t,i,a,h]){t=t.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);const g=h?h.evaluate(n):1,y=Qs(t,i,a,g);if(y)throw new Mr(y);return new Jt(t/255,i/255,a/255,g,!1)}function Ru(n,t){return n in t}function Du(n,t){const i=t[n];return i===void 0?null:i}function Rs(n){return{type:n}}function sa(n){if(n instanceof qt)return sa(n.boundExpression);if(n instanceof ti&&n.name==="error"||n instanceof ta||n instanceof Ps||n instanceof zs)return!1;const t=n instanceof xi||n instanceof _i;let i=!0;return n.eachChild(a=>{i=t?i&&sa(a):i&&a instanceof yi}),!!i&&oa(n)&&aa(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function oa(n){if(n instanceof ti&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Ps||n instanceof zs)return!1;let t=!0;return n.eachChild(i=>{t&&!oa(i)&&(t=!1)}),t}function so(n){if(n instanceof ti&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(i=>{t&&!so(i)&&(t=!1)}),t}function aa(n,t){if(n instanceof ti&&t.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(a=>{i&&!aa(a,t)&&(i=!1)}),i}function rl(n){return{result:"success",value:n}}function oo(n){return{result:"error",value:n}}function ao(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Fh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Lu(n){return!!n.expression&&n.expression.interpolated}function Ut(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function nl(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function uf(n){return n}function Oh(n,t){const i=t.type==="color",a=n.stops&&typeof n.stops[0][0]=="object",h=a||!(a||n.property!==void 0),g=n.type||(Lu(t)?"exponential":"interval");if(i||t.type==="padding"){const I=i?Jt.parse:jn.parse;(n=Vt({},n)).stops&&(n.stops=n.stops.map(P=>[P[0],I(P[1])])),n.default=I(n.default?n.default:t.default)}if(n.colorSpace&&(y=n.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var y;let x,b,k;if(g==="exponential")x=Nh;else if(g==="interval")x=il;else if(g==="categorical"){x=Bh,b=Object.create(null);for(const I of n.stops)b[I[0]]=I[1];k=typeof n.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);x=jh}if(a){const I={},P=[];for(let O=0;O<n.stops.length;O++){const j=n.stops[O],X=j[0].zoom;I[X]===void 0&&(I[X]={zoom:X,type:n.type,property:n.property,default:n.default,stops:[]},P.push(X)),I[X].stops.push([j[0].value,j[1]])}const z=[];for(const O of P)z.push([I[O].zoom,Oh(I[O],t)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:kn.interpolationFactor.bind(void 0,L),zoomStops:z.map(O=>O[0]),evaluate:({zoom:O},j)=>Nh({stops:z,base:n.base},t,O).evaluate(O,j)}}if(h){const I=g==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:kn.interpolationFactor.bind(void 0,I),zoomStops:n.stops.map(P=>P[0]),evaluate:({zoom:P})=>x(n,t,P,b,k)}}return{kind:"source",evaluate(I,P){const z=P&&P.properties?P.properties[n.property]:void 0;return z===void 0?lo(n.default,t.default):x(n,t,z,b,k)}}}function lo(n,t,i){return n!==void 0?n:t!==void 0?t:i!==void 0?i:void 0}function Bh(n,t,i,a,h){return lo(typeof i===h?a[i]:void 0,n.default,t.default)}function il(n,t,i){if(Ut(i)!=="number")return lo(n.default,t.default);const a=n.stops.length;if(a===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[a-1][0])return n.stops[a-1][1];const h=Ha(n.stops.map(g=>g[0]),i);return n.stops[h][1]}function Nh(n,t,i){const a=n.base!==void 0?n.base:1;if(Ut(i)!=="number")return lo(n.default,t.default);const h=n.stops.length;if(h===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[h-1][0])return n.stops[h-1][1];const g=Ha(n.stops.map(I=>I[0]),i),y=function(I,P,z,L){const O=L-z,j=I-z;return O===0?0:P===1?j/O:(Math.pow(P,j)-1)/(Math.pow(P,O)-1)}(i,a,n.stops[g][0],n.stops[g+1][0]),x=n.stops[g][1],b=n.stops[g+1][1],k=En[t.type]||uf;return typeof x.evaluate=="function"?{evaluate(...I){const P=x.evaluate.apply(void 0,I),z=b.evaluate.apply(void 0,I);if(P!==void 0&&z!==void 0)return k(P,z,y,n.colorSpace)}}:k(x,b,y,n.colorSpace)}function jh(n,t,i){switch(t.type){case"color":i=Jt.parse(i);break;case"formatted":i=Nn.fromString(i.toString());break;case"resolvedImage":i=Vn.fromString(i.toString());break;case"padding":i=jn.parse(i);break;default:Ut(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0)}return lo(i,n.default,t.default)}ti.register(io,{error:[{kind:"error"},[yt],(n,[t])=>{throw new Mr(t.evaluate(n))}],typeof:[yt,[ht],(n,[t])=>D(Vr(t.evaluate(n)))],"to-rgba":[R(Me,4),[_r],(n,[t])=>{const[i,a,h,g]=t.evaluate(n).rgb;return[255*i,255*a,255*h,g]}],rgb:[_r,[Me,Me,Me],zu],rgba:[_r,[Me,Me,Me,Me],zu],has:{type:st,overloads:[[[yt],(n,[t])=>Ru(t.evaluate(n),n.properties())],[[yt,Ar],(n,[t,i])=>Ru(t.evaluate(n),i.evaluate(n))]]},get:{type:ht,overloads:[[[yt],(n,[t])=>Du(t.evaluate(n),n.properties())],[[yt,Ar],(n,[t,i])=>Du(t.evaluate(n),i.evaluate(n))]]},"feature-state":[ht,[yt],(n,[t])=>Du(t.evaluate(n),n.featureState||{})],properties:[Ar,[],n=>n.properties()],"geometry-type":[yt,[],n=>n.geometryType()],id:[ht,[],n=>n.id()],zoom:[Me,[],n=>n.globals.zoom],"heatmap-density":[Me,[],n=>n.globals.heatmapDensity||0],"line-progress":[Me,[],n=>n.globals.lineProgress||0],accumulated:[ht,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Me,Rs(Me),(n,t)=>{let i=0;for(const a of t)i+=a.evaluate(n);return i}],"*":[Me,Rs(Me),(n,t)=>{let i=1;for(const a of t)i*=a.evaluate(n);return i}],"-":{type:Me,overloads:[[[Me,Me],(n,[t,i])=>t.evaluate(n)-i.evaluate(n)],[[Me],(n,[t])=>-t.evaluate(n)]]},"/":[Me,[Me,Me],(n,[t,i])=>t.evaluate(n)/i.evaluate(n)],"%":[Me,[Me,Me],(n,[t,i])=>t.evaluate(n)%i.evaluate(n)],ln2:[Me,[],()=>Math.LN2],pi:[Me,[],()=>Math.PI],e:[Me,[],()=>Math.E],"^":[Me,[Me,Me],(n,[t,i])=>Math.pow(t.evaluate(n),i.evaluate(n))],sqrt:[Me,[Me],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[Me,[Me],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[Me,[Me],(n,[t])=>Math.log(t.evaluate(n))],log2:[Me,[Me],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[Me,[Me],(n,[t])=>Math.sin(t.evaluate(n))],cos:[Me,[Me],(n,[t])=>Math.cos(t.evaluate(n))],tan:[Me,[Me],(n,[t])=>Math.tan(t.evaluate(n))],asin:[Me,[Me],(n,[t])=>Math.asin(t.evaluate(n))],acos:[Me,[Me],(n,[t])=>Math.acos(t.evaluate(n))],atan:[Me,[Me],(n,[t])=>Math.atan(t.evaluate(n))],min:[Me,Rs(Me),(n,t)=>Math.min(...t.map(i=>i.evaluate(n)))],max:[Me,Rs(Me),(n,t)=>Math.max(...t.map(i=>i.evaluate(n)))],abs:[Me,[Me],(n,[t])=>Math.abs(t.evaluate(n))],round:[Me,[Me],(n,[t])=>{const i=t.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Me,[Me],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[Me,[Me],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[st,[yt,ht],(n,[t,i])=>n.properties()[t.value]===i.value],"filter-id-==":[st,[ht],(n,[t])=>n.id()===t.value],"filter-type-==":[st,[yt],(n,[t])=>n.geometryType()===t.value],"filter-<":[st,[yt,ht],(n,[t,i])=>{const a=n.properties()[t.value],h=i.value;return typeof a==typeof h&&a<h}],"filter-id-<":[st,[ht],(n,[t])=>{const i=n.id(),a=t.value;return typeof i==typeof a&&i<a}],"filter->":[st,[yt,ht],(n,[t,i])=>{const a=n.properties()[t.value],h=i.value;return typeof a==typeof h&&a>h}],"filter-id->":[st,[ht],(n,[t])=>{const i=n.id(),a=t.value;return typeof i==typeof a&&i>a}],"filter-<=":[st,[yt,ht],(n,[t,i])=>{const a=n.properties()[t.value],h=i.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[st,[ht],(n,[t])=>{const i=n.id(),a=t.value;return typeof i==typeof a&&i<=a}],"filter->=":[st,[yt,ht],(n,[t,i])=>{const a=n.properties()[t.value],h=i.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[st,[ht],(n,[t])=>{const i=n.id(),a=t.value;return typeof i==typeof a&&i>=a}],"filter-has":[st,[ht],(n,[t])=>t.value in n.properties()],"filter-has-id":[st,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[st,[R(yt)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[st,[R(ht)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[st,[yt,R(ht)],(n,[t,i])=>i.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[st,[yt,R(ht)],(n,[t,i])=>function(a,h,g,y){for(;g<=y;){const x=g+y>>1;if(h[x]===a)return!0;h[x]>a?y=x-1:g=x+1}return!1}(n.properties()[t.value],i.value,0,i.value.length-1)],all:{type:st,overloads:[[[st,st],(n,[t,i])=>t.evaluate(n)&&i.evaluate(n)],[Rs(st),(n,t)=>{for(const i of t)if(!i.evaluate(n))return!1;return!0}]]},any:{type:st,overloads:[[[st,st],(n,[t,i])=>t.evaluate(n)||i.evaluate(n)],[Rs(st),(n,t)=>{for(const i of t)if(i.evaluate(n))return!0;return!1}]]},"!":[st,[st],(n,[t])=>!t.evaluate(n)],"is-supported-script":[st,[yt],(n,[t])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(t.evaluate(n))}],upcase:[yt,[yt],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[yt,[yt],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[yt,Rs(ht),(n,t)=>t.map(i=>Yo(i.evaluate(n))).join("")],"resolved-locale":[yt,[Gt],(n,[t])=>t.evaluate(n).resolvedLocale()]});class sl{constructor(t,i){var a;this.expression=t,this._warningHistory={},this._evaluator=new qa,this._defaultValue=i?(a=i).type==="color"&&nl(a.default)?new Jt(0,0,0,0):a.type==="color"?Jt.parse(a.default)||null:a.type==="padding"?jn.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?ei.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,a,h,g,y){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(t,i,a,h,g,y){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Mr(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function ol(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in io}function uo(n,t){const i=new ks(io,sa,[],t?function(h){const g={color:_r,string:yt,number:Me,enum:yt,boolean:st,formatted:Tn,padding:Bn,resolvedImage:fn,variableAnchorOffsetCollection:G};return h.type==="array"?R(g[h.value]||ht,h.length):g[h.type]}(t):void 0),a=i.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?rl(new sl(a,t)):oo(i.errors)}class co{constructor(t,i){this.kind=t,this._styleExpression=i,this.isStateDependent=t!=="constant"&&!so(i.expression)}evaluateWithoutErrorHandling(t,i,a,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,h,g,y)}evaluate(t,i,a,h,g,y){return this._styleExpression.evaluate(t,i,a,h,g,y)}}class ho{constructor(t,i,a,h){this.kind=t,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!so(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,i,a,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,h,g,y)}evaluate(t,i,a,h,g,y){return this._styleExpression.evaluate(t,i,a,h,g,y)}interpolationFactor(t,i,a){return this.interpolationType?kn.interpolationFactor(this.interpolationType,t,i,a):0}}function Fu(n,t){const i=uo(n,t);if(i.result==="error")return i;const a=i.value.expression,h=oa(a);if(!h&&!ao(t))return oo([new Ot("","data expressions not supported")]);const g=aa(a,["zoom"]);if(!g&&!Fh(t))return oo([new Ot("","zoom expressions not supported")]);const y=la(a);return y||g?y instanceof Ot?oo([y]):y instanceof kn&&!Lu(t)?oo([new Ot("",'"interpolate" expressions cannot be used with this property')]):rl(y?new ho(h?"camera":"composite",i.value,y.labels,y instanceof kn?y.interpolation:void 0):new co(h?"constant":"source",i.value)):oo([new Ot("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class po{constructor(t,i){this._parameters=t,this._specification=i,Vt(this,Oh(this._parameters,this._specification))}static deserialize(t){return new po(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function la(n){let t=null;if(n instanceof hs)t=la(n.result);else if(n instanceof Wa){for(const i of n.args)if(t=la(i),t)break}else(n instanceof to||n instanceof kn)&&n.input instanceof ti&&n.input.name==="zoom"&&(t=n);return t instanceof Ot||n.eachChild(i=>{const a=la(i);a instanceof Ot?t=a:!t&&a?t=new Ot("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new Ot("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function al(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!al(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const ll={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ou(n){if(n==null)return{filter:()=>!0,needGeometry:!1};al(n)||(n=ul(n));const t=uo(n,ll);if(t.result==="error")throw new Error(t.value.map(i=>`${i.key}: ${i.message}`).join(", "));return{filter:(i,a,h)=>t.value.evaluate(i,a,{},h),needGeometry:Vh(n)}}function cf(n,t){return n<t?-1:n>t?1:0}function Vh(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(Vh(n[t]))return!0;return!1}function ul(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?Bu(n[1],n[2],"=="):t==="!="?nn(Bu(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Bu(n[1],n[2],t):t==="any"?(i=n.slice(1),["any"].concat(i.map(ul))):t==="all"?["all"].concat(n.slice(1).map(ul)):t==="none"?["all"].concat(n.slice(1).map(ul).map(nn)):t==="in"?ua(n[1],n.slice(2)):t==="!in"?nn(ua(n[1],n.slice(2))):t==="has"?ca(n[1]):t!=="!has"||nn(ca(n[1]));var i}function Bu(n,t,i){switch(n){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,n,t]}}function ua(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",n,["literal",t.sort(cf)]]:["filter-in-small",n,["literal",t]]}}function ca(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function nn(n){return["!",n]}function Ds(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let h="[";for(const g of n)h+=`${Ds(g)},`;return`${h}]`}const i=Object.keys(n).sort();let a="{";for(let h=0;h<i.length;h++)a+=`${JSON.stringify(i[h])}:${Ds(n[i[h]])},`;return`${a}}`}function Uh(n){let t="";for(const i of Xi)t+=`/${Ds(n[i])}`;return t}function $h(n){const t=n.value;return t?[new Ie(n.key,t,"constants have been deprecated as of v8")]:[]}function Er(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function vi(n){if(Array.isArray(n))return n.map(vi);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const i in n)t[i]=vi(n[i]);return t}return Er(n)}function Un(n){const t=n.key,i=n.value,a=n.valueSpec||{},h=n.objectElementValidators||{},g=n.style,y=n.styleSpec,x=n.validateSpec;let b=[];const k=Ut(i);if(k!=="object")return[new Ie(t,i,`object expected, ${k} found`)];for(const I in i){const P=I.split(".")[0],z=a[P]||a["*"];let L;if(h[P])L=h[P];else if(a[P])L=x;else if(h["*"])L=h["*"];else{if(!a["*"]){b.push(new Ie(t,i[I],`unknown property "${I}"`));continue}L=x}b=b.concat(L({key:(t&&`${t}.`)+I,value:i[I],valueSpec:z,style:g,styleSpec:y,object:i,objectKey:I,validateSpec:x},i))}for(const I in a)h[I]||a[I].required&&a[I].default===void 0&&i[I]===void 0&&b.push(new Ie(t,i,`missing required property "${I}"`));return b}function ha(n){const t=n.value,i=n.valueSpec,a=n.style,h=n.styleSpec,g=n.key,y=n.arrayElementValidator||n.validateSpec;if(Ut(t)!=="array")return[new Ie(g,t,`array expected, ${Ut(t)} found`)];if(i.length&&t.length!==i.length)return[new Ie(g,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new Ie(g,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let x={type:i.value,values:i.values};h.$version<7&&(x.function=i.function),Ut(i.value)==="object"&&(x=i.value);let b=[];for(let k=0;k<t.length;k++)b=b.concat(y({array:t,arrayIndex:k,value:t[k],valueSpec:x,validateSpec:n.validateSpec,style:a,styleSpec:h,key:`${g}[${k}]`}));return b}function Nu(n){const t=n.key,i=n.value,a=n.valueSpec;let h=Ut(i);return h==="number"&&i!=i&&(h="NaN"),h!=="number"?[new Ie(t,i,`number expected, ${h} found`)]:"minimum"in a&&i<a.minimum?[new Ie(t,i,`${i} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&i>a.maximum?[new Ie(t,i,`${i} is greater than the maximum value ${a.maximum}`)]:[]}function cl(n){const t=n.valueSpec,i=Er(n.value.type);let a,h,g,y={};const x=i!=="categorical"&&n.value.property===void 0,b=!x,k=Ut(n.value.stops)==="array"&&Ut(n.value.stops[0])==="array"&&Ut(n.value.stops[0][0])==="object",I=Un({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(L){if(i==="identity")return[new Ie(L.key,L.value,'identity function may not have a "stops" property')];let O=[];const j=L.value;return O=O.concat(ha({key:L.key,value:j,valueSpec:L.valueSpec,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:P})),Ut(j)==="array"&&j.length===0&&O.push(new Ie(L.key,j,"array must have at least one stop")),O},default:function(L){return L.validateSpec({key:L.key,value:L.value,valueSpec:t,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec})}}});return i==="identity"&&x&&I.push(new Ie(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||I.push(new Ie(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!Lu(n.valueSpec)&&I.push(new Ie(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(b&&!ao(n.valueSpec)?I.push(new Ie(n.key,n.value,"property functions not supported")):x&&!Fh(n.valueSpec)&&I.push(new Ie(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!k||n.value.property!==void 0||I.push(new Ie(n.key,n.value,'"property" property is required')),I;function P(L){let O=[];const j=L.value,X=L.key;if(Ut(j)!=="array")return[new Ie(X,j,`array expected, ${Ut(j)} found`)];if(j.length!==2)return[new Ie(X,j,`array length 2 expected, length ${j.length} found`)];if(k){if(Ut(j[0])!=="object")return[new Ie(X,j,`object expected, ${Ut(j[0])} found`)];if(j[0].zoom===void 0)return[new Ie(X,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new Ie(X,j,"object stop key must have value")];if(g&&g>Er(j[0].zoom))return[new Ie(X,j[0].zoom,"stop zoom values must appear in ascending order")];Er(j[0].zoom)!==g&&(g=Er(j[0].zoom),h=void 0,y={}),O=O.concat(Un({key:`${X}[0]`,value:j[0],valueSpec:{zoom:{}},validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:Nu,value:z}}))}else O=O.concat(z({key:`${X}[0]`,value:j[0],validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec},j));return ol(vi(j[1]))?O.concat([new Ie(`${X}[1]`,j[1],"expressions are not allowed in function stops.")]):O.concat(L.validateSpec({key:`${X}[1]`,value:j[1],valueSpec:t,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec}))}function z(L,O){const j=Ut(L.value),X=Er(L.value),J=L.value!==null?L.value:O;if(a){if(j!==a)return[new Ie(L.key,J,`${j} stop domain type must match previous stop domain type ${a}`)]}else a=j;if(j!=="number"&&j!=="string"&&j!=="boolean")return[new Ie(L.key,J,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&i!=="categorical"){let me=`number expected, ${j} found`;return ao(t)&&i===void 0&&(me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ie(L.key,J,me)]}return i!=="categorical"||j!=="number"||isFinite(X)&&Math.floor(X)===X?i!=="categorical"&&j==="number"&&h!==void 0&&X<h?[new Ie(L.key,J,"stop domain values must appear in ascending order")]:(h=X,i==="categorical"&&X in y?[new Ie(L.key,J,"stop domain values must be unique")]:(y[X]=!0,[])):[new Ie(L.key,J,`integer expected, found ${X}`)]}}function fo(n){const t=(n.expressionContext==="property"?Fu:uo)(vi(n.value),n.valueSpec);if(t.result==="error")return t.value.map(a=>new Ie(`${n.key}${a.key}`,n.value,a.message));const i=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new Ie(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!so(i))return[new Ie(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!so(i))return[new Ie(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!aa(i,["zoom","feature-state"]))return[new Ie(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!oa(i))return[new Ie(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ji(n){const t=n.key,i=n.value,a=n.valueSpec,h=[];return Array.isArray(a.values)?a.values.indexOf(Er(i))===-1&&h.push(new Ie(t,i,`expected one of [${a.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(a.values).indexOf(Er(i))===-1&&h.push(new Ie(t,i,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(i)} found`)),h}function ju(n){return al(vi(n.value))?fo(Vt({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):hl(n)}function hl(n){const t=n.value,i=n.key;if(Ut(t)!=="array")return[new Ie(i,t,`array expected, ${Ut(t)} found`)];const a=n.styleSpec;let h,g=[];if(t.length<1)return[new Ie(i,t,"filter array must have at least 1 element")];switch(g=g.concat(Ji({key:`${i}[0]`,value:t[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),Er(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Er(t[1])==="$type"&&g.push(new Ie(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new Ie(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=Ut(t[1]),h!=="string"&&g.push(new Ie(`${i}[1]`,t[1],`string expected, ${h} found`)));for(let y=2;y<t.length;y++)h=Ut(t[y]),Er(t[1])==="$type"?g=g.concat(Ji({key:`${i}[${y}]`,value:t[y],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&g.push(new Ie(`${i}[${y}]`,t[y],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)g=g.concat(hl({key:`${i}[${y}]`,value:t[y],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=Ut(t[1]),t.length!==2?g.push(new Ie(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&g.push(new Ie(`${i}[1]`,t[1],`string expected, ${h} found`))}return g}function Vu(n,t){const i=n.key,a=n.validateSpec,h=n.style,g=n.styleSpec,y=n.value,x=n.objectKey,b=g[`${t}_${n.layerType}`];if(!b)return[];const k=x.match(/^(.*)-transition$/);if(t==="paint"&&k&&b[k[1]]&&b[k[1]].transition)return a({key:i,value:y,valueSpec:g.transition,style:h,styleSpec:g});const I=n.valueSpec||b[x];if(!I)return[new Ie(i,y,`unknown property "${x}"`)];let P;if(Ut(y)==="string"&&ao(I)&&!I.tokens&&(P=/^{([^}]+)}$/.exec(y)))return[new Ie(i,y,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const z=[];return n.layerType==="symbol"&&(x==="text-field"&&h&&!h.glyphs&&z.push(new Ie(i,y,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&nl(vi(y))&&Er(y.type)==="identity"&&z.push(new Ie(i,y,'"text-font" does not support identity functions'))),z.concat(a({key:n.key,value:y,valueSpec:I,style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:x}))}function dl(n){return Vu(n,"paint")}function Uu(n){return Vu(n,"layout")}function $u(n){let t=[];const i=n.value,a=n.key,h=n.style,g=n.styleSpec;i.type||i.ref||t.push(new Ie(a,i,'either "type" or "ref" is required'));let y=Er(i.type);const x=Er(i.ref);if(i.id){const b=Er(i.id);for(let k=0;k<n.arrayIndex;k++){const I=h.layers[k];Er(I.id)===b&&t.push(new Ie(a,i.id,`duplicate layer id "${i.id}", previously used at line ${I.id.__line__}`))}}if("ref"in i){let b;["type","source","source-layer","filter","layout"].forEach(k=>{k in i&&t.push(new Ie(a,i[k],`"${k}" is prohibited for ref layers`))}),h.layers.forEach(k=>{Er(k.id)===x&&(b=k)}),b?b.ref?t.push(new Ie(a,i.ref,"ref cannot reference another ref layer")):y=Er(b.type):t.push(new Ie(a,i.ref,`ref layer "${x}" not found`))}else if(y!=="background")if(i.source){const b=h.sources&&h.sources[i.source],k=b&&Er(b.type);b?k==="vector"&&y==="raster"?t.push(new Ie(a,i.source,`layer "${i.id}" requires a raster source`)):k!=="raster-dem"&&y==="hillshade"?t.push(new Ie(a,i.source,`layer "${i.id}" requires a raster-dem source`)):k==="raster"&&y!=="raster"?t.push(new Ie(a,i.source,`layer "${i.id}" requires a vector source`)):k!=="vector"||i["source-layer"]?k==="raster-dem"&&y!=="hillshade"?t.push(new Ie(a,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!i.paint||!i.paint["line-gradient"]||k==="geojson"&&b.lineMetrics||t.push(new Ie(a,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ie(a,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Ie(a,i.source,`source "${i.source}" not found`))}else t.push(new Ie(a,i,'missing required property "source"'));return t=t.concat(Un({key:a,value:i,valueSpec:g.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${a}.type`,value:i.type,valueSpec:g.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:i,objectKey:"type"}),filter:ju,layout:b=>Un({layer:i,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":k=>Uu(Vt({layerType:y},k))}}),paint:b=>Un({layer:i,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":k=>dl(Vt({layerType:y},k))}})}})),t}function Ls(n){const t=n.value,i=n.key,a=Ut(t);return a!=="string"?[new Ie(i,t,`string expected, ${a} found`)]:[]}const pl={promoteId:function({key:n,value:t}){if(Ut(t)==="string")return Ls({key:n,value:t});{const i=[];for(const a in t)i.push(...Ls({key:`${n}.${a}`,value:t[a]}));return i}}};function da(n){const t=n.value,i=n.key,a=n.styleSpec,h=n.style,g=n.validateSpec;if(!t.type)return[new Ie(i,t,'"type" is required')];const y=Er(t.type);let x;switch(y){case"vector":case"raster":return x=Un({key:i,value:t,valueSpec:a[`source_${y.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:pl,validateSpec:g}),x;case"raster-dem":return x=function(b){var k;const I=(k=b.sourceName)!==null&&k!==void 0?k:"",P=b.value,z=b.styleSpec,L=z.source_raster_dem,O=b.style;let j=[];const X=Ut(P);if(P===void 0)return j;if(X!=="object")return j.push(new Ie("source_raster_dem",P,`object expected, ${X} found`)),j;const J=Er(P.encoding)==="custom",me=["redFactor","greenFactor","blueFactor","baseShift"],se=b.value.encoding?`"${b.value.encoding}"`:"Default";for(const fe in P)!J&&me.includes(fe)?j.push(new Ie(fe,P[fe],`In "${I}": "${fe}" is only valid when "encoding" is set to "custom". ${se} encoding found`)):L[fe]?j=j.concat(b.validateSpec({key:fe,value:P[fe],valueSpec:L[fe],validateSpec:b.validateSpec,style:O,styleSpec:z})):j.push(new Ie(fe,P[fe],`unknown property "${fe}"`));return j}({sourceName:i,value:t,style:n.style,styleSpec:a,validateSpec:g}),x;case"geojson":if(x=Un({key:i,value:t,valueSpec:a.source_geojson,style:h,styleSpec:a,validateSpec:g,objectElementValidators:pl}),t.cluster)for(const b in t.clusterProperties){const[k,I]=t.clusterProperties[b],P=typeof k=="string"?[k,["accumulated"],["get",b]]:k;x.push(...fo({key:`${i}.${b}.map`,value:I,expressionContext:"cluster-map"})),x.push(...fo({key:`${i}.${b}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return x;case"video":return Un({key:i,value:t,valueSpec:a.source_video,style:h,validateSpec:g,styleSpec:a});case"image":return Un({key:i,value:t,valueSpec:a.source_image,style:h,validateSpec:g,styleSpec:a});case"canvas":return[new Ie(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ji({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function qu(n){const t=n.value,i=n.styleSpec,a=i.light,h=n.style;let g=[];const y=Ut(t);if(t===void 0)return g;if(y!=="object")return g=g.concat([new Ie("light",t,`object expected, ${y} found`)]),g;for(const x in t){const b=x.match(/^(.*)-transition$/);g=g.concat(b&&a[b[1]]&&a[b[1]].transition?n.validateSpec({key:x,value:t[x],valueSpec:i.transition,validateSpec:n.validateSpec,style:h,styleSpec:i}):a[x]?n.validateSpec({key:x,value:t[x],valueSpec:a[x],validateSpec:n.validateSpec,style:h,styleSpec:i}):[new Ie(x,t[x],`unknown property "${x}"`)])}return g}function Zu(n){const t=n.value,i=n.styleSpec,a=i.sky,h=n.style,g=Ut(t);if(t===void 0)return[];if(g!=="object")return[new Ie("sky",t,`object expected, ${g} found`)];let y=[];for(const x in t)y=y.concat(a[x]?n.validateSpec({key:x,value:t[x],valueSpec:a[x],style:h,styleSpec:i}):[new Ie(x,t[x],`unknown property "${x}"`)]);return y}function Hu(n){const t=n.value,i=n.styleSpec,a=i.terrain,h=n.style;let g=[];const y=Ut(t);if(t===void 0)return g;if(y!=="object")return g=g.concat([new Ie("terrain",t,`object expected, ${y} found`)]),g;for(const x in t)g=g.concat(a[x]?n.validateSpec({key:x,value:t[x],valueSpec:a[x],validateSpec:n.validateSpec,style:h,styleSpec:i}):[new Ie(x,t[x],`unknown property "${x}"`)]);return g}function Gu(n){let t=[];const i=n.value,a=n.key;if(Array.isArray(i)){const h=[],g=[];for(const y in i)i[y].id&&h.includes(i[y].id)&&t.push(new Ie(a,i,`all the sprites' ids must be unique, but ${i[y].id} is duplicated`)),h.push(i[y].id),i[y].url&&g.includes(i[y].url)&&t.push(new Ie(a,i,`all the sprites' URLs must be unique, but ${i[y].url} is duplicated`)),g.push(i[y].url),t=t.concat(Un({key:`${a}[${y}]`,value:i[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return Ls({key:a,value:i})}const fl={"*":()=>[],array:ha,boolean:function(n){const t=n.value,i=n.key,a=Ut(t);return a!=="boolean"?[new Ie(i,t,`boolean expected, ${a} found`)]:[]},number:Nu,color:function(n){const t=n.key,i=n.value,a=Ut(i);return a!=="string"?[new Ie(t,i,`color expected, ${a} found`)]:Jt.parse(String(i))?[]:[new Ie(t,i,`color expected, "${i}" found`)]},constants:$h,enum:Ji,filter:ju,function:cl,layer:$u,object:Un,source:da,light:qu,sky:Zu,terrain:Hu,projection:function(n){const t=n.value,i=n.styleSpec,a=i.projection,h=n.style,g=Ut(t);if(t===void 0)return[];if(g!=="object")return[new Ie("projection",t,`object expected, ${g} found`)];let y=[];for(const x in t)y=y.concat(a[x]?n.validateSpec({key:x,value:t[x],valueSpec:a[x],style:h,styleSpec:i}):[new Ie(x,t[x],`unknown property "${x}"`)]);return y},string:Ls,formatted:function(n){return Ls(n).length===0?[]:fo(n)},resolvedImage:function(n){return Ls(n).length===0?[]:fo(n)},padding:function(n){const t=n.key,i=n.value;if(Ut(i)==="array"){if(i.length<1||i.length>4)return[new Ie(t,i,`padding requires 1 to 4 values; ${i.length} values found`)];const a={type:"number"};let h=[];for(let g=0;g<i.length;g++)h=h.concat(n.validateSpec({key:`${t}[${g}]`,value:i[g],validateSpec:n.validateSpec,valueSpec:a}));return h}return Nu({key:t,value:i,valueSpec:{}})},variableAnchorOffsetCollection:function(n){const t=n.key,i=n.value,a=Ut(i),h=n.styleSpec;if(a!=="array"||i.length<1||i.length%2!=0)return[new Ie(t,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let y=0;y<i.length;y+=2)g=g.concat(Ji({key:`${t}[${y}]`,value:i[y],valueSpec:h.layout_symbol["text-anchor"]})),g=g.concat(ha({key:`${t}[${y+1}]`,value:i[y+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:h}));return g},sprite:Gu};function pa(n){const t=n.value,i=n.valueSpec,a=n.styleSpec;return n.validateSpec=pa,i.expression&&nl(Er(t))?cl(n):i.expression&&ol(vi(t))?fo(n):i.type&&fl[i.type]?fl[i.type](n):Un(Vt({},n,{valueSpec:i.type?a[i.type]:i}))}function qh(n){const t=n.value,i=n.key,a=Ls(n);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new Ie(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new Ie(i,t,'"glyphs" url must include a "{range}" token'))),a}function ri(n,t=xe){let i=[];return i=i.concat(pa({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:pa,objectElementValidators:{glyphs:qh,"*":()=>[]}})),n.constants&&(i=i.concat($h({key:"constants",value:n.constants}))),Wu(i)}function Fi(n){return function(t){return n({...t,validateSpec:pa})}}function Wu(n){return[].concat(n).sort((t,i)=>t.line-i.line)}function wi(n){return function(...t){return Wu(n.apply(this,t))}}ri.source=wi(Fi(da)),ri.sprite=wi(Fi(Gu)),ri.glyphs=wi(Fi(qh)),ri.light=wi(Fi(qu)),ri.sky=wi(Fi(Zu)),ri.terrain=wi(Fi(Hu)),ri.layer=wi(Fi($u)),ri.filter=wi(Fi(ju)),ri.paintProperty=wi(Fi(dl)),ri.layoutProperty=wi(Fi(Uu));const Fs=ri,hf=Fs.light,df=Fs.sky,Zh=Fs.paintProperty,Hh=Fs.layoutProperty;function Xu(n,t){let i=!1;if(t&&t.length)for(const a of t)n.fire(new mi(new Error(a.message))),i=!0;return i}class mo{constructor(t,i,a){const h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(i=y[1])+2*(a=y[2]);for(let b=0;b<this.d*this.d;b++){const k=y[3+b],I=y[3+b+1];h.push(k===I?null:y.subarray(k,I))}const x=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],x),this.bboxes=y.subarray(x),this.insert=this._insertReadonly}else{this.d=i+2*a;for(let y=0;y<this.d*this.d;y++)h.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=t,this.padding=a,this.scale=i/t,this.uid=0;const g=a/i*t;this.min=-g,this.max=t+g}insert(t,i,a,h,g){this._forEachCell(i,a,h,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,i,a,h,g,y){this.cells[g].push(y)}query(t,i,a,h,g){const y=this.min,x=this.max;if(t<=y&&i<=y&&x<=a&&x<=h&&!g)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(t,i,a,h,this._queryCell,b,{},g),b}}_queryCell(t,i,a,h,g,y,x,b){const k=this.cells[g];if(k!==null){const I=this.keys,P=this.bboxes;for(let z=0;z<k.length;z++){const L=k[z];if(x[L]===void 0){const O=4*L;(b?b(P[O+0],P[O+1],P[O+2],P[O+3]):t<=P[O+2]&&i<=P[O+3]&&a>=P[O+0]&&h>=P[O+1])?(x[L]=!0,y.push(I[L])):x[L]=!1}}}}_forEachCell(t,i,a,h,g,y,x,b){const k=this._convertToCellCoord(t),I=this._convertToCellCoord(i),P=this._convertToCellCoord(a),z=this._convertToCellCoord(h);for(let L=k;L<=P;L++)for(let O=I;O<=z;O++){const j=this.d*O+L;if((!b||b(this._convertFromCellCoord(L),this._convertFromCellCoord(O),this._convertFromCellCoord(L+1),this._convertFromCellCoord(O+1)))&&g.call(this,t,i,a,h,j,y,x,b))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,i=3+this.cells.length+1+1;let a=0;for(let y=0;y<this.cells.length;y++)a+=this.cells[y].length;const h=new Int32Array(i+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let g=i;for(let y=0;y<t.length;y++){const x=t[y];h[3+y]=g,h.set(x,g),g+=x.length}return h[3+t.length]=g,h.set(this.keys,g),g+=this.keys.length,h[3+t.length+1]=g,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer}static serialize(t,i){const a=t.toArrayBuffer();return i&&i.push(a),{buffer:a}}static deserialize(t){return new mo(t.buffer)}}const ni={};function Je(n,t,i={}){if(ni[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),ni[n]={klass:t,omit:i.omit||[],shallow:i.shallow||[]}}Je("Object",Object),Je("TransferableGridIndex",mo),Je("Color",Jt),Je("Error",Error),Je("AJAXError",Pr),Je("ResolvedImage",Vn),Je("StylePropertyFunction",po),Je("StyleExpression",sl,{omit:["_evaluator"]}),Je("ZoomDependentExpression",ho),Je("ZoomConstantExpression",co),Je("CompoundExpression",ti,{omit:["_evaluate"]});for(const n in io)io[n]._classRegistryKey||Je(`Expression_${n}`,io[n]);function ml(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Ku(n){return n.$name||n.constructor._classRegistryKey}function Gh(n){return!function(t){if(t===null||typeof t!="object")return!1;const i=Ku(t);return!(!i||i==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||ml(n)||Or(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function go(n,t){if(Gh(n))return(ml(n)||Or(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const g=[];for(const y of n)g.push(go(y,t));return g}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const i=Ku(n);if(!i)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!ni[i])throw new Error(`${i} is not registered.`);const{klass:a}=ni[i],h=a.serialize?a.serialize(n,t):{};if(a.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in n){if(!n.hasOwnProperty(g)||ni[i].omit.indexOf(g)>=0)continue;const y=n[g];h[g]=ni[i].shallow.indexOf(g)>=0?y:go(y,t)}n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(h.$name=i),h}function yo(n){if(Gh(n))return n;if(Array.isArray(n))return n.map(yo);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=Ku(n)||"Object";if(!ni[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:i}=ni[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(n);const a=Object.create(i.prototype);for(const h of Object.keys(n)){if(h==="$name")continue;const g=n[h];a[h]=ni[t].shallow.indexOf(h)>=0?g:yo(g)}return a}class Ju{constructor(){this.first=!0}update(t,i){const a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=i),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}const zt={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function Yu(n){for(const t of n)if(ec(t.charCodeAt(0)))return!0;return!1}function pf(n){for(const t of n)if(!_o(t.charCodeAt(0)))return!1;return!0}function Qu(n){const t=n.map(i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}}).filter(i=>i);return new RegExp(t.join("|"),"u")}const ff=Qu(["Arab","Dupl","Mong","Ougr","Syrc"]);function _o(n){return!ff.test(String.fromCodePoint(n))}const Wh=Qu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ec(n){return!(n!==746&&n!==747&&(n<4352||!(zt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||zt["CJK Compatibility"](n)||zt["CJK Strokes"](n)||!(!zt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||zt["Enclosed CJK Letters and Months"](n)||zt["Ideographic Description Characters"](n)||zt.Kanbun(n)||zt.Katakana(n)&&n!==12540||!(!zt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!zt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||zt["Vertical Forms"](n)||zt["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||Wh.test(String.fromCodePoint(n)))))}function Xh(n){return!(ec(n)||function(t){return!!(zt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||zt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||zt["Letterlike Symbols"](t)||zt["Number Forms"](t)||zt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||zt["Control Pictures"](t)&&t!==9251||zt["Optical Character Recognition"](t)||zt["Enclosed Alphanumerics"](t)||zt["Geometric Shapes"](t)||zt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||zt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||zt["CJK Symbols and Punctuation"](t)||zt.Katakana(t)||zt["Private Use Area"](t)||zt["CJK Compatibility Forms"](t)||zt["Small Form Variants"](t)||zt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}const mf=Qu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function tc(n){return mf.test(String.fromCodePoint(n))}function gf(n,t){return!(!t&&tc(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||zt.Khmer(n))}function yf(n){for(const t of n)if(tc(t.charCodeAt(0)))return!0;return!1}const $n=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class ur{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ju,this.transition={})}isSupportedScript(t){return function(i,a){for(const h of i)if(!gf(h.charCodeAt(0),a))return!1;return!0}(t,$n.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,i=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*i}}}class xo{constructor(t,i){this.property=t,this.value=i,this.expression=function(a,h){if(nl(a))return new po(a,h);if(ol(a)){const g=Fu(a,h);if(g.result==="error")throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=a;return h.type==="color"&&typeof a=="string"?g=Jt.parse(a):h.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(g=ei.parse(a)):g=jn.parse(a),{kind:"constant",evaluate:()=>g}}}(i===void 0?t.specification.default:i,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,i,a){return this.property.possiblyEvaluate(this,t,i,a)}}class gl{constructor(t){this.property=t,this.value=new xo(t,void 0)}transitioned(t,i){return new Kh(this.property,this.value,i,Oe({},t.transition,this.transition),t.now)}untransitioned(){return new Kh(this.property,this.value,null,{},0)}}class yl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return pt(this._values[t].value.value)}setValue(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new gl(this._values[t].property)),this._values[t].value=new xo(this._values[t].property,i===null?void 0:pt(i))}getTransition(t){return pt(this._values[t].transition)}setTransition(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new gl(this._values[t].property)),this._values[t].transition=pt(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(t[i]=a);const h=this.getTransition(i);h!==void 0&&(t[`${i}-transition`]=h)}return t}transitioned(t,i){const a=new fa(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(t,i._values[h]);return a}untransitioned(){const t=new fa(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class Kh{constructor(t,i,a,h,g){this.property=t,this.value=i,this.begin=g+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(t,i,a){const h=t.now||0,g=this.value.possiblyEvaluate(t,i,a),y=this.prior;if(y){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return y.possiblyEvaluate(t,i,a);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(t,i,a),g,function(b){if(b<=0)return 0;if(b>=1)return 1;const k=b*b,I=k*b;return 4*(b<.5?I:3*(b-k)+I-.75)}(x))}}return g}}class fa{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,a){const h=new ga(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,i,a);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ma{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return pt(this._values[t].value)}setValue(t,i){this._values[t]=new xo(this._values[t].property,i===null?void 0:pt(i))}serialize(){const t={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(t[i]=a)}return t}possiblyEvaluate(t,i,a){const h=new ga(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,i,a);return h}}class Oi{constructor(t,i,a){this.property=t,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,a,h){return this.property.evaluate(this.value,this.parameters,t,i,a,h)}}class ga{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class et{constructor(t){this.specification=t}possiblyEvaluate(t,i){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(i)}interpolate(t,i,a){const h=En[this.specification.type];return h?h(t,i,a):t}}class dt{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,a,h){return new Oi(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},a,h)}:t.expression,i)}interpolate(t,i,a){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new Oi(this,{kind:"constant",value:void 0},t.parameters);const h=En[this.specification.type];if(h){const g=h(t.value.value,i.value.value,a);return new Oi(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,i,a,h,g,y){return t.kind==="constant"?t.value:t.evaluate(i,a,h,g,y)}}class _l extends dt{possiblyEvaluate(t,i,a,h){if(t.value===void 0)return new Oi(this,{kind:"constant",value:void 0},i);if(t.expression.kind==="constant"){const g=t.expression.evaluate(i,null,{},a,h),y=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,x=this._calculate(y,y,y,i);return new Oi(this,{kind:"constant",value:x},i)}if(t.expression.kind==="camera"){const g=this._calculate(t.expression.evaluate({zoom:i.zoom-1}),t.expression.evaluate({zoom:i.zoom}),t.expression.evaluate({zoom:i.zoom+1}),i);return new Oi(this,{kind:"constant",value:g},i)}return new Oi(this,t.expression,i)}evaluate(t,i,a,h,g,y){if(t.kind==="source"){const x=t.evaluate(i,a,h,g,y);return this._calculate(x,x,x,i)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(i.zoom)-1},a,h),t.evaluate({zoom:Math.floor(i.zoom)},a,h),t.evaluate({zoom:Math.floor(i.zoom)+1},a,h),i):t.value}_calculate(t,i,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:a,to:i}}interpolate(t){return t}}class xl{constructor(t){this.specification=t}possiblyEvaluate(t,i,a,h){if(t.value!==void 0){if(t.expression.kind==="constant"){const g=t.expression.evaluate(i,null,{},a,h);return this._calculate(g,g,g,i)}return this._calculate(t.expression.evaluate(new ur(Math.floor(i.zoom-1),i)),t.expression.evaluate(new ur(Math.floor(i.zoom),i)),t.expression.evaluate(new ur(Math.floor(i.zoom+1),i)),i)}}_calculate(t,i,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:a,to:i}}interpolate(t){return t}}class rc{constructor(t){this.specification=t}possiblyEvaluate(t,i,a,h){return!!t.expression.evaluate(i,null,{},a,h)}interpolate(){return!1}}class m{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in t){const a=t[i];a.specification.overridable&&this.overridableProperties.push(i);const h=this.defaultPropertyValues[i]=new xo(a,void 0),g=this.defaultTransitionablePropertyValues[i]=new gl(a);this.defaultTransitioningPropertyValues[i]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=h.possiblyEvaluate({})}}}Je("DataDrivenProperty",dt),Je("DataConstantProperty",et),Je("CrossFadedDataDrivenProperty",_l),Je("CrossFadedProperty",xl),Je("ColorRampProperty",rc);const e="-transition";class o extends us{constructor(t,i){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),i.layout&&(this._unevaluatedLayout=new ma(i.layout)),i.paint)){this._transitionablePaint=new yl(i.paint);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ga(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i,a={}){i!=null&&this._validate(Hh,`layers.${this.id}.layout.${t}`,t,i,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,a={}){if(i!=null&&this._validate(Zh,`layers.${this.id}.paint.${t}`,t,i,a))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),i||void 0),!1;{const h=this._transitionablePaint._values[t],g=h.property.specification["property-type"]==="cross-faded-data-driven",y=h.value.isDataDriven(),x=h.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);const b=this._transitionablePaint._values[t].value;return b.isDataDriven()||y||g||this._handleOverridablePaintPropertyUpdate(t,x,b)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,i,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),mt(t,(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}_validate(t,i,a,h,g={}){return(!g||g.validate!==!1)&&Xu(this,t.call(Fs,{key:i,layerType:this.type,objectKey:a,value:h,styleSpec:xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof Oi&&ao(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}const u={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class c{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class f{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function w(n,t=1){let i=0,a=0;return{members:n.map(h=>{const g=u[h.type].BYTES_PER_ELEMENT,y=i=S(i,Math.max(t,g)),x=h.components||1;return a=Math.max(a,g),i+=g*x,{name:h.name,type:h.type,components:x,offset:y}}),size:S(i,Math.max(a,t)),alignment:t}}function S(n,t){return Math.ceil(n/t)*t}class E extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const h=2*t;return this.int16[h+0]=i,this.int16[h+1]=a,t}}E.prototype.bytesPerElement=4,Je("StructArrayLayout2i4",E);class C extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,a)}emplace(t,i,a,h){const g=3*t;return this.int16[g+0]=i,this.int16[g+1]=a,this.int16[g+2]=h,t}}C.prototype.bytesPerElement=6,Je("StructArrayLayout3i6",C);class A extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,a,h)}emplace(t,i,a,h,g){const y=4*t;return this.int16[y+0]=i,this.int16[y+1]=a,this.int16[y+2]=h,this.int16[y+3]=g,t}}A.prototype.bytesPerElement=8,Je("StructArrayLayout4i8",A);class M extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,t,i,a,h,g,y)}emplace(t,i,a,h,g,y,x){const b=6*t;return this.int16[b+0]=i,this.int16[b+1]=a,this.int16[b+2]=h,this.int16[b+3]=g,this.int16[b+4]=y,this.int16[b+5]=x,t}}M.prototype.bytesPerElement=12,Je("StructArrayLayout2i4i12",M);class F extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,t,i,a,h,g,y)}emplace(t,i,a,h,g,y,x){const b=4*t,k=8*t;return this.int16[b+0]=i,this.int16[b+1]=a,this.uint8[k+4]=h,this.uint8[k+5]=g,this.uint8[k+6]=y,this.uint8[k+7]=x,t}}F.prototype.bytesPerElement=8,Je("StructArrayLayout2i4ub8",F);class V extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const h=2*t;return this.float32[h+0]=i,this.float32[h+1]=a,t}}V.prototype.bytesPerElement=8,Je("StructArrayLayout2f8",V);class $ extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y,x,b,k,I){const P=this.length;return this.resize(P+1),this.emplace(P,t,i,a,h,g,y,x,b,k,I)}emplace(t,i,a,h,g,y,x,b,k,I,P){const z=10*t;return this.uint16[z+0]=i,this.uint16[z+1]=a,this.uint16[z+2]=h,this.uint16[z+3]=g,this.uint16[z+4]=y,this.uint16[z+5]=x,this.uint16[z+6]=b,this.uint16[z+7]=k,this.uint16[z+8]=I,this.uint16[z+9]=P,t}}$.prototype.bytesPerElement=20,Je("StructArrayLayout10ui20",$);class K extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y,x,b,k,I,P,z){const L=this.length;return this.resize(L+1),this.emplace(L,t,i,a,h,g,y,x,b,k,I,P,z)}emplace(t,i,a,h,g,y,x,b,k,I,P,z,L){const O=12*t;return this.int16[O+0]=i,this.int16[O+1]=a,this.int16[O+2]=h,this.int16[O+3]=g,this.uint16[O+4]=y,this.uint16[O+5]=x,this.uint16[O+6]=b,this.uint16[O+7]=k,this.int16[O+8]=I,this.int16[O+9]=P,this.int16[O+10]=z,this.int16[O+11]=L,t}}K.prototype.bytesPerElement=24,Je("StructArrayLayout4i4ui4i24",K);class Y extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,a)}emplace(t,i,a,h){const g=3*t;return this.float32[g+0]=i,this.float32[g+1]=a,this.float32[g+2]=h,t}}Y.prototype.bytesPerElement=12,Je("StructArrayLayout3f12",Y);class Q extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}Q.prototype.bytesPerElement=4,Je("StructArrayLayout1ul4",Q);class ne extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y,x,b,k){const I=this.length;return this.resize(I+1),this.emplace(I,t,i,a,h,g,y,x,b,k)}emplace(t,i,a,h,g,y,x,b,k,I){const P=10*t,z=5*t;return this.int16[P+0]=i,this.int16[P+1]=a,this.int16[P+2]=h,this.int16[P+3]=g,this.int16[P+4]=y,this.int16[P+5]=x,this.uint32[z+3]=b,this.uint16[P+8]=k,this.uint16[P+9]=I,t}}ne.prototype.bytesPerElement=20,Je("StructArrayLayout6i1ul2ui20",ne);class W extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,t,i,a,h,g,y)}emplace(t,i,a,h,g,y,x){const b=6*t;return this.int16[b+0]=i,this.int16[b+1]=a,this.int16[b+2]=h,this.int16[b+3]=g,this.int16[b+4]=y,this.int16[b+5]=x,t}}W.prototype.bytesPerElement=12,Je("StructArrayLayout2i2i2i12",W);class le extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,a,h,g)}emplace(t,i,a,h,g,y){const x=4*t,b=8*t;return this.float32[x+0]=i,this.float32[x+1]=a,this.float32[x+2]=h,this.int16[b+6]=g,this.int16[b+7]=y,t}}le.prototype.bytesPerElement=16,Je("StructArrayLayout2f1f2i16",le);class de extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,t,i,a,h,g,y)}emplace(t,i,a,h,g,y,x){const b=16*t,k=4*t,I=8*t;return this.uint8[b+0]=i,this.uint8[b+1]=a,this.float32[k+1]=h,this.float32[k+2]=g,this.int16[I+6]=y,this.int16[I+7]=x,t}}de.prototype.bytesPerElement=16,Je("StructArrayLayout2ub2f2i16",de);class ge extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,a)}emplace(t,i,a,h){const g=3*t;return this.uint16[g+0]=i,this.uint16[g+1]=a,this.uint16[g+2]=h,t}}ge.prototype.bytesPerElement=6,Je("StructArrayLayout3ui6",ge);class Ee extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y,x,b,k,I,P,z,L,O,j,X,J){const me=this.length;return this.resize(me+1),this.emplace(me,t,i,a,h,g,y,x,b,k,I,P,z,L,O,j,X,J)}emplace(t,i,a,h,g,y,x,b,k,I,P,z,L,O,j,X,J,me){const se=24*t,fe=12*t,we=48*t;return this.int16[se+0]=i,this.int16[se+1]=a,this.uint16[se+2]=h,this.uint16[se+3]=g,this.uint32[fe+2]=y,this.uint32[fe+3]=x,this.uint32[fe+4]=b,this.uint16[se+10]=k,this.uint16[se+11]=I,this.uint16[se+12]=P,this.float32[fe+7]=z,this.float32[fe+8]=L,this.uint8[we+36]=O,this.uint8[we+37]=j,this.uint8[we+38]=X,this.uint32[fe+10]=J,this.int16[se+22]=me,t}}Ee.prototype.bytesPerElement=48,Je("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ee);class ze extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y,x,b,k,I,P,z,L,O,j,X,J,me,se,fe,we,Ae,He,ct,$e,je,nt,Ye){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,t,i,a,h,g,y,x,b,k,I,P,z,L,O,j,X,J,me,se,fe,we,Ae,He,ct,$e,je,nt,Ye)}emplace(t,i,a,h,g,y,x,b,k,I,P,z,L,O,j,X,J,me,se,fe,we,Ae,He,ct,$e,je,nt,Ye,Ke){const Se=32*t,ot=16*t;return this.int16[Se+0]=i,this.int16[Se+1]=a,this.int16[Se+2]=h,this.int16[Se+3]=g,this.int16[Se+4]=y,this.int16[Se+5]=x,this.int16[Se+6]=b,this.int16[Se+7]=k,this.uint16[Se+8]=I,this.uint16[Se+9]=P,this.uint16[Se+10]=z,this.uint16[Se+11]=L,this.uint16[Se+12]=O,this.uint16[Se+13]=j,this.uint16[Se+14]=X,this.uint16[Se+15]=J,this.uint16[Se+16]=me,this.uint16[Se+17]=se,this.uint16[Se+18]=fe,this.uint16[Se+19]=we,this.uint16[Se+20]=Ae,this.uint16[Se+21]=He,this.uint16[Se+22]=ct,this.uint32[ot+12]=$e,this.float32[ot+13]=je,this.float32[ot+14]=nt,this.uint16[Se+30]=Ye,this.uint16[Se+31]=Ke,t}}ze.prototype.bytesPerElement=64,Je("StructArrayLayout8i15ui1ul2f2ui64",ze);class Ve extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}Ve.prototype.bytesPerElement=4,Je("StructArrayLayout1f4",Ve);class Ge extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,a)}emplace(t,i,a,h){const g=3*t;return this.uint16[6*t+0]=i,this.float32[g+1]=a,this.float32[g+2]=h,t}}Ge.prototype.bytesPerElement=12,Je("StructArrayLayout1ui2f12",Ge);class Be extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,a)}emplace(t,i,a,h){const g=4*t;return this.uint32[2*t+0]=i,this.uint16[g+2]=a,this.uint16[g+3]=h,t}}Be.prototype.bytesPerElement=8,Je("StructArrayLayout1ul2ui8",Be);class Fe extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const h=2*t;return this.uint16[h+0]=i,this.uint16[h+1]=a,t}}Fe.prototype.bytesPerElement=4,Je("StructArrayLayout2ui4",Fe);class tt extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}tt.prototype.bytesPerElement=2,Je("StructArrayLayout1ui2",tt);class bt extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,a,h)}emplace(t,i,a,h,g){const y=4*t;return this.float32[y+0]=i,this.float32[y+1]=a,this.float32[y+2]=h,this.float32[y+3]=g,t}}bt.prototype.bytesPerElement=16,Je("StructArrayLayout4f16",bt);class Ne extends c{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new q(this.anchorPointX,this.anchorPointY)}}Ne.prototype.size=20;class qe extends ne{get(t){return new Ne(this,t)}}Je("CollisionBoxArray",qe);class xt extends c{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}xt.prototype.size=48;class cr extends Ee{get(t){return new xt(this,t)}}Je("PlacedSymbolArray",cr);class kt extends c{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}kt.prototype.size=64;class Mt extends ze{get(t){return new kt(this,t)}}Je("SymbolInstanceArray",Mt);class hr extends Ve{getoffsetX(t){return this.float32[1*t+0]}}Je("GlyphOffsetArray",hr);class sn extends C{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Je("SymbolLineVertexArray",sn);class bi extends c{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}bi.prototype.size=12;class dr extends Ge{get(t){return new bi(this,t)}}Je("TextAnchorOffsetArray",dr);class In extends c{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}In.prototype.size=8;class gn extends Be{get(t){return new In(this,t)}}Je("FeatureIndexArray",gn);class on extends E{}class yn extends E{}class Bi extends E{}class vo extends M{}class vl extends F{}class wo extends V{}class ii extends ${}class wl extends K{}class nc extends Y{}class si extends Q{}class oi extends W{}class ps extends de{}class Si extends ge{}class Qr extends Fe{}const an=w([{name:"a_pos",components:2,type:"Int16"}],4),{members:qn}=an;class Rt{constructor(t=[]){this.segments=t}prepareSegment(t,i,a,h){let g=this.segments[this.segments.length-1];return t>Rt.MAX_VERTEX_ARRAY_LENGTH&&Dt(`Max vertices per segment is ${Rt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!g||g.vertexLength+t>Rt.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:i.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,a,h){return new Rt([{vertexOffset:t,primitiveOffset:i,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}function Os(n,t){return 256*(n=De(Math.floor(n),0,255))+De(Math.floor(t),0,255)}Rt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Je("SegmentVector",Rt);const bo=w([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var So={exports:{}},Jh={exports:{}};Jh.exports=function(n,t){var i,a,h,g,y,x,b,k;for(a=n.length-(i=3&n.length),h=t,y=3432918353,x=461845907,k=0;k<a;)b=255&n.charCodeAt(k)|(255&n.charCodeAt(++k))<<8|(255&n.charCodeAt(++k))<<16|(255&n.charCodeAt(++k))<<24,++k,h=27492+(65535&(g=5*(65535&(h=(h^=b=(65535&(b=(b=(65535&b)*y+(((b>>>16)*y&65535)<<16)&4294967295)<<15|b>>>17))*x+(((b>>>16)*x&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(b=0,i){case 3:b^=(255&n.charCodeAt(k+2))<<16;case 2:b^=(255&n.charCodeAt(k+1))<<8;case 1:h^=b=(65535&(b=(b=(65535&(b^=255&n.charCodeAt(k)))*y+(((b>>>16)*y&65535)<<16)&4294967295)<<15|b>>>17))*x+(((b>>>16)*x&65535)<<16)&4294967295}return h^=n.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var _f=Jh.exports,Yh={exports:{}};Yh.exports=function(n,t){for(var i,a=n.length,h=t^a,g=0;a>=4;)i=1540483477*(65535&(i=255&n.charCodeAt(g)|(255&n.charCodeAt(++g))<<8|(255&n.charCodeAt(++g))<<16|(255&n.charCodeAt(++g))<<24))+((1540483477*(i>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),a-=4,++g;switch(a){case 3:h^=(255&n.charCodeAt(g+2))<<16;case 2:h^=(255&n.charCodeAt(g+1))<<8;case 1:h=1540483477*(65535&(h^=255&n.charCodeAt(g)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var fs=_f,Qh=Yh.exports;So.exports=fs,So.exports.murmur3=fs,So.exports.murmur2=Qh;var bl=N(So.exports);class ya{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,a,h){this.ids.push(Sl(t)),this.positions.push(i,a,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=Sl(t);let a=0,h=this.ids.length-1;for(;a<h;){const y=a+h>>1;this.ids[y]>=i?h=y:a=y+1}const g=[];for(;this.ids[a]===i;)g.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return g}static serialize(t,i){const a=new Float64Array(t.ids),h=new Uint32Array(t.positions);return Tl(a,h,0,a.length-1),i&&i.push(a.buffer,h.buffer),{ids:a,positions:h}}static deserialize(t){const i=new ya;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function Sl(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:bl(String(n))}function Tl(n,t,i,a){for(;i<a;){const h=n[i+a>>1];let g=i-1,y=a+1;for(;;){do g++;while(n[g]<h);do y--;while(n[y]>h);if(g>=y)break;To(n,g,y),To(t,3*g,3*y),To(t,3*g+1,3*y+1),To(t,3*g+2,3*y+2)}y-i<a-y?(Tl(n,t,i,y),i=y+1):(Tl(n,t,y+1,a),a=y)}}function To(n,t,i){const a=n[t];n[t]=n[i],n[i]=a}Je("FeaturePositionMap",ya);class _a{constructor(t,i){this.gl=t.gl,this.location=i}}class ed extends _a{constructor(t,i){super(t,i),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Ly extends _a{constructor(t,i){super(t,i),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Fy extends _a{constructor(t,i){super(t,i),this.current=Jt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Iw=new Float32Array(16);function xf(n){return[Os(255*n.r,255*n.g),Os(255*n.b,255*n.a)]}class ic{constructor(t,i,a){this.value=t,this.uniformNames=i.map(h=>`u_${h}`),this.type=a}setUniform(t,i,a){t.set(a.constantOr(this.value))}getBinding(t,i,a){return this.type==="color"?new Fy(t,i):new ed(t,i)}}class El{constructor(t,i){this.uniformNames=i.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=t.tlbr}setUniform(t,i,a,h){const g=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,i,a){return a.substr(0,9)==="u_pattern"?new Ly(t,i):new ed(t,i)}}class Bs{constructor(t,i,a,h){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(g=>({name:`a_${g}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,i,a,h,g){const y=this.paintVertexArray.length,x=this.expression.evaluate(new ur(0),i,{},h,[],g);this.paintVertexArray.resize(t),this._setPaintValue(y,t,x)}updatePaintArray(t,i,a,h){const g=this.expression.evaluate({zoom:0},a,h);this._setPaintValue(t,i,g)}_setPaintValue(t,i,a){if(this.type==="color"){const h=xf(a);for(let g=t;g<i;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=t;h<i;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Yi{constructor(t,i,a,h,g,y){this.expression=t,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=a,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(t,i,a,h,g){const y=this.expression.evaluate(new ur(this.zoom),i,{},h,[],g),x=this.expression.evaluate(new ur(this.zoom+1),i,{},h,[],g),b=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(b,t,y,x)}updatePaintArray(t,i,a,h){const g=this.expression.evaluate({zoom:this.zoom},a,h),y=this.expression.evaluate({zoom:this.zoom+1},a,h);this._setPaintValue(t,i,g,y)}_setPaintValue(t,i,a,h){if(this.type==="color"){const g=xf(a),y=xf(h);for(let x=t;x<i;x++)this.paintVertexArray.emplace(x,g[0],g[1],y[0],y[1])}else{for(let g=t;g<i;g++)this.paintVertexArray.emplace(g,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i){const a=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,h=De(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,i,a){return new ed(t,i)}}class Eo{constructor(t,i,a,h,g,y){this.expression=t,this.type=i,this.useIntegerZoom=a,this.zoom=h,this.layerId=y,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,i,a){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(t,i,a,h,g){this._setPaintValues(t,i,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(t,i,a,h){if(!h||!a)return;const{min:g,mid:y,max:x}=a,b=h[g],k=h[y],I=h[x];if(b&&k&&I)for(let P=t;P<i;P++)this.zoomInPaintVertexArray.emplace(P,k.tl[0],k.tl[1],k.br[0],k.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],k.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,k.tl[0],k.tl[1],k.br[0],k.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],k.pixelRatio,I.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,bo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,bo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Oy{constructor(t,i,a){this.binders={},this._buffers=[];const h=[];for(const g in t.paint._values){if(!a(g))continue;const y=t.paint.get(g);if(!(y instanceof Oi&&ao(y.property.specification)))continue;const x=Cw(g,t.type),b=y.value,k=y.property.specification.type,I=y.property.useIntegerZoom,P=y.property.specification["property-type"],z=P==="cross-faded"||P==="cross-faded-data-driven";if(b.kind==="constant")this.binders[g]=z?new El(b.value,x):new ic(b.value,x,k),h.push(`/u_${g}`);else if(b.kind==="source"||z){const L=By(g,k,"source");this.binders[g]=z?new Eo(b,k,I,i,L,t.id):new Bs(b,x,k,L),h.push(`/a_${g}`)}else{const L=By(g,k,"composite");this.binders[g]=new Yi(b,x,k,I,i,L),h.push(`/z_${g}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof Bs||i instanceof Yi?i.maxValue:0}populatePaintArrays(t,i,a,h,g){for(const y in this.binders){const x=this.binders[y];(x instanceof Bs||x instanceof Yi||x instanceof Eo)&&x.populatePaintArray(t,i,a,h,g)}}setConstantPatternPositions(t,i){for(const a in this.binders){const h=this.binders[a];h instanceof El&&h.setConstantPatternPositions(t,i)}}updatePaintArrays(t,i,a,h,g){let y=!1;for(const x in t){const b=i.getPositions(x);for(const k of b){const I=a.feature(k.index);for(const P in this.binders){const z=this.binders[P];if((z instanceof Bs||z instanceof Yi||z instanceof Eo)&&z.expression.isStateDependent===!0){const L=h.paint.get(P);z.expression=L.value,z.updatePaintArray(k.start,k.end,I,t[x],g),y=!0}}}}return y}defines(){const t=[];for(const i in this.binders){const a=this.binders[i];(a instanceof ic||a instanceof El)&&t.push(...a.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof Bs||a instanceof Yi)for(let h=0;h<a.paintVertexAttributes.length;h++)t.push(a.paintVertexAttributes[h].name);else if(a instanceof Eo)for(let h=0;h<bo.members.length;h++)t.push(bo.members[h].name)}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof ic||a instanceof El||a instanceof Yi)for(const h of a.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,i){const a=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof ic||g instanceof El||g instanceof Yi){for(const y of g.uniformNames)if(i[y]){const x=g.getBinding(t,i[y],y);a.push({name:y,property:h,binding:x})}}}return a}setUniforms(t,i,a,h){for(const{name:g,property:y,binding:x}of i)this.binders[y].setUniform(x,h,a.get(y),g)}updatePaintBuffers(t){this._buffers=[];for(const i in this.binders){const a=this.binders[i];if(t&&a instanceof Eo){const h=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(a instanceof Bs||a instanceof Yi)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(const i in this.binders){const a=this.binders[i];(a instanceof Bs||a instanceof Yi||a instanceof Eo)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof Bs||i instanceof Yi||i instanceof Eo)&&i.destroy()}}}class xa{constructor(t,i,a=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new Oy(h,i,a);this.needsUpload=!1,this._featureMap=new ya,this._bufferOffset=0}populatePaintArrays(t,i,a,h,g,y){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(t,i,h,g,y);i.id!==void 0&&this._featureMap.add(i.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,a,h){for(const g of a)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,i,g,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Cw(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function By(n,t,i){const a={color:{source:V,composite:bt},number:{source:Ve,composite:V}},h=function(g){return{"line-pattern":{source:ii,composite:ii},"fill-pattern":{source:ii,composite:ii},"fill-extrusion-pattern":{source:ii,composite:ii}}[g]}(n);return h&&h[i]||a[t][i]}Je("ConstantBinder",ic),Je("CrossFadedConstantBinder",El),Je("SourceExpressionBinder",Bs),Je("CrossFadedCompositeBinder",Eo),Je("CompositeExpressionBinder",Yi),Je("ProgramConfiguration",Oy,{omit:["_buffers"]}),Je("ProgramConfigurationSet",xa);const Ur=8192,vf=Math.pow(2,14)-1,Ny=-vf-1;function va(n){const t=Ur/n.extent,i=n.loadGeometry();for(let a=0;a<i.length;a++){const h=i[a];for(let g=0;g<h.length;g++){const y=h[g],x=Math.round(y.x*t),b=Math.round(y.y*t);y.x=De(x,Ny,vf),y.y=De(b,Ny,vf),(x<y.x||x>y.x+1||b<y.y||b>y.y+1)&&Dt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function wa(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?va(n):[]}}function td(n,t,i,a,h){n.emplaceBack(2*t+(a+1)/2,2*i+(h+1)/2)}class wf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new yn,this.indexArray=new Si,this.segments=new Rt,this.programConfigurations=new xa(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){const h=this.layers[0],g=[];let y=null,x=!1;h.type==="circle"&&(y=h.layout.get("circle-sort-key"),x=!y.isConstant());for(const{feature:b,id:k,index:I,sourceLayerIndex:P}of t){const z=this.layers[0]._featureFilter.needGeometry,L=wa(b,z);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),L,a))continue;const O=x?y.evaluate(L,{},a):void 0,j={id:k,properties:b.properties,type:b.type,sourceLayerIndex:P,index:I,geometry:z?L.geometry:va(b),patterns:{},sortKey:O};g.push(j)}x&&g.sort((b,k)=>b.sortKey-k.sortKey);for(const b of g){const{geometry:k,index:I,sourceLayerIndex:P}=b,z=t[I].feature;this.addFeature(b,k,I,a),i.featureIndex.insert(z,k,I,P,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,qn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,a,h){for(const g of i)for(const y of g){const x=y.x,b=y.y;if(x<0||x>=Ur||b<0||b>=Ur)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),I=k.vertexLength;td(this.layoutVertexArray,x,b,-1,-1),td(this.layoutVertexArray,x,b,1,-1),td(this.layoutVertexArray,x,b,1,1),td(this.layoutVertexArray,x,b,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},h)}}function jy(n,t){for(let i=0;i<n.length;i++)if(kl(t,n[i]))return!0;for(let i=0;i<t.length;i++)if(kl(n,t[i]))return!0;return!!bf(n,t)}function Pw(n,t,i){return!!kl(n,t)||!!Sf(t,n,i)}function Vy(n,t){if(n.length===1)return $y(t,n[0]);for(let i=0;i<t.length;i++){const a=t[i];for(let h=0;h<a.length;h++)if(kl(n,a[h]))return!0}for(let i=0;i<n.length;i++)if($y(t,n[i]))return!0;for(let i=0;i<t.length;i++)if(bf(n,t[i]))return!0;return!1}function Aw(n,t,i){if(n.length>1){if(bf(n,t))return!0;for(let a=0;a<t.length;a++)if(Sf(t[a],n,i))return!0}for(let a=0;a<n.length;a++)if(Sf(n[a],t,i))return!0;return!1}function bf(n,t){if(n.length===0||t.length===0)return!1;for(let i=0;i<n.length-1;i++){const a=n[i],h=n[i+1];for(let g=0;g<t.length-1;g++)if(Mw(a,h,t[g],t[g+1]))return!0}return!1}function Mw(n,t,i,a){return Lt(n,i,a)!==Lt(t,i,a)&&Lt(n,t,i)!==Lt(n,t,a)}function Sf(n,t,i){const a=i*i;if(t.length===1)return n.distSqr(t[0])<a;for(let h=1;h<t.length;h++)if(Uy(n,t[h-1],t[h])<a)return!0;return!1}function Uy(n,t,i){const a=t.distSqr(i);if(a===0)return n.distSqr(t);const h=((n.x-t.x)*(i.x-t.x)+(n.y-t.y)*(i.y-t.y))/a;return n.distSqr(h<0?t:h>1?i:i.sub(t)._mult(h)._add(t))}function $y(n,t){let i,a,h,g=!1;for(let y=0;y<n.length;y++){i=n[y];for(let x=0,b=i.length-1;x<i.length;b=x++)a=i[x],h=i[b],a.y>t.y!=h.y>t.y&&t.x<(h.x-a.x)*(t.y-a.y)/(h.y-a.y)+a.x&&(g=!g)}return g}function kl(n,t){let i=!1;for(let a=0,h=n.length-1;a<n.length;h=a++){const g=n[a],y=n[h];g.y>t.y!=y.y>t.y&&t.x<(y.x-g.x)*(t.y-g.y)/(y.y-g.y)+g.x&&(i=!i)}return i}function zw(n,t,i){const a=i[0],h=i[2];if(n.x<a.x&&t.x<a.x||n.x>h.x&&t.x>h.x||n.y<a.y&&t.y<a.y||n.y>h.y&&t.y>h.y)return!1;const g=Lt(n,t,i[0]);return g!==Lt(n,t,i[1])||g!==Lt(n,t,i[2])||g!==Lt(n,t,i[3])}function sc(n,t,i){const a=t.paint.get(n).value;return a.kind==="constant"?a.value:i.programConfigurations.get(t.id).getMaxValue(n)}function rd(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function nd(n,t,i,a,h){if(!t[0]&&!t[1])return n;const g=q.convert(t)._mult(h);i==="viewport"&&g._rotate(-a);const y=[];for(let x=0;x<n.length;x++)y.push(n[x].sub(g));return y}let qy,Zy;Je("CircleBucket",wf,{omit:["layers"]});var Rw={get paint(){return Zy=Zy||new m({"circle-radius":new dt(xe.paint_circle["circle-radius"]),"circle-color":new dt(xe.paint_circle["circle-color"]),"circle-blur":new dt(xe.paint_circle["circle-blur"]),"circle-opacity":new dt(xe.paint_circle["circle-opacity"]),"circle-translate":new et(xe.paint_circle["circle-translate"]),"circle-translate-anchor":new et(xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new et(xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new et(xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new dt(xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new dt(xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new dt(xe.paint_circle["circle-stroke-opacity"])})},get layout(){return qy=qy||new m({"circle-sort-key":new dt(xe.layout_circle["circle-sort-key"])})}},Cn=1e-6,Il=typeof Float32Array<"u"?Float32Array:Array;function Tf(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Hy(n,t,i){var a=t[0],h=t[1],g=t[2],y=t[3],x=t[4],b=t[5],k=t[6],I=t[7],P=t[8],z=t[9],L=t[10],O=t[11],j=t[12],X=t[13],J=t[14],me=t[15],se=i[0],fe=i[1],we=i[2],Ae=i[3];return n[0]=se*a+fe*x+we*P+Ae*j,n[1]=se*h+fe*b+we*z+Ae*X,n[2]=se*g+fe*k+we*L+Ae*J,n[3]=se*y+fe*I+we*O+Ae*me,n[4]=(se=i[4])*a+(fe=i[5])*x+(we=i[6])*P+(Ae=i[7])*j,n[5]=se*h+fe*b+we*z+Ae*X,n[6]=se*g+fe*k+we*L+Ae*J,n[7]=se*y+fe*I+we*O+Ae*me,n[8]=(se=i[8])*a+(fe=i[9])*x+(we=i[10])*P+(Ae=i[11])*j,n[9]=se*h+fe*b+we*z+Ae*X,n[10]=se*g+fe*k+we*L+Ae*J,n[11]=se*y+fe*I+we*O+Ae*me,n[12]=(se=i[12])*a+(fe=i[13])*x+(we=i[14])*P+(Ae=i[15])*j,n[13]=se*h+fe*b+we*z+Ae*X,n[14]=se*g+fe*k+we*L+Ae*J,n[15]=se*y+fe*I+we*O+Ae*me,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var oc,Dw=Hy;function id(n,t,i){var a=t[0],h=t[1],g=t[2],y=t[3];return n[0]=i[0]*a+i[4]*h+i[8]*g+i[12]*y,n[1]=i[1]*a+i[5]*h+i[9]*g+i[13]*y,n[2]=i[2]*a+i[6]*h+i[10]*g+i[14]*y,n[3]=i[3]*a+i[7]*h+i[11]*g+i[15]*y,n}oc=new Il(4),Il!=Float32Array&&(oc[0]=0,oc[1]=0,oc[2]=0,oc[3]=0);class Lw extends o{constructor(t){super(t,Rw)}createBucket(t){return new wf(t)}queryRadius(t){const i=t;return sc("circle-radius",this,i)+sc("circle-stroke-width",this,i)+rd(this.paint.get("circle-translate"))}queryIntersectsFeature(t,i,a,h,g,y,x,b){const k=nd(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,x),I=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a),P=this.paint.get("circle-pitch-alignment")==="map",z=P?k:function(O,j){return O.map(X=>Gy(X,j))}(k,b),L=P?I*x:I;for(const O of h)for(const j of O){const X=P?j:Gy(j,b);let J=L;const me=id([],[j.x,j.y,0,1],b);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?J*=me[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(J*=y.cameraToCenterDistance/me[3]),Pw(z,X,J))return!0}return!1}}function Gy(n,t){const i=id([],[n.x,n.y,0,1],t);return new q(i[0]/i[3],i[1]/i[3])}class Wy extends wf{}let Xy;Je("HeatmapBucket",Wy,{omit:["layers"]});var Fw={get paint(){return Xy=Xy||new m({"heatmap-radius":new dt(xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new dt(xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new et(xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new rc(xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new et(xe.paint_heatmap["heatmap-opacity"])})}};function Ef(n,{width:t,height:i},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*i*a)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*i*a}`)}else h=new Uint8Array(t*i*a);return n.width=t,n.height=i,n.data=h,n}function Ky(n,{width:t,height:i},a){if(t===n.width&&i===n.height)return;const h=Ef({},{width:t,height:i},a);kf(n,h,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,i)},a),n.width=t,n.height=i,n.data=h.data}function kf(n,t,i,a,h,g){if(h.width===0||h.height===0)return t;if(h.width>n.width||h.height>n.height||i.x>n.width-h.width||i.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||a.x>t.width-h.width||a.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const y=n.data,x=t.data;if(y===x)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<h.height;b++){const k=((i.y+b)*n.width+i.x)*g,I=((a.y+b)*t.width+a.x)*g;for(let P=0;P<h.width*g;P++)x[I+P]=y[k+P]}return t}class ac{constructor(t,i){Ef(this,t,1,i)}resize(t){Ky(this,t,1)}clone(){return new ac({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,h,g){kf(t,i,a,h,g,1)}}class Ti{constructor(t,i){Ef(this,t,4,i)}resize(t){Ky(this,t,4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ti({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,h,g){kf(t,i,a,h,g,4)}}function Jy(n){const t={},i=n.resolution||256,a=n.clips?n.clips.length:1,h=n.image||new Ti({width:i,height:a});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const g=(y,x,b)=>{t[n.evaluationKey]=b;const k=n.expression.evaluate(t);h.data[y+x+0]=Math.floor(255*k.r/k.a),h.data[y+x+1]=Math.floor(255*k.g/k.a),h.data[y+x+2]=Math.floor(255*k.b/k.a),h.data[y+x+3]=Math.floor(255*k.a)};if(n.clips)for(let y=0,x=0;y<a;++y,x+=4*i)for(let b=0,k=0;b<i;b++,k+=4){const I=b/(i-1),{start:P,end:z}=n.clips[y];g(x,k,P*(1-I)+z*I)}else for(let y=0,x=0;y<i;y++,x+=4)g(0,x,y/(i-1));return h}Je("AlphaImage",ac),Je("RGBAImage",Ti);const If="big-fb";class Ow extends o{createBucket(t){return new Wy(t)}constructor(t){super(t,Fw),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Jy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(If)&&this.heatmapFbos.delete(If)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Yy;var Bw={get paint(){return Yy=Yy||new m({"hillshade-illumination-direction":new et(xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new et(xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new et(xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new et(xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new et(xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new et(xe.paint_hillshade["hillshade-accent-color"])})}};class Nw extends o{constructor(t){super(t,Bw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const jw=w([{name:"a_pos",components:2,type:"Int16"}],4),{members:Vw}=jw;function Qy(n,t,i=2){const a=t&&t.length,h=a?t[0]*i:n.length;let g=e_(n,0,h,i,!0);const y=[];if(!g||g.next===g.prev)return y;let x,b,k;if(a&&(g=function(I,P,z,L){const O=[];for(let j=0,X=P.length;j<X;j++){const J=e_(I,P[j]*L,j<X-1?P[j+1]*L:I.length,L,!1);J===J.next&&(J.steiner=!0),O.push(Xw(J))}O.sort(Hw);for(let j=0;j<O.length;j++)z=Gw(O[j],z);return z}(n,t,g,i)),n.length>80*i){x=1/0,b=1/0;let I=-1/0,P=-1/0;for(let z=i;z<h;z+=i){const L=n[z],O=n[z+1];L<x&&(x=L),O<b&&(b=O),L>I&&(I=L),O>P&&(P=O)}k=Math.max(I-x,P-b),k=k!==0?32767/k:0}return lc(g,y,i,x,b,k,0),y}function e_(n,t,i,a,h){let g;if(h===function(y,x,b,k){let I=0;for(let P=x,z=b-k;P<b;P+=k)I+=(y[z]-y[P])*(y[P+1]+y[z+1]),z=P;return I}(n,t,i,a)>0)for(let y=t;y<i;y+=a)g=n_(y/a|0,n[y],n[y+1],g);else for(let y=i-a;y>=t;y-=a)g=n_(y/a|0,n[y],n[y+1],g);return g&&sd(g,g.next)&&(cc(g),g=g.next),g}function ba(n,t){if(!n)return n;t||(t=n);let i,a=n;do if(i=!1,a.steiner||!sd(a,a.next)&&zr(a.prev,a,a.next)!==0)a=a.next;else{if(cc(a),a=t=a.prev,a===a.next)break;i=!0}while(i||a!==t);return t}function lc(n,t,i,a,h,g,y){if(!n)return;!y&&g&&function(b,k,I,P){let z=b;do z.z===0&&(z.z=Cf(z.x,z.y,k,I,P)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==b);z.prevZ.nextZ=null,z.prevZ=null,function(L){let O,j=1;do{let X,J=L;L=null;let me=null;for(O=0;J;){O++;let se=J,fe=0;for(let Ae=0;Ae<j&&(fe++,se=se.nextZ,se);Ae++);let we=j;for(;fe>0||we>0&&se;)fe!==0&&(we===0||!se||J.z<=se.z)?(X=J,J=J.nextZ,fe--):(X=se,se=se.nextZ,we--),me?me.nextZ=X:L=X,X.prevZ=me,me=X;J=se}me.nextZ=null,j*=2}while(O>1)}(z)}(n,a,h,g);let x=n;for(;n.prev!==n.next;){const b=n.prev,k=n.next;if(g?$w(n,a,h,g):Uw(n))t.push(b.i,n.i,k.i),cc(n),n=k.next,x=k.next;else if((n=k)===x){y?y===1?lc(n=qw(ba(n),t),t,i,a,h,g,2):y===2&&Zw(n,t,i,a,h,g):lc(ba(n),t,i,a,h,g,1);break}}}function Uw(n){const t=n.prev,i=n,a=n.next;if(zr(t,i,a)>=0)return!1;const h=t.x,g=i.x,y=a.x,x=t.y,b=i.y,k=a.y,I=h<g?h<y?h:y:g<y?g:y,P=x<b?x<k?x:k:b<k?b:k,z=h>g?h>y?h:y:g>y?g:y,L=x>b?x>k?x:k:b>k?b:k;let O=a.next;for(;O!==t;){if(O.x>=I&&O.x<=z&&O.y>=P&&O.y<=L&&Cl(h,x,g,b,y,k,O.x,O.y)&&zr(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function $w(n,t,i,a){const h=n.prev,g=n,y=n.next;if(zr(h,g,y)>=0)return!1;const x=h.x,b=g.x,k=y.x,I=h.y,P=g.y,z=y.y,L=x<b?x<k?x:k:b<k?b:k,O=I<P?I<z?I:z:P<z?P:z,j=x>b?x>k?x:k:b>k?b:k,X=I>P?I>z?I:z:P>z?P:z,J=Cf(L,O,t,i,a),me=Cf(j,X,t,i,a);let se=n.prevZ,fe=n.nextZ;for(;se&&se.z>=J&&fe&&fe.z<=me;){if(se.x>=L&&se.x<=j&&se.y>=O&&se.y<=X&&se!==h&&se!==y&&Cl(x,I,b,P,k,z,se.x,se.y)&&zr(se.prev,se,se.next)>=0||(se=se.prevZ,fe.x>=L&&fe.x<=j&&fe.y>=O&&fe.y<=X&&fe!==h&&fe!==y&&Cl(x,I,b,P,k,z,fe.x,fe.y)&&zr(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;se&&se.z>=J;){if(se.x>=L&&se.x<=j&&se.y>=O&&se.y<=X&&se!==h&&se!==y&&Cl(x,I,b,P,k,z,se.x,se.y)&&zr(se.prev,se,se.next)>=0)return!1;se=se.prevZ}for(;fe&&fe.z<=me;){if(fe.x>=L&&fe.x<=j&&fe.y>=O&&fe.y<=X&&fe!==h&&fe!==y&&Cl(x,I,b,P,k,z,fe.x,fe.y)&&zr(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function qw(n,t){let i=n;do{const a=i.prev,h=i.next.next;!sd(a,h)&&t_(a,i,i.next,h)&&uc(a,h)&&uc(h,a)&&(t.push(a.i,i.i,h.i),cc(i),cc(i.next),i=n=h),i=i.next}while(i!==n);return ba(i)}function Zw(n,t,i,a,h,g){let y=n;do{let x=y.next.next;for(;x!==y.prev;){if(y.i!==x.i&&Kw(y,x)){let b=r_(y,x);return y=ba(y,y.next),b=ba(b,b.next),lc(y,t,i,a,h,g,0),void lc(b,t,i,a,h,g,0)}x=x.next}y=y.next}while(y!==n)}function Hw(n,t){return n.x-t.x}function Gw(n,t){const i=function(h,g){let y=g;const x=h.x,b=h.y;let k,I=-1/0;do{if(b<=y.y&&b>=y.next.y&&y.next.y!==y.y){const j=y.x+(b-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(j<=x&&j>I&&(I=j,k=y.x<y.next.x?y:y.next,j===x))return k}y=y.next}while(y!==g);if(!k)return null;const P=k,z=k.x,L=k.y;let O=1/0;y=k;do{if(x>=y.x&&y.x>=z&&x!==y.x&&Cl(b<L?x:I,b,z,L,b<L?I:x,b,y.x,y.y)){const j=Math.abs(b-y.y)/(x-y.x);uc(y,h)&&(j<O||j===O&&(y.x>k.x||y.x===k.x&&Ww(k,y)))&&(k=y,O=j)}y=y.next}while(y!==P);return k}(n,t);if(!i)return t;const a=r_(i,n);return ba(a,a.next),ba(i,i.next)}function Ww(n,t){return zr(n.prev,n,t.prev)<0&&zr(t.next,n,n.next)<0}function Cf(n,t,i,a,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Xw(n){let t=n,i=n;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==n);return i}function Cl(n,t,i,a,h,g,y,x){return(h-y)*(t-x)>=(n-y)*(g-x)&&(n-y)*(a-x)>=(i-y)*(t-x)&&(i-y)*(g-x)>=(h-y)*(a-x)}function Kw(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(i,a){let h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==a.i&&h.next.i!==a.i&&t_(h,h.next,i,a))return!0;h=h.next}while(h!==i);return!1}(n,t)&&(uc(n,t)&&uc(t,n)&&function(i,a){let h=i,g=!1;const y=(i.x+a.x)/2,x=(i.y+a.y)/2;do h.y>x!=h.next.y>x&&h.next.y!==h.y&&y<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==i);return g}(n,t)&&(zr(n.prev,n,t.prev)||zr(n,t.prev,t))||sd(n,t)&&zr(n.prev,n,n.next)>0&&zr(t.prev,t,t.next)>0)}function zr(n,t,i){return(t.y-n.y)*(i.x-t.x)-(t.x-n.x)*(i.y-t.y)}function sd(n,t){return n.x===t.x&&n.y===t.y}function t_(n,t,i,a){const h=ad(zr(n,t,i)),g=ad(zr(n,t,a)),y=ad(zr(i,a,n)),x=ad(zr(i,a,t));return h!==g&&y!==x||!(h!==0||!od(n,i,t))||!(g!==0||!od(n,a,t))||!(y!==0||!od(i,n,a))||!(x!==0||!od(i,t,a))}function od(n,t,i){return t.x<=Math.max(n.x,i.x)&&t.x>=Math.min(n.x,i.x)&&t.y<=Math.max(n.y,i.y)&&t.y>=Math.min(n.y,i.y)}function ad(n){return n>0?1:n<0?-1:0}function uc(n,t){return zr(n.prev,n,n.next)<0?zr(n,t,n.next)>=0&&zr(n,n.prev,t)>=0:zr(n,t,n.prev)<0||zr(n,n.next,t)<0}function r_(n,t){const i=Pf(n.i,n.x,n.y),a=Pf(t.i,t.x,t.y),h=n.next,g=t.prev;return n.next=t,t.prev=n,i.next=h,h.prev=i,a.next=i,i.prev=a,g.next=a,a.prev=g,a}function n_(n,t,i,a){const h=Pf(n,t,i);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function cc(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Pf(n,t,i){return{i:n,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Af(n,t,i){const a=i.patternDependencies;let h=!1;for(const g of t){const y=g.paint.get(`${n}-pattern`);y.isConstant()||(h=!0);const x=y.constantOr(null);x&&(h=!0,a[x.to]=!0,a[x.from]=!0)}return h}function Mf(n,t,i,a,h){const g=h.patternDependencies;for(const y of t){const x=y.paint.get(`${n}-pattern`).value;if(x.kind!=="constant"){let b=x.evaluate({zoom:a-1},i,{},h.availableImages),k=x.evaluate({zoom:a},i,{},h.availableImages),I=x.evaluate({zoom:a+1},i,{},h.availableImages);b=b&&b.name?b.name:b,k=k&&k.name?k.name:k,I=I&&I.name?I.name:I,g[b]=!0,g[k]=!0,g[I]=!0,i.patterns[y.id]={min:b,mid:k,max:I}}}return i}class zf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Bi,this.indexArray=new Si,this.indexArray2=new Qr,this.programConfigurations=new xa(t.layers,t.zoom),this.segments=new Rt,this.segments2=new Rt,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){this.hasPattern=Af("fill",this.layers,i);const h=this.layers[0].layout.get("fill-sort-key"),g=!h.isConstant(),y=[];for(const{feature:x,id:b,index:k,sourceLayerIndex:I}of t){const P=this.layers[0]._featureFilter.needGeometry,z=wa(x,P);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),z,a))continue;const L=g?h.evaluate(z,{},a,i.availableImages):void 0,O={id:b,properties:x.properties,type:x.type,sourceLayerIndex:I,index:k,geometry:P?z.geometry:va(x),patterns:{},sortKey:L};y.push(O)}g&&y.sort((x,b)=>x.sortKey-b.sortKey);for(const x of y){const{geometry:b,index:k,sourceLayerIndex:I}=x;if(this.hasPattern){const P=Mf("fill",this.layers,x,this.zoom,i);this.patternFeatures.push(P)}else this.addFeature(x,b,k,a,{});i.featureIndex.insert(t[k].feature,b,k,I,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}addFeatures(t,i,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,i,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vw),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,a,h,g){for(const y of Ya(i,500)){let x=0;for(const L of y)x+=L.length;const b=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),k=b.vertexLength,I=[],P=[];for(const L of y){if(L.length===0)continue;L!==y[0]&&P.push(I.length/2);const O=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),j=O.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(j+L.length-1,j),I.push(L[0].x),I.push(L[0].y);for(let X=1;X<L.length;X++)this.layoutVertexArray.emplaceBack(L[X].x,L[X].y),this.indexArray2.emplaceBack(j+X-1,j+X),I.push(L[X].x),I.push(L[X].y);O.vertexLength+=L.length,O.primitiveLength+=L.length}const z=Qy(I,P);for(let L=0;L<z.length;L+=3)this.indexArray.emplaceBack(k+z[L],k+z[L+1],k+z[L+2]);b.vertexLength+=x,b.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}}let i_,s_;Je("FillBucket",zf,{omit:["layers","patternFeatures"]});var Jw={get paint(){return s_=s_||new m({"fill-antialias":new et(xe.paint_fill["fill-antialias"]),"fill-opacity":new dt(xe.paint_fill["fill-opacity"]),"fill-color":new dt(xe.paint_fill["fill-color"]),"fill-outline-color":new dt(xe.paint_fill["fill-outline-color"]),"fill-translate":new et(xe.paint_fill["fill-translate"]),"fill-translate-anchor":new et(xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new _l(xe.paint_fill["fill-pattern"])})},get layout(){return i_=i_||new m({"fill-sort-key":new dt(xe.layout_fill["fill-sort-key"])})}};class Yw extends o{constructor(t){super(t,Jw)}recalculate(t,i){super.recalculate(t,i);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new zf(t)}queryRadius(){return rd(this.paint.get("fill-translate"))}queryIntersectsFeature(t,i,a,h,g,y,x){return Vy(nd(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,x),h)}isTileClipped(){return!0}}const Qw=w([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),eb=w([{name:"a_centroid",components:2,type:"Int16"}],4),{members:tb}=Qw;var ko={},rb=Z,o_=Pl;function Pl(n,t,i,a,h){this.properties={},this.extent=i,this.type=0,this._pbf=n,this._geometry=-1,this._keys=a,this._values=h,n.readFields(nb,this,t)}function nb(n,t,i){n==1?t.id=i.readVarint():n==2?function(a,h){for(var g=a.readVarint()+a.pos;a.pos<g;){var y=h._keys[a.readVarint()],x=h._values[a.readVarint()];h.properties[y]=x}}(i,t):n==3?t.type=i.readVarint():n==4&&(t._geometry=i.pos)}function ib(n){for(var t,i,a=0,h=0,g=n.length,y=g-1;h<g;y=h++)a+=((i=n[y]).x-(t=n[h]).x)*(t.y+i.y);return a}Pl.types=["Unknown","Point","LineString","Polygon"],Pl.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,i=n.readVarint()+n.pos,a=1,h=0,g=0,y=0,x=[];n.pos<i;){if(h<=0){var b=n.readVarint();a=7&b,h=b>>3}if(h--,a===1||a===2)g+=n.readSVarint(),y+=n.readSVarint(),a===1&&(t&&x.push(t),t=[]),t.push(new rb(g,y));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&x.push(t),x},Pl.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,i=1,a=0,h=0,g=0,y=1/0,x=-1/0,b=1/0,k=-1/0;n.pos<t;){if(a<=0){var I=n.readVarint();i=7&I,a=I>>3}if(a--,i===1||i===2)(h+=n.readSVarint())<y&&(y=h),h>x&&(x=h),(g+=n.readSVarint())<b&&(b=g),g>k&&(k=g);else if(i!==7)throw new Error("unknown command "+i)}return[y,b,x,k]},Pl.prototype.toGeoJSON=function(n,t,i){var a,h,g=this.extent*Math.pow(2,i),y=this.extent*n,x=this.extent*t,b=this.loadGeometry(),k=Pl.types[this.type];function I(L){for(var O=0;O<L.length;O++){var j=L[O];L[O]=[360*(j.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+x)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(a=0;a<b.length;a++)P[a]=b[a][0];I(b=P);break;case 2:for(a=0;a<b.length;a++)I(b[a]);break;case 3:for(b=function(L){var O=L.length;if(O<=1)return[L];for(var j,X,J=[],me=0;me<O;me++){var se=ib(L[me]);se!==0&&(X===void 0&&(X=se<0),X===se<0?(j&&J.push(j),j=[L[me]]):j.push(L[me]))}return j&&J.push(j),J}(b),a=0;a<b.length;a++)for(h=0;h<b[a].length;h++)I(b[a][h])}b.length===1?b=b[0]:k="Multi"+k;var z={type:"Feature",geometry:{type:k,coordinates:b},properties:this.properties};return"id"in this&&(z.id=this.id),z};var sb=o_,a_=l_;function l_(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(ob,this,t),this.length=this._features.length}function ob(n,t,i){n===15?t.version=i.readVarint():n===1?t.name=i.readString():n===5?t.extent=i.readVarint():n===2?t._features.push(i.pos):n===3?t._keys.push(i.readString()):n===4&&t._values.push(function(a){for(var h=null,g=a.readVarint()+a.pos;a.pos<g;){var y=a.readVarint()>>3;h=y===1?a.readString():y===2?a.readFloat():y===3?a.readDouble():y===4?a.readVarint64():y===5?a.readVarint():y===6?a.readSVarint():y===7?a.readBoolean():null}return h}(i))}l_.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new sb(this._pbf,t,this.extent,this._keys,this._values)};var ab=a_;function lb(n,t,i){if(n===3){var a=new ab(i,i.readVarint()+i.pos);a.length&&(t[a.name]=a)}}ko.VectorTile=function(n,t){this.layers=n.readFields(lb,{},t)},ko.VectorTileFeature=o_,ko.VectorTileLayer=a_;const ub=ko.VectorTileFeature.types,Rf=Math.pow(2,13);function hc(n,t,i,a,h,g,y,x){n.emplaceBack(t,i,2*Math.floor(a*Rf)+y,h*Rf*2,g*Rf*2,Math.round(x))}class Df{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new vo,this.centroidVertexArray=new on,this.indexArray=new Si,this.programConfigurations=new xa(t.layers,t.zoom),this.segments=new Rt,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){this.features=[],this.hasPattern=Af("fill-extrusion",this.layers,i);for(const{feature:h,id:g,index:y,sourceLayerIndex:x}of t){const b=this.layers[0]._featureFilter.needGeometry,k=wa(h,b);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),k,a))continue;const I={id:g,sourceLayerIndex:x,index:y,geometry:b?k.geometry:va(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(Mf("fill-extrusion",this.layers,I,this.zoom,i)):this.addFeature(I,I.geometry,y,a,{}),i.featureIndex.insert(h,I.geometry,y,x,this.index,!0)}}addFeatures(t,i,a){for(const h of this.features){const{geometry:g}=h;this.addFeature(h,g,h.index,i,a)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,tb),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,eb.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,i,a,h,g){for(const y of Ya(i,500)){const x={x:0,y:0,vertexCount:0};let b=0;for(const O of y)b+=O.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const O of y){if(O.length===0||hb(O))continue;let j=0;for(let X=0;X<O.length;X++){const J=O[X];if(X>=1){const me=O[X-1];if(!cb(J,me)){k.vertexLength+4>Rt.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const se=J.sub(me)._perp()._unit(),fe=me.dist(J);j+fe>32768&&(j=0),hc(this.layoutVertexArray,J.x,J.y,se.x,se.y,0,0,j),hc(this.layoutVertexArray,J.x,J.y,se.x,se.y,0,1,j),x.x+=2*J.x,x.y+=2*J.y,x.vertexCount+=2,j+=fe,hc(this.layoutVertexArray,me.x,me.y,se.x,se.y,0,0,j),hc(this.layoutVertexArray,me.x,me.y,se.x,se.y,0,1,j),x.x+=2*me.x,x.y+=2*me.y,x.vertexCount+=2;const we=k.vertexLength;this.indexArray.emplaceBack(we,we+2,we+1),this.indexArray.emplaceBack(we+1,we+2,we+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+b>Rt.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray)),ub[t.type]!=="Polygon")continue;const I=[],P=[],z=k.vertexLength;for(const O of y)if(O.length!==0){O!==y[0]&&P.push(I.length/2);for(let j=0;j<O.length;j++){const X=O[j];hc(this.layoutVertexArray,X.x,X.y,0,0,1,1,0),x.x+=X.x,x.y+=X.y,x.vertexCount+=1,I.push(X.x),I.push(X.y)}}const L=Qy(I,P);for(let O=0;O<L.length;O+=3)this.indexArray.emplaceBack(z+L[O],z+L[O+2],z+L[O+1]);k.primitiveLength+=L.length/3,k.vertexLength+=b;for(let O=0;O<x.vertexCount;O++){const j=Math.floor(x.x/x.vertexCount),X=Math.floor(x.y/x.vertexCount);this.centroidVertexArray.emplaceBack(j,X)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}}function cb(n,t){return n.x===t.x&&(n.x<0||n.x>Ur)||n.y===t.y&&(n.y<0||n.y>Ur)}function hb(n){return n.every(t=>t.x<0)||n.every(t=>t.x>Ur)||n.every(t=>t.y<0)||n.every(t=>t.y>Ur)}let u_;Je("FillExtrusionBucket",Df,{omit:["layers","features"]});var db={get paint(){return u_=u_||new m({"fill-extrusion-opacity":new et(xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new dt(xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new et(xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new et(xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _l(xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new dt(xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new dt(xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new et(xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class pb extends o{constructor(t){super(t,db)}createBucket(t){return new Df(t)}queryRadius(){return rd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,i,a,h,g,y,x,b){const k=nd(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,x),I=this.paint.get("fill-extrusion-height").evaluate(i,a),P=this.paint.get("fill-extrusion-base").evaluate(i,a),z=function(O,j,X,J){const me=[];for(const se of O){const fe=[se.x,se.y,0,1];id(fe,fe,j),me.push(new q(fe[0]/fe[3],fe[1]/fe[3]))}return me}(k,b),L=function(O,j,X,J){const me=[],se=[],fe=J[8]*j,we=J[9]*j,Ae=J[10]*j,He=J[11]*j,ct=J[8]*X,$e=J[9]*X,je=J[10]*X,nt=J[11]*X;for(const Ye of O){const Ke=[],Se=[];for(const ot of Ye){const rt=ot.x,vt=ot.y,rr=J[0]*rt+J[4]*vt+J[12],tr=J[1]*rt+J[5]*vt+J[13],Wr=J[2]*rt+J[6]*vt+J[14],Ni=J[3]*rt+J[7]*vt+J[15],un=Wr+Ae,Xr=Ni+He,Pn=rr+ct,An=tr+$e,Mn=Wr+je,kr=Ni+nt,Kr=new q((rr+fe)/Xr,(tr+we)/Xr);Kr.z=un/Xr,Ke.push(Kr);const _n=new q(Pn/kr,An/kr);_n.z=Mn/kr,Se.push(_n)}me.push(Ke),se.push(Se)}return[me,se]}(h,P,I,b);return function(O,j,X){let J=1/0;Vy(X,j)&&(J=c_(X,j[0]));for(let me=0;me<j.length;me++){const se=j[me],fe=O[me];for(let we=0;we<se.length-1;we++){const Ae=se[we],He=[Ae,se[we+1],fe[we+1],fe[we],Ae];jy(X,He)&&(J=Math.min(J,c_(X,He)))}}return J!==1/0&&J}(L[0],L[1],z)}}function dc(n,t){return n.x*t.x+n.y*t.y}function c_(n,t){if(n.length===1){let i=0;const a=t[i++];let h;for(;!h||a.equals(h);)if(h=t[i++],!h)return 1/0;for(;i<t.length;i++){const g=t[i],y=n[0],x=h.sub(a),b=g.sub(a),k=y.sub(a),I=dc(x,x),P=dc(x,b),z=dc(b,b),L=dc(k,x),O=dc(k,b),j=I*z-P*P,X=(z*L-P*O)/j,J=(I*O-P*L)/j,me=a.z*(1-X-J)+h.z*X+g.z*J;if(isFinite(me))return me}return 1/0}{let i=1/0;for(const a of t)i=Math.min(i,a.z);return i}}const fb=w([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:mb}=fb,gb=w([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:yb}=gb,_b=ko.VectorTileFeature.types,xb=Math.cos(Math.PI/180*37.5),h_=Math.pow(2,14)/.5;class Lf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new vl,this.layoutVertexArray2=new wo,this.indexArray=new Si,this.programConfigurations=new xa(t.layers,t.zoom),this.segments=new Rt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){this.hasPattern=Af("line",this.layers,i);const h=this.layers[0].layout.get("line-sort-key"),g=!h.isConstant(),y=[];for(const{feature:x,id:b,index:k,sourceLayerIndex:I}of t){const P=this.layers[0]._featureFilter.needGeometry,z=wa(x,P);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),z,a))continue;const L=g?h.evaluate(z,{},a):void 0,O={id:b,properties:x.properties,type:x.type,sourceLayerIndex:I,index:k,geometry:P?z.geometry:va(x),patterns:{},sortKey:L};y.push(O)}g&&y.sort((x,b)=>x.sortKey-b.sortKey);for(const x of y){const{geometry:b,index:k,sourceLayerIndex:I}=x;if(this.hasPattern){const P=Mf("line",this.layers,x,this.zoom,i);this.patternFeatures.push(P)}else this.addFeature(x,b,k,a,{});i.featureIndex.insert(t[k].feature,b,k,I,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}addFeatures(t,i,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,i,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,yb)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,mb),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,a,h,g){const y=this.layers[0].layout,x=y.get("line-join").evaluate(t,{}),b=y.get("line-cap"),k=y.get("line-miter-limit"),I=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const P of i)this.addLine(P,t,x,b,k,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}addLine(t,i,a,h,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<t.length-1;J++)this.totalDistance+=t[J].dist(t[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=_b[i.type]==="Polygon";let b=t.length;for(;b>=2&&t[b-1].equals(t[b-2]);)b--;let k=0;for(;k<b-1&&t[k].equals(t[k+1]);)k++;if(b<(x?3:2))return;a==="bevel"&&(g=1.05);const I=this.overscaling<=16?15*Ur/(512*this.overscaling):0,P=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let z,L,O,j,X;this.e1=this.e2=-1,x&&(z=t[b-2],X=t[k].sub(z)._unit()._perp());for(let J=k;J<b;J++){if(O=J===b-1?x?t[k+1]:void 0:t[J+1],O&&t[J].equals(O))continue;X&&(j=X),z&&(L=z),z=t[J],X=O?O.sub(z)._unit()._perp():j,j=j||X;let me=j.add(X);me.x===0&&me.y===0||me._unit();const se=j.x*X.x+j.y*X.y,fe=me.x*X.x+me.y*X.y,we=fe!==0?1/fe:1/0,Ae=2*Math.sqrt(2-2*fe),He=fe<xb&&L&&O,ct=j.x*X.y-j.y*X.x>0;if(He&&J>k){const nt=z.dist(L);if(nt>2*I){const Ye=z.sub(z.sub(L)._mult(I/nt)._round());this.updateDistance(L,Ye),this.addCurrentVertex(Ye,j,0,0,P),L=Ye}}const $e=L&&O;let je=$e?a:x?"butt":h;if($e&&je==="round"&&(we<y?je="miter":we<=2&&(je="fakeround")),je==="miter"&&we>g&&(je="bevel"),je==="bevel"&&(we>2&&(je="flipbevel"),we<g&&(je="miter")),L&&this.updateDistance(L,z),je==="miter")me._mult(we),this.addCurrentVertex(z,me,0,0,P);else if(je==="flipbevel"){if(we>100)me=X.mult(-1);else{const nt=we*j.add(X).mag()/j.sub(X).mag();me._perp()._mult(nt*(ct?-1:1))}this.addCurrentVertex(z,me,0,0,P),this.addCurrentVertex(z,me.mult(-1),0,0,P)}else if(je==="bevel"||je==="fakeround"){const nt=-Math.sqrt(we*we-1),Ye=ct?nt:0,Ke=ct?0:nt;if(L&&this.addCurrentVertex(z,j,Ye,Ke,P),je==="fakeround"){const Se=Math.round(180*Ae/Math.PI/20);for(let ot=1;ot<Se;ot++){let rt=ot/Se;if(rt!==.5){const rr=rt-.5;rt+=rt*rr*(rt-1)*((1.0904+se*(se*(3.55645-1.43519*se)-3.2452))*rr*rr+(.848013+se*(.215638*se-1.06021)))}const vt=X.sub(j)._mult(rt)._add(j)._unit()._mult(ct?-1:1);this.addHalfVertex(z,vt.x,vt.y,!1,ct,0,P)}}O&&this.addCurrentVertex(z,X,-Ye,-Ke,P)}else if(je==="butt")this.addCurrentVertex(z,me,0,0,P);else if(je==="square"){const nt=L?1:-1;this.addCurrentVertex(z,me,nt,nt,P)}else je==="round"&&(L&&(this.addCurrentVertex(z,j,0,0,P),this.addCurrentVertex(z,j,1,1,P,!0)),O&&(this.addCurrentVertex(z,X,-1,-1,P,!0),this.addCurrentVertex(z,X,0,0,P)));if(He&&J<b-1){const nt=z.dist(O);if(nt>2*I){const Ye=z.add(O.sub(z)._mult(I/nt)._round());this.updateDistance(z,Ye),this.addCurrentVertex(Ye,X,0,0,P),z=Ye}}}}addCurrentVertex(t,i,a,h,g,y=!1){const x=i.y*h-i.x,b=-i.y-i.x*h;this.addHalfVertex(t,i.x+i.y*a,i.y-i.x*a,y,!1,a,g),this.addHalfVertex(t,x,b,y,!0,-h,g),this.distance>h_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,i,a,h,g,y))}addHalfVertex({x:t,y:i},a,h,g,y,x,b){const k=.5*(this.lineClips?this.scaledDistance*(h_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(i<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(x===0?0:x<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),b.primitiveLength++),y?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}let d_,p_;Je("LineBucket",Lf,{omit:["layers","patternFeatures"]});var f_={get paint(){return p_=p_||new m({"line-opacity":new dt(xe.paint_line["line-opacity"]),"line-color":new dt(xe.paint_line["line-color"]),"line-translate":new et(xe.paint_line["line-translate"]),"line-translate-anchor":new et(xe.paint_line["line-translate-anchor"]),"line-width":new dt(xe.paint_line["line-width"]),"line-gap-width":new dt(xe.paint_line["line-gap-width"]),"line-offset":new dt(xe.paint_line["line-offset"]),"line-blur":new dt(xe.paint_line["line-blur"]),"line-dasharray":new xl(xe.paint_line["line-dasharray"]),"line-pattern":new _l(xe.paint_line["line-pattern"]),"line-gradient":new rc(xe.paint_line["line-gradient"])})},get layout(){return d_=d_||new m({"line-cap":new et(xe.layout_line["line-cap"]),"line-join":new dt(xe.layout_line["line-join"]),"line-miter-limit":new et(xe.layout_line["line-miter-limit"]),"line-round-limit":new et(xe.layout_line["line-round-limit"]),"line-sort-key":new dt(xe.layout_line["line-sort-key"])})}};class vb extends dt{possiblyEvaluate(t,i){return i=new ur(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(t,i)}evaluate(t,i,a,h){return i=Oe({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(t,i,a,h)}}let ld;class wb extends o{constructor(t){super(t,f_),this.gradientVersion=0,ld||(ld=new vb(f_.paint.properties["line-width"].specification),ld.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(i)&&i._styleExpression.expression instanceof to,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,i){super.recalculate(t,i),this.paint._values["line-floorwidth"]=ld.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Lf(t)}queryRadius(t){const i=t,a=m_(sc("line-width",this,i),sc("line-gap-width",this,i)),h=sc("line-offset",this,i);return a/2+Math.abs(h)+rd(this.paint.get("line-translate"))}queryIntersectsFeature(t,i,a,h,g,y,x){const b=nd(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,x),k=x/2*m_(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),I=this.paint.get("line-offset").evaluate(i,a);return I&&(h=function(P,z){const L=[];for(let O=0;O<P.length;O++){const j=P[O],X=[];for(let J=0;J<j.length;J++){const me=j[J-1],se=j[J],fe=j[J+1],we=J===0?new q(0,0):se.sub(me)._unit()._perp(),Ae=J===j.length-1?new q(0,0):fe.sub(se)._unit()._perp(),He=we._add(Ae)._unit(),ct=He.x*Ae.x+He.y*Ae.y;ct!==0&&He._mult(1/ct),X.push(He._mult(z)._add(se))}L.push(X)}return L}(h,I*x)),function(P,z,L){for(let O=0;O<z.length;O++){const j=z[O];if(P.length>=3){for(let X=0;X<j.length;X++)if(kl(P,j[X]))return!0}if(Aw(P,j,L))return!0}return!1}(b,h,k)}isTileClipped(){return!0}}function m_(n,t){return t>0?t+2*n:n}const bb=w([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Sb=w([{name:"a_projected_pos",components:3,type:"Float32"}],4);w([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Tb=w([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);w([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const g_=w([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Eb=w([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function kb(n,t,i){return n.sections.forEach(a=>{a.text=function(h,g,y){const x=g.layout.get("text-transform").evaluate(y,{});return x==="uppercase"?h=h.toLocaleUpperCase():x==="lowercase"&&(h=h.toLocaleLowerCase()),$n.applyArabicShaping&&(h=$n.applyArabicShaping(h)),h}(a.text,t,i)}),n}w([{name:"triangle",components:3,type:"Uint16"}]),w([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),w([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),w([{type:"Float32",name:"offsetX"}]),w([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),w([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const pc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var qr=24,y_=er,__=function(n,t,i,a,h){var g,y,x=8*h-a-1,b=(1<<x)-1,k=b>>1,I=-7,P=h-1,z=-1,L=n[t+P];for(P+=z,g=L&(1<<-I)-1,L>>=-I,I+=x;I>0;g=256*g+n[t+P],P+=z,I-=8);for(y=g&(1<<-I)-1,g>>=-I,I+=a;I>0;y=256*y+n[t+P],P+=z,I-=8);if(g===0)g=1-k;else{if(g===b)return y?NaN:1/0*(L?-1:1);y+=Math.pow(2,a),g-=k}return(L?-1:1)*y*Math.pow(2,g-a)},x_=function(n,t,i,a,h,g){var y,x,b,k=8*g-h-1,I=(1<<k)-1,P=I>>1,z=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=0,O=1,j=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(x=isNaN(t)?1:0,y=I):(y=Math.floor(Math.log(t)/Math.LN2),t*(b=Math.pow(2,-y))<1&&(y--,b*=2),(t+=y+P>=1?z/b:z*Math.pow(2,1-P))*b>=2&&(y++,b/=2),y+P>=I?(x=0,y=I):y+P>=1?(x=(t*b-1)*Math.pow(2,h),y+=P):(x=t*Math.pow(2,P-1)*Math.pow(2,h),y=0));h>=8;n[i+L]=255&x,L+=O,x/=256,h-=8);for(y=y<<h|x,k+=h;k>0;n[i+L]=255&y,L+=O,y/=256,k-=8);n[i+L-O]|=128*j};function er(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}er.Varint=0,er.Fixed64=1,er.Bytes=2,er.Fixed32=5;var Ff=4294967296,v_=1/Ff,w_=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Ns(n){return n.type===er.Bytes?n.readVarint()+n.pos:n.pos+1}function Al(n,t,i){return i?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function b_(n,t,i){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(a);for(var h=i.pos-1;h>=n;h--)i.buf[h+a]=i.buf[h]}function Ib(n,t){for(var i=0;i<n.length;i++)t.writeVarint(n[i])}function Cb(n,t){for(var i=0;i<n.length;i++)t.writeSVarint(n[i])}function Pb(n,t){for(var i=0;i<n.length;i++)t.writeFloat(n[i])}function Ab(n,t){for(var i=0;i<n.length;i++)t.writeDouble(n[i])}function Mb(n,t){for(var i=0;i<n.length;i++)t.writeBoolean(n[i])}function zb(n,t){for(var i=0;i<n.length;i++)t.writeFixed32(n[i])}function Rb(n,t){for(var i=0;i<n.length;i++)t.writeSFixed32(n[i])}function Db(n,t){for(var i=0;i<n.length;i++)t.writeFixed64(n[i])}function Lb(n,t){for(var i=0;i<n.length;i++)t.writeSFixed64(n[i])}function ud(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function Ml(n,t,i){n[i]=t,n[i+1]=t>>>8,n[i+2]=t>>>16,n[i+3]=t>>>24}function S_(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}er.prototype={destroy:function(){this.buf=null},readFields:function(n,t,i){for(i=i||this.length;this.pos<i;){var a=this.readVarint(),h=a>>3,g=this.pos;this.type=7&a,n(h,t,this),this.pos===g&&this.skip(a)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=ud(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=S_(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=ud(this.buf,this.pos)+ud(this.buf,this.pos+4)*Ff;return this.pos+=8,n},readSFixed64:function(){var n=ud(this.buf,this.pos)+S_(this.buf,this.pos+4)*Ff;return this.pos+=8,n},readFloat:function(){var n=__(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=__(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,i,a=this.buf;return t=127&(i=a[this.pos++]),i<128?t:(t|=(127&(i=a[this.pos++]))<<7,i<128?t:(t|=(127&(i=a[this.pos++]))<<14,i<128?t:(t|=(127&(i=a[this.pos++]))<<21,i<128?t:function(h,g,y){var x,b,k=y.buf;if(x=(112&(b=k[y.pos++]))>>4,b<128||(x|=(127&(b=k[y.pos++]))<<3,b<128)||(x|=(127&(b=k[y.pos++]))<<10,b<128)||(x|=(127&(b=k[y.pos++]))<<17,b<128)||(x|=(127&(b=k[y.pos++]))<<24,b<128)||(x|=(1&(b=k[y.pos++]))<<31,b<128))return Al(h,x,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=a[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&w_?function(i,a,h){return w_.decode(i.subarray(a,h))}(this.buf,t,n):function(i,a,h){for(var g="",y=a;y<h;){var x,b,k,I=i[y],P=null,z=I>239?4:I>223?3:I>191?2:1;if(y+z>h)break;z===1?I<128&&(P=I):z===2?(192&(x=i[y+1]))==128&&(P=(31&I)<<6|63&x)<=127&&(P=null):z===3?(b=i[y+2],(192&(x=i[y+1]))==128&&(192&b)==128&&((P=(15&I)<<12|(63&x)<<6|63&b)<=2047||P>=55296&&P<=57343)&&(P=null)):z===4&&(b=i[y+2],k=i[y+3],(192&(x=i[y+1]))==128&&(192&b)==128&&(192&k)==128&&((P=(15&I)<<18|(63&x)<<12|(63&b)<<6|63&k)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,z=1):P>65535&&(P-=65536,g+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),g+=String.fromCharCode(P),y+=z}return g}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==er.Bytes)return n.push(this.readVarint(t));var i=Ns(this);for(n=n||[];this.pos<i;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==er.Bytes)return n.push(this.readSVarint());var t=Ns(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==er.Bytes)return n.push(this.readBoolean());var t=Ns(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==er.Bytes)return n.push(this.readFloat());var t=Ns(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==er.Bytes)return n.push(this.readDouble());var t=Ns(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==er.Bytes)return n.push(this.readFixed32());var t=Ns(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==er.Bytes)return n.push(this.readSFixed32());var t=Ns(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==er.Bytes)return n.push(this.readFixed64());var t=Ns(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==er.Bytes)return n.push(this.readSFixed64());var t=Ns(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===er.Varint)for(;this.buf[this.pos++]>127;);else if(t===er.Bytes)this.pos=this.readVarint()+this.pos;else if(t===er.Fixed32)this.pos+=4;else{if(t!==er.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Ml(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Ml(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Ml(this.buf,-1&n,this.pos),Ml(this.buf,Math.floor(n*v_),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Ml(this.buf,-1&n,this.pos),Ml(this.buf,Math.floor(n*v_),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,i){var a,h;if(t>=0?(a=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(g,y,x){x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,x.buf[x.pos]=127&(g>>>=7)}(a,0,i),function(g,y){var x=(7&g)<<4;y.buf[y.pos++]|=x|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(h,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(a,h,g){for(var y,x,b=0;b<h.length;b++){if((y=h.charCodeAt(b))>55295&&y<57344){if(!x){y>56319||b+1===h.length?(a[g++]=239,a[g++]=191,a[g++]=189):x=y;continue}if(y<56320){a[g++]=239,a[g++]=191,a[g++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(a[g++]=239,a[g++]=191,a[g++]=189,x=null);y<128?a[g++]=y:(y<2048?a[g++]=y>>6|192:(y<65536?a[g++]=y>>12|224:(a[g++]=y>>18|240,a[g++]=y>>12&63|128),a[g++]=y>>6&63|128),a[g++]=63&y|128)}return g}(this.buf,n,this.pos);var i=this.pos-t;i>=128&&b_(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(n){this.realloc(4),x_(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),x_(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=n[i]},writeRawMessage:function(n,t){this.pos++;var i=this.pos;n(t,this);var a=this.pos-i;a>=128&&b_(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeMessage:function(n,t,i){this.writeTag(n,er.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,Ib,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,Cb,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,Mb,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,Pb,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,Ab,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,zb,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,Rb,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,Db,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,Lb,t)},writeBytesField:function(n,t){this.writeTag(n,er.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,er.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,er.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,er.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,er.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,er.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,er.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,er.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,er.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,er.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};var Of=N(y_);const Bf=3;function Fb(n,t,i){n===1&&i.readMessage(Ob,t)}function Ob(n,t,i){if(n===3){const{id:a,bitmap:h,width:g,height:y,left:x,top:b,advance:k}=i.readMessage(Bb,{});t.push({id:a,bitmap:new ac({width:g+2*Bf,height:y+2*Bf},h),metrics:{width:g,height:y,left:x,top:b,advance:k}})}}function Bb(n,t,i){n===1?t.id=i.readVarint():n===2?t.bitmap=i.readBytes():n===3?t.width=i.readVarint():n===4?t.height=i.readVarint():n===5?t.left=i.readSVarint():n===6?t.top=i.readSVarint():n===7&&(t.advance=i.readVarint())}const T_=Bf;function E_(n){let t=0,i=0;for(const y of n)t+=y.w*y.h,i=Math.max(i,y.w);n.sort((y,x)=>x.h-y.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let h=0,g=0;for(const y of n)for(let x=a.length-1;x>=0;x--){const b=a[x];if(!(y.w>b.w||y.h>b.h)){if(y.x=b.x,y.y=b.y,g=Math.max(g,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===b.w&&y.h===b.h){const k=a.pop();x<a.length&&(a[x]=k)}else y.h===b.h?(b.x+=y.w,b.w-=y.w):y.w===b.w?(b.y+=y.h,b.h-=y.h):(a.push({x:b.x+y.w,y:b.y,w:b.w-y.w,h:y.h}),b.y+=y.h,b.h-=y.h);break}}return{w:h,h:g,fill:t/(h*g)||0}}const Zn=1;class Nf{constructor(t,{pixelRatio:i,version:a,stretchX:h,stretchY:g,content:y,textFitWidth:x,textFitHeight:b}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=h,this.stretchY=g,this.content=y,this.version=a,this.textFitWidth=x,this.textFitHeight=b}get tl(){return[this.paddedRect.x+Zn,this.paddedRect.y+Zn]}get br(){return[this.paddedRect.x+this.paddedRect.w-Zn,this.paddedRect.y+this.paddedRect.h-Zn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Zn)/this.pixelRatio,(this.paddedRect.h-2*Zn)/this.pixelRatio]}}class k_{constructor(t,i){const a={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,a,g),this.addImages(i,h,g);const{w:y,h:x}=E_(g),b=new Ti({width:y||1,height:x||1});for(const k in t){const I=t[k],P=a[k].paddedRect;Ti.copy(I.data,b,{x:0,y:0},{x:P.x+Zn,y:P.y+Zn},I.data)}for(const k in i){const I=i[k],P=h[k].paddedRect,z=P.x+Zn,L=P.y+Zn,O=I.data.width,j=I.data.height;Ti.copy(I.data,b,{x:0,y:0},{x:z,y:L},I.data),Ti.copy(I.data,b,{x:0,y:j-1},{x:z,y:L-1},{width:O,height:1}),Ti.copy(I.data,b,{x:0,y:0},{x:z,y:L+j},{width:O,height:1}),Ti.copy(I.data,b,{x:O-1,y:0},{x:z-1,y:L},{width:1,height:j}),Ti.copy(I.data,b,{x:0,y:0},{x:z+O,y:L},{width:1,height:j})}this.image=b,this.iconPositions=a,this.patternPositions=h}addImages(t,i,a){for(const h in t){const g=t[h],y={x:0,y:0,w:g.data.width+2*Zn,h:g.data.height+2*Zn};a.push(y),i[h]=new Nf(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,i){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),i),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),i)}patchUpdatedImage(t,i,a){if(!t||!i||t.version===i.version)return;t.version=i.version;const[h,g]=t.tl;a.update(i.data,void 0,{x:h,y:g})}}var Io;Je("ImagePosition",Nf),Je("ImageAtlas",k_),v.ah=void 0,(Io=v.ah||(v.ah={}))[Io.none=0]="none",Io[Io.horizontal=1]="horizontal",Io[Io.vertical=2]="vertical",Io[Io.horizontalOnly=3]="horizontalOnly";const fc=-17;class mc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,i){const a=new mc;return a.scale=t||1,a.fontStack=i,a}static forImage(t){const i=new mc;return i.imageName=t,i}}class zl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){const a=new zl;for(let h=0;h<t.sections.length;h++){const g=t.sections[h];g.image?a.addImageSection(g):a.addTextSection(g,i)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let i="";for(let a=0;a<t.length;a++){const h=t.charCodeAt(a+1)||null,g=t.charCodeAt(a-1)||null;i+=h&&Xh(h)&&!pc[t[a+1]]||g&&Xh(g)&&!pc[t[a-1]]||!pc[t[a]]?t[a]:pc[t[a]]}return i}(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&hd[this.text.charCodeAt(a)];a++)t++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&hd[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){const a=new zl;return a.text=this.text.substring(t,i),a.sectionIndex=this.sectionIndex.slice(t,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(mc.forText(t.scale,t.fontStack||i));const a=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(a)}addImageSection(t){const i=t.image?t.image.name:"";if(i.length===0)return void Dt("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(mc.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Dt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function cd(n,t,i,a,h,g,y,x,b,k,I,P,z,L,O){const j=zl.fromFeature(n,h);let X;P===v.ah.vertical&&j.verticalizePunctuation();const{processBidirectionalText:J,processStyledBidirectionalText:me}=$n;if(J&&j.sections.length===1){X=[];const we=J(j.toString(),jf(j,k,g,t,a,L));for(const Ae of we){const He=new zl;He.text=Ae,He.sections=j.sections;for(let ct=0;ct<Ae.length;ct++)He.sectionIndex.push(0);X.push(He)}}else if(me){X=[];const we=me(j.text,j.sectionIndex,jf(j,k,g,t,a,L));for(const Ae of we){const He=new zl;He.text=Ae[0],He.sectionIndex=Ae[1],He.sections=j.sections,X.push(He)}}else X=function(we,Ae){const He=[],ct=we.text;let $e=0;for(const je of Ae)He.push(we.substring($e,je)),$e=je;return $e<ct.length&&He.push(we.substring($e,ct.length)),He}(j,jf(j,k,g,t,a,L));const se=[],fe={positionedLines:se,text:j.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:P,iconsInText:!1,verticalizable:!1};return function(we,Ae,He,ct,$e,je,nt,Ye,Ke,Se,ot,rt){let vt=0,rr=fc,tr=0,Wr=0;const Ni=Ye==="right"?1:Ye==="left"?0:.5;let un=0;for(const kr of $e){kr.trim();const Kr=kr.getMaxScale(),_n=(Kr-1)*qr,cn={positionedGlyphs:[],lineOffset:0};we.positionedLines[un]=cn;const zn=cn.positionedGlyphs;let hn=0;if(!kr.length()){rr+=je,++un;continue}for(let Hn=0;Hn<kr.length();Hn++){const $t=kr.getSection(Hn),sr=kr.getSectionIndex(Hn),pr=kr.getCharCode(Hn);let ai=0,wr=null,Fl=null,gs=null,ys=qr;const ji=!(Ke===v.ah.horizontal||!ot&&!ec(pr)||ot&&(hd[pr]||(Xr=pr,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Xr)))));if($t.imageName){const Ii=ct[$t.imageName];if(!Ii)continue;gs=$t.imageName,we.iconsInText=we.iconsInText||!0,Fl=Ii.paddedRect;const en=Ii.displaySize;$t.scale=$t.scale*qr/rt,wr={width:en[0],height:en[1],left:Zn,top:-T_,advance:ji?en[1]:en[0]},ai=_n+(qr-en[1]*$t.scale),ys=wr.advance;const js=ji?en[0]*$t.scale-qr*Kr:en[1]*$t.scale-qr*Kr;js>0&&js>hn&&(hn=js)}else{const Ii=He[$t.fontStack],en=Ii&&Ii[pr];if(en&&en.rect)Fl=en.rect,wr=en.metrics;else{const js=Ae[$t.fontStack],wc=js&&js[pr];if(!wc)continue;wr=wc.metrics}ai=(Kr-$t.scale)*qr}ji?(we.verticalizable=!0,zn.push({glyph:pr,imageName:gs,x:vt,y:rr+ai,vertical:ji,scale:$t.scale,fontStack:$t.fontStack,sectionIndex:sr,metrics:wr,rect:Fl}),vt+=ys*$t.scale+Se):(zn.push({glyph:pr,imageName:gs,x:vt,y:rr+ai,vertical:ji,scale:$t.scale,fontStack:$t.fontStack,sectionIndex:sr,metrics:wr,rect:Fl}),vt+=wr.advance*$t.scale+Se)}zn.length!==0&&(tr=Math.max(vt-Se,tr),Ub(zn,0,zn.length-1,Ni,hn)),vt=0;const ki=je*Kr+hn;cn.lineOffset=Math.max(hn,_n),rr+=ki,Wr=Math.max(ki,Wr),++un}var Xr;const Pn=rr-fc,{horizontalAlign:An,verticalAlign:Mn}=Vf(nt);(function(kr,Kr,_n,cn,zn,hn,ki,Hn,$t){const sr=(Kr-_n)*zn;let pr=0;pr=hn!==ki?-Hn*cn-fc:(-cn*$t+.5)*ki;for(const ai of kr)for(const wr of ai.positionedGlyphs)wr.x+=sr,wr.y+=pr})(we.positionedLines,Ni,An,Mn,tr,Wr,je,Pn,$e.length),we.top+=-Mn*Pn,we.bottom=we.top+Pn,we.left+=-An*tr,we.right=we.left+tr}(fe,t,i,a,X,y,x,b,P,k,z,O),!function(we){for(const Ae of we)if(Ae.positionedGlyphs.length!==0)return!1;return!0}(se)&&fe}const hd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Nb={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},jb={40:!0};function I_(n,t,i,a,h,g){if(t.imageName){const y=a[t.imageName];return y?y.displaySize[0]*t.scale*qr/g+h:0}{const y=i[t.fontStack],x=y&&y[n];return x?x.metrics.advance*t.scale+h:0}}function C_(n,t,i,a){const h=Math.pow(n-t,2);return a?n<t?h/2:2*h:h+Math.abs(i)*i}function Vb(n,t,i){let a=0;return n===10&&(a-=1e4),i&&(a+=150),n!==40&&n!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function P_(n,t,i,a,h,g){let y=null,x=C_(t,i,h,g);for(const b of a){const k=C_(t-b.x,i,h,g)+b.badness;k<=x&&(y=b,x=k)}return{index:n,x:t,priorBreak:y,badness:x}}function A_(n){return n?A_(n.priorBreak).concat(n.index):[]}function jf(n,t,i,a,h,g){if(!n)return[];const y=[],x=function(P,z,L,O,j,X){let J=0;for(let me=0;me<P.length();me++){const se=P.getSection(me);J+=I_(P.getCharCode(me),se,O,j,z,X)}return J/Math.max(1,Math.ceil(J/L))}(n,t,i,a,h,g),b=n.text.indexOf("")>=0;let k=0;for(let P=0;P<n.length();P++){const z=n.getSection(P),L=n.getCharCode(P);if(hd[L]||(k+=I_(L,z,a,h,t,g)),P<n.length()-1){const O=!((I=L)<11904)&&(!!zt["CJK Compatibility Forms"](I)||!!zt["CJK Compatibility"](I)||!!zt["CJK Strokes"](I)||!!zt["CJK Symbols and Punctuation"](I)||!!zt["Enclosed CJK Letters and Months"](I)||!!zt["Halfwidth and Fullwidth Forms"](I)||!!zt["Ideographic Description Characters"](I)||!!zt["Vertical Forms"](I)||Wh.test(String.fromCodePoint(I)));(Nb[L]||O||z.imageName||P!==n.length()-2&&jb[n.getCharCode(P+1)])&&y.push(P_(P+1,k,x,y,Vb(L,n.getCharCode(P+1),O&&b),!1))}}var I;return A_(P_(n.length(),k,x,y,0,!0))}function Vf(n){let t=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Ub(n,t,i,a,h){if(!a&&!h)return;const g=n[i],y=(n[i].x+g.metrics.advance*g.scale)*a;for(let x=t;x<=i;x++)n[x].x-=y,n[x].y+=h}function $b(n,t,i){const{horizontalAlign:a,verticalAlign:h}=Vf(i),g=t[0]-n.displaySize[0]*a,y=t[1]-n.displaySize[1]*h;return{image:n,top:y,bottom:y+n.displaySize[1],left:g,right:g+n.displaySize[0]}}function M_(n){var t,i;let a=n.left,h=n.top,g=n.right-a,y=n.bottom-h;const x=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",b=(i=n.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",k=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(b==="proportional"){if(x==="stretchOnly"&&g/y<k||x==="proportional"){const I=Math.ceil(y*k);a*=I/g,g=I}}else if(x==="proportional"&&b==="stretchOnly"&&k!==0&&g/y>k){const I=Math.ceil(g/k);h*=I/y,y=I}return{x1:a,y1:h,x2:a+g,y2:h+y}}function z_(n,t,i,a,h,g){const y=n.image;let x;if(y.content){const X=y.content,J=y.pixelRatio||1;x=[X[0]/J,X[1]/J,y.displaySize[0]-X[2]/J,y.displaySize[1]-X[3]/J]}const b=t.left*g,k=t.right*g;let I,P,z,L;i==="width"||i==="both"?(L=h[0]+b-a[3],P=h[0]+k+a[1]):(L=h[0]+(b+k-y.displaySize[0])/2,P=L+y.displaySize[0]);const O=t.top*g,j=t.bottom*g;return i==="height"||i==="both"?(I=h[1]+O-a[0],z=h[1]+j+a[2]):(I=h[1]+(O+j-y.displaySize[1])/2,z=I+y.displaySize[1]),{image:y,top:I,right:P,bottom:z,left:L,collisionPadding:x}}const gc=255,ms=128,Co=gc*ms;function R_(n,t){const{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new ur(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:h}=i;let g=0;for(;g<a.length&&a[g]<=n;)g++;g=Math.max(0,g-1);let y=g;for(;y<a.length&&a[y]<n+1;)y++;y=Math.min(a.length-1,y);const x=a[g],b=a[y];return i.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:b,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:b,minSize:i.evaluate(new ur(x)),maxSize:i.evaluate(new ur(b)),interpolationType:h}}}function Uf(n,t,i){let a="never";const h=n.get(t);return h?a=h:n.get(i)&&(a="always"),a}const qb=ko.VectorTileFeature.types,Zb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function dd(n,t,i,a,h,g,y,x,b,k,I,P,z){const L=x?Math.min(Co,Math.round(x[0])):0,O=x?Math.min(Co,Math.round(x[1])):0;n.emplaceBack(t,i,Math.round(32*a),Math.round(32*h),g,y,(L<<1)+(b?1:0),O,16*k,16*I,256*P,256*z)}function $f(n,t,i){n.emplaceBack(t.x,t.y,i),n.emplaceBack(t.x,t.y,i),n.emplaceBack(t.x,t.y,i),n.emplaceBack(t.x,t.y,i)}function Hb(n){for(const t of n.sections)if(yf(t.text))return!0;return!1}class qf{constructor(t){this.layoutVertexArray=new wl,this.indexArray=new Si,this.programConfigurations=t,this.segments=new Rt,this.dynamicLayoutVertexArray=new nc,this.opacityVertexArray=new si,this.hasVisibleVertices=!1,this.placedSymbolArray=new cr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,i,a,h){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,bb.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Sb.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Zb,!0),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Je("SymbolBuffers",qf);class Zf{constructor(t,i,a){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new a,this.segments=new Rt,this.collisionVertexArray=new ps}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Tb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Je("CollisionBuffers",Zf);class Rl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(y=>y.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Tf([]),this.placementViewportMatrix=Tf([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=R_(this.zoom,i["text-size"]),this.iconSizeData=R_(this.zoom,i["icon-size"]);const a=this.layers[0].layout,h=a.get("symbol-sort-key"),g=a.get("symbol-z-order");this.canOverlap=Uf(a,"text-overlap","text-allow-overlap")!=="never"||Uf(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(y=>v.ah[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=t.sourceID}createArrays(){this.text=new qf(new xa(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new qf(new xa(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new hr,this.lineVertexArray=new sn,this.symbolInstances=new Mt,this.textAnchorOffsets=new dr}calculateGlyphDependencies(t,i,a,h,g){for(let y=0;y<t.length;y++)if(i[t.charCodeAt(y)]=!0,(a||h)&&g){const x=pc[t.charAt(y)];x&&(i[x.charCodeAt(0)]=!0)}}populate(t,i,a){const h=this.layers[0],g=h.layout,y=g.get("text-font"),x=g.get("text-field"),b=g.get("icon-image"),k=(x.value.kind!=="constant"||x.value.value instanceof Nn&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),I=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,P=g.get("symbol-sort-key");if(this.features=[],!k&&!I)return;const z=i.iconDependencies,L=i.glyphDependencies,O=i.availableImages,j=new ur(this.zoom);for(const{feature:X,id:J,index:me,sourceLayerIndex:se}of t){const fe=h._featureFilter.needGeometry,we=wa(X,fe);if(!h._featureFilter.filter(j,we,a))continue;let Ae,He;if(fe||(we.geometry=va(X)),k){const $e=h.getValueAndResolveTokens("text-field",we,a,O),je=Nn.factory($e),nt=this.hasRTLText=this.hasRTLText||Hb(je);(!nt||$n.getRTLTextPluginStatus()==="unavailable"||nt&&$n.isParsed())&&(Ae=kb(je,h,we))}if(I){const $e=h.getValueAndResolveTokens("icon-image",we,a,O);He=$e instanceof Vn?$e:Vn.fromString($e)}if(!Ae&&!He)continue;const ct=this.sortFeaturesByKey?P.evaluate(we,{},a):void 0;if(this.features.push({id:J,text:Ae,icon:He,index:me,sourceLayerIndex:se,geometry:we.geometry,properties:X.properties,type:qb[X.type],sortKey:ct}),He&&(z[He.name]=!0),Ae){const $e=y.evaluate(we,{},a).join(","),je=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(v.ah.vertical)>=0;for(const nt of Ae.sections)if(nt.image)z[nt.image.name]=!0;else{const Ye=Yu(Ae.toString()),Ke=nt.fontStack||$e,Se=L[Ke]=L[Ke]||{};this.calculateGlyphDependencies(nt.text,Se,je,this.allowVerticalPlacement,Ye)}}}g.get("symbol-placement")==="line"&&(this.features=function(X){const J={},me={},se=[];let fe=0;function we($e){se.push(X[$e]),fe++}function Ae($e,je,nt){const Ye=me[$e];return delete me[$e],me[je]=Ye,se[Ye].geometry[0].pop(),se[Ye].geometry[0]=se[Ye].geometry[0].concat(nt[0]),Ye}function He($e,je,nt){const Ye=J[je];return delete J[je],J[$e]=Ye,se[Ye].geometry[0].shift(),se[Ye].geometry[0]=nt[0].concat(se[Ye].geometry[0]),Ye}function ct($e,je,nt){const Ye=nt?je[0][je[0].length-1]:je[0][0];return`${$e}:${Ye.x}:${Ye.y}`}for(let $e=0;$e<X.length;$e++){const je=X[$e],nt=je.geometry,Ye=je.text?je.text.toString():null;if(!Ye){we($e);continue}const Ke=ct(Ye,nt),Se=ct(Ye,nt,!0);if(Ke in me&&Se in J&&me[Ke]!==J[Se]){const ot=He(Ke,Se,nt),rt=Ae(Ke,Se,se[ot].geometry);delete J[Ke],delete me[Se],me[ct(Ye,se[rt].geometry,!0)]=rt,se[ot].geometry=null}else Ke in me?Ae(Ke,Se,nt):Se in J?He(Ke,Se,nt):(we($e),J[Ke]=fe-1,me[Se]=fe-1)}return se.filter($e=>$e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,J)=>X.sortKey-J.sortKey)}update(t,i,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const a=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(i[t.segment+1]),g=t.dist(i[t.segment]);const y={};for(let x=t.segment+1;x<i.length;x++)y[x]={x:i[x].x,y:i[x].y,tileUnitDistanceFromAnchor:h},x<i.length-1&&(h+=i[x+1].dist(i[x]));for(let x=t.segment||0;x>=0;x--)y[x]={x:i[x].x,y:i[x].y,tileUnitDistanceFromAnchor:g},x>0&&(g+=i[x-1].dist(i[x]));for(let x=0;x<i.length;x++){const b=y[x];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,i,a,h,g,y,x,b,k,I,P,z){const L=t.indexArray,O=t.layoutVertexArray,j=t.segments.prepareSegment(4*i.length,O,L,this.canOverlap?y.sortKey:void 0),X=this.glyphOffsetArray.length,J=j.vertexLength,me=this.allowVerticalPlacement&&x===v.ah.vertical?Math.PI/2:0,se=y.text&&y.text.sections;for(let fe=0;fe<i.length;fe++){const{tl:we,tr:Ae,bl:He,br:ct,tex:$e,pixelOffsetTL:je,pixelOffsetBR:nt,minFontScaleX:Ye,minFontScaleY:Ke,glyphOffset:Se,isSDF:ot,sectionIndex:rt}=i[fe],vt=j.vertexLength,rr=Se[1];dd(O,b.x,b.y,we.x,rr+we.y,$e.x,$e.y,a,ot,je.x,je.y,Ye,Ke),dd(O,b.x,b.y,Ae.x,rr+Ae.y,$e.x+$e.w,$e.y,a,ot,nt.x,je.y,Ye,Ke),dd(O,b.x,b.y,He.x,rr+He.y,$e.x,$e.y+$e.h,a,ot,je.x,nt.y,Ye,Ke),dd(O,b.x,b.y,ct.x,rr+ct.y,$e.x+$e.w,$e.y+$e.h,a,ot,nt.x,nt.y,Ye,Ke),$f(t.dynamicLayoutVertexArray,b,me),L.emplaceBack(vt,vt+1,vt+2),L.emplaceBack(vt+1,vt+2,vt+3),j.vertexLength+=4,j.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Se[0]),fe!==i.length-1&&rt===i[fe+1].sectionIndex||t.programConfigurations.populatePaintArrays(O.length,y,y.index,{},z,se&&se[rt])}t.placedSymbolArray.emplaceBack(b.x,b.y,X,this.glyphOffsetArray.length-X,J,k,I,b.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],x,0,!1,0,P)}_addCollisionDebugVertex(t,i,a,h,g,y){return i.emplaceBack(0,0),t.emplaceBack(a.x,a.y,h,g,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(t,i,a,h,g,y,x){const b=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),k=b.vertexLength,I=g.layoutVertexArray,P=g.collisionVertexArray,z=x.anchorX,L=x.anchorY;this._addCollisionDebugVertex(I,P,y,z,L,new q(t,i)),this._addCollisionDebugVertex(I,P,y,z,L,new q(a,i)),this._addCollisionDebugVertex(I,P,y,z,L,new q(a,h)),this._addCollisionDebugVertex(I,P,y,z,L,new q(t,h)),b.vertexLength+=4;const O=g.indexArray;O.emplaceBack(k,k+1),O.emplaceBack(k+1,k+2),O.emplaceBack(k+2,k+3),O.emplaceBack(k+3,k),b.primitiveLength+=4}addDebugCollisionBoxes(t,i,a,h){for(let g=t;g<i;g++){const y=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,h?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Zf(oi,g_.members,Qr),this.iconCollisionBox=new Zf(oi,g_.members,Qr);for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(t,i,a,h,g,y,x,b,k){const I={};for(let P=i;P<a;P++){const z=t.get(P);I.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},I.textFeatureIndex=z.featureIndex;break}for(let P=h;P<g;P++){const z=t.get(P);I.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},I.verticalTextFeatureIndex=z.featureIndex;break}for(let P=y;P<x;P++){const z=t.get(P);I.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},I.iconFeatureIndex=z.featureIndex;break}for(let P=b;P<k;P++){const z=t.get(P);I.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},I.verticalIconFeatureIndex=z.featureIndex;break}return I}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){const a=t.placedSymbolArray.get(i),h=a.vertexStartIndex+4*a.numGlyphs;for(let g=a.vertexStartIndex;g<h;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(t),a=Math.cos(t),h=[],g=[],y=[];for(let x=0;x<this.symbolInstances.length;++x){y.push(x);const b=this.symbolInstances.get(x);h.push(0|Math.round(i*b.anchorX+a*b.anchorY)),g.push(b.featureIndex)}return y.sort((x,b)=>h[x]-h[b]||g[b]-g[x]),y}addToSortKeyRanges(t,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((h,g,y)=>{h>=0&&y.indexOf(h)===g&&this.addIndicesForPlacedSymbol(this.text,h)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let D_,L_;Je("SymbolBucket",Rl,{omit:["layers","collisionBoxArray","features","compareText"]}),Rl.MAX_GLYPHS=65535,Rl.addDynamicAttributes=$f;var Hf={get paint(){return L_=L_||new m({"icon-opacity":new dt(xe.paint_symbol["icon-opacity"]),"icon-color":new dt(xe.paint_symbol["icon-color"]),"icon-halo-color":new dt(xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new dt(xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new dt(xe.paint_symbol["icon-halo-blur"]),"icon-translate":new et(xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new et(xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new dt(xe.paint_symbol["text-opacity"]),"text-color":new dt(xe.paint_symbol["text-color"],{runtimeType:_r,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new dt(xe.paint_symbol["text-halo-color"]),"text-halo-width":new dt(xe.paint_symbol["text-halo-width"]),"text-halo-blur":new dt(xe.paint_symbol["text-halo-blur"]),"text-translate":new et(xe.paint_symbol["text-translate"]),"text-translate-anchor":new et(xe.paint_symbol["text-translate-anchor"])})},get layout(){return D_=D_||new m({"symbol-placement":new et(xe.layout_symbol["symbol-placement"]),"symbol-spacing":new et(xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new et(xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new dt(xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new et(xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new et(xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new et(xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new et(xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new et(xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new et(xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new dt(xe.layout_symbol["icon-size"]),"icon-text-fit":new et(xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new et(xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new dt(xe.layout_symbol["icon-image"]),"icon-rotate":new dt(xe.layout_symbol["icon-rotate"]),"icon-padding":new dt(xe.layout_symbol["icon-padding"]),"icon-keep-upright":new et(xe.layout_symbol["icon-keep-upright"]),"icon-offset":new dt(xe.layout_symbol["icon-offset"]),"icon-anchor":new dt(xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new et(xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new et(xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new et(xe.layout_symbol["text-rotation-alignment"]),"text-field":new dt(xe.layout_symbol["text-field"]),"text-font":new dt(xe.layout_symbol["text-font"]),"text-size":new dt(xe.layout_symbol["text-size"]),"text-max-width":new dt(xe.layout_symbol["text-max-width"]),"text-line-height":new et(xe.layout_symbol["text-line-height"]),"text-letter-spacing":new dt(xe.layout_symbol["text-letter-spacing"]),"text-justify":new dt(xe.layout_symbol["text-justify"]),"text-radial-offset":new dt(xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new et(xe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new dt(xe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new dt(xe.layout_symbol["text-anchor"]),"text-max-angle":new et(xe.layout_symbol["text-max-angle"]),"text-writing-mode":new et(xe.layout_symbol["text-writing-mode"]),"text-rotate":new dt(xe.layout_symbol["text-rotate"]),"text-padding":new et(xe.layout_symbol["text-padding"]),"text-keep-upright":new et(xe.layout_symbol["text-keep-upright"]),"text-transform":new dt(xe.layout_symbol["text-transform"]),"text-offset":new dt(xe.layout_symbol["text-offset"]),"text-allow-overlap":new et(xe.layout_symbol["text-allow-overlap"]),"text-overlap":new et(xe.layout_symbol["text-overlap"]),"text-ignore-placement":new et(xe.layout_symbol["text-ignore-placement"]),"text-optional":new et(xe.layout_symbol["text-optional"])})}};class F_{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Nr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Je("FormatSectionOverride",F_,{omit:["defaultValue"]});class pd extends o{constructor(t){super(t,Hf)}recalculate(t,i){if(super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const h=[];for(const g of a)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,i,a,h){const g=this.layout.get(t).evaluate(i,{},a,h),y=this._unevaluatedLayout._values[t];return y.isDataDriven()||ol(y.value)||!g?g:function(x,b){return b.replace(/{([^{}]+)}/g,(k,I)=>x&&I in x?String(x[I]):"")}(i.properties,g)}createBucket(t){return new Rl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Hf.paint.overridableProperties){if(!pd.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),a=new F_(i),h=new sl(a,i.property.specification);let g=null;g=i.value.kind==="constant"||i.value.kind==="source"?new co("source",h):new ho("composite",h,i.value.zoomStops),this.paint._values[t]=new Oi(i.property,g,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&pd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const a=t.get("text-field"),h=Hf.paint.properties[i];let g=!1;const y=x=>{for(const b of x)if(h.overrides&&h.overrides.hasOverride(b))return void(g=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Nn)y(a.value.value.sections);else if(a.value.kind==="source"){const x=k=>{g||(k instanceof yi&&Vr(k.value)===Tn?y(k.value.sections):k instanceof Ka?y(k.sections):k.eachChild(x))},b=a.value;b._styleExpression&&x(b._styleExpression.expression)}return g}}let O_;var Gb={get paint(){return O_=O_||new m({"background-color":new et(xe.paint_background["background-color"]),"background-pattern":new xl(xe.paint_background["background-pattern"]),"background-opacity":new et(xe.paint_background["background-opacity"])})}};class Wb extends o{constructor(t){super(t,Gb)}}let B_;var Xb={get paint(){return B_=B_||new m({"raster-opacity":new et(xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new et(xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new et(xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new et(xe.paint_raster["raster-brightness-max"]),"raster-saturation":new et(xe.paint_raster["raster-saturation"]),"raster-contrast":new et(xe.paint_raster["raster-contrast"]),"raster-resampling":new et(xe.paint_raster["raster-resampling"]),"raster-fade-duration":new et(xe.paint_raster["raster-fade-duration"])})}};class Kb extends o{constructor(t){super(t,Xb)}}class Jb extends o{constructor(t){super(t,{}),this.onAdd=i=>{this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)},this.onRemove=i=>{this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Yb{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Gf=63710088e-1;class Po{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Po(Ue(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,a=this.lat*i,h=t.lat*i,g=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((t.lng-this.lng)*i);return Gf*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof Po)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Po(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Po(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const N_=2*Math.PI*Gf;function j_(n){return N_*Math.cos(n*Math.PI/180)}function V_(n){return(180+n)/360}function U_(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function $_(n,t){return n/j_(t)}function Wf(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}class yc{constructor(t,i,a=0){this.x=+t,this.y=+i,this.z=+a}static fromLngLat(t,i=0){const a=Po.convert(t);return new yc(V_(a.lng),U_(a.lat),$_(i,a.lat))}toLngLat(){return new Po(360*this.x-180,Wf(this.y))}toAltitude(){return this.z*j_(Wf(this.y))}meterInMercatorCoordinateUnits(){return 1/N_*(t=Wf(this.y),1/Math.cos(t*Math.PI/180));var t}}function q_(n,t,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[n*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class Xf{constructor(t,i,a){if(!function(h,g,y){return!(h<0||h>25||y<0||y>=Math.pow(2,h)||g<0||g>=Math.pow(2,h))}(t,i,a))throw new Error(`x=${i}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=i,this.y=a,this.key=_c(0,t,t,i,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i,a){const h=(y=this.y,x=this.z,b=q_(256*(g=this.x),256*(y=Math.pow(2,x)-y-1),x),k=q_(256*(g+1),256*(y+1),x),b[0]+","+b[1]+","+k[0]+","+k[1]);var g,y,x,b,k;const I=function(P,z,L){let O,j="";for(let X=P;X>0;X--)O=1<<X-1,j+=(z&O?1:0)+(L&O?2:0);return j}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){const i=this.z-t.z;return i>0&&t.x===this.x>>i&&t.y===this.y>>i}getTilePoint(t){const i=Math.pow(2,this.z);return new q((t.x*i-this.x)*Ur,(t.y*i-this.y)*Ur)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Z_{constructor(t,i){this.wrap=t,this.canonical=i,this.key=_c(t,i.z,i.z,i.x,i.y)}}class Ei{constructor(t,i,a,h,g){if(t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=i,this.canonical=new Xf(a,+h,+g),this.key=_c(i,t,a,h,g)}clone(){return new Ei(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-t;return t>this.canonical.z?new Ei(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ei(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?_c(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y):_c(this.wrap*+i,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new Ei(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new Ei(i,this.wrap,i,a,h),new Ei(i,this.wrap,i,a+1,h),new Ei(i,this.wrap,i,a,h+1),new Ei(i,this.wrap,i,a+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ei(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ei(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Z_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new yc(t.x-this.wrap,t.y))}}function _c(n,t,i,a,h){(n*=2)<0&&(n=-1*n-1);const g=1<<i;return(g*g*n+g*h+a).toString(36)+i.toString(36)+t.toString(36)}Je("CanonicalTileID",Xf),Je("OverscaledTileID",Ei,{omit:["posMatrix"]});class H_{constructor(t,i,a,h=1,g=1,y=1,x=0){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void Dt(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const b=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=g,this.blueFactor=y,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<b;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(b,k)]=this.data[this._idx(b-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,b)]=this.data[this._idx(k,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<b;k++)for(let I=0;I<b;I++){const P=this.get(k,I);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(t,i){const a=new Uint8Array(this.data.buffer),h=4*this._idx(t,i);return this.unpack(a[h],a[h+1],a[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}unpack(t,i,a){return t*this.redFactor+i*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new Ti({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,i,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,g=i*this.dim+this.dim,y=a*this.dim,x=a*this.dim+this.dim;switch(i){case-1:h=g-1;break;case 1:g=h+1}switch(a){case-1:y=x-1;break;case 1:x=y+1}const b=-i*this.dim,k=-a*this.dim;for(let I=y;I<x;I++)for(let P=h;P<g;P++)this.data[this._idx(P,I)]=t.data[this._idx(P+b,I+k)]}}Je("DEMData",H_);class G_{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const a=t[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class W_{constructor(t,i,a,h,g){this.type="Feature",this._vectorTileFeature=t,t._z=i,t._x=a,t._y=h,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(t[i]=this[i]);return t}}class X_{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new mo(Ur,16,0),this.grid3D=new mo(Ur,16,0),this.featureIndexArray=new gn,this.promoteId=i}insert(t,i,a,h,g,y){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,g);const b=y?this.grid3D:this.grid;for(let k=0;k<i.length;k++){const I=i[k],P=[1/0,1/0,-1/0,-1/0];for(let z=0;z<I.length;z++){const L=I[z];P[0]=Math.min(P[0],L.x),P[1]=Math.min(P[1],L.y),P[2]=Math.max(P[2],L.x),P[3]=Math.max(P[3],L.y)}P[0]<Ur&&P[1]<Ur&&P[2]>=0&&P[3]>=0&&b.insert(x,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ko.VectorTile(new Of(this.rawTileData)).layers,this.sourceLayerCoder=new G_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,i,a,h){this.loadVTLayers();const g=t.params||{},y=Ur/t.tileSize/t.scale,x=Ou(g.filter),b=t.queryGeometry,k=t.queryPadding*y,I=J_(b),P=this.grid.query(I.minX-k,I.minY-k,I.maxX+k,I.maxY+k),z=J_(t.cameraQueryGeometry),L=this.grid3D.query(z.minX-k,z.minY-k,z.maxX+k,z.maxY+k,(X,J,me,se)=>function(fe,we,Ae,He,ct){for(const je of fe)if(we<=je.x&&Ae<=je.y&&He>=je.x&&ct>=je.y)return!0;const $e=[new q(we,Ae),new q(we,ct),new q(He,ct),new q(He,Ae)];if(fe.length>2){for(const je of $e)if(kl(fe,je))return!0}for(let je=0;je<fe.length-1;je++)if(zw(fe[je],fe[je+1],$e))return!0;return!1}(t.cameraQueryGeometry,X-k,J-k,me+k,se+k));for(const X of L)P.push(X);P.sort(Qb);const O={};let j;for(let X=0;X<P.length;X++){const J=P[X];if(J===j)continue;j=J;const me=this.featureIndexArray.get(J);let se=null;this.loadMatchingFeature(O,me.bucketIndex,me.sourceLayerIndex,me.featureIndex,x,g.layers,g.availableImages,i,a,h,(fe,we,Ae)=>(se||(se=va(fe)),we.queryIntersectsFeature(b,fe,Ae,se,this.z,t.transform,y,t.pixelPosMatrix)))}return O}loadMatchingFeature(t,i,a,h,g,y,x,b,k,I,P){const z=this.bucketLayerIDs[i];if(y&&!function(X,J){for(let me=0;me<X.length;me++)if(J.indexOf(X[me])>=0)return!0;return!1}(y,z))return;const L=this.sourceLayerCoder.decode(a),O=this.vtLayers[L].feature(h);if(g.needGeometry){const X=wa(O,!0);if(!g.filter(new ur(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!g.filter(new ur(this.tileID.overscaledZ),O))return;const j=this.getId(O,L);for(let X=0;X<z.length;X++){const J=z[X];if(y&&y.indexOf(J)<0)continue;const me=b[J];if(!me)continue;let se={};j&&I&&(se=I.getState(me.sourceLayer||"_geojsonTileLayer",j));const fe=Oe({},k[J]);fe.paint=K_(fe.paint,me.paint,O,se,x),fe.layout=K_(fe.layout,me.layout,O,se,x);const we=!P||P(O,me,se);if(!we)continue;const Ae=new W_(O,this.z,this.x,this.y,j);Ae.layer=fe;let He=t[J];He===void 0&&(He=t[J]=[]),He.push({featureIndex:h,feature:Ae,intersectionZ:we})}}lookupSymbolFeatures(t,i,a,h,g,y,x,b){const k={};this.loadVTLayers();const I=Ou(g);for(const P of t)this.loadMatchingFeature(k,a,h,P,I,y,x,b,i);return k}hasLayer(t){for(const i of this.bucketLayerIDs)for(const a of i)if(t===a)return!0;return!1}getId(t,i){let a=t.id;return this.promoteId&&(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof a=="boolean"&&(a=Number(a))),a}}function K_(n,t,i,a,h){return _t(n,(g,y)=>{const x=t instanceof ga?t.get(y):null;return x&&x.evaluate?x.evaluate(i,a,h):x})}function J_(n){let t=1/0,i=1/0,a=-1/0,h=-1/0;for(const g of n)t=Math.min(t,g.x),i=Math.min(i,g.y),a=Math.max(a,g.x),h=Math.max(h,g.y);return{minX:t,minY:i,maxX:a,maxY:h}}function Qb(n,t){return t-n}function Y_(n,t,i,a,h){const g=[];for(let y=0;y<n.length;y++){const x=n[y];let b;for(let k=0;k<x.length-1;k++){let I=x[k],P=x[k+1];I.x<t&&P.x<t||(I.x<t?I=new q(t,I.y+(t-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x<t&&(P=new q(t,I.y+(t-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y<i&&P.y<i||(I.y<i?I=new q(I.x+(i-I.y)/(P.y-I.y)*(P.x-I.x),i)._round():P.y<i&&(P=new q(I.x+(i-I.y)/(P.y-I.y)*(P.x-I.x),i)._round()),I.x>=a&&P.x>=a||(I.x>=a?I=new q(a,I.y+(a-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x>=a&&(P=new q(a,I.y+(a-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y>=h&&P.y>=h||(I.y>=h?I=new q(I.x+(h-I.y)/(P.y-I.y)*(P.x-I.x),h)._round():P.y>=h&&(P=new q(I.x+(h-I.y)/(P.y-I.y)*(P.x-I.x),h)._round()),b&&I.equals(b[b.length-1])||(b=[I],g.push(b)),b.push(P)))))}}return g}Je("FeatureIndex",X_,{omit:["rawTileData","sourceLayerCoder"]});class Ao extends q{constructor(t,i,a,h){super(t,i),this.angle=a,h!==void 0&&(this.segment=h)}clone(){return new Ao(this.x,this.y,this.angle,this.segment)}}function Q_(n,t,i,a,h){if(t.segment===void 0||i===0)return!0;let g=t,y=t.segment+1,x=0;for(;x>-i/2;){if(y--,y<0)return!1;x-=n[y].dist(g),g=n[y]}x+=n[y].dist(n[y+1]),y++;const b=[];let k=0;for(;x<i/2;){const I=n[y],P=n[y+1];if(!P)return!1;let z=n[y-1].angleTo(I)-I.angleTo(P);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:x,angleDelta:z}),k+=z;x-b[0].distance>a;)k-=b.shift().angleDelta;if(k>h)return!1;y++,x+=I.dist(P)}return!0}function ex(n){let t=0;for(let i=0;i<n.length-1;i++)t+=n[i].dist(n[i+1]);return t}function tx(n,t,i){return n?.6*t*i:0}function rx(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function e2(n,t,i,a,h,g){const y=tx(i,h,g),x=rx(i,a)*g;let b=0;const k=ex(n)/2;for(let I=0;I<n.length-1;I++){const P=n[I],z=n[I+1],L=P.dist(z);if(b+L>k){const O=(k-b)/L,j=En.number(P.x,z.x,O),X=En.number(P.y,z.y,O),J=new Ao(j,X,z.angleTo(P),I);return J._round(),!y||Q_(n,J,x,y,t)?J:void 0}b+=L}}function t2(n,t,i,a,h,g,y,x,b){const k=tx(a,g,y),I=rx(a,h),P=I*y,z=n[0].x===0||n[0].x===b||n[0].y===0||n[0].y===b;return t-P<t/4&&(t=P+t/4),nx(n,z?t/2*x%t:(I/2+2*g)*y*x%t,t,k,i,P,z,!1,b)}function nx(n,t,i,a,h,g,y,x,b){const k=g/2,I=ex(n);let P=0,z=t-i,L=[];for(let O=0;O<n.length-1;O++){const j=n[O],X=n[O+1],J=j.dist(X),me=X.angleTo(j);for(;z+i<P+J;){z+=i;const se=(z-P)/J,fe=En.number(j.x,X.x,se),we=En.number(j.y,X.y,se);if(fe>=0&&fe<b&&we>=0&&we<b&&z-k>=0&&z+k<=I){const Ae=new Ao(fe,we,me,O);Ae._round(),a&&!Q_(n,Ae,g,a,h)||L.push(Ae)}}P+=J}return x||L.length||y||(L=nx(n,P/2,i,a,h,g,y,!0,b)),L}Je("Anchor",Ao);const Dl=Zn;function ix(n,t,i,a){const h=[],g=n.image,y=g.pixelRatio,x=g.paddedRect.w-2*Dl,b=g.paddedRect.h-2*Dl;let k={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const I=g.stretchX||[[0,x]],P=g.stretchY||[[0,b]],z=(Se,ot)=>Se+ot[1]-ot[0],L=I.reduce(z,0),O=P.reduce(z,0),j=x-L,X=b-O;let J=0,me=L,se=0,fe=O,we=0,Ae=j,He=0,ct=X;if(g.content&&a){const Se=g.content,ot=Se[2]-Se[0],rt=Se[3]-Se[1];(g.textFitWidth||g.textFitHeight)&&(k=M_(n)),J=fd(I,0,Se[0]),se=fd(P,0,Se[1]),me=fd(I,Se[0],Se[2]),fe=fd(P,Se[1],Se[3]),we=Se[0]-J,He=Se[1]-se,Ae=ot-me,ct=rt-fe}const $e=k.x1,je=k.y1,nt=k.x2-$e,Ye=k.y2-je,Ke=(Se,ot,rt,vt)=>{const rr=md(Se.stretch-J,me,nt,$e),tr=gd(Se.fixed-we,Ae,Se.stretch,L),Wr=md(ot.stretch-se,fe,Ye,je),Ni=gd(ot.fixed-He,ct,ot.stretch,O),un=md(rt.stretch-J,me,nt,$e),Xr=gd(rt.fixed-we,Ae,rt.stretch,L),Pn=md(vt.stretch-se,fe,Ye,je),An=gd(vt.fixed-He,ct,vt.stretch,O),Mn=new q(rr,Wr),kr=new q(un,Wr),Kr=new q(un,Pn),_n=new q(rr,Pn),cn=new q(tr/y,Ni/y),zn=new q(Xr/y,An/y),hn=t*Math.PI/180;if(hn){const $t=Math.sin(hn),sr=Math.cos(hn),pr=[sr,-$t,$t,sr];Mn._matMult(pr),kr._matMult(pr),_n._matMult(pr),Kr._matMult(pr)}const ki=Se.stretch+Se.fixed,Hn=ot.stretch+ot.fixed;return{tl:Mn,tr:kr,bl:_n,br:Kr,tex:{x:g.paddedRect.x+Dl+ki,y:g.paddedRect.y+Dl+Hn,w:rt.stretch+rt.fixed-ki,h:vt.stretch+vt.fixed-Hn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:cn,pixelOffsetBR:zn,minFontScaleX:Ae/y/nt,minFontScaleY:ct/y/Ye,isSDF:i}};if(a&&(g.stretchX||g.stretchY)){const Se=sx(I,j,L),ot=sx(P,X,O);for(let rt=0;rt<Se.length-1;rt++){const vt=Se[rt],rr=Se[rt+1];for(let tr=0;tr<ot.length-1;tr++)h.push(Ke(vt,ot[tr],rr,ot[tr+1]))}}else h.push(Ke({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:b+1}));return h}function fd(n,t,i){let a=0;for(const h of n)a+=Math.max(t,Math.min(i,h[1]))-Math.max(t,Math.min(i,h[0]));return a}function sx(n,t,i){const a=[{fixed:-Dl,stretch:0}];for(const[h,g]of n){const y=a[a.length-1];a.push({fixed:h-y.stretch,stretch:y.stretch}),a.push({fixed:h-y.stretch,stretch:y.stretch+(g-h)})}return a.push({fixed:t+Dl,stretch:i}),a}function md(n,t,i,a){return n/t*i+a}function gd(n,t,i,a){return n-t*i/a}class yd{constructor(t,i,a,h,g,y,x,b,k,I){var P;if(this.boxStartIndex=t.length,k){let z=y.top,L=y.bottom;const O=y.collisionPadding;O&&(z-=O[1],L+=O[3]);let j=L-z;j>0&&(j=Math.max(10,j),this.circleDiameter=j)}else{const z=!((P=y.image)===null||P===void 0)&&P.content&&(y.image.textFitWidth||y.image.textFitHeight)?M_(y):{x1:y.left,y1:y.top,x2:y.right,y2:y.bottom};z.y1=z.y1*x-b[0],z.y2=z.y2*x+b[2],z.x1=z.x1*x-b[3],z.x2=z.x2*x+b[1];const L=y.collisionPadding;if(L&&(z.x1-=L[0]*x,z.y1-=L[1]*x,z.x2+=L[2]*x,z.y2+=L[3]*x),I){const O=new q(z.x1,z.y1),j=new q(z.x2,z.y1),X=new q(z.x1,z.y2),J=new q(z.x2,z.y2),me=I*Math.PI/180;O._rotate(me),j._rotate(me),X._rotate(me),J._rotate(me),z.x1=Math.min(O.x,j.x,X.x,J.x),z.x2=Math.max(O.x,j.x,X.x,J.x),z.y1=Math.min(O.y,j.y,X.y,J.y),z.y2=Math.max(O.y,j.y,X.y,J.y)}t.emplaceBack(i.x,i.y,z.x1,z.y1,z.x2,z.y2,a,h,g)}this.boxEndIndex=t.length}}class r2{constructor(t=[],i=(a,h)=>a<h?-1:a>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:a}=this,h=i[t];for(;t>0;){const g=t-1>>1,y=i[g];if(a(h,y)>=0)break;i[t]=y,t=g}i[t]=h}_down(t){const{data:i,compare:a}=this,h=this.length>>1,g=i[t];for(;t<h;){let y=1+(t<<1);const x=y+1;if(x<this.length&&a(i[x],i[y])<0&&(y=x),a(i[y],g)>=0)break;i[t]=i[y],t=y}i[t]=g}}function n2(n,t=1,i=!1){let a=1/0,h=1/0,g=-1/0,y=-1/0;const x=n[0];for(let L=0;L<x.length;L++){const O=x[L];(!L||O.x<a)&&(a=O.x),(!L||O.y<h)&&(h=O.y),(!L||O.x>g)&&(g=O.x),(!L||O.y>y)&&(y=O.y)}const b=Math.min(g-a,y-h);let k=b/2;const I=new r2([],i2);if(b===0)return new q(a,h);for(let L=a;L<g;L+=b)for(let O=h;O<y;O+=b)I.push(new Ll(L+k,O+k,k,n));let P=function(L){let O=0,j=0,X=0;const J=L[0];for(let me=0,se=J.length,fe=se-1;me<se;fe=me++){const we=J[me],Ae=J[fe],He=we.x*Ae.y-Ae.x*we.y;j+=(we.x+Ae.x)*He,X+=(we.y+Ae.y)*He,O+=3*He}return new Ll(j/O,X/O,0,L)}(n),z=I.length;for(;I.length;){const L=I.pop();(L.d>P.d||!P.d)&&(P=L,i&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,z)),L.max-P.d<=t||(k=L.h/2,I.push(new Ll(L.p.x-k,L.p.y-k,k,n)),I.push(new Ll(L.p.x+k,L.p.y-k,k,n)),I.push(new Ll(L.p.x-k,L.p.y+k,k,n)),I.push(new Ll(L.p.x+k,L.p.y+k,k,n)),z+=4)}return i&&(console.log(`num probes: ${z}`),console.log(`best distance: ${P.d}`)),P.p}function i2(n,t){return t.max-n.max}function Ll(n,t,i,a){this.p=new q(n,t),this.h=i,this.d=function(h,g){let y=!1,x=1/0;for(let b=0;b<g.length;b++){const k=g[b];for(let I=0,P=k.length,z=P-1;I<P;z=I++){const L=k[I],O=k[z];L.y>h.y!=O.y>h.y&&h.x<(O.x-L.x)*(h.y-L.y)/(O.y-L.y)+L.x&&(y=!y),x=Math.min(x,Uy(h,L,O))}}return(y?1:-1)*Math.sqrt(x)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var ln;v.aq=void 0,(ln=v.aq||(v.aq={}))[ln.center=1]="center",ln[ln.left=2]="left",ln[ln.right=3]="right",ln[ln.top=4]="top",ln[ln.bottom=5]="bottom",ln[ln["top-left"]=6]="top-left",ln[ln["top-right"]=7]="top-right",ln[ln["bottom-left"]=8]="bottom-left",ln[ln["bottom-right"]=9]="bottom-right";const Mo=7,Kf=Number.POSITIVE_INFINITY;function ox(n,t){return t[1]!==Kf?function(i,a,h){let g=0,y=0;switch(a=Math.abs(a),h=Math.abs(h),i){case"top-right":case"top-left":case"top":y=h-Mo;break;case"bottom-right":case"bottom-left":case"bottom":y=-h+Mo}switch(i){case"top-right":case"bottom-right":case"right":g=-a;break;case"top-left":case"bottom-left":case"left":g=a}return[g,y]}(n,t[0],t[1]):function(i,a){let h=0,g=0;a<0&&(a=0);const y=a/Math.SQRT2;switch(i){case"top-right":case"top-left":g=y-Mo;break;case"bottom-right":case"bottom-left":g=-y+Mo;break;case"bottom":g=-a+Mo;break;case"top":g=a-Mo}switch(i){case"top-right":case"bottom-right":h=-y;break;case"top-left":case"bottom-left":h=y;break;case"left":h=a;break;case"right":h=-a}return[h,g]}(n,t[0])}function ax(n,t,i){var a;const h=n.layout,g=(a=h.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},i);if(g){const x=g.values,b=[];for(let k=0;k<x.length;k+=2){const I=b[k]=x[k],P=x[k+1].map(z=>z*qr);I.startsWith("top")?P[1]-=Mo:I.startsWith("bottom")&&(P[1]+=Mo),b[k+1]=P}return new ei(b)}const y=h.get("text-variable-anchor");if(y){let x;x=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},i)*qr,Kf]:h.get("text-offset").evaluate(t,{},i).map(k=>k*qr);const b=[];for(const k of y)b.push(k,ox(k,x));return new ei(b)}return null}function Jf(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function s2(n,t,i,a,h,g,y,x,b,k,I){let P=g.textMaxSize.evaluate(t,{});P===void 0&&(P=y);const z=n.layers[0].layout,L=z.get("icon-offset").evaluate(t,{},I),O=ux(i.horizontal),j=y/24,X=n.tilePixelRatio*j,J=n.tilePixelRatio*P/24,me=n.tilePixelRatio*x,se=n.tilePixelRatio*z.get("symbol-spacing"),fe=z.get("text-padding")*n.tilePixelRatio,we=function(Se,ot,rt,vt=1){const rr=Se.get("icon-padding").evaluate(ot,{},rt),tr=rr&&rr.values;return[tr[0]*vt,tr[1]*vt,tr[2]*vt,tr[3]*vt]}(z,t,I,n.tilePixelRatio),Ae=z.get("text-max-angle")/180*Math.PI,He=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",ct=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",$e=z.get("symbol-placement"),je=se/2,nt=z.get("icon-text-fit");let Ye;a&&nt!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(Ye=z_(a,i.vertical,nt,z.get("icon-text-fit-padding"),L,j)),O&&(a=z_(a,O,nt,z.get("icon-text-fit-padding"),L,j)));const Ke=(Se,ot)=>{ot.x<0||ot.x>=Ur||ot.y<0||ot.y>=Ur||function(rt,vt,rr,tr,Wr,Ni,un,Xr,Pn,An,Mn,kr,Kr,_n,cn,zn,hn,ki,Hn,$t,sr,pr,ai,wr,Fl){const gs=rt.addToLineVertexArray(vt,rr);let ys,ji,Ii,en,js=0,wc=0,px=0,fx=0,sm=-1,om=-1;const Vs={};let mx=bl("");if(rt.allowVerticalPlacement&&tr.vertical){const xn=Xr.layout.get("text-rotate").evaluate(sr,{},wr)+90;Ii=new yd(Pn,vt,An,Mn,kr,tr.vertical,Kr,_n,cn,xn),un&&(en=new yd(Pn,vt,An,Mn,kr,un,hn,ki,cn,xn))}if(Wr){const xn=Xr.layout.get("icon-rotate").evaluate(sr,{}),Ci=Xr.layout.get("icon-text-fit")!=="none",Sa=ix(Wr,xn,ai,Ci),es=un?ix(un,xn,ai,Ci):void 0;ji=new yd(Pn,vt,An,Mn,kr,Wr,hn,ki,!1,xn),js=4*Sa.length;const Ta=rt.iconSizeData;let _s=null;Ta.kind==="source"?(_s=[ms*Xr.layout.get("icon-size").evaluate(sr,{})],_s[0]>Co&&Dt(`${rt.layerIds[0]}: Value for "icon-size" is >= ${gc}. Reduce your "icon-size".`)):Ta.kind==="composite"&&(_s=[ms*pr.compositeIconSizes[0].evaluate(sr,{},wr),ms*pr.compositeIconSizes[1].evaluate(sr,{},wr)],(_s[0]>Co||_s[1]>Co)&&Dt(`${rt.layerIds[0]}: Value for "icon-size" is >= ${gc}. Reduce your "icon-size".`)),rt.addSymbols(rt.icon,Sa,_s,$t,Hn,sr,v.ah.none,vt,gs.lineStartIndex,gs.lineLength,-1,wr),sm=rt.icon.placedSymbolArray.length-1,es&&(wc=4*es.length,rt.addSymbols(rt.icon,es,_s,$t,Hn,sr,v.ah.vertical,vt,gs.lineStartIndex,gs.lineLength,-1,wr),om=rt.icon.placedSymbolArray.length-1)}const gx=Object.keys(tr.horizontal);for(const xn of gx){const Ci=tr.horizontal[xn];if(!ys){mx=bl(Ci.text);const es=Xr.layout.get("text-rotate").evaluate(sr,{},wr);ys=new yd(Pn,vt,An,Mn,kr,Ci,Kr,_n,cn,es)}const Sa=Ci.positionedLines.length===1;if(px+=lx(rt,vt,Ci,Ni,Xr,cn,sr,zn,gs,tr.vertical?v.ah.horizontal:v.ah.horizontalOnly,Sa?gx:[xn],Vs,sm,pr,wr),Sa)break}tr.vertical&&(fx+=lx(rt,vt,tr.vertical,Ni,Xr,cn,sr,zn,gs,v.ah.vertical,["vertical"],Vs,om,pr,wr));const l2=ys?ys.boxStartIndex:rt.collisionBoxArray.length,u2=ys?ys.boxEndIndex:rt.collisionBoxArray.length,c2=Ii?Ii.boxStartIndex:rt.collisionBoxArray.length,h2=Ii?Ii.boxEndIndex:rt.collisionBoxArray.length,d2=ji?ji.boxStartIndex:rt.collisionBoxArray.length,p2=ji?ji.boxEndIndex:rt.collisionBoxArray.length,f2=en?en.boxStartIndex:rt.collisionBoxArray.length,m2=en?en.boxEndIndex:rt.collisionBoxArray.length;let Qi=-1;const xd=(xn,Ci)=>xn&&xn.circleDiameter?Math.max(xn.circleDiameter,Ci):Ci;Qi=xd(ys,Qi),Qi=xd(Ii,Qi),Qi=xd(ji,Qi),Qi=xd(en,Qi);const yx=Qi>-1?1:0;yx&&(Qi*=Fl/qr),rt.glyphOffsetArray.length>=Rl.MAX_GLYPHS&&Dt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),sr.sortKey!==void 0&&rt.addToSortKeyRanges(rt.symbolInstances.length,sr.sortKey);const g2=ax(Xr,sr,wr),[y2,_2]=function(xn,Ci){const Sa=xn.length,es=Ci==null?void 0:Ci.values;if((es==null?void 0:es.length)>0)for(let Ta=0;Ta<es.length;Ta+=2){const _s=es[Ta+1];xn.emplaceBack(v.aq[es[Ta]],_s[0],_s[1])}return[Sa,xn.length]}(rt.textAnchorOffsets,g2);rt.symbolInstances.emplaceBack(vt.x,vt.y,Vs.right>=0?Vs.right:-1,Vs.center>=0?Vs.center:-1,Vs.left>=0?Vs.left:-1,Vs.vertical||-1,sm,om,mx,l2,u2,c2,h2,d2,p2,f2,m2,An,px,fx,js,wc,yx,0,Kr,Qi,y2,_2)}(n,ot,Se,i,a,h,Ye,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,X,[fe,fe,fe,fe],He,b,me,we,ct,L,t,g,k,I,y)};if($e==="line")for(const Se of Y_(t.geometry,0,0,Ur,Ur)){const ot=t2(Se,se,Ae,i.vertical||O,a,24,J,n.overscaling,Ur);for(const rt of ot)O&&o2(n,O.text,je,rt)||Ke(Se,rt)}else if($e==="line-center"){for(const Se of t.geometry)if(Se.length>1){const ot=e2(Se,Ae,i.vertical||O,a,24,J);ot&&Ke(Se,ot)}}else if(t.type==="Polygon")for(const Se of Ya(t.geometry,0)){const ot=n2(Se,16);Ke(Se[0],new Ao(ot.x,ot.y,0))}else if(t.type==="LineString")for(const Se of t.geometry)Ke(Se,new Ao(Se[0].x,Se[0].y,0));else if(t.type==="Point")for(const Se of t.geometry)for(const ot of Se)Ke([ot],new Ao(ot.x,ot.y,0))}function lx(n,t,i,a,h,g,y,x,b,k,I,P,z,L,O){const j=function(me,se,fe,we,Ae,He,ct,$e){const je=we.layout.get("text-rotate").evaluate(He,{})*Math.PI/180,nt=[];for(const Ye of se.positionedLines)for(const Ke of Ye.positionedGlyphs){if(!Ke.rect)continue;const Se=Ke.rect||{};let ot=T_+1,rt=!0,vt=1,rr=0;const tr=(Ae||$e)&&Ke.vertical,Wr=Ke.metrics.advance*Ke.scale/2;if($e&&se.verticalizable&&(rr=Ye.lineOffset/2-(Ke.imageName?-(qr-Ke.metrics.width*Ke.scale)/2:(Ke.scale-1)*qr)),Ke.imageName){const $t=ct[Ke.imageName];rt=$t.sdf,vt=$t.pixelRatio,ot=Zn/vt}const Ni=Ae?[Ke.x+Wr,Ke.y]:[0,0];let un=Ae?[0,0]:[Ke.x+Wr+fe[0],Ke.y+fe[1]-rr],Xr=[0,0];tr&&(Xr=un,un=[0,0]);const Pn=Ke.metrics.isDoubleResolution?2:1,An=(Ke.metrics.left-ot)*Ke.scale-Wr+un[0],Mn=(-Ke.metrics.top-ot)*Ke.scale+un[1],kr=An+Se.w/Pn*Ke.scale/vt,Kr=Mn+Se.h/Pn*Ke.scale/vt,_n=new q(An,Mn),cn=new q(kr,Mn),zn=new q(An,Kr),hn=new q(kr,Kr);if(tr){const $t=new q(-Wr,Wr-fc),sr=-Math.PI/2,pr=qr/2-Wr,ai=new q(5-fc-pr,-(Ke.imageName?pr:0)),wr=new q(...Xr);_n._rotateAround(sr,$t)._add(ai)._add(wr),cn._rotateAround(sr,$t)._add(ai)._add(wr),zn._rotateAround(sr,$t)._add(ai)._add(wr),hn._rotateAround(sr,$t)._add(ai)._add(wr)}if(je){const $t=Math.sin(je),sr=Math.cos(je),pr=[sr,-$t,$t,sr];_n._matMult(pr),cn._matMult(pr),zn._matMult(pr),hn._matMult(pr)}const ki=new q(0,0),Hn=new q(0,0);nt.push({tl:_n,tr:cn,bl:zn,br:hn,tex:Se,writingMode:se.writingMode,glyphOffset:Ni,sectionIndex:Ke.sectionIndex,isSDF:rt,pixelOffsetTL:ki,pixelOffsetBR:Hn,minFontScaleX:0,minFontScaleY:0})}return nt}(0,i,x,h,g,y,a,n.allowVerticalPlacement),X=n.textSizeData;let J=null;X.kind==="source"?(J=[ms*h.layout.get("text-size").evaluate(y,{})],J[0]>Co&&Dt(`${n.layerIds[0]}: Value for "text-size" is >= ${gc}. Reduce your "text-size".`)):X.kind==="composite"&&(J=[ms*L.compositeTextSizes[0].evaluate(y,{},O),ms*L.compositeTextSizes[1].evaluate(y,{},O)],(J[0]>Co||J[1]>Co)&&Dt(`${n.layerIds[0]}: Value for "text-size" is >= ${gc}. Reduce your "text-size".`)),n.addSymbols(n.text,j,J,x,g,y,k,t,b.lineStartIndex,b.lineLength,z,O);for(const me of I)P[me]=n.text.placedSymbolArray.length-1;return 4*j.length}function ux(n){for(const t in n)return n[t];return null}function o2(n,t,i,a){const h=n.compareText;if(t in h){const g=h[t];for(let y=g.length-1;y>=0;y--)if(a.dist(g[y])<i)return!0}else h[t]=[];return h[t].push(a),!1}const cx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,a]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=a>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const g=cx[15&a];if(!g)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(t,2,1),[x]=new Uint32Array(t,4,1);return new Yf(x,y,g,t)}constructor(t,i=64,a=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=cx.indexOf(this.ArrayType),y=2*t*this.ArrayType.BYTES_PER_ELEMENT,x=t*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-x%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${a}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+b,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+y+x+b),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+b,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=i,a}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Qf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:x}=this,b=[0,g.length-1,0],k=[];for(;b.length;){const I=b.pop()||0,P=b.pop()||0,z=b.pop()||0;if(P-z<=x){for(let X=z;X<=P;X++){const J=y[2*X],me=y[2*X+1];J>=t&&J<=a&&me>=i&&me<=h&&k.push(g[X])}continue}const L=z+P>>1,O=y[2*L],j=y[2*L+1];O>=t&&O<=a&&j>=i&&j<=h&&k.push(g[L]),(I===0?t<=O:i<=j)&&(b.push(z),b.push(L-1),b.push(1-I)),(I===0?a>=O:h>=j)&&(b.push(L+1),b.push(P),b.push(1-I))}return k}within(t,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:y}=this,x=[0,h.length-1,0],b=[],k=a*a;for(;x.length;){const I=x.pop()||0,P=x.pop()||0,z=x.pop()||0;if(P-z<=y){for(let X=z;X<=P;X++)dx(g[2*X],g[2*X+1],t,i)<=k&&b.push(h[X]);continue}const L=z+P>>1,O=g[2*L],j=g[2*L+1];dx(O,j,t,i)<=k&&b.push(h[L]),(I===0?t-a<=O:i-a<=j)&&(x.push(z),x.push(L-1),x.push(1-I)),(I===0?t+a>=O:i+a>=j)&&(x.push(L+1),x.push(P),x.push(1-I))}return b}}function Qf(n,t,i,a,h,g){if(h-a<=i)return;const y=a+h>>1;hx(n,t,y,a,h,g),Qf(n,t,i,a,y-1,1-g),Qf(n,t,i,y+1,h,1-g)}function hx(n,t,i,a,h,g){for(;h>a;){if(h-a>600){const k=h-a+1,I=i-a+1,P=Math.log(k),z=.5*Math.exp(2*P/3),L=.5*Math.sqrt(P*z*(k-z)/k)*(I-k/2<0?-1:1);hx(n,t,i,Math.max(a,Math.floor(i-I*z/k+L)),Math.min(h,Math.floor(i+(k-I)*z/k+L)),g)}const y=t[2*i+g];let x=a,b=h;for(xc(n,t,a,i),t[2*h+g]>y&&xc(n,t,a,h);x<b;){for(xc(n,t,x,b),x++,b--;t[2*x+g]<y;)x++;for(;t[2*b+g]>y;)b--}t[2*a+g]===y?xc(n,t,a,b):(b++,xc(n,t,b,h)),b<=i&&(a=b+1),i<=b&&(h=b-1)}}function xc(n,t,i,a){em(n,i,a),em(t,2*i,2*a),em(t,2*i+1,2*a+1)}function em(n,t,i){const a=n[t];n[t]=n[i],n[i]=a}function dx(n,t,i,a){const h=n-i,g=t-a;return h*h+g*g}var tm;v.bg=void 0,(tm=v.bg||(v.bg={})).create="create",tm.load="load",tm.fullLoad="fullLoad";let _d=null,vc=[];const rm=1e3/60,nm="loadTime",im="fullLoadTime",a2={mark(n){performance.mark(n)},frame(n){const t=n;_d!=null&&vc.push(t-_d),_d=t},clearMetrics(){_d=null,vc=[],performance.clearMeasures(nm),performance.clearMeasures(im);for(const n in v.bg)performance.clearMarks(v.bg[n])},getPerformanceMetrics(){performance.measure(nm,v.bg.create,v.bg.load),performance.measure(im,v.bg.create,v.bg.fullLoad);const n=performance.getEntriesByName(nm)[0].duration,t=performance.getEntriesByName(im)[0].duration,i=vc.length,a=1/(vc.reduce((g,y)=>g+y,0)/i/1e3),h=vc.filter(g=>g>rm).reduce((g,y)=>g+(y-rm)/rm,0);return{loadTime:n,fullLoadTime:t,fps:a,percentDroppedFrames:h/(i+h)*100,totalFrames:i}}};v.$=class extends A{},v.A=Il,v.B=df,v.C=function(n){if(nr==null){const t=n.navigator?n.navigator.userAgent:null;nr=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return nr},v.D=et,v.E=us,v.F=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Yb(()=>this.process()),this.subscription=function(i,a,h,g){return i.addEventListener(a,h,!1),{unsubscribe:()=>{i.removeEventListener(a,h,!1)}}}(this.target,"message",i=>this.receive(i)),this.globalScope=fr(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((i,a)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[h]={resolve:i,reject:a},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[h];const x={id:h,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)},{once:!0});const g=[],y=Object.assign(Object.assign({},n),{id:h,sourceMapId:this.mapId,origin:location.origin,data:go(n.data,g)});this.target.postMessage(y,{transfer:g})})}receive(n){const t=n.data,i=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[i];const a=this.abortControllers[i];return delete this.abortControllers[i],void(a&&a.abort())}if(fr(self)||t.mustQueue)return this.tasks[i]=t,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return d(this,void 0,void 0,function*(){if(t.type==="<response>"){const h=this.resolveRejects[n];return delete this.resolveRejects[n],h?void(t.error?h.reject(yo(t.error)):h.resolve(yo(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=yo(t.data),a=new AbortController;this.abortControllers[n]=a;try{const h=yield this.messageHandlers[t.type](t.sourceMapId,i,a);this.completeTask(n,null,h)}catch(h){this.completeTask(n,h)}})}completeTask(n,t,i){const a=[];delete this.abortControllers[n];const h={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?go(t):null,data:go(i,a)};this.target.postMessage(h,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},v.G=Yt,v.H=function(){var n=new Il(16);return Il!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},v.I=Nf,v.J=function(n,t,i){var a,h,g,y,x,b,k,I,P,z,L,O,j=i[0],X=i[1],J=i[2];return t===n?(n[12]=t[0]*j+t[4]*X+t[8]*J+t[12],n[13]=t[1]*j+t[5]*X+t[9]*J+t[13],n[14]=t[2]*j+t[6]*X+t[10]*J+t[14],n[15]=t[3]*j+t[7]*X+t[11]*J+t[15]):(h=t[1],g=t[2],y=t[3],x=t[4],b=t[5],k=t[6],I=t[7],P=t[8],z=t[9],L=t[10],O=t[11],n[0]=a=t[0],n[1]=h,n[2]=g,n[3]=y,n[4]=x,n[5]=b,n[6]=k,n[7]=I,n[8]=P,n[9]=z,n[10]=L,n[11]=O,n[12]=a*j+x*X+P*J+t[12],n[13]=h*j+b*X+z*J+t[13],n[14]=g*j+k*X+L*J+t[14],n[15]=y*j+I*X+O*J+t[15]),n},v.K=function(n,t,i){var a=i[0],h=i[1],g=i[2];return n[0]=t[0]*a,n[1]=t[1]*a,n[2]=t[2]*a,n[3]=t[3]*a,n[4]=t[4]*h,n[5]=t[5]*h,n[6]=t[6]*h,n[7]=t[7]*h,n[8]=t[8]*g,n[9]=t[9]*g,n[10]=t[10]*g,n[11]=t[11]*g,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},v.L=Hy,v.M=function(n,t){const i={};for(let a=0;a<t.length;a++){const h=t[a];h in n&&(i[h]=n[h])}return i},v.N=Po,v.O=V_,v.P=q,v.Q=U_,v.R=Ti,v.S=Ei,v.T=yl,v.U=oe,v.V=re,v.W=ft,v.X=Ur,v.Y=w,v.Z=yc,v._=d,v.a=mr,v.a$=function(n,t){var i=n[0],a=n[1],h=n[2],g=n[3],y=n[4],x=n[5],b=n[6],k=n[7],I=n[8],P=n[9],z=n[10],L=n[11],O=n[12],j=n[13],X=n[14],J=n[15],me=t[0],se=t[1],fe=t[2],we=t[3],Ae=t[4],He=t[5],ct=t[6],$e=t[7],je=t[8],nt=t[9],Ye=t[10],Ke=t[11],Se=t[12],ot=t[13],rt=t[14],vt=t[15];return Math.abs(i-me)<=Cn*Math.max(1,Math.abs(i),Math.abs(me))&&Math.abs(a-se)<=Cn*Math.max(1,Math.abs(a),Math.abs(se))&&Math.abs(h-fe)<=Cn*Math.max(1,Math.abs(h),Math.abs(fe))&&Math.abs(g-we)<=Cn*Math.max(1,Math.abs(g),Math.abs(we))&&Math.abs(y-Ae)<=Cn*Math.max(1,Math.abs(y),Math.abs(Ae))&&Math.abs(x-He)<=Cn*Math.max(1,Math.abs(x),Math.abs(He))&&Math.abs(b-ct)<=Cn*Math.max(1,Math.abs(b),Math.abs(ct))&&Math.abs(k-$e)<=Cn*Math.max(1,Math.abs(k),Math.abs($e))&&Math.abs(I-je)<=Cn*Math.max(1,Math.abs(I),Math.abs(je))&&Math.abs(P-nt)<=Cn*Math.max(1,Math.abs(P),Math.abs(nt))&&Math.abs(z-Ye)<=Cn*Math.max(1,Math.abs(z),Math.abs(Ye))&&Math.abs(L-Ke)<=Cn*Math.max(1,Math.abs(L),Math.abs(Ke))&&Math.abs(O-Se)<=Cn*Math.max(1,Math.abs(O),Math.abs(Se))&&Math.abs(j-ot)<=Cn*Math.max(1,Math.abs(j),Math.abs(ot))&&Math.abs(X-rt)<=Cn*Math.max(1,Math.abs(X),Math.abs(rt))&&Math.abs(J-vt)<=Cn*Math.max(1,Math.abs(J),Math.abs(vt))},v.a0=Rt,v.a1=Xf,v.a2=Ie,v.a3=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(i=>{t.onloadstart=()=>{i(t)};for(const a of n){const h=window.document.createElement("source");Hr(a)||(t.crossOrigin="Anonymous"),h.src=a,t.appendChild(h)}})},v.a4=function(){return Qe++},v.a5=qe,v.a6=Rl,v.a7=Ou,v.a8=wa,v.a9=W_,v.aA=function(n){if(n.type==="custom")return new Jb(n);switch(n.type){case"background":return new Wb(n);case"circle":return new Lw(n);case"fill":return new Yw(n);case"fill-extrusion":return new pb(n);case"heatmap":return new Ow(n);case"hillshade":return new Nw(n);case"line":return new wb(n);case"raster":return new Kb(n);case"symbol":return new pd(n)}},v.aB=pt,v.aC=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let i=[];try{if(!Ft(n.version,t.version))return[{command:"setStyle",args:[t]}];Ft(n.center,t.center)||i.push({command:"setCenter",args:[t.center]}),Ft(n.zoom,t.zoom)||i.push({command:"setZoom",args:[t.zoom]}),Ft(n.bearing,t.bearing)||i.push({command:"setBearing",args:[t.bearing]}),Ft(n.pitch,t.pitch)||i.push({command:"setPitch",args:[t.pitch]}),Ft(n.sprite,t.sprite)||i.push({command:"setSprite",args:[t.sprite]}),Ft(n.glyphs,t.glyphs)||i.push({command:"setGlyphs",args:[t.glyphs]}),Ft(n.transition,t.transition)||i.push({command:"setTransition",args:[t.transition]}),Ft(n.light,t.light)||i.push({command:"setLight",args:[t.light]}),Ft(n.terrain,t.terrain)||i.push({command:"setTerrain",args:[t.terrain]}),Ft(n.sky,t.sky)||i.push({command:"setSky",args:[t.sky]}),Ft(n.projection,t.projection)||i.push({command:"setProjection",args:[t.projection]});const a={},h=[];(function(y,x,b,k){let I;for(I in x=x||{},y=y||{})Object.prototype.hasOwnProperty.call(y,I)&&(Object.prototype.hasOwnProperty.call(x,I)||gi(I,b,k));for(I in x)Object.prototype.hasOwnProperty.call(x,I)&&(Object.prototype.hasOwnProperty.call(y,I)?Ft(y[I],x[I])||(y[I].type==="geojson"&&x[I].type==="geojson"&&it(y,x,I)?gr(b,{command:"setGeoJSONSourceData",args:[I,x[I].data]}):Qn(I,x,b,k)):Ts(I,x,b))})(n.sources,t.sources,h,a);const g=[];n.layers&&n.layers.forEach(y=>{"source"in y&&a[y.source]?i.push({command:"removeLayer",args:[y.id]}):g.push(y)}),i=i.concat(h),function(y,x,b){x=x||[];const k=(y=y||[]).map(Ht),I=x.map(Ht),P=y.reduce(ut,{}),z=x.reduce(ut,{}),L=k.slice(),O=Object.create(null);let j,X,J,me,se;for(let fe=0,we=0;fe<k.length;fe++)j=k[fe],Object.prototype.hasOwnProperty.call(z,j)?we++:(gr(b,{command:"removeLayer",args:[j]}),L.splice(L.indexOf(j,we),1));for(let fe=0,we=0;fe<I.length;fe++)j=I[I.length-1-fe],L[L.length-1-fe]!==j&&(Object.prototype.hasOwnProperty.call(P,j)?(gr(b,{command:"removeLayer",args:[j]}),L.splice(L.lastIndexOf(j,L.length-we),1)):we++,me=L[L.length-fe],gr(b,{command:"addLayer",args:[z[j],me]}),L.splice(L.length-fe,0,j),O[j]=!0);for(let fe=0;fe<I.length;fe++)if(j=I[fe],X=P[j],J=z[j],!O[j]&&!Ft(X,J))if(Ft(X.source,J.source)&&Ft(X["source-layer"],J["source-layer"])&&Ft(X.type,J.type)){for(se in Tt(X.layout,J.layout,b,j,null,"setLayoutProperty"),Tt(X.paint,J.paint,b,j,null,"setPaintProperty"),Ft(X.filter,J.filter)||gr(b,{command:"setFilter",args:[j,J.filter]}),Ft(X.minzoom,J.minzoom)&&Ft(X.maxzoom,J.maxzoom)||gr(b,{command:"setLayerZoomRange",args:[j,J.minzoom,J.maxzoom]}),X)Object.prototype.hasOwnProperty.call(X,se)&&se!=="layout"&&se!=="paint"&&se!=="filter"&&se!=="metadata"&&se!=="minzoom"&&se!=="maxzoom"&&(se.indexOf("paint.")===0?Tt(X[se],J[se],b,j,se.slice(6),"setPaintProperty"):Ft(X[se],J[se])||gr(b,{command:"setLayerProperty",args:[j,se,J[se]]}));for(se in J)Object.prototype.hasOwnProperty.call(J,se)&&!Object.prototype.hasOwnProperty.call(X,se)&&se!=="layout"&&se!=="paint"&&se!=="filter"&&se!=="metadata"&&se!=="minzoom"&&se!=="maxzoom"&&(se.indexOf("paint.")===0?Tt(X[se],J[se],b,j,se.slice(6),"setPaintProperty"):Ft(X[se],J[se])||gr(b,{command:"setLayerProperty",args:[j,se,J[se]]}))}else gr(b,{command:"removeLayer",args:[j]}),me=L[L.lastIndexOf(j)+1],gr(b,{command:"addLayer",args:[J,me]})}(g,t.layers,i)}catch(a){console.warn("Unable to compute style diff:",a),i=[{command:"setStyle",args:[t]}]}return i},v.aD=function(n){const t=[],i=n.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},v.aE=function n(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let a=0;a<t.length;a++)if(!n(t[a],i[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&i!==null){if(typeof i!="object"||Object.keys(t).length!==Object.keys(i).length)return!1;for(const a in t)if(!n(t[a],i[a]))return!1;return!0}return t===i},v.aF=_t,v.aG=mt,v.aH=class extends _a{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},v.aI=ed,v.aJ=class extends _a{constructor(n,t){super(n,t),this.current=Iw}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},v.aK=Ly,v.aL=Fy,v.aM=Jt,v.aN=class extends _a{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},v.aO=class extends _a{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},v.aP=function(n,t,i,a,h,g,y){var x=1/(t-i),b=1/(a-h),k=1/(g-y);return n[0]=-2*x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*k,n[11]=0,n[12]=(t+i)*x,n[13]=(h+a)*b,n[14]=(y+g)*k,n[15]=1,n},v.aQ=Dw,v.aR=class extends le{},v.aS=Eb,v.aT=class extends ge{},v.aU=If,v.aV=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},v.aW=Jy,v.aX=on,v.aY=Si,v.aZ=class extends tt{},v.a_=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},v.aa=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,h,g)=>{const y=h||g;return t[a]=!y||y.toLowerCase(),""}),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t},v.ab=function(n,t){const i=[];for(const a in n)a in t||i.push(a);return i},v.ac=De,v.ad=function(n,t,i){var a=Math.sin(i),h=Math.cos(i),g=t[0],y=t[1],x=t[2],b=t[3],k=t[4],I=t[5],P=t[6],z=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=g*h+k*a,n[1]=y*h+I*a,n[2]=x*h+P*a,n[3]=b*h+z*a,n[4]=k*h-g*a,n[5]=I*h-y*a,n[6]=P*h-x*a,n[7]=z*h-b*a,n},v.ae=function(n){var t=new Il(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},v.af=id,v.ag=function(n,t){let i=0,a=0;if(n.kind==="constant")a=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:h,minZoom:g,maxZoom:y}=n,x=h?De(kn.interpolationFactor(h,t,g,y),0,1):0;n.kind==="camera"?a=En.number(n.minSize,n.maxSize,x):i=x}return{uSizeT:i,uSize:a}},v.ai=function(n,{uSize:t,uSizeT:i},{lowerSize:a,upperSize:h}){return n.kind==="source"?a/ms:n.kind==="composite"?En.number(a/ms,h/ms,i):t},v.aj=$f,v.ak=function(n,t,i,a){const h=t.y-n.y,g=t.x-n.x,y=a.y-i.y,x=a.x-i.x,b=y*g-x*h;if(b===0)return null;const k=(x*(n.y-i.y)-y*(n.x-i.x))/b;return new q(n.x+k*g,n.y+k*h)},v.al=Y_,v.am=jy,v.an=Tf,v.ao=function(n){let t=1/0,i=1/0,a=-1/0,h=-1/0;for(const g of n)t=Math.min(t,g.x),i=Math.min(i,g.y),a=Math.max(a,g.x),h=Math.max(h,g.y);return[t,i,a,h]},v.ap=qr,v.ar=Uf,v.as=function(n,t){var i=t[0],a=t[1],h=t[2],g=t[3],y=t[4],x=t[5],b=t[6],k=t[7],I=t[8],P=t[9],z=t[10],L=t[11],O=t[12],j=t[13],X=t[14],J=t[15],me=i*x-a*y,se=i*b-h*y,fe=i*k-g*y,we=a*b-h*x,Ae=a*k-g*x,He=h*k-g*b,ct=I*j-P*O,$e=I*X-z*O,je=I*J-L*O,nt=P*X-z*j,Ye=P*J-L*j,Ke=z*J-L*X,Se=me*Ke-se*Ye+fe*nt+we*je-Ae*$e+He*ct;return Se?(n[0]=(x*Ke-b*Ye+k*nt)*(Se=1/Se),n[1]=(h*Ye-a*Ke-g*nt)*Se,n[2]=(j*He-X*Ae+J*we)*Se,n[3]=(z*Ae-P*He-L*we)*Se,n[4]=(b*je-y*Ke-k*$e)*Se,n[5]=(i*Ke-h*je+g*$e)*Se,n[6]=(X*fe-O*He-J*se)*Se,n[7]=(I*He-z*fe+L*se)*Se,n[8]=(y*Ye-x*je+k*ct)*Se,n[9]=(a*je-i*Ye-g*ct)*Se,n[10]=(O*Ae-j*fe+J*me)*Se,n[11]=(P*fe-I*Ae-L*me)*Se,n[12]=(x*$e-y*nt-b*ct)*Se,n[13]=(i*nt-a*$e+h*ct)*Se,n[14]=(j*se-O*we-X*me)*Se,n[15]=(I*we-P*se+z*me)*Se,n):null},v.at=Jf,v.au=Vf,v.av=Yf,v.aw=function(){const n={},t=xe.$version;for(const i in xe.$root){const a=xe.$root[i];if(a.required){let h=null;h=i==="version"?t:a.type==="array"?[]:{},h!=null&&(n[i]=h)}}return n},v.ax=Ju,v.ay=Sn,v.az=function(n){n=n.slice();const t=Object.create(null);for(let i=0;i<n.length;i++)t[n[i].id]=n[i];for(let i=0;i<n.length;i++)"ref"in n[i]&&(n[i]=cs(n[i],t[n[i].ref]));return n},v.b=Or,v.b0=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},v.b1=function(n,t,i){return n[0]=t[0]*i[0],n[1]=t[1]*i[1],n[2]=t[2]*i[2],n[3]=t[3]*i[3],n},v.b2=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},v.b3=Ue,v.b4=Z_,v.b5=$_,v.b6=function(n,t,i,a,h){var g,y=1/Math.tan(t/2);return n[0]=y/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=y,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,h!=null&&h!==1/0?(n[10]=(h+a)*(g=1/(a-h)),n[14]=2*h*a*g):(n[10]=-1,n[14]=-2*a),n},v.b7=function(n,t,i){var a=Math.sin(i),h=Math.cos(i),g=t[4],y=t[5],x=t[6],b=t[7],k=t[8],I=t[9],P=t[10],z=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=g*h+k*a,n[5]=y*h+I*a,n[6]=x*h+P*a,n[7]=b*h+z*a,n[8]=k*h-g*a,n[9]=I*h-y*a,n[10]=P*h-x*a,n[11]=z*h-b*a,n},v.b8=ce,v.b9=Ce,v.bA=y_,v.bB=function(n){return n.message===Pt},v.bC=uo,v.bD=$n,v.ba=function(n){return n*Math.PI/180},v.bb=function(n,t){const{x:i,y:a}=yc.fromLngLat(t);return!(n<0||n>25||a<0||a>=1||i<0||i>=1)},v.bc=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},v.bd=class extends C{},v.be=Gf,v.bf=a2,v.bh=Pr,v.bi=function(n,t){mr.REGISTERED_PROTOCOLS[n]=t},v.bj=function(n){delete mr.REGISTERED_PROTOCOLS[n]},v.bk=function(n,t){const i={};for(let h=0;h<n.length;h++){const g=t&&t[n[h].id]||Uh(n[h]);t&&(t[n[h].id]=g);let y=i[g];y||(y=i[g]=[]),y.push(n[h])}const a=[];for(const h in i)a.push(i[h]);return a},v.bl=Je,v.bm=G_,v.bn=X_,v.bo=k_,v.bp=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Ur/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],i=t.layout,a=t._unevaluatedLayout._values,h={layoutIconSize:a["icon-size"].possiblyEvaluate(new ur(n.bucket.zoom+1),n.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new ur(n.bucket.zoom+1),n.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new ur(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:I}=n.bucket.textSizeData;h.compositeTextSizes=[a["text-size"].possiblyEvaluate(new ur(k),n.canonical),a["text-size"].possiblyEvaluate(new ur(I),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:I}=n.bucket.iconSizeData;h.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new ur(k),n.canonical),a["icon-size"].possiblyEvaluate(new ur(I),n.canonical)]}const g=i.get("text-line-height")*qr,y=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",x=i.get("text-keep-upright"),b=i.get("text-size");for(const k of n.bucket.features){const I=i.get("text-font").evaluate(k,{},n.canonical).join(","),P=b.evaluate(k,{},n.canonical),z=h.layoutTextSize.evaluate(k,{},n.canonical),L=h.layoutIconSize.evaluate(k,{},n.canonical),O={horizontal:{},vertical:void 0},j=k.text;let X,J=[0,0];if(j){const fe=j.toString(),we=i.get("text-letter-spacing").evaluate(k,{},n.canonical)*qr,Ae=pf(fe)?we:0,He=i.get("text-anchor").evaluate(k,{},n.canonical),ct=ax(t,k,n.canonical);if(!ct){const Ye=i.get("text-radial-offset").evaluate(k,{},n.canonical);J=Ye?ox(He,[Ye*qr,Kf]):i.get("text-offset").evaluate(k,{},n.canonical).map(Ke=>Ke*qr)}let $e=y?"center":i.get("text-justify").evaluate(k,{},n.canonical);const je=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(k,{},n.canonical)*qr:1/0,nt=()=>{n.bucket.allowVerticalPlacement&&Yu(fe)&&(O.vertical=cd(j,n.glyphMap,n.glyphPositions,n.imagePositions,I,je,g,He,"left",Ae,J,v.ah.vertical,!0,z,P))};if(!y&&ct){const Ye=new Set;if($e==="auto")for(let Se=0;Se<ct.values.length;Se+=2)Ye.add(Jf(ct.values[Se]));else Ye.add($e);let Ke=!1;for(const Se of Ye)if(!O.horizontal[Se])if(Ke)O.horizontal[Se]=O.horizontal[0];else{const ot=cd(j,n.glyphMap,n.glyphPositions,n.imagePositions,I,je,g,"center",Se,Ae,J,v.ah.horizontal,!1,z,P);ot&&(O.horizontal[Se]=ot,Ke=ot.positionedLines.length===1)}nt()}else{$e==="auto"&&($e=Jf(He));const Ye=cd(j,n.glyphMap,n.glyphPositions,n.imagePositions,I,je,g,He,$e,Ae,J,v.ah.horizontal,!1,z,P);Ye&&(O.horizontal[$e]=Ye),nt(),Yu(fe)&&y&&x&&(O.vertical=cd(j,n.glyphMap,n.glyphPositions,n.imagePositions,I,je,g,He,$e,Ae,J,v.ah.vertical,!1,z,P))}}let me=!1;if(k.icon&&k.icon.name){const fe=n.imageMap[k.icon.name];fe&&(X=$b(n.imagePositions[k.icon.name],i.get("icon-offset").evaluate(k,{},n.canonical),i.get("icon-anchor").evaluate(k,{},n.canonical)),me=!!fe.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=me:n.bucket.sdfIcons!==me&&Dt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(fe.pixelRatio!==n.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const se=ux(O.horizontal)||O.vertical;n.bucket.iconsInText=!!se&&se.iconsInText,(se||X)&&s2(n.bucket,k,O,X,n.imageMap,h,z,L,J,me,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},v.bq=Lf,v.br=zf,v.bs=Df,v.bt=ko,v.bu=Of,v.bv=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},v.bw=function(n,t,i,a,h){return d(this,void 0,void 0,function*(){if(re())try{return yield ft(n,t,i,a,h)}catch{}return function(g,y,x,b,k){const I=g.width,P=g.height;gt&&wt||(gt=new OffscreenCanvas(I,P),wt=gt.getContext("2d",{willReadFrequently:!0})),gt.width=I,gt.height=P,wt.drawImage(g,0,0,I,P);const z=wt.getImageData(y,x,b,k);return wt.clearRect(0,0,I,P),z.data}(n,t,i,a,h)})},v.bx=H_,v.by=N,v.bz=Z,v.c=ar,v.d=n=>d(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),v.e=Oe,v.f=n=>new Promise((t,i)=>{const a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=Ze})},a.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(n)],{type:"image/png"});a.src=n.byteLength?URL.createObjectURL(h):Ze}),v.g=Cr,v.h=(n,t)=>Wi(Oe(n,{type:"json"}),t),v.i=fr,v.j=mi,v.k=Yn,v.l=(n,t)=>Wi(Oe(n,{type:"arrayBuffer"}),t),v.m=Wi,v.n=function(n){return new Of(n).readFields(Fb,[])},v.o=ac,v.p=E_,v.q=m,v.r=hf,v.s=Hr,v.t=Xu,v.u=Fs,v.v=xe,v.w=Dt,v.x=function([n,t,i]){return t+=90,t*=Math.PI/180,i*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(i),y:n*Math.sin(t)*Math.sin(i),z:n*Math.cos(i)}},v.y=En,v.z=ur}),_("worker",["./shared"],function(v){class d{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,D){for(const H of R){this._layerConfigs[H.id]=H;const ie=this._layers[H.id]=v.aA(H);ie._featureFilter=v.a7(ie.filter),this.keyCache[H.id]&&delete this.keyCache[H.id]}for(const H of D)delete this.keyCache[H],delete this._layerConfigs[H],delete this._layers[H];this.familiesBySource={};const B=v.bk(Object.values(this._layerConfigs),this.keyCache);for(const H of B){const ie=H.map(ye=>this._layers[ye.id]),ae=ie[0];if(ae.visibility==="none")continue;const pe=ae.source||"";let ee=this.familiesBySource[pe];ee||(ee=this.familiesBySource[pe]={});const ve=ae.sourceLayer||"_geojsonTileLayer";let Te=ee[ve];Te||(Te=ee[ve]=[]),Te.push(ie)}}}class N{constructor(R){const D={},B=[];for(const pe in R){const ee=R[pe],ve=D[pe]={};for(const Te in ee){const ye=ee[+Te];if(!ye||ye.bitmap.width===0||ye.bitmap.height===0)continue;const Re={x:0,y:0,w:ye.bitmap.width+2,h:ye.bitmap.height+2};B.push(Re),ve[Te]={rect:Re,metrics:ye.metrics}}}const{w:H,h:ie}=v.p(B),ae=new v.o({width:H||1,height:ie||1});for(const pe in R){const ee=R[pe];for(const ve in ee){const Te=ee[+ve];if(!Te||Te.bitmap.width===0||Te.bitmap.height===0)continue;const ye=D[pe][ve].rect;v.o.copy(Te.bitmap,ae,{x:0,y:0},{x:ye.x+1,y:ye.y+1},Te.bitmap)}}this.image=ae,this.positions=D}}v.bl("GlyphAtlas",N);class Z{constructor(R){this.tileID=new v.S(R.tileID.overscaledZ,R.tileID.wrap,R.tileID.canonical.z,R.tileID.canonical.x,R.tileID.canonical.y),this.uid=R.uid,this.zoom=R.zoom,this.pixelRatio=R.pixelRatio,this.tileSize=R.tileSize,this.source=R.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=R.showCollisionBoxes,this.collectResourceTiming=!!R.collectResourceTiming,this.returnDependencies=!!R.returnDependencies,this.promoteId=R.promoteId,this.inFlightDependencies=[]}parse(R,D,B,H){return v._(this,void 0,void 0,function*(){this.status="parsing",this.data=R,this.collisionBoxArray=new v.a5;const ie=new v.bm(Object.keys(R.layers).sort()),ae=new v.bn(this.tileID,this.promoteId);ae.bucketLayerIDs=[];const pe={},ee={featureIndex:ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:B},ve=D.familiesBySource[this.source];for(const It in ve){const Kt=R.layers[It];if(!Kt)continue;Kt.version===1&&v.w(`Vector tile source "${this.source}" layer "${It}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const yr=ie.encode(It),Gr=[];for(let Yr=0;Yr<Kt.length;Yr++){const mn=Kt.feature(Yr),Ys=ae.getId(mn,It);Gr.push({feature:mn,id:Ys,index:Yr,sourceLayerIndex:yr})}for(const Yr of ve[It]){const mn=Yr[0];mn.source!==this.source&&v.w(`layer.source = ${mn.source} does not equal this.source = ${this.source}`),mn.minzoom&&this.zoom<Math.floor(mn.minzoom)||mn.maxzoom&&this.zoom>=mn.maxzoom||mn.visibility!=="none"&&(te(Yr,this.zoom,B),(pe[mn.id]=mn.createBucket({index:ae.bucketLayerIDs.length,layers:Yr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:yr,sourceID:this.source})).populate(Gr,ee,this.tileID.canonical),ae.bucketLayerIDs.push(Yr.map(Ys=>Ys.id)))}}const Te=v.aF(ee.glyphDependencies,It=>Object.keys(It).map(Number));this.inFlightDependencies.forEach(It=>It==null?void 0:It.abort()),this.inFlightDependencies=[];let ye=Promise.resolve({});if(Object.keys(Te).length){const It=new AbortController;this.inFlightDependencies.push(It),ye=H.sendAsync({type:"GG",data:{stacks:Te,source:this.source,tileID:this.tileID,type:"glyphs"}},It)}const Re=Object.keys(ee.iconDependencies);let Xe=Promise.resolve({});if(Re.length){const It=new AbortController;this.inFlightDependencies.push(It),Xe=H.sendAsync({type:"GI",data:{icons:Re,source:this.source,tileID:this.tileID,type:"icons"}},It)}const lt=Object.keys(ee.patternDependencies);let Bt=Promise.resolve({});if(lt.length){const It=new AbortController;this.inFlightDependencies.push(It),Bt=H.sendAsync({type:"GI",data:{icons:lt,source:this.source,tileID:this.tileID,type:"patterns"}},It)}const[St,Nt,At]=yield Promise.all([ye,Xe,Bt]),jr=new N(St),vr=new v.bo(Nt,At);for(const It in pe){const Kt=pe[It];Kt instanceof v.a6?(te(Kt.layers,this.zoom,B),v.bp({bucket:Kt,glyphMap:St,glyphPositions:jr.positions,imageMap:Nt,imagePositions:vr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Kt.hasPattern&&(Kt instanceof v.bq||Kt instanceof v.br||Kt instanceof v.bs)&&(te(Kt.layers,this.zoom,B),Kt.addFeatures(ee,this.tileID.canonical,vr.patternPositions))}return this.status="done",{buckets:Object.values(pe).filter(It=>!It.isEmpty()),featureIndex:ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:jr.image,imageAtlas:vr,glyphMap:this.returnDependencies?St:null,iconMap:this.returnDependencies?Nt:null,glyphPositions:this.returnDependencies?jr.positions:null}})}}function te(G,R,D){const B=new v.z(R);for(const H of G)H.recalculate(B,D)}class q{constructor(R,D,B){this.actor=R,this.layerIndex=D,this.availableImages=B,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(R,D){return v._(this,void 0,void 0,function*(){const B=yield v.l(R.request,D);try{return{vectorTile:new v.bt.VectorTile(new v.bu(B.data)),rawData:B.data,cacheControl:B.cacheControl,expires:B.expires}}catch(H){const ie=new Uint8Array(B.data);let ae=`Unable to parse the tile at ${R.request.url}, `;throw ae+=ie[0]===31&&ie[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${H.message}`,new Error(ae)}})}loadTile(R){return v._(this,void 0,void 0,function*(){const D=R.uid,B=!!(R&&R.request&&R.request.collectResourceTiming)&&new v.bv(R.request),H=new Z(R);this.loading[D]=H;const ie=new AbortController;H.abort=ie;try{const ae=yield this.loadVectorTile(R,ie);if(delete this.loading[D],!ae)return null;const pe=ae.rawData,ee={};ae.expires&&(ee.expires=ae.expires),ae.cacheControl&&(ee.cacheControl=ae.cacheControl);const ve={};if(B){const ye=B.finish();ye&&(ve.resourceTiming=JSON.parse(JSON.stringify(ye)))}H.vectorTile=ae.vectorTile;const Te=H.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[D]=H,this.fetching[D]={rawTileData:pe,cacheControl:ee,resourceTiming:ve};try{const ye=yield Te;return v.e({rawTileData:pe.slice(0)},ye,ee,ve)}finally{delete this.fetching[D]}}catch(ae){throw delete this.loading[D],H.status="done",this.loaded[D]=H,ae}})}reloadTile(R){return v._(this,void 0,void 0,function*(){const D=R.uid;if(!this.loaded||!this.loaded[D])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const B=this.loaded[D];if(B.showCollisionBoxes=R.showCollisionBoxes,B.status==="parsing"){const H=yield B.parse(B.vectorTile,this.layerIndex,this.availableImages,this.actor);let ie;if(this.fetching[D]){const{rawTileData:ae,cacheControl:pe,resourceTiming:ee}=this.fetching[D];delete this.fetching[D],ie=v.e({rawTileData:ae.slice(0)},H,pe,ee)}else ie=H;return ie}if(B.status==="done"&&B.vectorTile)return B.parse(B.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(R){return v._(this,void 0,void 0,function*(){const D=this.loading,B=R.uid;D&&D[B]&&D[B].abort&&(D[B].abort.abort(),delete D[B])})}removeTile(R){return v._(this,void 0,void 0,function*(){this.loaded&&this.loaded[R.uid]&&delete this.loaded[R.uid]})}}class U{constructor(){this.loaded={}}loadTile(R){return v._(this,void 0,void 0,function*(){const{uid:D,encoding:B,rawImageData:H,redFactor:ie,greenFactor:ae,blueFactor:pe,baseShift:ee}=R,ve=H.width+2,Te=H.height+2,ye=v.b(H)?new v.R({width:ve,height:Te},yield v.bw(H,-1,-1,ve,Te)):H,Re=new v.bx(D,ye,B,ie,ae,pe,ee);return this.loaded=this.loaded||{},this.loaded[D]=Re,Re})}removeTile(R){const D=this.loaded,B=R.uid;D&&D[B]&&delete D[B]}}function ke(G,R){if(G.length!==0){ue(G[0],R);for(var D=1;D<G.length;D++)ue(G[D],!R)}}function ue(G,R){for(var D=0,B=0,H=0,ie=G.length,ae=ie-1;H<ie;ae=H++){var pe=(G[H][0]-G[ae][0])*(G[ae][1]+G[H][1]),ee=D+pe;B+=Math.abs(D)>=Math.abs(pe)?D-ee+pe:pe-ee+D,D=ee}D+B>=0!=!!R&&G.reverse()}var _e=v.by(function G(R,D){var B,H=R&&R.type;if(H==="FeatureCollection")for(B=0;B<R.features.length;B++)G(R.features[B],D);else if(H==="GeometryCollection")for(B=0;B<R.geometries.length;B++)G(R.geometries[B],D);else if(H==="Feature")G(R.geometry,D);else if(H==="Polygon")ke(R.coordinates,D);else if(H==="MultiPolygon")for(B=0;B<R.coordinates.length;B++)ke(R.coordinates[B],D);return R});const Pe=v.bt.VectorTileFeature.prototype.toGeoJSON;var oe={exports:{}},re=v.bz,ce=v.bt.VectorTileFeature,Ce=De;function De(G,R){this.options=R||{},this.features=G,this.length=G.length}function Ue(G,R){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=R||4096}De.prototype.feature=function(G){return new Ue(this.features[G],this.options.extent)},Ue.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var R=0;R<G.length;R++){for(var D=G[R],B=[],H=0;H<D.length;H++)B.push(new re(D[H][0],D[H][1]));this.geometry.push(B)}return this.geometry},Ue.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,R=1/0,D=-1/0,B=1/0,H=-1/0,ie=0;ie<G.length;ie++)for(var ae=G[ie],pe=0;pe<ae.length;pe++){var ee=ae[pe];R=Math.min(R,ee.x),D=Math.max(D,ee.x),B=Math.min(B,ee.y),H=Math.max(H,ee.y)}return[R,B,D,H]},Ue.prototype.toGeoJSON=ce.prototype.toGeoJSON;var Oe=v.bA,Qe=Ce;function _t(G){var R=new Oe;return function(D,B){for(var H in D.layers)B.writeMessage(3,mt,D.layers[H])}(G,R),R.finish()}function mt(G,R){var D;R.writeVarintField(15,G.version||1),R.writeStringField(1,G.name||""),R.writeVarintField(5,G.extent||4096);var B={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<G.length;D++)B.feature=G.feature(D),R.writeMessage(2,pt,B);var H=B.keys;for(D=0;D<H.length;D++)R.writeStringField(3,H[D]);var ie=B.values;for(D=0;D<ie.length;D++)R.writeMessage(4,nr,ie[D])}function pt(G,R){var D=G.feature;D.id!==void 0&&R.writeVarintField(1,D.id),R.writeMessage(2,Xt,G),R.writeVarintField(3,D.type),R.writeMessage(4,fr,D)}function Xt(G,R){var D=G.feature,B=G.keys,H=G.values,ie=G.keycache,ae=G.valuecache;for(var pe in D.properties){var ee=D.properties[pe],ve=ie[pe];if(ee!==null){ve===void 0&&(B.push(pe),ie[pe]=ve=B.length-1),R.writeVarint(ve);var Te=typeof ee;Te!=="string"&&Te!=="boolean"&&Te!=="number"&&(ee=JSON.stringify(ee));var ye=Te+":"+ee,Re=ae[ye];Re===void 0&&(H.push(ee),ae[ye]=Re=H.length-1),R.writeVarint(Re)}}}function Dt(G,R){return(R<<3)+(7&G)}function Lt(G){return G<<1^G>>31}function fr(G,R){for(var D=G.loadGeometry(),B=G.type,H=0,ie=0,ae=D.length,pe=0;pe<ae;pe++){var ee=D[pe],ve=1;B===1&&(ve=ee.length),R.writeVarint(Dt(1,ve));for(var Te=B===3?ee.length-1:ee.length,ye=0;ye<Te;ye++){ye===1&&B!==1&&R.writeVarint(Dt(2,Te-1));var Re=ee[ye].x-H,Xe=ee[ye].y-ie;R.writeVarint(Lt(Re)),R.writeVarint(Lt(Xe)),H+=Re,ie+=Xe}B===3&&R.writeVarint(Dt(7,1))}}function nr(G,R){var D=typeof G;D==="string"?R.writeStringField(1,G):D==="boolean"?R.writeBooleanField(7,G):D==="number"&&(G%1!=0?R.writeDoubleField(3,G):G<0?R.writeSVarintField(6,G):R.writeVarintField(5,G))}oe.exports=_t,oe.exports.fromVectorTileJs=_t,oe.exports.fromGeojsonVt=function(G,R){R=R||{};var D={};for(var B in G)D[B]=new Qe(G[B].features,R),D[B].name=B,D[B].version=R.version,D[B].extent=R.extent;return _t({layers:D})},oe.exports.GeoJSONWrapper=Qe;var Or=v.by(oe.exports);const Ze={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:G=>G},ft=Math.fround||(gt=new Float32Array(1),G=>(gt[0]=+G,gt[0]));var gt;const wt=3,Pt=5,ar=6;class mr{constructor(R){this.options=Object.assign(Object.create(Ze),R),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(R){const{log:D,minZoom:B,maxZoom:H}=this.options;D&&console.time("total time");const ie=`prepare ${R.length} points`;D&&console.time(ie),this.points=R;const ae=[];for(let ee=0;ee<R.length;ee++){const ve=R[ee];if(!ve.geometry)continue;const[Te,ye]=ve.geometry.coordinates,Re=ft(Pr(Te)),Xe=ft(Sn(ye));ae.push(Re,Xe,1/0,ee,-1,1),this.options.reduce&&ae.push(0)}let pe=this.trees[H+1]=this._createTree(ae);D&&console.timeEnd(ie);for(let ee=H;ee>=B;ee--){const ve=+Date.now();pe=this.trees[ee]=this._createTree(this._cluster(pe,ee)),D&&console.log("z%d: %d clusters in %dms",ee,pe.numItems,+Date.now()-ve)}return D&&console.timeEnd("total time"),this}getClusters(R,D){let B=((R[0]+180)%360+360)%360-180;const H=Math.max(-90,Math.min(90,R[1]));let ie=R[2]===180?180:((R[2]+180)%360+360)%360-180;const ae=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)B=-180,ie=180;else if(B>ie){const ye=this.getClusters([B,H,180,ae],D),Re=this.getClusters([-180,H,ie,ae],D);return ye.concat(Re)}const pe=this.trees[this._limitZoom(D)],ee=pe.range(Pr(B),Sn(ae),Pr(ie),Sn(H)),ve=pe.data,Te=[];for(const ye of ee){const Re=this.stride*ye;Te.push(ve[Re+Pt]>1?Cr(ve,Re,this.clusterProps):this.points[ve[Re+wt]])}return Te}getChildren(R){const D=this._getOriginId(R),B=this._getOriginZoom(R),H="No cluster with the specified id.",ie=this.trees[B];if(!ie)throw new Error(H);const ae=ie.data;if(D*this.stride>=ae.length)throw new Error(H);const pe=this.options.radius/(this.options.extent*Math.pow(2,B-1)),ee=ie.within(ae[D*this.stride],ae[D*this.stride+1],pe),ve=[];for(const Te of ee){const ye=Te*this.stride;ae[ye+4]===R&&ve.push(ae[ye+Pt]>1?Cr(ae,ye,this.clusterProps):this.points[ae[ye+wt]])}if(ve.length===0)throw new Error(H);return ve}getLeaves(R,D,B){const H=[];return this._appendLeaves(H,R,D=D||10,B=B||0,0),H}getTile(R,D,B){const H=this.trees[this._limitZoom(R)],ie=Math.pow(2,R),{extent:ae,radius:pe}=this.options,ee=pe/ae,ve=(B-ee)/ie,Te=(B+1+ee)/ie,ye={features:[]};return this._addTileFeatures(H.range((D-ee)/ie,ve,(D+1+ee)/ie,Te),H.data,D,B,ie,ye),D===0&&this._addTileFeatures(H.range(1-ee/ie,ve,1,Te),H.data,ie,B,ie,ye),D===ie-1&&this._addTileFeatures(H.range(0,ve,ee/ie,Te),H.data,-1,B,ie,ye),ye.features.length?ye:null}getClusterExpansionZoom(R){let D=this._getOriginZoom(R)-1;for(;D<=this.options.maxZoom;){const B=this.getChildren(R);if(D++,B.length!==1)break;R=B[0].properties.cluster_id}return D}_appendLeaves(R,D,B,H,ie){const ae=this.getChildren(D);for(const pe of ae){const ee=pe.properties;if(ee&&ee.cluster?ie+ee.point_count<=H?ie+=ee.point_count:ie=this._appendLeaves(R,ee.cluster_id,B,H,ie):ie<H?ie++:R.push(pe),R.length===B)break}return ie}_createTree(R){const D=new v.av(R.length/this.stride|0,this.options.nodeSize,Float32Array);for(let B=0;B<R.length;B+=this.stride)D.add(R[B],R[B+1]);return D.finish(),D.data=R,D}_addTileFeatures(R,D,B,H,ie,ae){for(const pe of R){const ee=pe*this.stride,ve=D[ee+Pt]>1;let Te,ye,Re;if(ve)Te=Yt(D,ee,this.clusterProps),ye=D[ee],Re=D[ee+1];else{const Bt=this.points[D[ee+wt]];Te=Bt.properties;const[St,Nt]=Bt.geometry.coordinates;ye=Pr(St),Re=Sn(Nt)}const Xe={type:1,geometry:[[Math.round(this.options.extent*(ye*ie-B)),Math.round(this.options.extent*(Re*ie-H))]],tags:Te};let lt;lt=ve||this.options.generateId?D[ee+wt]:this.points[D[ee+wt]].id,lt!==void 0&&(Xe.id=lt),ae.features.push(Xe)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,D){const{radius:B,extent:H,reduce:ie,minPoints:ae}=this.options,pe=B/(H*Math.pow(2,D)),ee=R.data,ve=[],Te=this.stride;for(let ye=0;ye<ee.length;ye+=Te){if(ee[ye+2]<=D)continue;ee[ye+2]=D;const Re=ee[ye],Xe=ee[ye+1],lt=R.within(ee[ye],ee[ye+1],pe),Bt=ee[ye+Pt];let St=Bt;for(const Nt of lt){const At=Nt*Te;ee[At+2]>D&&(St+=ee[At+Pt])}if(St>Bt&&St>=ae){let Nt,At=Re*Bt,jr=Xe*Bt,vr=-1;const It=((ye/Te|0)<<5)+(D+1)+this.points.length;for(const Kt of lt){const yr=Kt*Te;if(ee[yr+2]<=D)continue;ee[yr+2]=D;const Gr=ee[yr+Pt];At+=ee[yr]*Gr,jr+=ee[yr+1]*Gr,ee[yr+4]=It,ie&&(Nt||(Nt=this._map(ee,ye,!0),vr=this.clusterProps.length,this.clusterProps.push(Nt)),ie(Nt,this._map(ee,yr)))}ee[ye+4]=It,ve.push(At/St,jr/St,1/0,It,-1,St),ie&&ve.push(vr)}else{for(let Nt=0;Nt<Te;Nt++)ve.push(ee[ye+Nt]);if(St>1)for(const Nt of lt){const At=Nt*Te;if(!(ee[At+2]<=D)){ee[At+2]=D;for(let jr=0;jr<Te;jr++)ve.push(ee[At+jr])}}}}return ve}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,D,B){if(R[D+Pt]>1){const ae=this.clusterProps[R[D+ar]];return B?Object.assign({},ae):ae}const H=this.points[R[D+wt]].properties,ie=this.options.map(H);return B&&ie===H?Object.assign({},ie):ie}}function Cr(G,R,D){return{type:"Feature",id:G[R+wt],properties:Yt(G,R,D),geometry:{type:"Point",coordinates:[(B=G[R],360*(B-.5)),Wi(G[R+1])]}};var B}function Yt(G,R,D){const B=G[R+Pt],H=B>=1e4?`${Math.round(B/1e3)}k`:B>=1e3?Math.round(B/100)/10+"k":B,ie=G[R+ar],ae=ie===-1?{}:Object.assign({},D[ie]);return Object.assign(ae,{cluster:!0,cluster_id:G[R+wt],point_count:B,point_count_abbreviated:H})}function Pr(G){return G/360+.5}function Sn(G){const R=Math.sin(G*Math.PI/180),D=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return D<0?0:D>1?1:D}function Wi(G){const R=(180-360*G)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function Hr(G,R,D,B){let H=B;const ie=R+(D-R>>1);let ae,pe=D-R;const ee=G[R],ve=G[R+1],Te=G[D],ye=G[D+1];for(let Re=R+3;Re<D;Re+=3){const Xe=Jn(G[Re],G[Re+1],ee,ve,Te,ye);if(Xe>H)ae=Re,H=Xe;else if(Xe===H){const lt=Math.abs(Re-ie);lt<pe&&(ae=Re,pe=lt)}}H>B&&(ae-R>3&&Hr(G,R,ae,B),G[ae+2]=H,D-ae>3&&Hr(G,ae,D,B))}function Jn(G,R,D,B,H,ie){let ae=H-D,pe=ie-B;if(ae!==0||pe!==0){const ee=((G-D)*ae+(R-B)*pe)/(ae*ae+pe*pe);ee>1?(D=H,B=ie):ee>0&&(D+=ae*ee,B+=pe*ee)}return ae=G-D,pe=R-B,ae*ae+pe*pe}function Br(G,R,D,B){const H={id:G??null,type:R,geometry:D,tags:B,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(R==="Point"||R==="MultiPoint"||R==="LineString")Yn(H,D);else if(R==="Polygon")Yn(H,D[0]);else if(R==="MultiLineString")for(const ie of D)Yn(H,ie);else if(R==="MultiPolygon")for(const ie of D)Yn(H,ie[0]);return H}function Yn(G,R){for(let D=0;D<R.length;D+=3)G.minX=Math.min(G.minX,R[D]),G.minY=Math.min(G.minY,R[D+1]),G.maxX=Math.max(G.maxX,R[D]),G.maxY=Math.max(G.maxY,R[D+1])}function mi(G,R,D,B){if(!R.geometry)return;const H=R.geometry.coordinates;if(H&&H.length===0)return;const ie=R.geometry.type,ae=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2);let pe=[],ee=R.id;if(D.promoteId?ee=R.properties[D.promoteId]:D.generateId&&(ee=B||0),ie==="Point")us(H,pe);else if(ie==="MultiPoint")for(const ve of H)us(ve,pe);else if(ie==="LineString")xe(H,pe,ae,!1);else if(ie==="MultiLineString"){if(D.lineMetrics){for(const ve of H)pe=[],xe(ve,pe,ae,!1),G.push(Br(ee,"LineString",pe,R.properties));return}Xi(H,pe,ae,!1)}else if(ie==="Polygon")Xi(H,pe,ae,!0);else{if(ie!=="MultiPolygon"){if(ie==="GeometryCollection"){for(const ve of R.geometry.geometries)mi(G,{id:ee,geometry:ve,properties:R.properties},D,B);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ve of H){const Te=[];Xi(ve,Te,ae,!0),pe.push(Te)}}G.push(Br(ee,ie,pe,R.properties))}function us(G,R){R.push(cs(G[0]),Ft(G[1]),0)}function xe(G,R,D,B){let H,ie,ae=0;for(let ee=0;ee<G.length;ee++){const ve=cs(G[ee][0]),Te=Ft(G[ee][1]);R.push(ve,Te,0),ee>0&&(ae+=B?(H*Te-ve*ie)/2:Math.sqrt(Math.pow(ve-H,2)+Math.pow(Te-ie,2))),H=ve,ie=Te}const pe=R.length-3;R[2]=1,Hr(R,0,pe,D),R[pe+2]=1,R.size=Math.abs(ae),R.start=0,R.end=R.size}function Xi(G,R,D,B){for(let H=0;H<G.length;H++){const ie=[];xe(G[H],ie,D,B),R.push(ie)}}function cs(G){return G/360+.5}function Ft(G){const R=Math.sin(G*Math.PI/180),D=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return D<0?0:D>1?1:D}function gr(G,R,D,B,H,ie,ae,pe){if(B/=R,ie>=(D/=R)&&ae<B)return G;if(ae<D||ie>=B)return null;const ee=[];for(const ve of G){const Te=ve.geometry;let ye=ve.type;const Re=H===0?ve.minX:ve.minY,Xe=H===0?ve.maxX:ve.maxY;if(Re>=D&&Xe<B){ee.push(ve);continue}if(Xe<D||Re>=B)continue;let lt=[];if(ye==="Point"||ye==="MultiPoint")Ts(Te,lt,D,B,H);else if(ye==="LineString")gi(Te,lt,D,B,H,!1,pe.lineMetrics);else if(ye==="MultiLineString")it(Te,lt,D,B,H,!1);else if(ye==="Polygon")it(Te,lt,D,B,H,!0);else if(ye==="MultiPolygon")for(const Bt of Te){const St=[];it(Bt,St,D,B,H,!0),St.length&&lt.push(St)}if(lt.length){if(pe.lineMetrics&&ye==="LineString"){for(const Bt of lt)ee.push(Br(ve.id,ye,Bt,ve.tags));continue}ye!=="LineString"&&ye!=="MultiLineString"||(lt.length===1?(ye="LineString",lt=lt[0]):ye="MultiLineString"),ye!=="Point"&&ye!=="MultiPoint"||(ye=lt.length===3?"Point":"MultiPoint"),ee.push(Br(ve.id,ye,lt,ve.tags))}}return ee.length?ee:null}function Ts(G,R,D,B,H){for(let ie=0;ie<G.length;ie+=3){const ae=G[ie+H];ae>=D&&ae<=B&&Tt(R,G[ie],G[ie+1],G[ie+2])}}function gi(G,R,D,B,H,ie,ae){let pe=Qn(G);const ee=H===0?Ht:ut;let ve,Te,ye=G.start;for(let St=0;St<G.length-3;St+=3){const Nt=G[St],At=G[St+1],jr=G[St+2],vr=G[St+3],It=G[St+4],Kt=H===0?Nt:At,yr=H===0?vr:It;let Gr=!1;ae&&(ve=Math.sqrt(Math.pow(Nt-vr,2)+Math.pow(At-It,2))),Kt<D?yr>D&&(Te=ee(pe,Nt,At,vr,It,D),ae&&(pe.start=ye+ve*Te)):Kt>B?yr<B&&(Te=ee(pe,Nt,At,vr,It,B),ae&&(pe.start=ye+ve*Te)):Tt(pe,Nt,At,jr),yr<D&&Kt>=D&&(Te=ee(pe,Nt,At,vr,It,D),Gr=!0),yr>B&&Kt<=B&&(Te=ee(pe,Nt,At,vr,It,B),Gr=!0),!ie&&Gr&&(ae&&(pe.end=ye+ve*Te),R.push(pe),pe=Qn(G)),ae&&(ye+=ve)}let Re=G.length-3;const Xe=G[Re],lt=G[Re+1],Bt=H===0?Xe:lt;Bt>=D&&Bt<=B&&Tt(pe,Xe,lt,G[Re+2]),Re=pe.length-3,ie&&Re>=3&&(pe[Re]!==pe[0]||pe[Re+1]!==pe[1])&&Tt(pe,pe[0],pe[1],pe[2]),pe.length&&R.push(pe)}function Qn(G){const R=[];return R.size=G.size,R.start=G.start,R.end=G.end,R}function it(G,R,D,B,H,ie){for(const ae of G)gi(ae,R,D,B,H,ie,!1)}function Tt(G,R,D,B){G.push(R,D,B)}function Ht(G,R,D,B,H,ie){const ae=(ie-R)/(B-R);return Tt(G,ie,D+(H-D)*ae,1),ae}function ut(G,R,D,B,H,ie){const ae=(ie-D)/(H-D);return Tt(G,R+(B-R)*ae,ie,1),ae}function Ie(G,R){const D=[];for(let B=0;B<G.length;B++){const H=G[B],ie=H.type;let ae;if(ie==="Point"||ie==="MultiPoint"||ie==="LineString")ae=Vt(H.geometry,R);else if(ie==="MultiLineString"||ie==="Polygon"){ae=[];for(const pe of H.geometry)ae.push(Vt(pe,R))}else if(ie==="MultiPolygon"){ae=[];for(const pe of H.geometry){const ee=[];for(const ve of pe)ee.push(Vt(ve,R));ae.push(ee)}}D.push(Br(H.id,ie,ae,H.tags))}return D}function Vt(G,R){const D=[];D.size=G.size,G.start!==void 0&&(D.start=G.start,D.end=G.end);for(let B=0;B<G.length;B+=3)D.push(G[B]+R,G[B+1],G[B+2]);return D}function Ot(G,R){if(G.transformed)return G;const D=1<<G.z,B=G.x,H=G.y;for(const ie of G.features){const ae=ie.geometry,pe=ie.type;if(ie.geometry=[],pe===1)for(let ee=0;ee<ae.length;ee+=2)ie.geometry.push(lr(ae[ee],ae[ee+1],R,D,B,H));else for(let ee=0;ee<ae.length;ee++){const ve=[];for(let Te=0;Te<ae[ee].length;Te+=2)ve.push(lr(ae[ee][Te],ae[ee][Te+1],R,D,B,H));ie.geometry.push(ve)}}return G.transformed=!0,G}function lr(G,R,D,B,H,ie){return[Math.round(D*(G*B-H)),Math.round(D*(R*B-ie))]}function Nr(G,R,D,B,H){const ie=R===H.maxZoom?0:H.tolerance/((1<<R)*H.extent),ae={features:[],numPoints:0,numSimplified:0,numFeatures:G.length,source:null,x:D,y:B,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const pe of G)Me(ae,pe,ie,H);return ae}function Me(G,R,D,B){const H=R.geometry,ie=R.type,ae=[];if(G.minX=Math.min(G.minX,R.minX),G.minY=Math.min(G.minY,R.minY),G.maxX=Math.max(G.maxX,R.maxX),G.maxY=Math.max(G.maxY,R.maxY),ie==="Point"||ie==="MultiPoint")for(let pe=0;pe<H.length;pe+=3)ae.push(H[pe],H[pe+1]),G.numPoints++,G.numSimplified++;else if(ie==="LineString")yt(ae,H,G,D,!1,!1);else if(ie==="MultiLineString"||ie==="Polygon")for(let pe=0;pe<H.length;pe++)yt(ae,H[pe],G,D,ie==="Polygon",pe===0);else if(ie==="MultiPolygon")for(let pe=0;pe<H.length;pe++){const ee=H[pe];for(let ve=0;ve<ee.length;ve++)yt(ae,ee[ve],G,D,!0,ve===0)}if(ae.length){let pe=R.tags||null;if(ie==="LineString"&&B.lineMetrics){pe={};for(const ve in R.tags)pe[ve]=R.tags[ve];pe.mapbox_clip_start=H.start/H.size,pe.mapbox_clip_end=H.end/H.size}const ee={geometry:ae,type:ie==="Polygon"||ie==="MultiPolygon"?3:ie==="LineString"||ie==="MultiLineString"?2:1,tags:pe};R.id!==null&&(ee.id=R.id),G.features.push(ee)}}function yt(G,R,D,B,H,ie){const ae=B*B;if(B>0&&R.size<(H?ae:B))return void(D.numPoints+=R.length/3);const pe=[];for(let ee=0;ee<R.length;ee+=3)(B===0||R[ee+2]>ae)&&(D.numSimplified++,pe.push(R[ee],R[ee+1])),D.numPoints++;H&&function(ee,ve){let Te=0;for(let ye=0,Re=ee.length,Xe=Re-2;ye<Re;Xe=ye,ye+=2)Te+=(ee[ye]-ee[Xe])*(ee[ye+1]+ee[Xe+1]);if(Te>0===ve)for(let ye=0,Re=ee.length;ye<Re/2;ye+=2){const Xe=ee[ye],lt=ee[ye+1];ee[ye]=ee[Re-2-ye],ee[ye+1]=ee[Re-1-ye],ee[Re-2-ye]=Xe,ee[Re-1-ye]=lt}}(pe,ie),G.push(pe)}const st={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class _r{constructor(R,D){const B=(D=this.options=function(ie,ae){for(const pe in ae)ie[pe]=ae[pe];return ie}(Object.create(st),D)).debug;if(B&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");let H=function(ie,ae){const pe=[];if(ie.type==="FeatureCollection")for(let ee=0;ee<ie.features.length;ee++)mi(pe,ie.features[ee],ae,ee);else mi(pe,ie.type==="Feature"?ie:{geometry:ie},ae);return pe}(R,D);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),H=function(ie,ae){const pe=ae.buffer/ae.extent;let ee=ie;const ve=gr(ie,1,-1-pe,pe,0,-1,2,ae),Te=gr(ie,1,1-pe,2+pe,0,-1,2,ae);return(ve||Te)&&(ee=gr(ie,1,-pe,1+pe,0,-1,2,ae)||[],ve&&(ee=Ie(ve,1).concat(ee)),Te&&(ee=ee.concat(Ie(Te,-1)))),ee}(H,D),H.length&&this.splitTile(H,0,0,0),B&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(R,D,B,H,ie,ae,pe){const ee=[R,D,B,H],ve=this.options,Te=ve.debug;for(;ee.length;){H=ee.pop(),B=ee.pop(),D=ee.pop(),R=ee.pop();const ye=1<<D,Re=Ar(D,B,H);let Xe=this.tiles[Re];if(!Xe&&(Te>1&&console.time("creation"),Xe=this.tiles[Re]=Nr(R,D,B,H,ve),this.tileCoords.push({z:D,x:B,y:H}),Te)){Te>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,B,H,Xe.numFeatures,Xe.numPoints,Xe.numSimplified),console.timeEnd("creation"));const Gr=`z${D}`;this.stats[Gr]=(this.stats[Gr]||0)+1,this.total++}if(Xe.source=R,ie==null){if(D===ve.indexMaxZoom||Xe.numPoints<=ve.indexMaxPoints)continue}else{if(D===ve.maxZoom||D===ie)continue;if(ie!=null){const Gr=ie-D;if(B!==ae>>Gr||H!==pe>>Gr)continue}}if(Xe.source=null,R.length===0)continue;Te>1&&console.time("clipping");const lt=.5*ve.buffer/ve.extent,Bt=.5-lt,St=.5+lt,Nt=1+lt;let At=null,jr=null,vr=null,It=null,Kt=gr(R,ye,B-lt,B+St,0,Xe.minX,Xe.maxX,ve),yr=gr(R,ye,B+Bt,B+Nt,0,Xe.minX,Xe.maxX,ve);R=null,Kt&&(At=gr(Kt,ye,H-lt,H+St,1,Xe.minY,Xe.maxY,ve),jr=gr(Kt,ye,H+Bt,H+Nt,1,Xe.minY,Xe.maxY,ve),Kt=null),yr&&(vr=gr(yr,ye,H-lt,H+St,1,Xe.minY,Xe.maxY,ve),It=gr(yr,ye,H+Bt,H+Nt,1,Xe.minY,Xe.maxY,ve),yr=null),Te>1&&console.timeEnd("clipping"),ee.push(At||[],D+1,2*B,2*H),ee.push(jr||[],D+1,2*B,2*H+1),ee.push(vr||[],D+1,2*B+1,2*H),ee.push(It||[],D+1,2*B+1,2*H+1)}}getTile(R,D,B){R=+R,D=+D,B=+B;const H=this.options,{extent:ie,debug:ae}=H;if(R<0||R>24)return null;const pe=1<<R,ee=Ar(R,D=D+pe&pe-1,B);if(this.tiles[ee])return Ot(this.tiles[ee],ie);ae>1&&console.log("drilling down to z%d-%d-%d",R,D,B);let ve,Te=R,ye=D,Re=B;for(;!ve&&Te>0;)Te--,ye>>=1,Re>>=1,ve=this.tiles[Ar(Te,ye,Re)];return ve&&ve.source?(ae>1&&(console.log("found parent tile z%d-%d-%d",Te,ye,Re),console.time("drilling down")),this.splitTile(ve.source,Te,ye,Re,R,D,B),ae>1&&console.timeEnd("drilling down"),this.tiles[ee]?Ot(this.tiles[ee],ie):null):null}}function Ar(G,R,D){return 32*((1<<G)*D+R)+G}function ht(G,R){return R?G.properties[R]:G.id}function Gt(G,R){if(G==null)return!0;if(G.type==="Feature")return ht(G,R)!=null;if(G.type==="FeatureCollection"){const D=new Set;for(const B of G.features){const H=ht(B,R);if(H==null||D.has(H))return!1;D.add(H)}return!0}return!1}function Tn(G,R){const D=new Map;if(G!=null)if(G.type==="Feature")D.set(ht(G,R),G);else for(const B of G.features)D.set(ht(B,R),B);return D}class Bn extends q{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(R,D){return v._(this,void 0,void 0,function*(){const B=R.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const H=this._geoJSONIndex.getTile(B.z,B.x,B.y);if(!H)return null;const ie=new class{constructor(pe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.X,this.length=pe.length,this._features=pe}feature(pe){return new class{constructor(ee){this._feature=ee,this.extent=v.X,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))}loadGeometry(){if(this._feature.type===1){const ee=[];for(const ve of this._feature.geometry)ee.push([new v.P(ve[0],ve[1])]);return ee}{const ee=[];for(const ve of this._feature.geometry){const Te=[];for(const ye of ve)Te.push(new v.P(ye[0],ye[1]));ee.push(Te)}return ee}}toGeoJSON(ee,ve,Te){return Pe.call(this,ee,ve,Te)}}(this._features[pe])}}(H.features);let ae=Or(ie);return ae.byteOffset===0&&ae.byteLength===ae.buffer.byteLength||(ae=new Uint8Array(ae)),{vectorTile:ie,rawData:ae.buffer}})}loadData(R){return v._(this,void 0,void 0,function*(){var D;(D=this._pendingRequest)===null||D===void 0||D.abort();const B=!!(R&&R.request&&R.request.collectResourceTiming)&&new v.bv(R.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(R,this._pendingRequest),this._geoJSONIndex=R.cluster?new mr(function({superclusterOptions:ae,clusterProperties:pe}){if(!pe||!ae)return ae;const ee={},ve={},Te={accumulated:null,zoom:0},ye={properties:null},Re=Object.keys(pe);for(const Xe of Re){const[lt,Bt]=pe[Xe],St=v.bC(Bt),Nt=v.bC(typeof lt=="string"?[lt,["accumulated"],["get",Xe]]:lt);ee[Xe]=St.value,ve[Xe]=Nt.value}return ae.map=Xe=>{ye.properties=Xe;const lt={};for(const Bt of Re)lt[Bt]=ee[Bt].evaluate(Te,ye);return lt},ae.reduce=(Xe,lt)=>{ye.properties=lt;for(const Bt of Re)Te.accumulated=Xe[Bt],Xe[Bt]=ve[Bt].evaluate(Te,ye)},ae}(R)).load((yield this._pendingData).features):(H=yield this._pendingData,new _r(H,R.geojsonVtOptions)),this.loaded={};const ie={};if(B){const ae=B.finish();ae&&(ie.resourceTiming={},ie.resourceTiming[R.source]=JSON.parse(JSON.stringify(ae)))}return ie}catch(ie){if(delete this._pendingRequest,v.bB(ie))return{abandoned:!0};throw ie}var H})}getData(){return v._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(R){const D=this.loaded;return D&&D[R.uid]?super.reloadTile(R):this.loadTile(R)}loadAndProcessGeoJSON(R,D){return v._(this,void 0,void 0,function*(){let B=yield this.loadGeoJSON(R,D);if(delete this._pendingRequest,typeof B!="object")throw new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`);if(_e(B,!0),R.filter){const H=v.bC(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(H.result==="error")throw new Error(H.value.map(ae=>`${ae.key}: ${ae.message}`).join(", "));B={type:"FeatureCollection",features:B.features.filter(ae=>H.value.evaluate({zoom:0},ae))}}return B})}loadGeoJSON(R,D){return v._(this,void 0,void 0,function*(){const{promoteId:B}=R;if(R.request){const H=yield v.h(R.request,D);return this._dataUpdateable=Gt(H.data,B)?Tn(H.data,B):void 0,H.data}if(typeof R.data=="string")try{const H=JSON.parse(R.data);return this._dataUpdateable=Gt(H,B)?Tn(H,B):void 0,H}catch{throw new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`)}if(!R.dataDiff)throw new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${R.source}`);return function(H,ie,ae){var pe,ee,ve,Te;if(ie.removeAll&&H.clear(),ie.remove)for(const ye of ie.remove)H.delete(ye);if(ie.add)for(const ye of ie.add){const Re=ht(ye,ae);Re!=null&&H.set(Re,ye)}if(ie.update)for(const ye of ie.update){let Re=H.get(ye.id);if(Re==null)continue;const Xe=!ye.removeAllProperties&&(((pe=ye.removeProperties)===null||pe===void 0?void 0:pe.length)>0||((ee=ye.addOrUpdateProperties)===null||ee===void 0?void 0:ee.length)>0);if((ye.newGeometry||ye.removeAllProperties||Xe)&&(Re=Object.assign({},Re),H.set(ye.id,Re),Xe&&(Re.properties=Object.assign({},Re.properties))),ye.newGeometry&&(Re.geometry=ye.newGeometry),ye.removeAllProperties)Re.properties={};else if(((ve=ye.removeProperties)===null||ve===void 0?void 0:ve.length)>0)for(const lt of ye.removeProperties)Object.prototype.hasOwnProperty.call(Re.properties,lt)&&delete Re.properties[lt];if(((Te=ye.addOrUpdateProperties)===null||Te===void 0?void 0:Te.length)>0)for(const{key:lt,value:Bt}of ye.addOrUpdateProperties)Re.properties[lt]=Bt}}(this._dataUpdateable,R.dataDiff,B),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(R){return v._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(R){return this._geoJSONIndex.getClusterExpansionZoom(R.clusterId)}getClusterChildren(R){return this._geoJSONIndex.getChildren(R.clusterId)}getClusterLeaves(R){return this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset)}}class fn{constructor(R){this.self=R,this.actor=new v.F(R),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(D,B)=>{if(this.externalWorkerSourceTypes[D])throw new Error(`Worker source with name "${D}" already registered.`);this.externalWorkerSourceTypes[D]=B},this.self.addProtocol=v.bi,this.self.removeProtocol=v.bj,this.self.registerRTLTextPlugin=D=>{if(v.bD.isParsed())throw new Error("RTL text plugin already registered.");v.bD.setMethods(D)},this.actor.registerMessageHandler("LDT",(D,B)=>this._getDEMWorkerSource(D,B.source).loadTile(B)),this.actor.registerMessageHandler("RDT",(D,B)=>v._(this,void 0,void 0,function*(){this._getDEMWorkerSource(D,B.source).removeTile(B)})),this.actor.registerMessageHandler("GCEZ",(D,B)=>v._(this,void 0,void 0,function*(){return this._getWorkerSource(D,B.type,B.source).getClusterExpansionZoom(B)})),this.actor.registerMessageHandler("GCC",(D,B)=>v._(this,void 0,void 0,function*(){return this._getWorkerSource(D,B.type,B.source).getClusterChildren(B)})),this.actor.registerMessageHandler("GCL",(D,B)=>v._(this,void 0,void 0,function*(){return this._getWorkerSource(D,B.type,B.source).getClusterLeaves(B)})),this.actor.registerMessageHandler("LD",(D,B)=>this._getWorkerSource(D,B.type,B.source).loadData(B)),this.actor.registerMessageHandler("GD",(D,B)=>this._getWorkerSource(D,B.type,B.source).getData()),this.actor.registerMessageHandler("LT",(D,B)=>this._getWorkerSource(D,B.type,B.source).loadTile(B)),this.actor.registerMessageHandler("RT",(D,B)=>this._getWorkerSource(D,B.type,B.source).reloadTile(B)),this.actor.registerMessageHandler("AT",(D,B)=>this._getWorkerSource(D,B.type,B.source).abortTile(B)),this.actor.registerMessageHandler("RMT",(D,B)=>this._getWorkerSource(D,B.type,B.source).removeTile(B)),this.actor.registerMessageHandler("RS",(D,B)=>v._(this,void 0,void 0,function*(){if(!this.workerSources[D]||!this.workerSources[D][B.type]||!this.workerSources[D][B.type][B.source])return;const H=this.workerSources[D][B.type][B.source];delete this.workerSources[D][B.type][B.source],H.removeSource!==void 0&&H.removeSource(B)})),this.actor.registerMessageHandler("RM",D=>v._(this,void 0,void 0,function*(){delete this.layerIndexes[D],delete this.availableImages[D],delete this.workerSources[D],delete this.demWorkerSources[D]})),this.actor.registerMessageHandler("SR",(D,B)=>v._(this,void 0,void 0,function*(){this.referrer=B})),this.actor.registerMessageHandler("SRPS",(D,B)=>this._syncRTLPluginState(D,B)),this.actor.registerMessageHandler("IS",(D,B)=>v._(this,void 0,void 0,function*(){this.self.importScripts(B)})),this.actor.registerMessageHandler("SI",(D,B)=>this._setImages(D,B)),this.actor.registerMessageHandler("UL",(D,B)=>v._(this,void 0,void 0,function*(){this._getLayerIndex(D).update(B.layers,B.removedIds)})),this.actor.registerMessageHandler("SL",(D,B)=>v._(this,void 0,void 0,function*(){this._getLayerIndex(D).replace(B)}))}_setImages(R,D){return v._(this,void 0,void 0,function*(){this.availableImages[R]=D;for(const B in this.workerSources[R]){const H=this.workerSources[R][B];for(const ie in H)H[ie].availableImages=D}})}_syncRTLPluginState(R,D){return v._(this,void 0,void 0,function*(){if(v.bD.isParsed())return v.bD.getState();if(D.pluginStatus!=="loading")return v.bD.setState(D),D;const B=D.pluginURL;if(this.self.importScripts(B),v.bD.isParsed()){const H={pluginStatus:"loaded",pluginURL:B};return v.bD.setState(H),H}throw v.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${B}`)})}_getAvailableImages(R){let D=this.availableImages[R];return D||(D=[]),D}_getLayerIndex(R){let D=this.layerIndexes[R];return D||(D=this.layerIndexes[R]=new d),D}_getWorkerSource(R,D,B){if(this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][D]||(this.workerSources[R][D]={}),!this.workerSources[R][D][B]){const H={sendAsync:(ie,ae)=>(ie.targetMapId=R,this.actor.sendAsync(ie,ae))};switch(D){case"vector":this.workerSources[R][D][B]=new q(H,this._getLayerIndex(R),this._getAvailableImages(R));break;case"geojson":this.workerSources[R][D][B]=new Bn(H,this._getLayerIndex(R),this._getAvailableImages(R));break;default:this.workerSources[R][D][B]=new this.externalWorkerSourceTypes[D](H,this._getLayerIndex(R),this._getAvailableImages(R))}}return this.workerSources[R][D][B]}_getDEMWorkerSource(R,D){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][D]||(this.demWorkerSources[R][D]=new U),this.demWorkerSources[R][D]}}return v.i(self)&&(self.worker=new fn(self)),fn}),_("index",["exports","./shared"],function(v,d){var N="4.7.1";let Z,te;const q={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:m=>new Promise((e,o)=>{const u=requestAnimationFrame(e);m.signal.addEventListener("abort",()=>{cancelAnimationFrame(u),o(d.c())})}),getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){const e=window.document.createElement("canvas"),o=e.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,o.drawImage(m,0,0,m.width,m.height),o},resolveURL:m=>(Z||(Z=document.createElement("a")),Z.href=m,Z.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(te==null&&(te=matchMedia("(prefers-reduced-motion: reduce)")),te.matches)}};class U{static testProp(e){if(!U.docStyle)return e[0];for(let o=0;o<e.length;o++)if(e[o]in U.docStyle)return e[o];return e[0]}static create(e,o,u){const c=window.document.createElement(e);return o!==void 0&&(c.className=o),u&&u.appendChild(c),c}static createNS(e,o){return window.document.createElementNS(e,o)}static disableDrag(){U.docStyle&&U.selectProp&&(U.userSelect=U.docStyle[U.selectProp],U.docStyle[U.selectProp]="none")}static enableDrag(){U.docStyle&&U.selectProp&&(U.docStyle[U.selectProp]=U.userSelect)}static setTransform(e,o){e.style[U.transformProp]=o}static addEventListener(e,o,u,c={}){e.addEventListener(o,u,"passive"in c?c:c.capture)}static removeEventListener(e,o,u,c={}){e.removeEventListener(o,u,"passive"in c?c:c.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",U.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",U.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",U.suppressClickInternal,!0)},0)}static getScale(e){const o=e.getBoundingClientRect();return{x:o.width/e.offsetWidth||1,y:o.height/e.offsetHeight||1,boundingClientRect:o}}static getPoint(e,o,u){const c=o.boundingClientRect;return new d.P((u.clientX-c.left)/o.x-e.clientLeft,(u.clientY-c.top)/o.y-e.clientTop)}static mousePos(e,o){const u=U.getScale(e);return U.getPoint(e,u,o)}static touchPos(e,o){const u=[],c=U.getScale(e);for(let f=0;f<o.length;f++)u.push(U.getPoint(e,c,o[f]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}U.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,U.selectProp=U.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),U.transformProp=U.testProp(["transform","WebkitTransform"]);const ke={supported:!1,testSupport:function(m){!Pe&&_e&&(oe?re(m):ue=m)}};let ue,_e,Pe=!1,oe=!1;function re(m){const e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,_e),m.isContextLost())return;ke.supported=!0}catch{}m.deleteTexture(e),Pe=!0}var ce;typeof document<"u"&&(_e=document.createElement("img"),_e.onload=()=>{ue&&re(ue),ue=null,oe=!0},_e.onerror=()=>{Pe=!0,ue=null},_e.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let e,o,u,c;m.resetRequestQueue=()=>{e=[],o=0,u=0,c={}},m.addThrottleControl=E=>{const C=u++;return c[C]=E,C},m.removeThrottleControl=E=>{delete c[E],w()},m.getImage=(E,C,A=!0)=>new Promise((M,F)=>{ke.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*"),d.e(E,{type:"image"}),e.push({abortController:C,requestParameters:E,supportImageRefresh:A,state:"queued",onError:V=>{F(V)},onSuccess:V=>{M(V)}}),w()});const f=E=>d._(this,void 0,void 0,function*(){E.state="running";const{requestParameters:C,supportImageRefresh:A,onError:M,onSuccess:F,abortController:V}=E,$=A===!1&&!d.i(self)&&!d.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce((Q,ne)=>Q&&ne==="accept",!0));o++;const K=$?S(C,V):d.m(C,V);try{const Q=yield K;delete E.abortController,E.state="completed",Q.data instanceof HTMLImageElement||d.b(Q.data)?F(Q):Q.data&&F({data:yield(Y=Q.data,typeof createImageBitmap=="function"?d.d(Y):d.f(Y)),cacheControl:Q.cacheControl,expires:Q.expires})}catch(Q){delete E.abortController,M(Q)}finally{o--,w()}var Y}),w=()=>{const E=(()=>{for(const C of Object.keys(c))if(c[C]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=o;C<E&&e.length>0;C++){const A=e.shift();A.abortController.signal.aborted?C--:f(A)}},S=(E,C)=>new Promise((A,M)=>{const F=new Image,V=E.url,$=E.credentials;$&&$==="include"?F.crossOrigin="use-credentials":($&&$==="same-origin"||!d.s(V))&&(F.crossOrigin="anonymous"),C.signal.addEventListener("abort",()=>{F.src="",M(d.c())}),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,A({data:F})},F.onerror=()=>{F.onerror=F.onload=null,C.signal.aborted||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=V})}(ce||(ce={})),ce.resetRequestQueue();class Ce{constructor(e){this._transformRequestFn=e}transformRequest(e,o){return this._transformRequestFn&&this._transformRequestFn(e,o)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function De(m){var e=new d.A(3);return e[0]=m[0],e[1]=m[1],e[2]=m[2],e}var Ue,Oe=function(m,e,o){return m[0]=e[0]-o[0],m[1]=e[1]-o[1],m[2]=e[2]-o[2],m};Ue=new d.A(3),d.A!=Float32Array&&(Ue[0]=0,Ue[1]=0,Ue[2]=0);var Qe=function(m){var e=m[0],o=m[1];return e*e+o*o};function _t(m){const e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){const o=[];for(const{id:u,url:c}of m){const f=`${u}${c}`;o.indexOf(f)===-1&&(o.push(f),e.push({id:u,url:c}))}}return e}function mt(m,e,o){const u=m.split("?");return u[0]+=`${e}${o}`,u.join("?")}(function(){var m=new d.A(2);d.A!=Float32Array&&(m[0]=0,m[1]=0)})();class pt{constructor(e,o,u,c){this.context=e,this.format=u,this.texture=e.gl.createTexture(),this.update(o,c)}update(e,o,u){const{width:c,height:f}=e,w=!(this.size&&this.size[0]===c&&this.size[1]===f||u),{context:S}=this,{gl:E}=S;if(this.useMipmap=!!(o&&o.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!o||o.premultiply!==!1)),w)this.size=[c,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,e):E.texImage2D(E.TEXTURE_2D,0,this.format,c,f,0,this.format,E.UNSIGNED_BYTE,e.data);else{const{x:C,y:A}=u||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?E.texSubImage2D(E.TEXTURE_2D,0,C,A,E.RGBA,E.UNSIGNED_BYTE,e):E.texSubImage2D(E.TEXTURE_2D,0,C,A,c,f,E.RGBA,E.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(e,o,u){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),u!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,u||e),this.filter=e),o!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Xt(m){const{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class Dt extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:o,promiseResolve:u}of this.requestors)u(this._getImagesForIds(o));this.requestors=[]}}getImage(e){const o=this.images[e];if(o&&!o.data&&o.spriteData){const u=o.spriteData;o.data=new d.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),o.spriteData=null}return o}addImage(e,o){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,o)&&(this.images[e]=o)}_validate(e,o){let u=!0;const c=o.data||o.spriteData;return this._validateStretch(o.stretchX,c&&c.width)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(o.stretchY,c&&c.height)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(o.content,o)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,o){if(!e)return!0;let u=0;for(const c of e){if(c[0]<u||c[1]<c[0]||o<c[1])return!1;u=c[1]}return!0}_validateContent(e,o){if(!e)return!0;if(e.length!==4)return!1;const u=o.spriteData,c=u&&u.width||o.data.width,f=u&&u.height||o.data.height;return!(e[0]<0||c<e[0]||e[1]<0||f<e[1]||e[2]<0||c<e[2]||e[3]<0||f<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,o,u=!0){const c=this.getImage(e);if(u&&(c.data.width!==o.data.width||c.data.height!==o.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=c.version+1,this.images[e]=o,this.updatedImages[e]=!0}removeImage(e){const o=this.images[e];delete this.images[e],delete this.patterns[e],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((o,u)=>{let c=!0;if(!this.isLoaded())for(const f of e)this.images[f]||(c=!1);this.isLoaded()||c?o(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:o})})}_getImagesForIds(e){const o={};for(const u of e){let c=this.getImage(u);c||(this.fire(new d.k("styleimagemissing",{id:u})),c=this.getImage(u)),c?o[u]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,textFitWidth:c.textFitWidth,textFitHeight:c.textFitHeight,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:d.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:e,height:o}=this.atlasImage;return{width:e,height:o}}getPattern(e){const o=this.patterns[e],u=this.getImage(e);if(!u)return null;if(o&&o.position.version===u.version)return o.position;if(o)o.position.version=u.version;else{const c={w:u.data.width+2,h:u.data.height+2,x:0,y:0},f=new d.I(c,u);this.patterns[e]={bin:c,position:f}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const o=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new pt(e,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const f in this.patterns)e.push(this.patterns[f].bin);const{w:o,h:u}=d.p(e),c=this.atlasImage;c.resize({width:o||1,height:u||1});for(const f in this.patterns){const{bin:w}=this.patterns[f],S=w.x+1,E=w.y+1,C=this.getImage(f).data,A=C.width,M=C.height;d.R.copy(C,c,{x:0,y:0},{x:S,y:E},{width:A,height:M}),d.R.copy(C,c,{x:0,y:M-1},{x:S,y:E-1},{width:A,height:1}),d.R.copy(C,c,{x:0,y:0},{x:S,y:E+M},{width:A,height:1}),d.R.copy(C,c,{x:A-1,y:0},{x:S-1,y:E},{width:1,height:M}),d.R.copy(C,c,{x:0,y:0},{x:S+A,y:E},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const o of e){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const u=this.getImage(o);u||d.w(`Image with ID: "${o}" was not found`),Xt(u)&&this.updateImage(o,u)}}}const Lt=1e20;function fr(m,e,o,u,c,f,w,S,E){for(let C=e;C<e+u;C++)nr(m,o*f+C,f,c,w,S,E);for(let C=o;C<o+c;C++)nr(m,C*f+e,1,u,w,S,E)}function nr(m,e,o,u,c,f,w){f[0]=0,w[0]=-Lt,w[1]=Lt,c[0]=m[e];for(let S=1,E=0,C=0;S<u;S++){c[S]=m[e+S*o];const A=S*S;do{const M=f[E];C=(c[S]-c[M]+A-M*M)/(S-M)/2}while(C<=w[E]&&--E>-1);E++,f[E]=S,w[E]=C,w[E+1]=Lt}for(let S=0,E=0;S<u;S++){for(;w[E+1]<S;)E++;const C=f[E],A=S-C;m[e+S*o]=c[C]+A*A}}class Or{constructor(e,o){this.requestManager=e,this.localIdeographFontFamily=o,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return d._(this,void 0,void 0,function*(){const o=[];for(const f in e)for(const w of e[f])o.push(this._getAndCacheGlyphsPromise(f,w));const u=yield Promise.all(o),c={};for(const{stack:f,id:w,glyph:S}of u)c[f]||(c[f]={}),c[f][w]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return c})}_getAndCacheGlyphsPromise(e,o){return d._(this,void 0,void 0,function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let c=u.glyphs[o];if(c!==void 0)return{stack:e,id:o,glyph:c};if(c=this._tinySDF(u,e,o),c)return u.glyphs[o]=c,{stack:e,id:o,glyph:c};const f=Math.floor(o/256);if(256*f>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[f])return{stack:e,id:o,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[f]){const S=Or.loadGlyphRange(e,f,this.url,this.requestManager);u.requests[f]=S}const w=yield u.requests[f];for(const S in w)this._doesCharSupportLocalGlyph(+S)||(u.glyphs[+S]=w[+S]);return u.ranges[f]=!0,{stack:e,id:o,glyph:w[o]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,o,u){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(u))return;let f=e.tinySDF;if(!f){let S="400";/bold/i.test(o)?S="900":/medium/i.test(o)?S="500":/light/i.test(o)&&(S="200"),f=e.tinySDF=new Or.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:S})}const w=f.draw(String.fromCharCode(u));return{id:u,bitmap:new d.o({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}}Or.loadGlyphRange=function(m,e,o,u){return d._(this,void 0,void 0,function*(){const c=256*e,f=c+255,w=u.transformRequest(o.replace("{fontstack}",m).replace("{range}",`${c}-${f}`),"Glyphs"),S=yield d.l(w,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${e}, ${c}-${f}`);const E={};for(const C of d.n(S.data))E[C.id]=C;return E})},Or.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:o=8,cutoff:u=.25,fontFamily:c="sans-serif",fontWeight:f="normal",fontStyle:w="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=o;const S=this.size=m+4*e,E=this._createCanvas(S),C=this.ctx=E.getContext("2d",{willReadFrequently:!0});C.font=`${w} ${f} ${m}px ${c}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(m){const e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){const{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:c,actualBoundingBoxRight:f}=this.ctx.measureText(m),w=Math.ceil(o),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-c))),E=Math.min(this.size-this.buffer,w+Math.ceil(u)),C=S+2*this.buffer,A=E+2*this.buffer,M=Math.max(C*A,0),F=new Uint8ClampedArray(M),V={data:F,width:C,height:A,glyphWidth:S,glyphHeight:E,glyphTop:w,glyphLeft:0,glyphAdvance:e};if(S===0||E===0)return V;const{ctx:$,buffer:K,gridInner:Y,gridOuter:Q}=this;$.clearRect(K,K,S,E),$.fillText(m,K,K+w);const ne=$.getImageData(K,K,S,E);Q.fill(Lt,0,M),Y.fill(0,0,M);for(let W=0;W<E;W++)for(let le=0;le<S;le++){const de=ne.data[4*(W*S+le)+3]/255;if(de===0)continue;const ge=(W+K)*C+le+K;if(de===1)Q[ge]=0,Y[ge]=Lt;else{const Ee=.5-de;Q[ge]=Ee>0?Ee*Ee:0,Y[ge]=Ee<0?Ee*Ee:0}}fr(Q,0,0,C,A,C,this.f,this.v,this.z),fr(Y,K,K,S,E,C,this.f,this.v,this.z);for(let W=0;W<M;W++){const le=Math.sqrt(Q[W])-Math.sqrt(Y[W]);F[W]=Math.round(255-255*(le/this.radius+this.cutoff))}return V}};class Ze{constructor(){this.specification=d.v.light.position}possiblyEvaluate(e,o){return d.x(e.expression.evaluate(o))}interpolate(e,o,u){return{x:d.y.number(e.x,o.x,u),y:d.y.number(e.y,o.y,u),z:d.y.number(e.z,o.z,u)}}}let ft;class gt extends d.E{constructor(e){super(),ft=ft||new d.q({anchor:new d.D(d.v.light.anchor),position:new Ze,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.T(ft),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,o={}){if(!this._validate(d.r,e,o))for(const u in e){const c=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),c):this._transitionable.setValue(u,c)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,u){return(!u||u.validate!==!1)&&d.t(this,e.call(d.u,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}const wt=new d.q({"sky-color":new d.D(d.v.sky["sky-color"]),"horizon-color":new d.D(d.v.sky["horizon-color"]),"fog-color":new d.D(d.v.sky["fog-color"]),"fog-ground-blend":new d.D(d.v.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.v.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.v.sky["atmosphere-blend"])});class Pt extends d.E{constructor(e){super(),this._transitionable=new d.T(wt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.z(0))}setSky(e,o={}){if(!this._validate(d.B,e,o)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in e){const c=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),c):this._transitionable.setValue(u,c)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,u={}){return(u==null?void 0:u.validate)!==!1&&d.t(this,e.call(d.u,d.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:d.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class ar{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,o){const u=e.join(",")+String(o);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,o)),this.dashEntry[u]}getDashRanges(e,o,u){const c=[];let f=e.length%2==1?-e[e.length-1]*u:0,w=e[0]*u,S=!0;c.push({left:f,right:w,isDash:S,zeroLength:e[0]===0});let E=e[0];for(let C=1;C<e.length;C++){S=!S;const A=e[C];f=E*u,E+=A,w=E*u,c.push({left:f,right:w,isDash:S,zeroLength:A===0})}return c}addRoundDash(e,o,u){const c=o/2;for(let f=-u;f<=u;f++){const w=this.width*(this.nextRow+u+f);let S=0,E=e[S];for(let C=0;C<this.width;C++){C/E.right>1&&(E=e[++S]);const A=Math.abs(C-E.left),M=Math.abs(C-E.right),F=Math.min(A,M);let V;const $=f/u*(c+1);if(E.isDash){const K=c-Math.abs($);V=Math.sqrt(F*F+K*K)}else V=c-Math.sqrt(F*F+$*$);this.data[w+C]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(e){for(let S=e.length-1;S>=0;--S){const E=e[S],C=e[S+1];E.zeroLength?e.splice(S,1):C&&C.isDash===E.isDash&&(C.left=E.left,e.splice(S,1))}const o=e[0],u=e[e.length-1];o.isDash===u.isDash&&(o.left=u.left-this.width,u.right=o.right+this.width);const c=this.width*this.nextRow;let f=0,w=e[f];for(let S=0;S<this.width;S++){S/w.right>1&&(w=e[++f]);const E=Math.abs(S-w.left),C=Math.abs(S-w.right),A=Math.min(E,C);this.data[c+S]=Math.max(0,Math.min(255,(w.isDash?A:-A)+128))}}addDash(e,o){const u=o?7:0,c=2*u+1;if(this.nextRow+c>this.height)return d.w("LineAtlas out of space"),null;let f=0;for(let S=0;S<e.length;S++)f+=e[S];if(f!==0){const S=this.width/f,E=this.getDashRanges(e,this.width,S);o?this.addRoundDash(E,S,u):this.addRegularDash(E)}const w={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:f};return this.nextRow+=c,this.dirty=!0,w}bind(e){const o=e.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}const mr="maplibre_preloaded_worker_pool";class Cr{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Cr.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[mr]}numActive(){return Object.keys(this.active).length}}const Yt=Math.floor(q.hardwareConcurrency/2);let Pr,Sn;function Wi(){return Pr||(Pr=new Cr),Pr}Cr.workerCount=d.C(globalThis)?Math.max(Math.min(Yt,3),1):1;class Hr{constructor(e,o){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=o;const u=this.workerPool.acquire(o);for(let c=0;c<u.length;c++){const f=new d.F(u[c],o);f.name=`Worker ${c}`,this.actors.push(f)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,o){const u=[];for(const c of this.actors)u.push(c.sendAsync({type:e,data:o}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,o){for(const u of this.actors)u.registerMessageHandler(e,o)}}function Jn(){return Sn||(Sn=new Hr(Wi(),d.G),Sn.registerMessageHandler("GR",(m,e,o)=>d.m(e,o))),Sn}function Br(m,e){const o=d.H();return d.J(o,o,[1,1,0]),d.K(o,o,[.5*m.width,.5*m.height,1]),d.L(o,o,m.calculatePosMatrix(e.toUnwrapped()))}function Yn(m,e,o,u,c,f){const w=function(M,F,V){if(M)for(const $ of M){const K=F[$];if(K&&K.source===V&&K.type==="fill-extrusion")return!0}else for(const $ in F){const K=F[$];if(K.source===V&&K.type==="fill-extrusion")return!0}return!1}(c&&c.layers,e,m.id),S=f.maxPitchScaleFactor(),E=m.tilesIn(u,S,w);E.sort(mi);const C=[];for(const M of E)C.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(e,o,m._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,c,f,S,Br(m.transform,M.tileID))});const A=function(M){const F={},V={};for(const $ of M){const K=$.queryResults,Y=$.wrappedTileID,Q=V[Y]=V[Y]||{};for(const ne in K){const W=K[ne],le=Q[ne]=Q[ne]||{},de=F[ne]=F[ne]||[];for(const ge of W)le[ge.featureIndex]||(le[ge.featureIndex]=!0,de.push(ge))}}return F}(C);for(const M in A)A[M].forEach(F=>{const V=F.feature,$=m.getFeatureState(V.layer["source-layer"],V.id);V.source=V.layer.source,V.layer["source-layer"]&&(V.sourceLayer=V.layer["source-layer"]),V.state=$});return A}function mi(m,e){const o=m.tileID,u=e.tileID;return o.overscaledZ-u.overscaledZ||o.canonical.y-u.canonical.y||o.wrap-u.wrap||o.canonical.x-u.canonical.x}function us(m,e,o){return d._(this,void 0,void 0,function*(){let u=m;if(m.url?u=(yield d.h(e.transformRequest(m.url,"Source"),o)).data:yield q.frameAsync(o),!u)return null;const c=d.M(d.e(u,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(c.vectorLayerIds=u.vector_layers.map(f=>f.id)),c})}class xe{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}extend(e){const o=this._sw,u=this._ne;let c,f;if(e instanceof d.N)c=e,f=e;else{if(!(e instanceof xe))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(xe.convert(e)):this.extend(d.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.N.convert(e)):this;if(c=e._sw,f=e._ne,!c||!f)return this}return o||u?(o.lng=Math.min(c.lng,o.lng),o.lat=Math.min(c.lat,o.lat),u.lng=Math.max(f.lng,u.lng),u.lat=Math.max(f.lat,u.lat)):(this._sw=new d.N(c.lng,c.lat),this._ne=new d.N(f.lng,f.lat)),this}getCenter(){return new d.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.N(this.getWest(),this.getNorth())}getSouthEast(){return new d.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:o,lat:u}=d.N.convert(e);let c=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&c}static convert(e){return e instanceof xe?e:e&&new xe(e)}static fromLngLat(e,o=0){const u=360*o/40075017,c=u/Math.cos(Math.PI/180*e.lat);return new xe(new d.N(e.lng-c,e.lat-u),new d.N(e.lng+c,e.lat+u))}adjustAntiMeridian(){const e=new d.N(this._sw.lng,this._sw.lat),o=new d.N(this._ne.lng,this._ne.lat);return new xe(e,e.lng>o.lng?new d.N(o.lng+360,o.lat):o)}}class Xi{constructor(e,o,u){this.bounds=xe.convert(this.validateBounds(e)),this.minzoom=o||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const o=Math.pow(2,e.z),u=Math.floor(d.O(this.bounds.getWest())*o),c=Math.floor(d.Q(this.bounds.getNorth())*o),f=Math.ceil(d.O(this.bounds.getEast())*o),w=Math.ceil(d.Q(this.bounds.getSouth())*o);return e.x>=u&&e.x<f&&e.y>=c&&e.y<w}}class cs extends d.E{constructor(e,o,u,c){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.M(o,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield us(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(d.e(this,e),e.bounds&&(this.tileBounds=new Xi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(o,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};u.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((f,w)=>{e.reloadPromise={resolve:f,reject:w}})}else e.actor=this.dispatcher.getActor(),c="LT";e.abortController=new AbortController;try{const f=yield e.actor.sendAsync({type:c,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,f)}catch(f){if(delete e.abortController,e.aborted)return;if(f&&f.status!==404)throw f;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,o){if(o&&o.resourceTiming&&(e.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&e.setExpiryData(o),e.loadVectorData(o,this.map.painter),e.reloadPromise){const u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ft extends d.E{constructor(e,o,u,c){super(),this.id=e,this.dispatcher=u,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},o),d.e(this,d.M(o,["url","scheme","tileSize"]))}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield us(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(d.e(this,e),e.bounds&&(this.tileBounds=new Xi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return d.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const u=yield ce.getImage(this.map._requestManager.transformRequest(o,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const c=this.map.painter.context,f=c.gl,w=u.data;e.texture=this.map.painter.getTileTexture(w.width),e.texture?e.texture.update(w,{useMipmap:!0}):(e.texture=new pt(c,w,f.RGBA,{useMipmap:!0}),e.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class gr extends Ft{constructor(e,o,u,c){super(e,o,u,c),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(o,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const c=yield ce.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){const f=c.data;this.map._refreshExpiredTiles&&c.cacheControl&&c.expires&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const w=d.b(f)&&d.U()?f:yield this.readImageNow(f),S={type:this.type,uid:e.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const E=yield e.actor.sendAsync({type:"LDT",data:S});e.dem=E,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}})}readImageNow(e){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.V()){const o=e.width+2,u=e.height+2;try{return new d.R({width:o,height:u},yield d.W(e,-1,-1,o,u))}catch{}}return q.getImageData(e,1)})}_getNeighboringTiles(e){const o=e.canonical,u=Math.pow(2,o.z),c=(o.x-1+u)%u,f=o.x===0?e.wrap-1:e.wrap,w=(o.x+1+u)%u,S=o.x+1===u?e.wrap+1:e.wrap,E={};return E[new d.S(e.overscaledZ,f,o.z,c,o.y).key]={backfilled:!1},E[new d.S(e.overscaledZ,S,o.z,w,o.y).key]={backfilled:!1},o.y>0&&(E[new d.S(e.overscaledZ,f,o.z,c,o.y-1).key]={backfilled:!1},E[new d.S(e.overscaledZ,e.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},E[new d.S(e.overscaledZ,S,o.z,w,o.y-1).key]={backfilled:!1}),o.y+1<u&&(E[new d.S(e.overscaledZ,f,o.z,c,o.y+1).key]={backfilled:!1},E[new d.S(e.overscaledZ,e.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},E[new d.S(e.overscaledZ,S,o.z,w,o.y+1).key]={backfilled:!1}),E}unloadTile(e){return d._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Ts extends d.E{constructor(e,o,u,c){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(c),this._data=o.data,this._options=d.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const f=d.X/this.tileSize;o.clusterMaxZoom!==void 0&&this.maxzoom<=o.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${o.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*f,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*f,extent:d.X,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:d.X,radius:(o.clusterRadius||50)*f,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return d._(this,void 0,void 0,function*(){const e=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,o,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:o,offset:u}})}_updateWorkerData(e){return d._(this,void 0,void 0,function*(){const o=d.e({type:this.type},this.workerOptions);e?o.dataDiff=e:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(q.resolveURL(this._data),"Source"),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.k("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"LD",data:o});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new d.k("dataabort",{dataType:"source"}));let c=null;u.resourceTiming&&u.resourceTiming[this.id]&&(c=u.resourceTiming[this.id].slice(0));const f={dataType:"source"};this._collectResourceTiming&&c&&c.length>0&&d.e(f,{resourceTiming:c}),this.fire(new d.k("data",Object.assign(Object.assign({},f),{sourceDataType:"metadata"}))),this.fire(new d.k("data",Object.assign(Object.assign({},f),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new d.k("dataabort",{dataType:"source"}));this.fire(new d.j(u))}})}loaded(){return this._pendingLoads===0}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.actor?"RT":"LT";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const c=yield this.actor.sendAsync({type:o,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(c,this.map.painter,o==="RT")})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var gi=d.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Qn extends d.E{constructor(e,o,u,c){super(),this.id=e,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=o}load(e){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield ce.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,e&&(this.coordinates=e),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new d.j(o))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const o=e.map(d.Z.fromLngLat);this.tileID=function(c){let f=1/0,w=1/0,S=-1/0,E=-1/0;for(const F of c)f=Math.min(f,F.x),w=Math.min(w,F.y),S=Math.max(S,F.x),E=Math.max(E,F.y);const C=Math.max(S-f,E-w),A=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),M=Math.pow(2,A);return new d.a1(A,Math.floor((f+S)/2*M),Math.floor((w+E)/2*M))}(o),this.minzoom=this.maxzoom=this.tileID.z;const u=o.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new d.$,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,d.X,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,d.X),this._boundsArray.emplaceBack(u[2].x,u[2].y,d.X,d.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,o=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,gi.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new pt(e,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const c in this.tiles){const f=this.tiles[c];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class it extends Qn{constructor(e,o,u,c){super(e,o,u,c),this.roundZoom=!0,this.type="video",this.options=o}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const o of e.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{const o=yield d.a3(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new d.j(o))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const o=this.video.seekable;e<o.start(0)||e>o.end(0)?this.fire(new d.j(new d.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,o=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,gi.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new pt(e,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const c in this.tiles){const f=this.tiles[c];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Tt extends Qn{constructor(e,o,u,c){super(e,o,u,c),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(w=>typeof w!="number"))||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new d.j(new d.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,u=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,gi.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new pt(o,this.canvas,u.RGBA,{premultiply:!0});let c=!1;for(const f in this.tiles){const w=this.tiles[f];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,c=!0)}c&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Ht={},ut=m=>{switch(m){case"geojson":return Ts;case"image":return Qn;case"raster":return Ft;case"raster-dem":return gr;case"vector":return cs;case"video":return it;case"canvas":return Tt}return Ht[m]},Ie="RTLPluginLoaded";class Vt extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Jn()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(o=>{throw this.status="error",o})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return d._(this,arguments,void 0,function*(o,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=q.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.k(Ie))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ot=null;function lr(){return Ot||(Ot=new Vt),Ot}class Nr{constructor(e,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=d.a4(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const o=e+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,f){const w={};if(!f)return w;for(const S of c){const E=S.layerIds.map(C=>f.getLayer(C)).filter(Boolean);if(E.length!==0){S.layers=E,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(C=>E.filter(A=>A.id===C)[0]));for(const C of E)w[C.id]=S}}return w}(e.buckets,o.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const f=this.buckets[c];if(f instanceof d.a6){if(this.hasSymbolBuckets=!0,!u)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const f=this.buckets[c];if(f instanceof d.a6&&f.hasRTLText){this.hasRTLText=!0,lr().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const f=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(c).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new d.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const c=this.buckets[u];c.uploadPending()&&c.upload(e)}const o=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new pt(e,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new pt(e,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,o,u,c,f,w,S,E,C,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:f,scale:w,tileSize:this.tileSize,pixelPosMatrix:A,transform:E,params:S,queryPadding:this.queryPadding*C},e,o,u):{}}querySourceFeatures(e,o){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const c=u.loadVTLayers(),f=o&&o.sourceLayer?o.sourceLayer:"",w=c._geojsonTileLayer||c[f];if(!w)return;const S=d.a7(o&&o.filter),{z:E,x:C,y:A}=this.tileID.canonical,M={z:E,x:C,y:A};for(let F=0;F<w.length;F++){const V=w.feature(F);if(S.needGeometry){const Y=d.a8(V,!0);if(!S.filter(new d.z(this.tileID.overscaledZ),Y,this.tileID.canonical))continue}else if(!S.filter(new d.z(this.tileID.overscaledZ),V))continue;const $=u.getId(V,f),K=new d.a9(V,E,C,A,$);K.tile=M,e.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const o=this.expirationTime;if(e.cacheControl){const u=d.aa(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let c=!1;if(this.expirationTime>u)c=!1;else if(o)if(this.expirationTime<o)c=!0;else{const f=this.expirationTime-o;f?this.expirationTime=u+Math.max(f,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!o.style.hasLayer(c))continue;const f=this.buckets[c],w=f.layers[0].sourceLayer||"_geojsonTileLayer",S=u[w],E=e[w];if(!S||!E||Object.keys(E).length===0)continue;f.update(E,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=o&&o.style&&o.style.getLayer(c);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=q.now()+e}setDependencies(e,o){const u={};for(const c of o)u[c]=!0;this.dependencies[e]=u}hasDependency(e,o){for(const u of e){const c=this.dependencies[u];if(c){for(const f of o)if(c[f])return!0}}return!1}}class Me{constructor(e,o){this.max=e,this.onRemove=o,this.reset()}reset(){for(const e in this.data)for(const o of this.data[e])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(e,o,u){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const f={value:o,timeout:void 0};if(u!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},u)),this.data[c].push(f),this.order.push(c),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const o=this.data[e].shift();return o.timeout&&clearTimeout(o.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),o.value}getByKey(e){const o=this.data[e];return o?o[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,o){if(!this.has(e))return this;const u=e.wrapped().key,c=o===void 0?0:this.data[u].indexOf(o),f=this.data[u][c];return this.data[u].splice(c,1),f.timeout&&clearTimeout(f.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(f.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(e){const o=[];for(const u in this.data)for(const c of this.data[u])e(c.value)||o.push(c);for(const u of o)this.remove(u.value.tileID,u)}}class yt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,u){const c=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},d.e(this.stateChanges[e][c],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const f in this.state[e])f!==c&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const f in this.state[e][c])u[f]||(this.deletedStates[e][c][f]=null)}else for(const f in u)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][f]===null&&delete this.deletedStates[e][c][f]}removeFeatureState(e,o,u){if(this.deletedStates[e]===null)return;const c=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&o!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][u]=null);else if(o!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(u in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][u]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,o){const u=String(o),c=d.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const f=this.deletedStates[e][o];if(f===null)return{};for(const w in f)delete c[w]}return c}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){const u={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const f={};for(const w in this.stateChanges[c])this.state[c][w]||(this.state[c][w]={}),d.e(this.state[c][w],this.stateChanges[c][w]),f[w]=this.state[c][w];u[c]=f}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const f={};if(this.deletedStates[c]===null)for(const w in this.state[c])f[w]={},this.state[c][w]={};else for(const w in this.deletedStates[c]){if(this.deletedStates[c][w]===null)this.state[c][w]={};else for(const S of Object.keys(this.deletedStates[c][w]))delete this.state[c][w][S];f[w]=this.state[c][w]}u[c]=u[c]||{},d.e(u[c],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const c in e)e[c].setFeatureState(u,o)}}class st extends d.E{constructor(e,o,u){super(),this.id=e,this.dispatcher=u,this.on("data",c=>this._dataHandler(c)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,f,w,S)=>{const E=new(ut(f.type))(c,f,w,S);if(E.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${E.id}`);return E})(e,o,u,this),this._tiles={},this._cache=new Me(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new yt,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const o=this._tiles[e];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,o,u){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,o,u)}catch(c){e.state="errored",c.status!==404?this._source.fire(new d.j(c,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new d.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const u=this._tiles[o];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(_r).map(e=>e.key)}getRenderableIds(e){const o=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&o.push(this._tiles[u]);return e?o.sort((u,c)=>{const f=u.tileID,w=c.tileID,S=new d.P(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),E=new d.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-w.overscaledZ||E.y-S.y||E.x-S.x}).map(u=>u.tileID.key):o.map(u=>u.tileID).sort(_r).map(u=>u.key)}hasRenderableParent(e){const o=this.findLoadedParent(e,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(e,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(o||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,o){return d._(this,void 0,void 0,function*(){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=o),yield this._loadTile(u,e,o))})}_tileLoaded(e,o,u){e.timeAdded=q.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const o=this.getRenderableIds();for(let c=0;c<o.length;c++){const f=o[c];if(e.neighboringTiles&&e.neighboringTiles[f]){const w=this.getTileByID(f);u(e,w),u(w,e)}}function u(c,f){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let w=f.tileID.canonical.x-c.tileID.canonical.x;const S=f.tileID.canonical.y-c.tileID.canonical.y,E=Math.pow(2,c.tileID.canonical.z),C=f.tileID.key;w===0&&S===0||Math.abs(S)>1||(Math.abs(w)>1&&(Math.abs(w+E)===1?w+=E:Math.abs(w-E)===1&&(w-=E)),f.dem&&c.dem&&(c.dem.backfillBorder(f.dem,w,S),c.neighboringTiles&&c.neighboringTiles[C]&&(c.neighboringTiles[C].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,o,u,c){for(const f in this._tiles){let w=this._tiles[f];if(c[f]||!w.hasData()||w.tileID.overscaledZ<=o||w.tileID.overscaledZ>u)continue;let S=w.tileID;for(;w&&w.tileID.overscaledZ>o+1;){const C=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[C.key],w&&w.hasData()&&(S=C)}let E=S;for(;E.overscaledZ>o;)if(E=E.scaledTo(E.overscaledZ-1),e[E.key]){c[S.key]=S;break}}}findLoadedParent(e,o){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=o?u:null}for(let u=e.overscaledZ-1;u>=o;u--){const c=e.scaledTo(u),f=this._getLoadedTile(c);if(f)return f}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const o=this._tiles[e.key];return o&&o.hasData()?o:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const o=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,c=Math.floor(o*u*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(f)}handleWrapJump(e){const o=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,o){const u={};for(const c in this._tiles){const f=this._tiles[c];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+o),u[f.tileID.key]=f}this._tiles=u;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}_updateCoveredAndRetainedTiles(e,o,u,c,f,w){const S={},E={},C=Object.keys(e),A=q.now();for(const M of C){const F=e[M],V=this._tiles[M];if(!V||V.fadeEndTime!==0&&V.fadeEndTime<=A)continue;const $=this.findLoadedParent(F,o),K=this.findLoadedSibling(F),Y=$||K||null;Y&&(this._addTile(Y.tileID),S[Y.tileID.key]=Y.tileID),E[M]=F}this._retainLoadedChildren(E,c,u,e);for(const M in S)e[M]||(this._coveredTiles[M]=!0,e[M]=S[M]);if(w){const M={},F={};for(const V of f)this._tiles[V.key].hasData()?M[V.key]=V:F[V.key]=V;for(const V in F){const $=F[V].children(this._source.maxzoom);this._tiles[$[0].key]&&this._tiles[$[1].key]&&this._tiles[$[2].key]&&this._tiles[$[3].key]&&(M[$[0].key]=e[$[0].key]=$[0],M[$[1].key]=e[$[1].key]=$[1],M[$[2].key]=e[$[2].key]=$[2],M[$[3].key]=e[$[3].key]=$[3],delete F[V])}for(const V in F){const $=F[V],K=this.findLoadedParent($,this._source.minzoom),Y=this.findLoadedSibling($),Q=K||Y||null;if(Q){M[Q.tileID.key]=e[Q.tileID.key]=Q.tileID;for(const ne in M)M[ne].isChildOf(Q.tileID)&&delete M[ne]}}for(const V in this._tiles)M[V]||(this._coveredTiles[V]=!0)}}update(e,o){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=o,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new d.S(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(u=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(u=u.filter(A=>this._source.hasTile(A)))):u=[];const c=e.coveringZoomLevel(this._source),f=Math.max(c-st.maxOverzooming,this._source.minzoom),w=Math.max(c+st.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const M of u)if(M.canonical.z>this._source.minzoom){const F=M.scaledTo(M.canonical.z-1);A[F.key]=F;const V=M.scaledTo(Math.max(this._source.minzoom,Math.min(M.canonical.z,5)));A[V.key]=V}u=u.concat(Object.values(A))}const S=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new d.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const E=this._updateRetainedTiles(u,c);Ar(this._source.type)&&this._updateCoveredAndRetainedTiles(E,f,w,c,u,o);for(const A in E)this._tiles[A].clearFadeHold();const C=d.ab(this._tiles,E);for(const A of C){const M=this._tiles[A];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,o){var u;const c={},f={},w=Math.max(o-st.maxOverzooming,this._source.minzoom),S=Math.max(o+st.maxUnderzooming,this._source.minzoom),E={};for(const C of e){const A=this._addTile(C);c[C.key]=C,A.hasData()||o<this._source.maxzoom&&(E[C.key]=C)}this._retainLoadedChildren(E,o,S,c);for(const C of e){let A=this._tiles[C.key];if(A.hasData())continue;if(o+1>this._source.maxzoom){const F=C.children(this._source.maxzoom)[0],V=this.getTile(F);if(V&&V.hasData()){c[F.key]=F;continue}}else{const F=C.children(this._source.maxzoom);if(c[F[0].key]&&c[F[1].key]&&c[F[2].key]&&c[F[3].key])continue}let M=A.wasRequested();for(let F=C.overscaledZ-1;F>=w;--F){const V=C.scaledTo(F);if(f[V.key])break;if(f[V.key]=!0,A=this.getTile(V),!A&&M&&(A=this._addTile(V)),A){const $=A.hasData();if(($||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||M)&&(c[V.key]=V),M=A.wasRequested(),$)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const o=[];let u,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){u=this._loadedParentTiles[c.key];break}o.push(c.key);const f=c.scaledTo(c.overscaledZ-1);if(u=this._getLoadedTile(f),u)break;c=f}for(const f of o)this._loadedParentTiles[f]=u}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const o=this._tiles[e].tileID,u=this._getLoadedTile(o);this._loadedSiblingTiles[o.key]=u}}_addTile(e){let o=this._tiles[e.key];if(o)return o;o=this._cache.getAndRemove(e),o&&(this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,o)));const u=o;return o||(o=new Nr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(o,e.key,o.state)),o.uses++,this._tiles[e.key]=o,u||this._source.fire(new d.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(e,o){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=o.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}_removeTile(e){const o=this._tiles[e];o&&(o.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(e){const o=e.sourceDataType;e.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&o==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,o,u){const c=[],f=this.transform;if(!f)return c;const w=u?f.getCameraQueryGeometry(e):e,S=e.map($=>f.pointCoordinate($,this.terrain)),E=w.map($=>f.pointCoordinate($,this.terrain)),C=this.getIds();let A=1/0,M=1/0,F=-1/0,V=-1/0;for(const $ of E)A=Math.min(A,$.x),M=Math.min(M,$.y),F=Math.max(F,$.x),V=Math.max(V,$.y);for(let $=0;$<C.length;$++){const K=this._tiles[C[$]];if(K.holdingForFade())continue;const Y=K.tileID,Q=Math.pow(2,f.zoom-K.tileID.overscaledZ),ne=o*K.queryPadding*d.X/K.tileSize/Q,W=[Y.getTilePoint(new d.Z(A,M)),Y.getTilePoint(new d.Z(F,V))];if(W[0].x-ne<d.X&&W[0].y-ne<d.X&&W[1].x+ne>=0&&W[1].y+ne>=0){const le=S.map(ge=>Y.getTilePoint(ge)),de=E.map(ge=>Y.getTilePoint(ge));c.push({tile:K,tileID:Y,queryGeometry:le,cameraQueryGeometry:de,scale:Q})}}return c}getVisibleCoordinates(e){const o=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);for(const u of o)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(Ar(this._source.type)){const e=q.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=e)return!0}return!1}setFeatureState(e,o,u){this._state.updateState(e=e||"_geojsonTileLayer",o,u)}removeFeatureState(e,o,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",o,u)}getFeatureState(e,o){return this._state.getState(e=e||"_geojsonTileLayer",o)}setDependencies(e,o,u){const c=this._tiles[e];c&&c.setDependencies(o,u)}reloadTilesForDependencies(e,o){for(const u in this._tiles)this._tiles[u].hasDependency(e,o)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(e,o))}}function _r(m,e){const o=Math.abs(2*m.wrap)-+(m.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||u-o||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function Ar(m){return m==="raster"||m==="image"||m==="video"}st.maxOverzooming=10,st.maxUnderzooming=3;class ht{constructor(e,o){this.reset(e,o)}reset(e,o){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.ac(e,0,1);let o=1,u=this._distances[o];const c=e*this.paddedLength+this.padding;for(;u<c&&o<this._distances.length;)u=this._distances[++o];const f=o-1,w=this._distances[f],S=u-w,E=S>0?(c-w)/S:0;return this.points[f].mult(1-E).add(this.points[o].mult(E))}}function Gt(m,e){let o=!0;return m==="always"||m!=="never"&&e!=="never"||(o=!1),o}class Tn{constructor(e,o,u){const c=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(o/u);for(let w=0;w<this.xCellCount*this.yCellCount;w++)c.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=o,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,o,u,c,f){this._forEachCell(o,u,c,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(c),this.bboxes.push(f)}insertCircle(e,o,u,c){this._forEachCell(o-c,u-c,o+c,u+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(o),this.circles.push(u),this.circles.push(c)}_insertBoxCell(e,o,u,c,f,w){this.boxCells[f].push(w)}_insertCircleCell(e,o,u,c,f,w){this.circleCells[f].push(w)}_query(e,o,u,c,f,w,S){if(u<0||e>this.width||c<0||o>this.height)return[];const E=[];if(e<=0&&o<=0&&this.width<=u&&this.height<=c){if(f)return[{key:null,x1:e,y1:o,x2:u,y2:c}];for(let C=0;C<this.boxKeys.length;C++)E.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const A=this.circles[3*C],M=this.circles[3*C+1],F=this.circles[3*C+2];E.push({key:this.circleKeys[C],x1:A-F,y1:M-F,x2:A+F,y2:M+F})}}else this._forEachCell(e,o,u,c,this._queryCell,E,{hitTest:f,overlapMode:w,seenUids:{box:{},circle:{}}},S);return E}query(e,o,u,c){return this._query(e,o,u,c,!1,null)}hitTest(e,o,u,c,f,w){return this._query(e,o,u,c,!0,f,w).length>0}hitTestCircle(e,o,u,c,f){const w=e-u,S=e+u,E=o-u,C=o+u;if(S<0||w>this.width||C<0||E>this.height)return!1;const A=[];return this._forEachCell(w,E,S,C,this._queryCellCircle,A,{hitTest:!0,overlapMode:c,circle:{x:e,y:o,radius:u},seenUids:{box:{},circle:{}}},f),A.length>0}_queryCell(e,o,u,c,f,w,S,E){const{seenUids:C,hitTest:A,overlapMode:M}=S,F=this.boxCells[f];if(F!==null){const $=this.bboxes;for(const K of F)if(!C.box[K]){C.box[K]=!0;const Y=4*K,Q=this.boxKeys[K];if(e<=$[Y+2]&&o<=$[Y+3]&&u>=$[Y+0]&&c>=$[Y+1]&&(!E||E(Q))&&(!A||!Gt(M,Q.overlapMode))&&(w.push({key:Q,x1:$[Y],y1:$[Y+1],x2:$[Y+2],y2:$[Y+3]}),A))return!0}}const V=this.circleCells[f];if(V!==null){const $=this.circles;for(const K of V)if(!C.circle[K]){C.circle[K]=!0;const Y=3*K,Q=this.circleKeys[K];if(this._circleAndRectCollide($[Y],$[Y+1],$[Y+2],e,o,u,c)&&(!E||E(Q))&&(!A||!Gt(M,Q.overlapMode))){const ne=$[Y],W=$[Y+1],le=$[Y+2];if(w.push({key:Q,x1:ne-le,y1:W-le,x2:ne+le,y2:W+le}),A)return!0}}}return!1}_queryCellCircle(e,o,u,c,f,w,S,E){const{circle:C,seenUids:A,overlapMode:M}=S,F=this.boxCells[f];if(F!==null){const $=this.bboxes;for(const K of F)if(!A.box[K]){A.box[K]=!0;const Y=4*K,Q=this.boxKeys[K];if(this._circleAndRectCollide(C.x,C.y,C.radius,$[Y+0],$[Y+1],$[Y+2],$[Y+3])&&(!E||E(Q))&&!Gt(M,Q.overlapMode))return w.push(!0),!0}}const V=this.circleCells[f];if(V!==null){const $=this.circles;for(const K of V)if(!A.circle[K]){A.circle[K]=!0;const Y=3*K,Q=this.circleKeys[K];if(this._circlesCollide($[Y],$[Y+1],$[Y+2],C.x,C.y,C.radius)&&(!E||E(Q))&&!Gt(M,Q.overlapMode))return w.push(!0),!0}}}_forEachCell(e,o,u,c,f,w,S,E){const C=this._convertToXCellCoord(e),A=this._convertToYCellCoord(o),M=this._convertToXCellCoord(u),F=this._convertToYCellCoord(c);for(let V=C;V<=M;V++)for(let $=A;$<=F;$++)if(f.call(this,e,o,u,c,this.xCellCount*$+V,w,S,E))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,o,u,c,f,w){const S=c-e,E=f-o,C=u+w;return C*C>S*S+E*E}_circleAndRectCollide(e,o,u,c,f,w,S){const E=(w-c)/2,C=Math.abs(e-(c+E));if(C>E+u)return!1;const A=(S-f)/2,M=Math.abs(o-(f+A));if(M>A+u)return!1;if(C<=E||M<=A)return!0;const F=C-E,V=M-A;return F*F+V*V<=u*u}}function Bn(m,e,o,u,c){const f=d.H();return e?(d.K(f,f,[1/c,1/c,1]),o||d.ad(f,f,u.angle)):d.L(f,u.labelPlaneMatrix,m),f}function fn(m,e,o,u,c){if(e){const f=d.ae(m);return d.K(f,f,[c,c,1]),o||d.ad(f,f,-u.angle),f}return u.glCoordMatrix}function G(m,e,o,u){let c;u?(c=[m,e,u(m,e),1],d.af(c,c,o)):(c=[m,e,0,1],Bt(c,c,o));const f=c[3];return{point:new d.P(c[0]/f,c[1]/f),signedDistanceFromCamera:f,isOccluded:!1}}function R(m,e){return .5+m/e*.5}function D(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function B(m,e,o,u,c,f,w,S,E,C,A,M,F,V,$){const K=u?m.textSizeData:m.iconSizeData,Y=d.ag(K,o.transform.zoom),Q=[256/o.width*2+1,256/o.height*2+1],ne=u?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ne.clear();const W=m.lineVertexArray,le=u?m.text.placedSymbolArray:m.icon.placedSymbolArray,de=o.transform.width/o.transform.height;let ge=!1;for(let Ee=0;Ee<le.length;Ee++){const ze=le.get(Ee);if(ze.hidden||ze.writingMode===d.ah.vertical&&!ge){lt(ze.numGlyphs,ne);continue}ge=!1;const Ve=G(ze.anchorX,ze.anchorY,e,$);if(!D(Ve.point,Q)){lt(ze.numGlyphs,ne);continue}const Ge=R(o.transform.cameraToCenterDistance,Ve.signedDistanceFromCamera),Be=d.ai(K,Y,ze),Fe=w?Be/Ge:Be*Ge,tt={getElevation:$,labelPlaneMatrix:c,lineVertexArray:W,pitchWithMap:w,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:C,tileAnchorPoint:new d.P(ze.anchorX,ze.anchorY),unwrappedTileID:A,width:M,height:F,translation:V},bt=ae(tt,ze,Fe,!1,S,e,f,m.glyphOffsetArray,ne,de,E);ge=bt.useVertical,(bt.notEnoughRoom||ge||bt.needsFlipping&&ae(tt,ze,Fe,!0,S,e,f,m.glyphOffsetArray,ne,de,E).notEnoughRoom)&&lt(ze.numGlyphs,ne)}u?m.text.dynamicLayoutVertexBuffer.updateData(ne):m.icon.dynamicLayoutVertexBuffer.updateData(ne)}function H(m,e,o,u,c,f,w,S){const E=f.glyphStartIndex+f.numGlyphs,C=f.lineStartIndex,A=f.lineStartIndex+f.lineLength,M=e.getoffsetX(f.glyphStartIndex),F=e.getoffsetX(E-1),V=Re(m*M,o,u,c,f.segment,C,A,S,w);if(!V)return null;const $=Re(m*F,o,u,c,f.segment,C,A,S,w);return $?S.projectionCache.anyProjectionOccluded?null:{first:V,last:$}:null}function ie(m,e,o,u){return m===d.ah.horizontal&&Math.abs(o.y-e.y)>Math.abs(o.x-e.x)*u?{useVertical:!0}:(m===d.ah.vertical?e.y<o.y:e.x>o.x)?{needsFlipping:!0}:null}function ae(m,e,o,u,c,f,w,S,E,C,A){const M=o/24,F=e.lineOffsetX*M,V=e.lineOffsetY*M;let $;if(e.numGlyphs>1){const K=e.glyphStartIndex+e.numGlyphs,Y=e.lineStartIndex,Q=e.lineStartIndex+e.lineLength,ne=H(M,S,F,V,u,e,A,m);if(!ne)return{notEnoughRoom:!0};const W=G(ne.first.point.x,ne.first.point.y,w,m.getElevation).point,le=G(ne.last.point.x,ne.last.point.y,w,m.getElevation).point;if(c&&!u){const de=ie(e.writingMode,W,le,C);if(de)return de}$=[ne.first];for(let de=e.glyphStartIndex+1;de<K-1;de++)$.push(Re(M*S.getoffsetX(de),F,V,u,e.segment,Y,Q,m,A));$.push(ne.last)}else{if(c&&!u){const Y=G(m.tileAnchorPoint.x,m.tileAnchorPoint.y,f,m.getElevation).point,Q=e.lineStartIndex+e.segment+1,ne=new d.P(m.lineVertexArray.getx(Q),m.lineVertexArray.gety(Q)),W=G(ne.x,ne.y,f,m.getElevation),le=W.signedDistanceFromCamera>0?W.point:function(ge,Ee,ze,Ve,Ge,Be){return pe(ge,Ee,ze,1,Ge,Be)}(m.tileAnchorPoint,ne,Y,0,f,m),de=ie(e.writingMode,Y,le,C);if(de)return de}const K=Re(M*S.getoffsetX(e.glyphStartIndex),F,V,u,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,m,A);if(!K||m.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};$=[K]}for(const K of $)d.aj(E,K.point,K.angle);return{}}function pe(m,e,o,u,c,f){const w=m.add(m.sub(e)._unit()),S=c!==void 0?G(w.x,w.y,c,f.getElevation).point:ve(w.x,w.y,f).point,E=o.sub(S);return o.add(E._mult(u/E.mag()))}function ee(m,e,o){const u=e.projectionCache;if(u.projections[m])return u.projections[m];const c=new d.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),f=ve(c.x,c.y,e);if(f.signedDistanceFromCamera>0)return u.projections[m]=f.point,u.anyProjectionOccluded=u.anyProjectionOccluded||f.isOccluded,f.point;const w=m-o.direction;return function(S,E,C,A,M){return pe(S,E,C,A,void 0,M)}(o.distanceFromAnchor===0?e.tileAnchorPoint:new d.P(e.lineVertexArray.getx(w),e.lineVertexArray.gety(w)),c,o.previousVertex,o.absOffsetX-o.distanceFromAnchor+1,e)}function ve(m,e,o){const u=m+o.translation[0],c=e+o.translation[1];let f;return!o.pitchWithMap&&o.projection.useSpecialProjectionForSymbols?(f=o.projection.projectTileCoordinates(u,c,o.unwrappedTileID,o.getElevation),f.point.x=(.5*f.point.x+.5)*o.width,f.point.y=(.5*-f.point.y+.5)*o.height):(f=G(u,c,o.labelPlaneMatrix,o.getElevation),f.isOccluded=!1),f}function Te(m,e,o){return m._unit()._perp()._mult(e*o)}function ye(m,e,o,u,c,f,w,S,E){if(S.projectionCache.offsets[m])return S.projectionCache.offsets[m];const C=o.add(e);if(m+E.direction<u||m+E.direction>=c)return S.projectionCache.offsets[m]=C,C;const A=ee(m+E.direction,S,E),M=Te(A.sub(o),w,E.direction),F=o.add(M),V=A.add(M);return S.projectionCache.offsets[m]=d.ak(f,C,F,V)||C,S.projectionCache.offsets[m]}function Re(m,e,o,u,c,f,w,S,E){const C=u?m-e:m+e;let A=C>0?1:-1,M=0;u&&(A*=-1,M=Math.PI),A<0&&(M+=Math.PI);let F,V=A>0?f+c:f+c+1;S.projectionCache.cachedAnchorPoint?F=S.projectionCache.cachedAnchorPoint:(F=ve(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=F);let $,K,Y=F,Q=F,ne=0,W=0;const le=Math.abs(C),de=[];let ge;for(;ne+W<=le;){if(V+=A,V<f||V>=w)return null;ne+=W,Q=Y,K=$;const Ve={absOffsetX:le,direction:A,distanceFromAnchor:ne,previousVertex:Q};if(Y=ee(V,S,Ve),o===0)de.push(Q),ge=Y.sub(Q);else{let Ge;const Be=Y.sub(Q);Ge=Be.mag()===0?Te(ee(V+A,S,Ve).sub(Y),o,A):Te(Be,o,A),K||(K=Q.add(Ge)),$=ye(V,Ge,Y,f,w,K,o,S,Ve),de.push(K),ge=$.sub(K)}W=ge.mag()}const Ee=ge._mult((le-ne)/W)._add(K||Q),ze=M+Math.atan2(Y.y-Q.y,Y.x-Q.x);return de.push(Ee),{point:Ee,angle:E?ze:0,path:de}}const Xe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function lt(m,e){for(let o=0;o<m;o++){const u=e.length;e.resize(u+4),e.float32.set(Xe,3*u)}}function Bt(m,e,o){const u=e[0],c=e[1];return m[0]=o[0]*u+o[4]*c+o[12],m[1]=o[1]*u+o[5]*c+o[13],m[3]=o[3]*u+o[7]*c+o[15],m}const St=100;class Nt{constructor(e,o,u=new Tn(e.width+200,e.height+200,25),c=new Tn(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=o,this.grid=u,this.ignoredGrid=c,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+St,this.screenBottomBoundary=e.height+St,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,o,u,c,f,w,S,E,C,A,M){const F=e.anchorPointX+E[0],V=e.anchorPointY+E[1],$=this.projectAndGetPerspectiveRatio(c,F,V,f,A),K=u*$.perspectiveRatio;let Y;if(w||S)Y=this._projectCollisionBox(e,K,c,f,w,S,E,$,A,M);else{const de=$.point.x+(M?M.x*K:0),ge=$.point.y+(M?M.y*K:0);Y={allPointsOccluded:!1,box:[de+e.x1*K,ge+e.y1*K,de+e.x2*K,ge+e.y2*K]}}const[Q,ne,W,le]=Y.box;return this.mapProjection.useSpecialProjectionForSymbols&&(w?Y.allPointsOccluded:this.mapProjection.isOccluded(F,V,f))||$.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Q,ne,W,le)||o!=="always"&&this.grid.hitTest(Q,ne,W,le,o,C)?{box:[Q,ne,W,le],placeable:!1,offscreen:!1}:{box:[Q,ne,W,le],placeable:!0,offscreen:this.isOffscreen(Q,ne,W,le)}}placeCollisionCircles(e,o,u,c,f,w,S,E,C,A,M,F,V,$,K,Y){const Q=[],ne=new d.P(o.anchorX,o.anchorY),W=this.getPerspectiveRatio(w,ne.x,ne.y,S,Y),le=(M?f/W:f*W)/d.ap,de={getElevation:Y,labelPlaneMatrix:E,lineVertexArray:u,pitchWithMap:M,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ne,unwrappedTileID:S,width:this.transform.width,height:this.transform.height,translation:K},ge=H(le,c,o.lineOffsetX*le,o.lineOffsetY*le,!1,o,!1,de);let Ee=!1,ze=!1,Ve=!0;if(ge){const Ge=.5*V*W+$,Be=new d.P(-100,-100),Fe=new d.P(this.screenRightBoundary,this.screenBottomBoundary),tt=new ht,bt=ge.first,Ne=ge.last;let qe=[];for(let kt=bt.path.length-1;kt>=1;kt--)qe.push(bt.path[kt]);for(let kt=1;kt<Ne.path.length;kt++)qe.push(Ne.path[kt]);const xt=2.5*Ge;if(C){const kt=this.projectPathToScreenSpace(qe,de,C);qe=kt.some(Mt=>Mt.signedDistanceFromCamera<=0)?[]:kt.map(Mt=>Mt.point)}let cr=[];if(qe.length>0){const kt=qe[0].clone(),Mt=qe[0].clone();for(let hr=1;hr<qe.length;hr++)kt.x=Math.min(kt.x,qe[hr].x),kt.y=Math.min(kt.y,qe[hr].y),Mt.x=Math.max(Mt.x,qe[hr].x),Mt.y=Math.max(Mt.y,qe[hr].y);cr=kt.x>=Be.x&&Mt.x<=Fe.x&&kt.y>=Be.y&&Mt.y<=Fe.y?[qe]:Mt.x<Be.x||kt.x>Fe.x||Mt.y<Be.y||kt.y>Fe.y?[]:d.al([qe],Be.x,Be.y,Fe.x,Fe.y)}for(const kt of cr){tt.reset(kt,.25*Ge);let Mt=0;Mt=tt.length<=.5*Ge?1:Math.ceil(tt.paddedLength/xt)+1;for(let hr=0;hr<Mt;hr++){const sn=hr/Math.max(Mt-1,1),bi=tt.lerp(sn),dr=bi.x+St,In=bi.y+St;Q.push(dr,In,Ge,0);const gn=dr-Ge,on=In-Ge,yn=dr+Ge,Bi=In+Ge;if(Ve=Ve&&this.isOffscreen(gn,on,yn,Bi),ze=ze||this.isInsideGrid(gn,on,yn,Bi),e!=="always"&&this.grid.hitTestCircle(dr,In,Ge,e,F)&&(Ee=!0,!A))return{circles:[],offscreen:!1,collisionDetected:Ee}}}}return{circles:!A&&Ee||!ze||W<this.perspectiveRatioCutoff?[]:Q,offscreen:Ve,collisionDetected:Ee}}projectPathToScreenSpace(e,o,u){return e.map(c=>G(c.x,c.y,u,o.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let u=1/0,c=1/0,f=-1/0,w=-1/0;for(const A of e){const M=new d.P(A.x+St,A.y+St);u=Math.min(u,M.x),c=Math.min(c,M.y),f=Math.max(f,M.x),w=Math.max(w,M.y),o.push(M)}const S=this.grid.query(u,c,f,w).concat(this.ignoredGrid.query(u,c,f,w)),E={},C={};for(const A of S){const M=A.key;if(E[M.bucketInstanceId]===void 0&&(E[M.bucketInstanceId]={}),E[M.bucketInstanceId][M.featureIndex])continue;const F=[new d.P(A.x1,A.y1),new d.P(A.x2,A.y1),new d.P(A.x2,A.y2),new d.P(A.x1,A.y2)];d.am(o,F)&&(E[M.bucketInstanceId][M.featureIndex]=!0,C[M.bucketInstanceId]===void 0&&(C[M.bucketInstanceId]=[]),C[M.bucketInstanceId].push(M.featureIndex))}return C}insertCollisionBox(e,o,u,c,f,w){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:f,collisionGroupID:w,overlapMode:o},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,o,u,c,f,w){const S=u?this.ignoredGrid:this.grid,E={bucketInstanceId:c,featureIndex:f,collisionGroupID:w,overlapMode:o};for(let C=0;C<e.length;C+=4)S.insertCircle(E,e[C],e[C+1],e[C+2])}projectAndGetPerspectiveRatio(e,o,u,c,f){let w;f?(w=[o,u,f(o,u),1],d.af(w,w,e)):(w=[o,u,0,1],Bt(w,w,e));const S=w[3];return{point:new d.P((w[0]/S+1)/2*this.transform.width+St,(-w[1]/S+1)/2*this.transform.height+St),perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}getPerspectiveRatio(e,o,u,c,f){const w=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(o,u,c,f):G(o,u,e,f);return .5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5}isOffscreen(e,o,u,c){return u<St||e>=this.screenRightBoundary||c<St||o>this.screenBottomBoundary}isInsideGrid(e,o,u,c){return u>=0&&e<this.gridRightBoundary&&c>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const e=d.an([]);return d.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,o,u,c,f,w,S,E,C,A){let M=new d.P(1,0),F=new d.P(0,1);const V=new d.P(e.anchorPointX+S[0],e.anchorPointY+S[1]);if(w&&!f){const Ve=this.projectAndGetPerspectiveRatio(u,V.x+1,V.y,c,C).point.sub(E.point).unit(),Ge=Math.atan(Ve.y/Ve.x)+(Ve.x<0?Math.PI:0),Be=Math.sin(Ge),Fe=Math.cos(Ge);M=new d.P(Fe,Be),F=new d.P(-Be,Fe)}else if(!w&&f){const Ve=-this.transform.angle,Ge=Math.sin(Ve),Be=Math.cos(Ve);M=new d.P(Be,Ge),F=new d.P(-Ge,Be)}let $=E.point,K=o;if(f){$=V;const Ve=this.transform.zoom-Math.floor(this.transform.zoom);K=Math.pow(2,-Ve),K*=this.mapProjection.getPitchedTextCorrection(this.transform,V,c),A||(K*=d.ac(.5+E.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}A&&($=$.add(M.mult(A.x*K)).add(F.mult(A.y*K)));const Y=e.x1*K,Q=e.x2*K,ne=(Y+Q)/2,W=e.y1*K,le=e.y2*K,de=(W+le)/2,ge=[{offsetX:Y,offsetY:W},{offsetX:ne,offsetY:W},{offsetX:Q,offsetY:W},{offsetX:Q,offsetY:de},{offsetX:Q,offsetY:le},{offsetX:ne,offsetY:le},{offsetX:Y,offsetY:le},{offsetX:Y,offsetY:de}];let Ee=[];for(const{offsetX:Ve,offsetY:Ge}of ge)Ee.push(new d.P($.x+M.x*Ve+F.x*Ge,$.y+M.y*Ve+F.y*Ge));let ze=!1;if(f){const Ve=Ee.map(Ge=>this.projectAndGetPerspectiveRatio(u,Ge.x,Ge.y,c,C));ze=Ve.some(Ge=>!Ge.isOccluded),Ee=Ve.map(Ge=>Ge.point)}else ze=!0;return{box:d.ao(Ee),allPointsOccluded:!ze}}}function At(m,e,o){return e*(d.X/(m.tileSize*Math.pow(2,o-m.tileID.overscaledZ)))}class jr{constructor(e,o,u,c){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?o:-o))):c&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class vr{constructor(e,o,u,c,f){this.text=new jr(e?e.text:null,o,u,f),this.icon=new jr(e?e.icon:null,o,c,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class It{constructor(e,o,u){this.text=e,this.icon=o,this.skipFade=u}}class Kt{constructor(){this.invProjMatrix=d.H(),this.viewportMatrix=d.H(),this.circles=[]}}class yr{constructor(e,o,u,c,f){this.bucketInstanceId=e,this.featureIndex=o,this.sourceLayerIndex=u,this.bucketIndex=c,this.tileID=f}}class Gr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const o=++this.maxGroupID;this.collisionGroups[e]={ID:o,predicate:u=>u.collisionGroupID===o}}return this.collisionGroups[e]}}function Yr(m,e,o,u,c){const{horizontalAlign:f,verticalAlign:w}=d.au(m);return new d.P(-(f-.5)*e+u[0]*c,-(w-.5)*o+u[1]*c)}class mn{constructor(e,o,u,c,f,w){this.transform=e.clone(),this.terrain=u,this.collisionIndex=new Nt(this.transform,o),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Gr(f),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const o=this.terrain;return o?(u,c)=>o.getElevation(e,u,c):null}getBucketParts(e,o,u,c){const f=u.getBucket(o),w=u.latestFeatureIndex;if(!f||!w||o.id!==f.layerIds[0])return;const S=u.collisionBoxArray,E=f.layers[0].layout,C=f.layers[0].paint,A=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),M=u.tileSize/d.X,F=u.tileID.toUnwrapped(),V=this.transform.calculatePosMatrix(F),$=E.get("text-pitch-alignment")==="map",K=E.get("text-rotation-alignment")==="map",Y=At(u,1,this.transform.zoom),Q=this.collisionIndex.mapProjection.translatePosition(this.transform,u,C.get("text-translate"),C.get("text-translate-anchor")),ne=this.collisionIndex.mapProjection.translatePosition(this.transform,u,C.get("icon-translate"),C.get("icon-translate-anchor")),W=Bn(V,$,K,this.transform,Y);let le=null;if($){const ge=fn(V,$,K,this.transform,Y);le=d.L([],this.transform.labelPlaneMatrix,ge)}this.retainedQueryData[f.bucketInstanceId]=new yr(f.bucketInstanceId,w,f.sourceLayerIndex,f.index,u.tileID);const de={bucket:f,layout:E,translationText:Q,translationIcon:ne,posMatrix:V,unwrappedTileID:F,textLabelPlaneMatrix:W,labelToScreenMatrix:le,scale:A,textPixelRatio:M,holdingForFade:u.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:d.ag(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(c)for(const ge of f.sortKeyRanges){const{sortKey:Ee,symbolInstanceStart:ze,symbolInstanceEnd:Ve}=ge;e.push({sortKey:Ee,symbolInstanceStart:ze,symbolInstanceEnd:Ve,parameters:de})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:de})}attemptAnchorPlacement(e,o,u,c,f,w,S,E,C,A,M,F,V,$,K,Y,Q,ne,W){const le=d.aq[e.textAnchor],de=[e.textOffset0,e.textOffset1],ge=Yr(le,u,c,de,f),Ee=this.collisionIndex.placeCollisionBox(o,F,E,C,A,S,w,Y,M.predicate,W,ge);if((!ne||this.collisionIndex.placeCollisionBox(ne,F,E,C,A,S,w,Q,M.predicate,W,ge).placeable)&&Ee.placeable){let ze;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(ze=this.prevPlacement.variableOffsets[V.crossTileID].anchor),V.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:de,width:u,height:c,anchor:le,textBoxScale:f,prevAnchor:ze},this.markUsedJustification($,le,V,K),$.allowVerticalPlacement&&(this.markUsedOrientation($,K,V),this.placedOrientations[V.crossTileID]=K),{shift:ge,placedGlyphBoxes:Ee}}}placeLayerBucketPart(e,o,u){const{bucket:c,layout:f,translationText:w,translationIcon:S,posMatrix:E,unwrappedTileID:C,textLabelPlaneMatrix:A,labelToScreenMatrix:M,textPixelRatio:F,holdingForFade:V,collisionBoxArray:$,partiallyEvaluatedTextSize:K,collisionGroup:Y}=e.parameters,Q=f.get("text-optional"),ne=f.get("icon-optional"),W=d.ar(f,"text-overlap","text-allow-overlap"),le=W==="always",de=d.ar(f,"icon-overlap","icon-allow-overlap"),ge=de==="always",Ee=f.get("text-rotation-alignment")==="map",ze=f.get("text-pitch-alignment")==="map",Ve=f.get("icon-text-fit")!=="none",Ge=f.get("symbol-z-order")==="viewport-y",Be=le&&(ge||!c.hasIconData()||ne),Fe=ge&&(le||!c.hasTextData()||Q);!c.collisionArrays&&$&&c.deserializeCollisionBoxes($);const tt=this._getTerrainElevationFunc(this.retainedQueryData[c.bucketInstanceId].tileID),bt=(Ne,qe,xt)=>{var cr,kt;if(o[Ne.crossTileID])return;if(V)return void(this.placements[Ne.crossTileID]=new It(!1,!1,!1));let Mt=!1,hr=!1,sn=!0,bi=null,dr={box:null,placeable:!1,offscreen:null},In={placeable:!1},gn=null,on=null,yn=null,Bi=0,vo=0,vl=0;qe.textFeatureIndex?Bi=qe.textFeatureIndex:Ne.useRuntimeCollisionCircles&&(Bi=Ne.featureIndex),qe.verticalTextFeatureIndex&&(vo=qe.verticalTextFeatureIndex);const wo=qe.textBox;if(wo){const si=Qr=>{let an=d.ah.horizontal;if(c.allowVerticalPlacement&&!Qr&&this.prevPlacement){const qn=this.prevPlacement.placedOrientations[Ne.crossTileID];qn&&(this.placedOrientations[Ne.crossTileID]=qn,an=qn,this.markUsedOrientation(c,an,Ne))}return an},oi=(Qr,an)=>{if(c.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&qe.verticalTextBox){for(const qn of c.writingModes)if(qn===d.ah.vertical?(dr=an(),In=dr):dr=Qr(),dr&&dr.placeable)break}else dr=Qr()},ps=Ne.textAnchorOffsetStartIndex,Si=Ne.textAnchorOffsetEndIndex;if(Si===ps){const Qr=(an,qn)=>{const Rt=this.collisionIndex.placeCollisionBox(an,W,F,E,C,ze,Ee,w,Y.predicate,tt);return Rt&&Rt.placeable&&(this.markUsedOrientation(c,qn,Ne),this.placedOrientations[Ne.crossTileID]=qn),Rt};oi(()=>Qr(wo,d.ah.horizontal),()=>{const an=qe.verticalTextBox;return c.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&an?Qr(an,d.ah.vertical):{box:null,offscreen:null}}),si(dr&&dr.placeable)}else{let Qr=d.aq[(kt=(cr=this.prevPlacement)===null||cr===void 0?void 0:cr.variableOffsets[Ne.crossTileID])===null||kt===void 0?void 0:kt.anchor];const an=(Rt,Os,bo)=>{const So=Rt.x2-Rt.x1,Jh=Rt.y2-Rt.y1,_f=Ne.textBoxScale,Yh=Ve&&de==="never"?Os:null;let fs=null,Qh=W==="never"?1:2,bl="never";Qr&&Qh++;for(let ya=0;ya<Qh;ya++){for(let Sl=ps;Sl<Si;Sl++){const Tl=c.textAnchorOffsets.get(Sl);if(Qr&&Tl.textAnchor!==Qr)continue;const To=this.attemptAnchorPlacement(Tl,Rt,So,Jh,_f,Ee,ze,F,E,C,Y,bl,Ne,c,bo,w,S,Yh,tt);if(To&&(fs=To.placedGlyphBoxes,fs&&fs.placeable))return Mt=!0,bi=To.shift,fs}Qr?Qr=null:bl=W}return u&&!fs&&(fs={box:this.collisionIndex.placeCollisionBox(wo,"always",F,E,C,ze,Ee,w,Y.predicate,tt,new d.P(0,0)).box,offscreen:!1,placeable:!1}),fs};oi(()=>an(wo,qe.iconBox,d.ah.horizontal),()=>{const Rt=qe.verticalTextBox;return c.allowVerticalPlacement&&(!dr||!dr.placeable)&&Ne.numVerticalGlyphVertices>0&&Rt?an(Rt,qe.verticalIconBox,d.ah.vertical):{box:null,occluded:!0,offscreen:null}}),dr&&(Mt=dr.placeable,sn=dr.offscreen);const qn=si(dr&&dr.placeable);if(!Mt&&this.prevPlacement){const Rt=this.prevPlacement.variableOffsets[Ne.crossTileID];Rt&&(this.variableOffsets[Ne.crossTileID]=Rt,this.markUsedJustification(c,Rt.anchor,Ne,qn))}}}if(gn=dr,Mt=gn&&gn.placeable,sn=gn&&gn.offscreen,Ne.useRuntimeCollisionCircles){const si=c.text.placedSymbolArray.get(Ne.centerJustifiedTextSymbolIndex),oi=d.ai(c.textSizeData,K,si),ps=f.get("text-padding");on=this.collisionIndex.placeCollisionCircles(W,si,c.lineVertexArray,c.glyphOffsetArray,oi,E,C,A,M,u,ze,Y.predicate,Ne.collisionCircleDiameter,ps,w,tt),on.circles.length&&on.collisionDetected&&!u&&d.w("Collisions detected, but collision boxes are not shown"),Mt=le||on.circles.length>0&&!on.collisionDetected,sn=sn&&on.offscreen}if(qe.iconFeatureIndex&&(vl=qe.iconFeatureIndex),qe.iconBox){const si=oi=>this.collisionIndex.placeCollisionBox(oi,de,F,E,C,ze,Ee,S,Y.predicate,tt,Ve&&bi?bi:void 0);In&&In.placeable&&qe.verticalIconBox?(yn=si(qe.verticalIconBox),hr=yn.placeable):(yn=si(qe.iconBox),hr=yn.placeable),sn=sn&&yn.offscreen}const ii=Q||Ne.numHorizontalGlyphVertices===0&&Ne.numVerticalGlyphVertices===0,wl=ne||Ne.numIconVertices===0;ii||wl?wl?ii||(hr=hr&&Mt):Mt=hr&&Mt:hr=Mt=hr&&Mt;const nc=hr&&yn.placeable;if(Mt&&gn.placeable&&this.collisionIndex.insertCollisionBox(gn.box,W,f.get("text-ignore-placement"),c.bucketInstanceId,In&&In.placeable&&vo?vo:Bi,Y.ID),nc&&this.collisionIndex.insertCollisionBox(yn.box,de,f.get("icon-ignore-placement"),c.bucketInstanceId,vl,Y.ID),on&&Mt&&this.collisionIndex.insertCollisionCircles(on.circles,W,f.get("text-ignore-placement"),c.bucketInstanceId,Bi,Y.ID),u&&this.storeCollisionData(c.bucketInstanceId,xt,qe,gn,yn,on),Ne.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ne.crossTileID]=new It(Mt||Be,hr||Fe,sn||c.justReloaded),o[Ne.crossTileID]=!0};if(Ge){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ne=c.getSortedSymbolIndexes(this.transform.angle);for(let qe=Ne.length-1;qe>=0;--qe){const xt=Ne[qe];bt(c.symbolInstances.get(xt),c.collisionArrays[xt],xt)}}else for(let Ne=e.symbolInstanceStart;Ne<e.symbolInstanceEnd;Ne++)bt(c.symbolInstances.get(Ne),c.collisionArrays[Ne],Ne);if(u&&c.bucketInstanceId in this.collisionCircleArrays){const Ne=this.collisionCircleArrays[c.bucketInstanceId];d.as(Ne.invProjMatrix,E),Ne.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}storeCollisionData(e,o,u,c,f,w){if(u.textBox||u.iconBox){let S,E;this.collisionBoxArrays.has(e)?S=this.collisionBoxArrays.get(e):(S=new Map,this.collisionBoxArrays.set(e,S)),S.has(o)?E=S.get(o):(E={text:null,icon:null},S.set(o,E)),u.textBox&&(E.text=c.box),u.iconBox&&(E.icon=f.box)}if(w){let S=this.collisionCircleArrays[e];S===void 0&&(S=this.collisionCircleArrays[e]=new Kt);for(let E=0;E<w.circles.length;E+=4)S.circles.push(w.circles[E+0]),S.circles.push(w.circles[E+1]),S.circles.push(w.circles[E+2]),S.circles.push(w.collisionDetected?1:0)}}markUsedJustification(e,o,u,c){let f;f=c===d.ah.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[d.at(o)];const w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const S of w)S>=0&&(e.text.placedSymbolArray.get(S).crossTileID=f>=0&&S!==f?0:u.crossTileID)}markUsedOrientation(e,o,u){const c=o===d.ah.horizontal||o===d.ah.horizontalOnly?o:0,f=o===d.ah.vertical?o:0,w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const S of w)e.text.placedSymbolArray.get(S).placedOrientation=c;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let u=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const c=o?o.symbolFadeChange(e):1,f=o?o.opacities:{},w=o?o.variableOffsets:{},S=o?o.placedOrientations:{};for(const E in this.placements){const C=this.placements[E],A=f[E];A?(this.opacities[E]=new vr(A,c,C.text,C.icon),u=u||C.text!==A.text.placed||C.icon!==A.icon.placed):(this.opacities[E]=new vr(null,c,C.text,C.icon,C.skipFade),u=u||C.text||C.icon)}for(const E in f){const C=f[E];if(!this.opacities[E]){const A=new vr(C,c,!1,!1);A.isHidden()||(this.opacities[E]=A,u=u||C.text.placed||C.icon.placed)}}for(const E in w)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=w[E]);for(const E in S)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=S[E]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:e)}updateLayerOpacities(e,o){const u={};for(const c of o){const f=c.getBucket(e);f&&c.latestFeatureIndex&&e.id===f.layerIds[0]&&this.updateBucketOpacities(f,c.tileID,u,c.collisionBoxArray)}}updateBucketOpacities(e,o,u,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const f=e.layers[0],w=f.layout,S=new vr(null,0,!1,!1,!0),E=w.get("text-allow-overlap"),C=w.get("icon-allow-overlap"),A=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),M=w.get("text-rotation-alignment")==="map",F=w.get("text-pitch-alignment")==="map",V=w.get("icon-text-fit")!=="none",$=new vr(null,0,E&&(C||!e.hasIconData()||w.get("icon-optional")),C&&(E||!e.hasTextData()||w.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);const K=(Q,ne,W)=>{for(let le=0;le<ne/4;le++)Q.opacityVertexArray.emplaceBack(W);Q.hasVisibleVertices=Q.hasVisibleVertices||W!==Qs},Y=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Q=0;Q<e.symbolInstances.length;Q++){const ne=e.symbolInstances.get(Q),{numHorizontalGlyphVertices:W,numVerticalGlyphVertices:le,crossTileID:de}=ne;let ge=this.opacities[de];u[de]?ge=S:ge||(ge=$,this.opacities[de]=ge),u[de]=!0;const Ee=ne.numIconVertices>0,ze=this.placedOrientations[ne.crossTileID],Ve=ze===d.ah.vertical,Ge=ze===d.ah.horizontal||ze===d.ah.horizontalOnly;if(W>0||le>0){const Fe=Vn(ge.text);K(e.text,W,Ve?Qs:Fe),K(e.text,le,Ge?Qs:Fe);const tt=ge.text.isHidden();[ne.rightJustifiedTextSymbolIndex,ne.centerJustifiedTextSymbolIndex,ne.leftJustifiedTextSymbolIndex].forEach(qe=>{qe>=0&&(e.text.placedSymbolArray.get(qe).hidden=tt||Ve?1:0)}),ne.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ne.verticalPlacedTextSymbolIndex).hidden=tt||Ge?1:0);const bt=this.variableOffsets[ne.crossTileID];bt&&this.markUsedJustification(e,bt.anchor,ne,ze);const Ne=this.placedOrientations[ne.crossTileID];Ne&&(this.markUsedJustification(e,"left",ne,Ne),this.markUsedOrientation(e,Ne,ne))}if(Ee){const Fe=Vn(ge.icon),tt=!(V&&ne.verticalPlacedIconSymbolIndex&&Ve);ne.placedIconSymbolIndex>=0&&(K(e.icon,ne.numIconVertices,tt?Fe:Qs),e.icon.placedSymbolArray.get(ne.placedIconSymbolIndex).hidden=ge.icon.isHidden()),ne.verticalPlacedIconSymbolIndex>=0&&(K(e.icon,ne.numVerticalIconVertices,tt?Qs:Fe),e.icon.placedSymbolArray.get(ne.verticalPlacedIconSymbolIndex).hidden=ge.icon.isHidden())}const Be=Y&&Y.has(Q)?Y.get(Q):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Fe=e.collisionArrays[Q];if(Fe){let tt=new d.P(0,0);if(Fe.textBox||Fe.verticalTextBox){let bt=!0;if(A){const Ne=this.variableOffsets[de];Ne?(tt=Yr(Ne.anchor,Ne.width,Ne.height,Ne.textOffset,Ne.textBoxScale),M&&tt._rotate(F?this.transform.angle:-this.transform.angle)):bt=!1}if(Fe.textBox||Fe.verticalTextBox){let Ne;Fe.textBox&&(Ne=Ve),Fe.verticalTextBox&&(Ne=Ge),Ys(e.textCollisionBox.collisionVertexArray,ge.text.placed,!bt||Ne,Be.text,tt.x,tt.y)}}if(Fe.iconBox||Fe.verticalIconBox){const bt=!!(!Ge&&Fe.verticalIconBox);let Ne;Fe.iconBox&&(Ne=bt),Fe.verticalIconBox&&(Ne=!bt),Ys(e.iconCollisionBox.collisionVertexArray,ge.icon.placed,Ne,Be.icon,V?tt.x:0,V?tt.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const Q=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=Q.invProjMatrix,e.placementViewportMatrix=Q.viewportMatrix,e.collisionCircleArray=Q.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,o){const u=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function Ys(m,e,o,u,c,f){u&&u.length!==0||(u=[0,0,0,0]);const w=u[0]-St,S=u[1]-St,E=u[2]-St,C=u[3]-St;m.emplaceBack(e?1:0,o?1:0,c||0,f||0,w,S),m.emplaceBack(e?1:0,o?1:0,c||0,f||0,E,S),m.emplaceBack(e?1:0,o?1:0,c||0,f||0,E,C),m.emplaceBack(e?1:0,o?1:0,c||0,f||0,w,C)}const Jt=Math.pow(2,25),fu=Math.pow(2,24),mu=Math.pow(2,17),Nn=Math.pow(2,16),jn=Math.pow(2,9),Zp=Math.pow(2,8),ei=Math.pow(2,1);function Vn(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const e=m.placed?1:0,o=Math.floor(127*m.opacity);return o*Jt+e*fu+o*mu+e*Nn+o*jn+e*Zp+o*ei+e}const Qs=0;function Es(){return{isOccluded:(m,e,o)=>!1,getPitchedTextCorrection:(m,e,o)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(m,e,o,u){throw new Error("Not implemented.")},translatePosition:(m,e,o,u)=>function(c,f,w,S,E=!1){if(!w[0]&&!w[1])return[0,0];const C=E?S==="map"?c.angle:0:S==="viewport"?-c.angle:0;if(C){const A=Math.sin(C),M=Math.cos(C);w=[w[0]*M-w[1]*A,w[0]*A+w[1]*M]}return[E?w[0]:At(f,w[0],c.zoom),E?w[1]:At(f,w[1],c.zoom)]}(m,e,o,u),getCircleRadiusCorrection:m=>1}}class Vr{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,o,u,c,f){const w=this._bucketParts;for(;this._currentTileIndex<e.length;)if(o.getBucketParts(w,c,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((S,E)=>S.sortKey-E.sortKey));this._currentPartIndex<w.length;)if(o.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,f())return!0;return!1}}class Yo{constructor(e,o,u,c,f,w,S,E){this.placement=new mn(e,Es(),o,w,S,E),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(e,o,u){const c=q.now(),f=()=>!this._forceFullPlacement&&q.now()-c>2;for(;this._currentPlacementIndex>=0;){const w=o[e[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=S)&&(!w.maxzoom||w.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Vr(w)),this._inProgressLayer.continuePlacement(u[w.source],this.placement,this._showCollisionBoxes,w,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const yi=512/d.X/2;class Mr{constructor(e,o,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};const c=new Map;for(let f=0;f<o.length;f++){const w=o.get(f),S=w.key,E=c.get(S);E?E.push(w):c.set(S,[w])}for(const[f,w]of c){const S={positions:w.map(E=>({x:Math.floor(E.anchorX*yi),y:Math.floor(E.anchorY*yi)})),crossTileIDs:w.map(E=>E.crossTileID)};if(S.positions.length>128){const E=new d.av(S.positions.length,16,Uint16Array);for(const{x:C,y:A}of S.positions)E.add(C,A);E.finish(),delete S.positions,S.index=E}this._symbolsByKey[f]=S}}getScaledCoordinates(e,o){const{x:u,y:c,z:f}=this.tileID.canonical,{x:w,y:S,z:E}=o.canonical,C=yi/Math.pow(2,E-f),A=(S*d.X+e.anchorY)*C,M=c*d.X*yi;return{x:Math.floor((w*d.X+e.anchorX)*C-u*d.X*yi),y:Math.floor(A-M)}}findMatches(e,o,u){const c=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let f=0;f<e.length;f++){const w=e.get(f);if(w.crossTileID)continue;const S=this._symbolsByKey[w.key];if(!S)continue;const E=this.getScaledCoordinates(w,o);if(S.index){const C=S.index.range(E.x-c,E.y-c,E.x+c,E.y+c).sort();for(const A of C){const M=S.crossTileIDs[A];if(!u[M]){u[M]=!0,w.crossTileID=M;break}}}else if(S.positions)for(let C=0;C<S.positions.length;C++){const A=S.positions[C],M=S.crossTileIDs[C];if(Math.abs(A.x-E.x)<=c&&Math.abs(A.y-E.y)<=c&&!u[M]){u[M]=!0,w.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class $a{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class _i{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const o=Math.round((e-this.lng)/360);if(o!==0)for(const u in this.indexes){const c=this.indexes[u],f={};for(const w in c){const S=c[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+o),f[S.tileID.key]=S}this.indexes[u]=f}this.lng=e}addBucket(e,o,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let f=0;f<o.symbolInstances.length;f++)o.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const c=this.usedCrossTileIDs[e.overscaledZ];for(const f in this.indexes){const w=this.indexes[f];if(Number(f)>e.overscaledZ)for(const S in w){const E=w[S];E.tileID.isChildOf(e)&&E.findMatches(o.symbolInstances,e,c)}else{const S=w[e.scaledTo(Number(f)).key];S&&S.findMatches(o.symbolInstances,e,c)}}for(let f=0;f<o.symbolInstances.length;f++){const w=o.symbolInstances.get(f);w.crossTileID||(w.crossTileID=u.generate(),c[w.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Mr(e,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(e,o){for(const u of o.getCrossTileIDsLists())for(const c of u)delete this.usedCrossTileIDs[e][c]}removeStaleBuckets(e){let o=!1;for(const u in this.indexes){const c=this.indexes[u];for(const f in c)e[c[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,c[f]),delete c[f],o=!0)}return o}}class gu{constructor(){this.layerIndexes={},this.crossTileIDs=new $a,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,o,u){let c=this.layerIndexes[e.id];c===void 0&&(c=this.layerIndexes[e.id]=new _i);let f=!1;const w={};c.handleWrapJump(u);for(const S of o){const E=S.getBucket(e);E&&e.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(S.tileID,E,this.crossTileIDs)&&(f=!0),w[E.bucketInstanceId]=!0)}return c.removeStaleBuckets(w)&&(f=!0),f}pruneUnusedLayers(e){const o={};e.forEach(u=>{o[u]=!0});for(const u in this.layerIndexes)o[u]||delete this.layerIndexes[u]}}const xi=(m,e)=>d.t(m,e&&e.filter(o=>o.identifier!=="source.canvas")),Hp=d.aw();class qa extends d.E{constructor(e,o={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const c=this.sourceCaches[u].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[u].reload()}},this.map=e,this.dispatcher=new Hr(Wi(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(u,c)=>this.getGlyphs(u,c)),this.dispatcher.registerMessageHandler("GI",(u,c)=>this.getImages(u,c)),this.imageManager=new Dt,this.imageManager.setEventedParent(this),this.glyphManager=new Or(e._requestManager,o.localIdeographFontFamily),this.lineAtlas=new ar(256,512),this.crossTileSymbolIndex=new gu,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",d.ay()),lr().on(Ie,this._rtlPluginLoaded),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const c=this.sourceCaches[u.sourceId];if(!c)return;const f=c.getSource();if(f&&f.vectorLayerIds)for(const w in this._layers){const S=this._layers[w];S.source===f.id&&this._validateLayer(S)}})}loadURL(e,o={},u){this.fire(new d.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const c=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const f=this._loadStyleRequest;d.h(c,this._loadStyleRequest).then(w=>{this._loadStyleRequest=null,this._load(w.data,o,u)}).catch(w=>{this._loadStyleRequest=null,w&&!f.signal.aborted&&this.fire(new d.j(w))})}loadJSON(e,o={},u){this.fire(new d.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,q.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(e,o,u)}).catch(()=>{})}loadEmpty(){this.fire(new d.k("dataloading",{dataType:"style"})),this._load(Hp,{validate:!1})}_load(e,o,u){var c;const f=o.transformStyle?o.transformStyle(u,e):e;if(!o.validate||!xi(this,d.u(f))){this._loaded=!0,this.stylesheet=f;for(const w in f.sources)this.addSource(w,f.sources[w],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs),this._createLayers(),this.light=new gt(this.stylesheet.light),this.sky=new Pt(this.stylesheet.sky),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new d.k("data",{dataType:"style"})),this.fire(new d.k("style.load"))}}_createLayers(){const e=d.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(o=>o.id),this._layers={},this._serializedLayers=null;for(const o of e){const u=d.aA(o);u.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=u}}_loadSprite(e,o=!1,u=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(f,w,S,E){return d._(this,void 0,void 0,function*(){const C=_t(f),A=S>1?"@2x":"",M={},F={};for(const{id:V,url:$}of C){const K=w.transformRequest(mt($,A,".json"),"SpriteJSON");M[V]=d.h(K,E);const Y=w.transformRequest(mt($,A,".png"),"SpriteImage");F[V]=ce.getImage(Y,E)}return yield Promise.all([...Object.values(M),...Object.values(F)]),function(V,$){return d._(this,void 0,void 0,function*(){const K={};for(const Y in V){K[Y]={};const Q=q.getImageCanvasContext((yield $[Y]).data),ne=(yield V[Y]).data;for(const W in ne){const{width:le,height:de,x:ge,y:Ee,sdf:ze,pixelRatio:Ve,stretchX:Ge,stretchY:Be,content:Fe,textFitWidth:tt,textFitHeight:bt}=ne[W];K[Y][W]={data:null,pixelRatio:Ve,sdf:ze,stretchX:Ge,stretchY:Be,content:Fe,textFitWidth:tt,textFitHeight:bt,spriteData:{width:le,height:de,x:ge,y:Ee,context:Q}}}}return K})}(M,F)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(f=>{if(this._spriteRequest=null,f)for(const w in f){this._spritesImagesIds[w]=[];const S=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter(E=>!(E in f)):[];for(const E of S)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(const E in f[w]){const C=w==="default"?E:`${w}:${E}`;this._spritesImagesIds[w].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,f[w][E],!1):this.imageManager.addImage(C,f[w][E]),o&&(this._changedImages[C]=!0)}}}).catch(f=>{this._spriteRequest=null,c=f,this.fire(new d.j(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"})),u&&u(c)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}_validateLayer(e){const o=this.sourceCaches[e.source];if(!o)return;const u=e.sourceLayer;if(!u)return;const c=o.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(u)===-1)&&this.fire(new d.j(new Error(`Source layer "${u}" does not exist on source "${c.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,o=!1){const u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(o?d.aB(u):u);const c=[];for(const f of e)if(u[f]){const w=o?d.aB(u[f]):u[f];c.push(w)}return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const o=Object.keys(this._layers);for(const u of o){const c=this._layers[u];c.type!=="custom"&&(e[u]=c.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const o=this._changed;if(o){const c=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(c.length||f.length)&&this._updateWorkerLayers(c,f);for(const w in this._updatedSources){const S=this._updatedSources[w];if(S==="reload")this._reloadSource(w);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const u={};for(const c in this.sourceCaches){const f=this.sourceCaches[c];u[c]=f.used,f.used=!1}for(const c of this._order){const f=this._layers[c];f.recalculate(e,this._availableImages),!f.isHidden(e.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const c in u){const f=this.sourceCaches[c];!!u[c]!=!!f.used&&f.fire(new d.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,o&&this.fire(new d.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,o={}){var u;this._checkLoaded();const c=this.serialize();if(e=o.transformStyle?o.transformStyle(c,e):e,((u=o.validate)===null||u===void 0||u)&&xi(this,d.u(e)))return!1;(e=d.aB(e)).layers=d.az(e.layers);const f=d.aC(c,e),w=this._getOperationsToPerform(f);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const S of w.operations)S();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const o=[],u=[];for(const c of e)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":o.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":o.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":o.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":o.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":o.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":o.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":o.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":o.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":o.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":o.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":o.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":o.push(()=>this.setSprite.apply(this,c.args));break;case"setSky":o.push(()=>this.setSky.apply(this,c.args));break;case"setTerrain":o.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setTransition":o.push(()=>{});break;default:u.push(c.command)}return{operations:o,unimplemented:u}}addImage(e,o){if(this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,o),this._afterImageUpdated(e)}updateImage(e,o){this.imageManager.updateImage(e,o)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,o,u={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(d.u.source,`sources.${e}`,o,null,u))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const c=this.sourceCaches[e]=new st(e,o,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:e})),c.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new d.j(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const o=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],o.fire(new d.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,o){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const u=this.sourceCaches[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(o),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,o,u={}){this._checkLoaded();const c=e.id;if(this.getLayer(c))return void this.fire(new d.j(new Error(`Layer "${c}" already exists on this map.`)));let f;if(e.type==="custom"){if(xi(this,d.aD(e)))return;f=d.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(c,e.source),e=d.aB(e),e=d.e(e,{source:c})),this._validate(d.u.layer,`layers.${c}`,e,{arrayIndex:-1},u))return;f=d.aA(e),this._validateLayer(f),f.setEventedParent(this,{layer:{id:c}})}const w=o?this._order.indexOf(o):this._order.length;if(o&&w===-1)this.fire(new d.j(new Error(`Cannot add layer "${c}" before non-existing layer "${o}".`)));else{if(this._order.splice(w,0,c),this._layerOrderChanged=!0,this._layers[c]=f,this._removedLayers[c]&&f.source&&f.type!=="custom"){const S=this._removedLayers[c];delete this._removedLayers[c],S.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(e,o){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===o)return;const u=this._order.indexOf(e);this._order.splice(u,1);const c=o?this._order.indexOf(o):this._order.length;o&&c===-1?this.fire(new d.j(new Error(`Cannot move layer "${e}" before non-existing layer "${o}".`))):(this._order.splice(c,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const o=this._layers[e];if(!o)return void this.fire(new d.j(new Error(`Cannot remove non-existing layer "${e}".`)));o.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=o,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],o.onRemove&&o.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,o,u){this._checkLoaded();const c=this.getLayer(e);c?c.minzoom===o&&c.maxzoom===u||(o!=null&&(c.minzoom=o),u!=null&&(c.maxzoom=u),this._updateLayer(c)):this.fire(new d.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,o,u={}){this._checkLoaded();const c=this.getLayer(e);if(c){if(!d.aE(c.filter,o))return o==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(d.u.filter,`layers.${c.id}.filter`,o,null,u)||(c.filter=d.aB(o),this._updateLayer(c)))}else this.fire(new d.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.aB(this.getLayer(e).filter)}setLayoutProperty(e,o,u,c={}){this._checkLoaded();const f=this.getLayer(e);f?d.aE(f.getLayoutProperty(o),u)||(f.setLayoutProperty(o,u,c),this._updateLayer(f)):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,o){const u=this.getLayer(e);if(u)return u.getLayoutProperty(o);this.fire(new d.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,o,u,c={}){this._checkLoaded();const f=this.getLayer(e);f?d.aE(f.getPaintProperty(o),u)||(f.setPaintProperty(o,u,c)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,o){return this.getLayer(e).getPaintProperty(o)}setFeatureState(e,o){this._checkLoaded();const u=e.source,c=e.sourceLayer,f=this.sourceCaches[u];if(f===void 0)return void this.fire(new d.j(new Error(`The source '${u}' does not exist in the map's style.`)));const w=f.getSource().type;w==="geojson"&&c?this.fire(new d.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||c?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),f.setFeatureState(c,e.id,o)):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,o){this._checkLoaded();const u=e.source,c=this.sourceCaches[u];if(c===void 0)return void this.fire(new d.j(new Error(`The source '${u}' does not exist in the map's style.`)));const f=c.getSource().type,w=f==="vector"?e.sourceLayer:void 0;f!=="vector"||w?o&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(w,e.id,o):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const o=e.source,u=e.sourceLayer,c=this.sourceCaches[o];if(c!==void 0)return c.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(u,e.id)):void this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=d.aF(this.sourceCaches,f=>f.serialize()),o=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,c=this.stylesheet;return d.aG({version:c.version,name:c.name,metadata:c.metadata,light:c.light,sky:c.sky,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:e,layers:o,terrain:u},f=>f!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const o=w=>this._layers[w].type==="fill-extrusion",u={},c=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(o(S)){u[S]=w;for(const E of e){const C=E[S];if(C)for(const A of C)c.push(A)}}}c.sort((w,S)=>S.intersectionZ-w.intersectionZ);const f=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(o(S))for(let E=c.length-1;E>=0;E--){const C=c[E].feature;if(u[C.layer.id]<w)break;f.push(C),c.pop()}else for(const E of e){const C=E[S];if(C)for(const A of C)f.push(A.feature)}}return f}queryRenderedFeatures(e,o,u){o&&o.filter&&this._validate(d.u.filter,"queryRenderedFeatures.filter",o.filter,null,o);const c={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new d.j(new Error("parameters.layers must be an Array."))),[];for(const S of o.layers){const E=this._layers[S];if(!E)return this.fire(new d.j(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];c[E.source]=!0}}const f=[];o.availableImages=this._availableImages;const w=this._serializedAllLayers();for(const S in this.sourceCaches)o.layers&&!c[S]||f.push(Yn(this.sourceCaches[S],this._layers,w,e,o,u));return this.placement&&f.push(function(S,E,C,A,M,F,V){const $={},K=F.queryRenderedSymbols(A),Y=[];for(const Q of Object.keys(K).map(Number))Y.push(V[Q]);Y.sort(mi);for(const Q of Y){const ne=Q.featureIndex.lookupSymbolFeatures(K[Q.bucketInstanceId],E,Q.bucketIndex,Q.sourceLayerIndex,M.filter,M.layers,M.availableImages,S);for(const W in ne){const le=$[W]=$[W]||[],de=ne[W];de.sort((ge,Ee)=>{const ze=Q.featureSortOrder;if(ze){const Ve=ze.indexOf(ge.featureIndex);return ze.indexOf(Ee.featureIndex)-Ve}return Ee.featureIndex-ge.featureIndex});for(const ge of de)le.push(ge)}}for(const Q in $)$[Q].forEach(ne=>{const W=ne.feature,le=C[S[Q].source].getFeatureState(W.layer["source-layer"],W.id);W.source=W.layer.source,W.layer["source-layer"]&&(W.sourceLayer=W.layer["source-layer"]),W.state=le});return $}(this._layers,w,this.sourceCaches,e,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(e,o){o&&o.filter&&this._validate(d.u.filter,"querySourceFeatures.filter",o.filter,null,o);const u=this.sourceCaches[e];return u?function(c,f){const w=c.getRenderableIds().map(C=>c.getTileByID(C)),S=[],E={};for(let C=0;C<w.length;C++){const A=w[C],M=A.tileID.canonical.key;E[M]||(E[M]=!0,A.querySourceFeatures(S,f))}return S}(u,o):[]}getLight(){return this.light.getLight()}setLight(e,o={}){this._checkLoaded();const u=this.light.getLight();let c=!1;for(const w in e)if(!d.aE(e[w],u[w])){c=!0;break}if(!c)return;const f={now:q.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,o),this.light.updateTransitions(f)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,o={}){const u=this.getSky();let c=!1;if(!e&&!u)return;if(e&&!u)c=!0;else if(!e&&u)c=!0;else for(const w in e)if(!d.aE(e[w],u[w])){c=!0;break}if(!c)return;const f={now:q.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,o),this.sky.updateTransitions(f)}_validate(e,o,u,c,f={}){return(!f||f.validate!==!1)&&xi(this,e.call(d.u,d.e({key:o,style:this.serialize(),value:u,styleSpec:d.v},c)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),lr().off(Ie,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const u=this.sourceCaches[o];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const o in this.sourceCaches)this.sourceCaches[o].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,o,u,c,f=!1){let w=!1,S=!1;const E={};for(const C of this._order){const A=this._layers[C];if(A.type!=="symbol")continue;if(!E[A.source]){const F=this.sourceCaches[A.source];E[A.source]=F.getRenderableIds(!0).map(V=>F.getTileByID(V)).sort((V,$)=>$.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan($.tileID)?-1:1))}const M=this.crossTileSymbolIndex.addLayer(A,E[A.source],e.center.lng);w=w||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(q.now(),e.zoom))&&(this.pauseablePlacement=new Yo(e,this.map.terrain,this._order,f,o,u,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(q.now()),S=!0),w&&this.pauseablePlacement.placement.setStale()),S||w)for(const C of this._order){const A=this._layers[C];A.type==="symbol"&&this.placement.updateLayerOpacities(A,E[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(q.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,o){return d._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[o.source];return c&&c.setDependencies(o.tileID.key,o.type,o.icons),u})}getGlyphs(e,o){return d._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(o.stacks),c=this.sourceCaches[o.source];return c&&c.setDependencies(o.tileID.key,o.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,o={}){this._checkLoaded(),e&&this._validate(d.u.glyphs,"glyphs",e,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,o,u={},c){this._checkLoaded();const f=[{id:e,url:o}],w=[..._t(this.stylesheet.sprite),...f];this._validate(d.u.sprite,"sprite",w,null,u)||(this.stylesheet.sprite=w,this._loadSprite(f,!0,c))}removeSprite(e){this._checkLoaded();const o=_t(this.stylesheet.sprite);if(o.find(u=>u.id===e)){if(this._spritesImagesIds[e])for(const u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;o.splice(o.findIndex(u=>u.id===e),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}else this.fire(new d.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return _t(this.stylesheet.sprite)}setSprite(e,o={},u){this._checkLoaded(),e&&this._validate(d.u.sprite,"sprite",e,null,o)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}}var ks=d.Y([{name:"a_pos",type:"Int16",components:2}]);const hs={prelude:qt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:qt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:qt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:qt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:qt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:qt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:qt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:qt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:qt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:qt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:qt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:qt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:qt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:qt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:qt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:qt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:qt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:qt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:qt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:qt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:qt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:qt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:qt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:qt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:qt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:qt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:qt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function qt(m,e){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/attribute ([\w]+) ([\w]+)/g),c=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=f?f.concat(c):c,S={};return{fragmentSource:m=m.replace(o,(E,C,A,M,F)=>(S[F]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${A} ${M} ${F};
#else
uniform ${A} ${M} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${A} ${M} ${F} = u_${F};
#endif
`)),vertexSource:e=e.replace(o,(E,C,A,M,F)=>{const V=M==="float"?"vec2":"vec4",$=F.match(/color/)?"color":V;return S[F]?C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${V} a_${F};
varying ${A} ${M} ${F};
#else
uniform ${A} ${M} u_${F};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${A} ${M} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${$}(a_${F}, u_${F}_t);
#else
    ${A} ${M} ${F} = u_${F};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${V} a_${F};
#else
uniform ${A} ${M} u_${F};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${M} ${F} = a_${F};
#else
    ${A} ${M} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${M} ${F} = unpack_mix_${$}(a_${F}, u_${F}_t);
#else
    ${A} ${M} ${F} = u_${F};
#endif
`}),staticAttributes:u,staticUniforms:w}}class yu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,o,u,c,f,w,S,E,C){this.context=e;let A=this.boundPaintVertexBuffers.length!==c.length;for(let M=0;!A&&M<c.length;M++)this.boundPaintVertexBuffers[M]!==c[M]&&(A=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==u||A||this.boundIndexBuffer!==f||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==C?this.freshBind(o,u,c,f,w,S,E,C):(e.bindVertexArray.set(this.vao),S&&S.bind(),f&&f.dynamicDraw&&f.bind(),E&&E.bind(),C&&C.bind())}freshBind(e,o,u,c,f,w,S,E){const C=e.numAttributes,A=this.context,M=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=c,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=E,o.enableAttributes(M,e);for(const F of u)F.enableAttributes(M,e);w&&w.enableAttributes(M,e),S&&S.enableAttributes(M,e),E&&E.enableAttributes(M,e),o.bind(),o.setVertexAttribPointers(M,e,f);for(const F of u)F.bind(),F.setVertexAttribPointers(M,e,f);w&&(w.bind(),w.setVertexAttribPointers(M,e,f)),c&&c.bind(),S&&(S.bind(),S.setVertexAttribPointers(M,e,f)),E&&(E.bind(),E.setVertexAttribPointers(M,e,f)),A.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const _u=(m,e,o,u,c)=>({u_matrix:m,u_texture:0,u_ele_delta:e,u_fog_matrix:o,u_fog_color:u?u.properties.get("fog-color"):d.aM.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:u?u.calculateFogBlendOpacity(c):0,u_horizon_color:u?u.properties.get("horizon-color"):d.aM.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1});function eo(m){const e=[];for(let o=0;o<m.length;o++){if(m[o]===null)continue;const u=m[o].split(" ");e.push(u.pop())}return e}class xu{constructor(e,o,u,c,f,w){const S=e.gl;this.program=S.createProgram();const E=eo(o.staticAttributes),C=u?u.getBinderAttributes():[],A=E.concat(C),M=hs.prelude.staticUniforms?eo(hs.prelude.staticUniforms):[],F=o.staticUniforms?eo(o.staticUniforms):[],V=u?u.getBinderUniforms():[],$=M.concat(F).concat(V),K=[];for(const ge of $)K.indexOf(ge)<0&&K.push(ge);const Y=u?u.defines():[];f&&Y.push("#define OVERDRAW_INSPECTOR;"),w&&Y.push("#define TERRAIN3D;");const Q=Y.concat(hs.prelude.fragmentSource,o.fragmentSource).join(`
`),ne=Y.concat(hs.prelude.vertexSource,o.vertexSource).join(`
`),W=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(W,Q),S.compileShader(W),!S.getShaderParameter(W,S.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${S.getShaderInfoLog(W)}`);S.attachShader(this.program,W);const le=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(le,ne),S.compileShader(le),!S.getShaderParameter(le,S.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${S.getShaderInfoLog(le)}`);S.attachShader(this.program,le),this.attributes={};const de={};this.numAttributes=A.length;for(let ge=0;ge<this.numAttributes;ge++)A[ge]&&(S.bindAttribLocation(this.program,ge,A[ge]),this.attributes[A[ge]]=ge);if(S.linkProgram(this.program),!S.getProgramParameter(this.program,S.LINK_STATUS))throw new Error(`Program failed to link: ${S.getProgramInfoLog(this.program)}`);S.deleteShader(le),S.deleteShader(W);for(let ge=0;ge<K.length;ge++){const Ee=K[ge];if(Ee&&!de[Ee]){const ze=S.getUniformLocation(this.program,Ee);ze&&(de[Ee]=ze)}}this.fixedUniforms=c(e,de),this.terrainUniforms=((ge,Ee)=>({u_depth:new d.aH(ge,Ee.u_depth),u_terrain:new d.aH(ge,Ee.u_terrain),u_terrain_dim:new d.aI(ge,Ee.u_terrain_dim),u_terrain_matrix:new d.aJ(ge,Ee.u_terrain_matrix),u_terrain_unpack:new d.aK(ge,Ee.u_terrain_unpack),u_terrain_exaggeration:new d.aI(ge,Ee.u_terrain_exaggeration)}))(e,de),this.binderUniforms=u?u.getUniforms(e,de):[]}draw(e,o,u,c,f,w,S,E,C,A,M,F,V,$,K,Y,Q,ne){const W=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(c),e.setColorMode(f),e.setCullFace(w),E){e.activeTexture.set(W.TEXTURE2),W.bindTexture(W.TEXTURE_2D,E.depthTexture),e.activeTexture.set(W.TEXTURE3),W.bindTexture(W.TEXTURE_2D,E.texture);for(const de in this.terrainUniforms)this.terrainUniforms[de].set(E[de])}for(const de in this.fixedUniforms)this.fixedUniforms[de].set(S[de]);K&&K.setUniforms(e,this.binderUniforms,V,{zoom:$});let le=0;switch(o){case W.LINES:le=2;break;case W.TRIANGLES:le=3;break;case W.LINE_STRIP:le=1}for(const de of F.get()){const ge=de.vaos||(de.vaos={});(ge[C]||(ge[C]=new yu)).bind(e,this,A,K?K.getPaintVertexBuffers():[],M,de.vertexOffset,Y,Q,ne),W.drawElements(o,de.primitiveLength*le,W.UNSIGNED_SHORT,de.primitiveOffset*le*2)}}}function Za(m,e,o){const u=1/At(o,1,e.transform.tileZoom),c=Math.pow(2,o.tileID.overscaledZ),f=o.tileSize*Math.pow(2,e.transform.tileZoom)/c,w=f*(o.tileID.canonical.x+o.tileID.wrap*c),S=f*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[u,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[w>>16,S>>16],u_pixel_coord_lower:[65535&w,65535&S]}}const Qo=(m,e,o,u)=>{const c=e.style.light,f=c.properties.get("position"),w=[f.x,f.y,f.z],S=function(){var C=new d.A(9);return d.A!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[5]=0,C[6]=0,C[7]=0),C[0]=1,C[4]=1,C[8]=1,C}();c.properties.get("anchor")==="viewport"&&function(C,A){var M=Math.sin(A),F=Math.cos(A);C[0]=F,C[1]=M,C[2]=0,C[3]=-M,C[4]=F,C[5]=0,C[6]=0,C[7]=0,C[8]=1}(S,-e.transform.angle),function(C,A,M){var F=A[0],V=A[1],$=A[2];C[0]=F*M[0]+V*M[3]+$*M[6],C[1]=F*M[1]+V*M[4]+$*M[7],C[2]=F*M[2]+V*M[5]+$*M[8]}(w,w,S);const E=c.properties.get("color");return{u_matrix:m,u_lightpos:w,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+o,u_opacity:u}},Ha=(m,e,o,u,c,f,w)=>d.e(Qo(m,e,o,u),Za(f,e,w),{u_height_factor:-Math.pow(2,c.overscaledZ)/w.tileSize/8}),to=m=>({u_matrix:m}),_h=(m,e,o,u)=>d.e(to(m),Za(o,e,u)),Gp=(m,e)=>({u_matrix:m,u_world:e}),xh=(m,e,o,u,c)=>d.e(_h(m,e,o,u),{u_world:c}),Wp=(m,e,o,u)=>{const c=m.transform;let f,w;if(u.paint.get("circle-pitch-alignment")==="map"){const S=At(o,1,c.zoom);f=!0,w=[S,S]}else f=!1,w=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(e.posMatrix,o,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+f,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:w}},Is=(m,e,o)=>({u_matrix:m,u_inv_matrix:e,u_camera_to_center_distance:o.cameraToCenterDistance,u_viewport_size:[o.width,o.height]}),ea=(m,e,o=1)=>({u_matrix:m,u_color:e,u_overlay:0,u_overlay_scale:o}),En=m=>({u_matrix:m}),kn=(m,e,o,u)=>({u_matrix:m,u_extrude_scale:At(e,1,o),u_intensity:u}),Ga=(m,e,o,u)=>{const c=d.H();d.aP(c,0,m.width,m.height,0,0,1);const f=m.context.gl;return{u_matrix:c,u_world:[f.drawingBufferWidth,f.drawingBufferHeight],u_image:o,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}};function Wa(m,e){const o=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new d.Z(0,u/o).toLngLat().lat,new d.Z(0,(u+1)/o).toLngLat().lat]}const Xa=(m,e,o,u)=>{const c=m.transform;return{u_matrix:bh(m,e,o,u),u_ratio:1/At(e,1,c.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},vh=(m,e,o,u,c)=>d.e(Xa(m,e,o,c),{u_image:0,u_image_height:u}),ro=(m,e,o,u,c)=>{const f=m.transform,w=wh(e,f);return{u_matrix:bh(m,e,o,c),u_texsize:e.imageAtlasTexture.size,u_ratio:1/At(e,1,f.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[w,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Xp=(m,e,o,u,c,f)=>{const w=m.lineAtlas,S=wh(e,m.transform),E=o.layout.get("line-cap")==="round",C=w.getDash(u.from,E),A=w.getDash(u.to,E),M=C.width*c.fromScale,F=A.width*c.toScale;return d.e(Xa(m,e,o,f),{u_patternscale_a:[S/M,-C.height/2],u_patternscale_b:[S/F,-A.height/2],u_sdfgamma:w.width/(256*Math.min(M,F)*m.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:A.y,u_mix:c.t})};function wh(m,e){return 1/At(m,1,e.tileZoom)}function bh(m,e,o,u){return m.translatePosMatrix(u?u.posMatrix:e.tileID.posMatrix,e,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const Kp=(m,e,o,u,c)=>{return{u_matrix:m,u_tl_parent:e,u_scale_parent:o,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(w=c.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(f=c.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:Jp(c.paint.get("raster-hue-rotate"))};var f,w};function Jp(m){m*=Math.PI/180;const e=Math.sin(m),o=Math.cos(m);return[(2*o+1)/3,(-Math.sqrt(3)*e-o+1)/3,(Math.sqrt(3)*e-o+1)/3]}const Sh=(m,e,o,u,c,f,w,S,E,C,A,M,F,V)=>{const $=w.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:$.width/$.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:E,u_coord_matrix:C,u_is_text:+M,u_pitch_with_map:+u,u_is_along_line:c,u_is_variable_anchor:f,u_texsize:F,u_texture:0,u_translation:A,u_pitched_scale:V}},ta=(m,e,o,u,c,f,w,S,E,C,A,M,F,V,$)=>{const K=w.transform;return d.e(Sh(m,e,o,u,c,f,w,S,E,C,A,M,F,$),{u_gamma_scale:u?Math.cos(K._pitch)*K.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:1})},vu=(m,e,o,u,c,f,w,S,E,C,A,M,F,V)=>d.e(ta(m,e,o,u,c,f,w,S,E,C,A,!0,M,!0,V),{u_texsize_icon:F,u_texture_icon:1}),Ka=(m,e,o)=>({u_matrix:m,u_opacity:e,u_color:o}),wu=(m,e,o,u,c,f)=>d.e(function(w,S,E,C){const A=E.imageManager.getPattern(w.from.toString()),M=E.imageManager.getPattern(w.to.toString()),{width:F,height:V}=E.imageManager.getPixelSize(),$=Math.pow(2,C.tileID.overscaledZ),K=C.tileSize*Math.pow(2,E.transform.tileZoom)/$,Y=K*(C.tileID.canonical.x+C.tileID.wrap*$),Q=K*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[F,V],u_mix:S.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/At(C,1,E.transform.tileZoom),u_pixel_coord_upper:[Y>>16,Q>>16],u_pixel_coord_lower:[65535&Y,65535&Q]}}(u,f,o,c),{u_matrix:m,u_opacity:e}),bu={fillExtrusion:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_lightpos:new d.aN(m,e.u_lightpos),u_lightintensity:new d.aI(m,e.u_lightintensity),u_lightcolor:new d.aN(m,e.u_lightcolor),u_vertical_gradient:new d.aI(m,e.u_vertical_gradient),u_opacity:new d.aI(m,e.u_opacity)}),fillExtrusionPattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_lightpos:new d.aN(m,e.u_lightpos),u_lightintensity:new d.aI(m,e.u_lightintensity),u_lightcolor:new d.aN(m,e.u_lightcolor),u_vertical_gradient:new d.aI(m,e.u_vertical_gradient),u_height_factor:new d.aI(m,e.u_height_factor),u_image:new d.aH(m,e.u_image),u_texsize:new d.aO(m,e.u_texsize),u_pixel_coord_upper:new d.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(m,e.u_pixel_coord_lower),u_scale:new d.aN(m,e.u_scale),u_fade:new d.aI(m,e.u_fade),u_opacity:new d.aI(m,e.u_opacity)}),fill:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix)}),fillPattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_image:new d.aH(m,e.u_image),u_texsize:new d.aO(m,e.u_texsize),u_pixel_coord_upper:new d.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(m,e.u_pixel_coord_lower),u_scale:new d.aN(m,e.u_scale),u_fade:new d.aI(m,e.u_fade)}),fillOutline:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_world:new d.aO(m,e.u_world)}),fillOutlinePattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_world:new d.aO(m,e.u_world),u_image:new d.aH(m,e.u_image),u_texsize:new d.aO(m,e.u_texsize),u_pixel_coord_upper:new d.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(m,e.u_pixel_coord_lower),u_scale:new d.aN(m,e.u_scale),u_fade:new d.aI(m,e.u_fade)}),circle:(m,e)=>({u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_scale_with_map:new d.aH(m,e.u_scale_with_map),u_pitch_with_map:new d.aH(m,e.u_pitch_with_map),u_extrude_scale:new d.aO(m,e.u_extrude_scale),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_matrix:new d.aJ(m,e.u_matrix)}),collisionBox:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_pixel_extrude_scale:new d.aO(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_inv_matrix:new d.aJ(m,e.u_inv_matrix),u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_viewport_size:new d.aO(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new d.aL(m,e.u_color),u_matrix:new d.aJ(m,e.u_matrix),u_overlay:new d.aH(m,e.u_overlay),u_overlay_scale:new d.aI(m,e.u_overlay_scale)}),clippingMask:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix)}),heatmap:(m,e)=>({u_extrude_scale:new d.aI(m,e.u_extrude_scale),u_intensity:new d.aI(m,e.u_intensity),u_matrix:new d.aJ(m,e.u_matrix)}),heatmapTexture:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_world:new d.aO(m,e.u_world),u_image:new d.aH(m,e.u_image),u_color_ramp:new d.aH(m,e.u_color_ramp),u_opacity:new d.aI(m,e.u_opacity)}),hillshade:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_image:new d.aH(m,e.u_image),u_latrange:new d.aO(m,e.u_latrange),u_light:new d.aO(m,e.u_light),u_shadow:new d.aL(m,e.u_shadow),u_highlight:new d.aL(m,e.u_highlight),u_accent:new d.aL(m,e.u_accent)}),hillshadePrepare:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_image:new d.aH(m,e.u_image),u_dimension:new d.aO(m,e.u_dimension),u_zoom:new d.aI(m,e.u_zoom),u_unpack:new d.aK(m,e.u_unpack)}),line:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_ratio:new d.aI(m,e.u_ratio),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_ratio:new d.aI(m,e.u_ratio),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(m,e.u_units_to_pixels),u_image:new d.aH(m,e.u_image),u_image_height:new d.aI(m,e.u_image_height)}),linePattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_texsize:new d.aO(m,e.u_texsize),u_ratio:new d.aI(m,e.u_ratio),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_image:new d.aH(m,e.u_image),u_units_to_pixels:new d.aO(m,e.u_units_to_pixels),u_scale:new d.aN(m,e.u_scale),u_fade:new d.aI(m,e.u_fade)}),lineSDF:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_ratio:new d.aI(m,e.u_ratio),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(m,e.u_units_to_pixels),u_patternscale_a:new d.aO(m,e.u_patternscale_a),u_patternscale_b:new d.aO(m,e.u_patternscale_b),u_sdfgamma:new d.aI(m,e.u_sdfgamma),u_image:new d.aH(m,e.u_image),u_tex_y_a:new d.aI(m,e.u_tex_y_a),u_tex_y_b:new d.aI(m,e.u_tex_y_b),u_mix:new d.aI(m,e.u_mix)}),raster:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_tl_parent:new d.aO(m,e.u_tl_parent),u_scale_parent:new d.aI(m,e.u_scale_parent),u_buffer_scale:new d.aI(m,e.u_buffer_scale),u_fade_t:new d.aI(m,e.u_fade_t),u_opacity:new d.aI(m,e.u_opacity),u_image0:new d.aH(m,e.u_image0),u_image1:new d.aH(m,e.u_image1),u_brightness_low:new d.aI(m,e.u_brightness_low),u_brightness_high:new d.aI(m,e.u_brightness_high),u_saturation_factor:new d.aI(m,e.u_saturation_factor),u_contrast_factor:new d.aI(m,e.u_contrast_factor),u_spin_weights:new d.aN(m,e.u_spin_weights)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new d.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(m,e.u_is_size_feature_constant),u_size_t:new d.aI(m,e.u_size_t),u_size:new d.aI(m,e.u_size),u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_pitch:new d.aI(m,e.u_pitch),u_rotate_symbol:new d.aH(m,e.u_rotate_symbol),u_aspect_ratio:new d.aI(m,e.u_aspect_ratio),u_fade_change:new d.aI(m,e.u_fade_change),u_matrix:new d.aJ(m,e.u_matrix),u_label_plane_matrix:new d.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(m,e.u_coord_matrix),u_is_text:new d.aH(m,e.u_is_text),u_pitch_with_map:new d.aH(m,e.u_pitch_with_map),u_is_along_line:new d.aH(m,e.u_is_along_line),u_is_variable_anchor:new d.aH(m,e.u_is_variable_anchor),u_texsize:new d.aO(m,e.u_texsize),u_texture:new d.aH(m,e.u_texture),u_translation:new d.aO(m,e.u_translation),u_pitched_scale:new d.aI(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new d.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(m,e.u_is_size_feature_constant),u_size_t:new d.aI(m,e.u_size_t),u_size:new d.aI(m,e.u_size),u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_pitch:new d.aI(m,e.u_pitch),u_rotate_symbol:new d.aH(m,e.u_rotate_symbol),u_aspect_ratio:new d.aI(m,e.u_aspect_ratio),u_fade_change:new d.aI(m,e.u_fade_change),u_matrix:new d.aJ(m,e.u_matrix),u_label_plane_matrix:new d.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(m,e.u_coord_matrix),u_is_text:new d.aH(m,e.u_is_text),u_pitch_with_map:new d.aH(m,e.u_pitch_with_map),u_is_along_line:new d.aH(m,e.u_is_along_line),u_is_variable_anchor:new d.aH(m,e.u_is_variable_anchor),u_texsize:new d.aO(m,e.u_texsize),u_texture:new d.aH(m,e.u_texture),u_gamma_scale:new d.aI(m,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_is_halo:new d.aH(m,e.u_is_halo),u_translation:new d.aO(m,e.u_translation),u_pitched_scale:new d.aI(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new d.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(m,e.u_is_size_feature_constant),u_size_t:new d.aI(m,e.u_size_t),u_size:new d.aI(m,e.u_size),u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_pitch:new d.aI(m,e.u_pitch),u_rotate_symbol:new d.aH(m,e.u_rotate_symbol),u_aspect_ratio:new d.aI(m,e.u_aspect_ratio),u_fade_change:new d.aI(m,e.u_fade_change),u_matrix:new d.aJ(m,e.u_matrix),u_label_plane_matrix:new d.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(m,e.u_coord_matrix),u_is_text:new d.aH(m,e.u_is_text),u_pitch_with_map:new d.aH(m,e.u_pitch_with_map),u_is_along_line:new d.aH(m,e.u_is_along_line),u_is_variable_anchor:new d.aH(m,e.u_is_variable_anchor),u_texsize:new d.aO(m,e.u_texsize),u_texsize_icon:new d.aO(m,e.u_texsize_icon),u_texture:new d.aH(m,e.u_texture),u_texture_icon:new d.aH(m,e.u_texture_icon),u_gamma_scale:new d.aI(m,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_is_halo:new d.aH(m,e.u_is_halo),u_translation:new d.aO(m,e.u_translation),u_pitched_scale:new d.aI(m,e.u_pitched_scale)}),background:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_opacity:new d.aI(m,e.u_opacity),u_color:new d.aL(m,e.u_color)}),backgroundPattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_opacity:new d.aI(m,e.u_opacity),u_image:new d.aH(m,e.u_image),u_pattern_tl_a:new d.aO(m,e.u_pattern_tl_a),u_pattern_br_a:new d.aO(m,e.u_pattern_br_a),u_pattern_tl_b:new d.aO(m,e.u_pattern_tl_b),u_pattern_br_b:new d.aO(m,e.u_pattern_br_b),u_texsize:new d.aO(m,e.u_texsize),u_mix:new d.aI(m,e.u_mix),u_pattern_size_a:new d.aO(m,e.u_pattern_size_a),u_pattern_size_b:new d.aO(m,e.u_pattern_size_b),u_scale_a:new d.aI(m,e.u_scale_a),u_scale_b:new d.aI(m,e.u_scale_b),u_pixel_coord_upper:new d.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.aI(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_texture:new d.aH(m,e.u_texture),u_ele_delta:new d.aI(m,e.u_ele_delta),u_fog_matrix:new d.aJ(m,e.u_fog_matrix),u_fog_color:new d.aL(m,e.u_fog_color),u_fog_ground_blend:new d.aI(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.aI(m,e.u_fog_ground_blend_opacity),u_horizon_color:new d.aL(m,e.u_horizon_color),u_horizon_fog_blend:new d.aI(m,e.u_horizon_fog_blend)}),terrainDepth:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_ele_delta:new d.aI(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_texture:new d.aH(m,e.u_texture),u_terrain_coords_id:new d.aI(m,e.u_terrain_coords_id),u_ele_delta:new d.aI(m,e.u_ele_delta)}),sky:(m,e)=>({u_sky_color:new d.aL(m,e.u_sky_color),u_horizon_color:new d.aL(m,e.u_horizon_color),u_horizon:new d.aI(m,e.u_horizon),u_sky_horizon_blend:new d.aI(m,e.u_sky_horizon_blend)})};class Li{constructor(e,o,u){this.context=e;const c=e.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Yp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Su{constructor(e,o,u,c){this.length=o.length,this.attributes=u,this.itemSize=o.bytesPerElement,this.dynamicDraw=c,this.context=e;const f=e.gl;this.buffer=f.createBuffer(),e.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,o){for(let u=0;u<this.attributes.length;u++){const c=o.attributes[this.attributes[u].name];c!==void 0&&e.enableVertexAttribArray(c)}}setVertexAttribPointers(e,o,u){for(let c=0;c<this.attributes.length;c++){const f=this.attributes[c],w=o.attributes[f.name];w!==void 0&&e.vertexAttribPointer(w,f.components,e[Yp[f.type]],!1,this.itemSize,f.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Cs=new WeakMap;function ds(m){var e;if(Cs.has(m))return Cs.get(m);{const o=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Cs.set(m,o),o}}class Zt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ja extends Zt{getDefault(){return d.aM.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Qp extends Zt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class no extends Zt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class ef extends Zt{getDefault(){return[!0,!0,!0,!0]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Th extends Zt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class tf extends Zt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Eh extends Zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const o=this.current;(e.func!==o.func||e.ref!==o.ref||e.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Tu extends Zt{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class kh extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=e,this.dirty=!1}}class Ih extends Zt{getDefault(){return[0,1]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ch extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=e,this.dirty=!1}}class Ph extends Zt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Ps extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.BLEND):o.disable(o.BLEND),this.current=e,this.dirty=!1}}class Ah extends Zt{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class rf extends Zt{getDefault(){return d.aM.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Mh extends Zt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ra extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=e,this.dirty=!1}}class nf extends Zt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Ya extends Zt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class sf extends Zt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class of extends Zt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class zh extends Zt{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Rh extends Zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Dh extends Zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Eu extends Zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Lh extends Zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Qa extends Zt{getDefault(){return null}set(e){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ki extends Zt{getDefault(){return null}set(e){var o;if(e===this.current&&!this.dirty)return;const u=this.gl;ds(u)?u.bindVertexArray(e):(o=u.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class ku extends Zt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Iu extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Cu extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class el extends Zt{constructor(e,o){super(e),this.context=e,this.parent=o}getDefault(){return null}}class Pu extends el{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class As extends el{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Au extends el{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class af{constructor(e,o,u,c,f){this.context=e,this.width=o,this.height=u;const w=e.gl,S=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new Pu(e,S),c)this.depthAttachment=f?new Au(e,S):new As(e,S);else if(f)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,o=this.colorAttachment.get();if(o&&e.deleteTexture(o),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class Tr{constructor(e,o,u){this.blendFunction=e,this.blendColor=o,this.mask=u}}Tr.Replace=[1,0],Tr.disabled=new Tr(Tr.Replace,d.aM.transparent,[!1,!1,!1,!1]),Tr.unblended=new Tr(Tr.Replace,d.aM.transparent,[!0,!0,!0,!0]),Tr.alphaBlended=new Tr([1,771],d.aM.transparent,[!0,!0,!0,!0]);class lf{constructor(e){var o,u;if(this.gl=e,this.clearColor=new Ja(this),this.clearDepth=new Qp(this),this.clearStencil=new no(this),this.colorMask=new ef(this),this.depthMask=new Th(this),this.stencilMask=new tf(this),this.stencilFunc=new Eh(this),this.stencilOp=new Tu(this),this.stencilTest=new kh(this),this.depthRange=new Ih(this),this.depthTest=new Ch(this),this.depthFunc=new Ph(this),this.blend=new Ps(this),this.blendFunc=new Ah(this),this.blendColor=new rf(this),this.blendEquation=new Mh(this),this.cullFace=new ra(this),this.cullFaceSide=new nf(this),this.frontFace=new Ya(this),this.program=new sf(this),this.activeTexture=new of(this),this.viewport=new zh(this),this.bindFramebuffer=new Rh(this),this.bindRenderbuffer=new Dh(this),this.bindTexture=new Eu(this),this.bindVertexBuffer=new Lh(this),this.bindElementBuffer=new Qa(this),this.bindVertexArray=new Ki(this),this.pixelStoreUnpack=new ku(this),this.pixelStoreUnpackPremultiplyAlpha=new Iu(this),this.pixelStoreUnpackFlipY=new Cu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ds(e)){this.HALF_FLOAT=e.HALF_FLOAT;const c=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=e.RGBA16F)!==null&&o!==void 0?o:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:c==null?void 0:c.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const c=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,o){return new Li(this,e,o)}createVertexBuffer(e,o,u){return new Su(this,e,o,u)}createRenderbuffer(e,o,u){const c=this.gl,f=c.createRenderbuffer();return this.bindRenderbuffer.set(f),c.renderbufferStorage(c.RENDERBUFFER,e,o,u),this.bindRenderbuffer.set(null),f}createFramebuffer(e,o,u,c){return new af(this,e,o,u,c)}clear({color:e,depth:o,stencil:u}){const c=this.gl;let f=0;e&&(f|=c.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(f|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),u!==void 0&&(f|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),c.clear(f)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.aE(e.blendFunction,Tr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ds(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var o;return ds(this.gl)?this.gl.deleteVertexArray(e):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class Ct{constructor(e,o,u){this.func=e,this.mask=o,this.range=u}}Ct.ReadOnly=!1,Ct.ReadWrite=!0,Ct.disabled=new Ct(519,Ct.ReadOnly,[0,1]);const tl=7680;class ir{constructor(e,o,u,c,f,w){this.test=e,this.ref=o,this.mask=u,this.fail=c,this.depthFail=f,this.pass=w}}ir.disabled=new ir({func:519,mask:0},0,0,tl,tl,tl);class Qt{constructor(e,o,u){this.enable=e,this.mode=o,this.frontFace=u}}let Ms;function na(m,e,o,u,c){const f=m.context,w=f.gl,S=m.useProgram("collisionBox"),E=[];let C=0,A=0;for(let Q=0;Q<u.length;Q++){const ne=u[Q],W=e.getTile(ne).getBucket(o);if(!W)continue;const le=c?W.textCollisionBox:W.iconCollisionBox,de=W.collisionCircleArray;if(de.length>0){const ge=d.H();d.aQ(ge,W.placementInvProjMatrix,m.transform.glCoordMatrix),d.aQ(ge,ge,W.placementViewportMatrix),E.push({circleArray:de,circleOffset:A,transform:ne.posMatrix,invTransform:ge,coord:ne}),C+=de.length/4,A=C}le&&S.draw(f,w.LINES,Ct.disabled,ir.disabled,m.colorModeForRenderPass(),Qt.disabled,{u_matrix:ne.posMatrix,u_pixel_extrude_scale:[1/(M=m.transform).width,1/M.height]},m.style.map.terrain&&m.style.map.terrain.getTerrainData(ne),o.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,null,m.transform.zoom,null,null,le.collisionVertexBuffer)}var M;if(!c||!E.length)return;const F=m.useProgram("collisionCircle"),V=new d.aR;V.resize(4*C),V._trim();let $=0;for(const Q of E)for(let ne=0;ne<Q.circleArray.length/4;ne++){const W=4*ne,le=Q.circleArray[W+0],de=Q.circleArray[W+1],ge=Q.circleArray[W+2],Ee=Q.circleArray[W+3];V.emplace($++,le,de,ge,Ee,0),V.emplace($++,le,de,ge,Ee,1),V.emplace($++,le,de,ge,Ee,2),V.emplace($++,le,de,ge,Ee,3)}(!Ms||Ms.length<2*C)&&(Ms=function(Q){const ne=2*Q,W=new d.aT;W.resize(ne),W._trim();for(let le=0;le<ne;le++){const de=6*le;W.uint16[de+0]=4*le+0,W.uint16[de+1]=4*le+1,W.uint16[de+2]=4*le+2,W.uint16[de+3]=4*le+2,W.uint16[de+4]=4*le+3,W.uint16[de+5]=4*le+0}return W}(C));const K=f.createIndexBuffer(Ms,!0),Y=f.createVertexBuffer(V,d.aS.members,!0);for(const Q of E){const ne=Is(Q.transform,Q.invTransform,m.transform);F.draw(f,w.TRIANGLES,Ct.disabled,ir.disabled,m.colorModeForRenderPass(),Qt.disabled,ne,m.style.map.terrain&&m.style.map.terrain.getTerrainData(Q.coord),o.id,Y,K,d.a0.simpleSegment(0,2*Q.circleOffset,Q.circleArray.length,Q.circleArray.length/2),null,m.transform.zoom,null,null,null)}Y.destroy(),K.destroy()}Qt.disabled=new Qt(!1,1029,2305),Qt.backCCW=new Qt(!0,1029,2305);const ia=d.an(new Float32Array(16));function Mu(m,e,o,u,c,f){const{horizontalAlign:w,verticalAlign:S}=d.au(m);return new d.P((-(w-.5)*e/c+u[0])*f,(-(S-.5)*o/c+u[1])*f)}function zs(m,e,o,u,c,f){const w=e.tileAnchorPoint.add(new d.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let S=u.mult(f);o||(S=S.rotate(-c));const E=w.add(S);return G(E.x,E.y,e.labelPlaneMatrix,e.getElevation).point}if(o){const S=ve(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),E=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return m.add(u.rotate(E))}return m.add(u)}function io(m,e,o,u,c,f,w,S,E,C,A,M,F,V){const $=m.text.placedSymbolArray,K=m.text.dynamicLayoutVertexArray,Y=m.icon.dynamicLayoutVertexArray,Q={};K.clear();for(let ne=0;ne<$.length;ne++){const W=$.get(ne),le=W.hidden||!W.crossTileID||m.allowVerticalPlacement&&!W.placedOrientation?null:u[W.crossTileID];if(le){const de=new d.P(W.anchorX,W.anchorY),ge={getElevation:V,width:c.width,height:c.height,labelPlaneMatrix:f,pitchWithMap:o,projection:A,tileAnchorPoint:de,translation:M,unwrappedTileID:F},Ee=o?G(de.x,de.y,w,V):ve(de.x,de.y,ge),ze=R(c.cameraToCenterDistance,Ee.signedDistanceFromCamera);let Ve=d.ai(m.textSizeData,E,W)*ze/d.ap;o&&(Ve*=m.tilePixelRatio/S);const{width:Ge,height:Be,anchor:Fe,textOffset:tt,textBoxScale:bt}=le,Ne=Mu(Fe,Ge,Be,tt,bt,Ve),qe=A.getPitchedTextCorrection(c,de.add(new d.P(M[0],M[1])),F),xt=zs(Ee.point,ge,e,Ne,c.angle,qe),cr=m.allowVerticalPlacement&&W.placedOrientation===d.ah.vertical?Math.PI/2:0;for(let kt=0;kt<W.numGlyphs;kt++)d.aj(K,xt,cr);C&&W.associatedIconIndex>=0&&(Q[W.associatedIconIndex]={shiftedAnchor:xt,angle:cr})}else lt(W.numGlyphs,K)}if(C){Y.clear();const ne=m.icon.placedSymbolArray;for(let W=0;W<ne.length;W++){const le=ne.get(W);if(le.hidden)lt(le.numGlyphs,Y);else{const de=Q[W];if(de)for(let ge=0;ge<le.numGlyphs;ge++)d.aj(Y,de.shiftedAnchor,de.angle);else lt(le.numGlyphs,Y)}}m.icon.dynamicLayoutVertexBuffer.updateData(Y)}m.text.dynamicLayoutVertexBuffer.updateData(K)}function ti(m,e,o){return o.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function zu(m,e,o,u,c,f,w,S,E,C,A,M){const F=m.context,V=F.gl,$=m.transform,K=Es(),Y=S==="map",Q=E==="map",ne=S!=="viewport"&&o.layout.get("symbol-placement")!=="point",W=Y&&!Q&&!ne,le=!Q&&ne,de=!o.layout.get("symbol-sort-key").isConstant();let ge=!1;const Ee=m.depthModeForSublayer(0,Ct.ReadOnly),ze=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ve=[],Ge=K.getCircleRadiusCorrection($);for(const Be of u){const Fe=e.getTile(Be),tt=Fe.getBucket(o);if(!tt)continue;const bt=c?tt.text:tt.icon;if(!bt||!bt.segments.get().length||!bt.hasVisibleVertices)continue;const Ne=bt.programConfigurations.get(o.id),qe=c||tt.sdfIcons,xt=c?tt.textSizeData:tt.iconSizeData,cr=Q||$.pitch!==0,kt=m.useProgram(ti(qe,c,tt),Ne),Mt=d.ag(xt,$.zoom),hr=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Be);let sn,bi,dr,In,gn=[0,0],on=null;if(c)bi=Fe.glyphAtlasTexture,dr=V.LINEAR,sn=Fe.glyphAtlasTexture.size,tt.iconsInText&&(gn=Fe.imageAtlasTexture.size,on=Fe.imageAtlasTexture,In=cr||m.options.rotating||m.options.zooming||xt.kind==="composite"||xt.kind==="camera"?V.LINEAR:V.NEAREST);else{const Rt=o.layout.get("icon-size").constantOr(0)!==1||tt.iconsNeedLinear;bi=Fe.imageAtlasTexture,dr=qe||m.options.rotating||m.options.zooming||Rt||cr?V.LINEAR:V.NEAREST,sn=Fe.imageAtlasTexture.size}const yn=At(Fe,1,m.transform.zoom),Bi=le?Be.posMatrix:ia,vo=Bn(Bi,Q,Y,m.transform,yn),vl=fn(Bi,Q,Y,m.transform,yn),wo=fn(Be.posMatrix,Q,Y,m.transform,yn),ii=K.translatePosition(m.transform,Fe,f,w),wl=ze&&tt.hasTextData(),nc=o.layout.get("icon-text-fit")!=="none"&&wl&&tt.hasIconData();if(ne){const Rt=m.style.map.terrain?(bo,So)=>m.style.map.terrain.getElevation(Be,bo,So):null,Os=o.layout.get("text-rotation-alignment")==="map";B(tt,Be.posMatrix,m,c,vo,wo,Q,C,Os,K,Be.toUnwrapped(),$.width,$.height,ii,Rt)}const si=Be.posMatrix,oi=c&&ze||nc,ps=ne||oi?ia:vo,Si=vl,Qr=qe&&o.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let an;an=qe?tt.iconsInText?vu(xt.kind,Mt,W,Q,ne,oi,m,si,ps,Si,ii,sn,gn,Ge):ta(xt.kind,Mt,W,Q,ne,oi,m,si,ps,Si,ii,c,sn,!0,Ge):Sh(xt.kind,Mt,W,Q,ne,oi,m,si,ps,Si,ii,c,sn,Ge);const qn={program:kt,buffers:bt,uniformValues:an,atlasTexture:bi,atlasTextureIcon:on,atlasInterpolation:dr,atlasInterpolationIcon:In,isSDF:qe,hasHalo:Qr};if(de&&tt.canOverlap){ge=!0;const Rt=bt.segments.get();for(const Os of Rt)Ve.push({segments:new d.a0([Os]),sortKey:Os.sortKey,state:qn,terrainData:hr})}else Ve.push({segments:bt.segments,sortKey:0,state:qn,terrainData:hr})}ge&&Ve.sort((Be,Fe)=>Be.sortKey-Fe.sortKey);for(const Be of Ve){const Fe=Be.state;if(F.activeTexture.set(V.TEXTURE0),Fe.atlasTexture.bind(Fe.atlasInterpolation,V.CLAMP_TO_EDGE),Fe.atlasTextureIcon&&(F.activeTexture.set(V.TEXTURE1),Fe.atlasTextureIcon&&Fe.atlasTextureIcon.bind(Fe.atlasInterpolationIcon,V.CLAMP_TO_EDGE)),Fe.isSDF){const tt=Fe.uniformValues;Fe.hasHalo&&(tt.u_is_halo=1,Ru(Fe.buffers,Be.segments,o,m,Fe.program,Ee,A,M,tt,Be.terrainData)),tt.u_is_halo=0}Ru(Fe.buffers,Be.segments,o,m,Fe.program,Ee,A,M,Fe.uniformValues,Be.terrainData)}}function Ru(m,e,o,u,c,f,w,S,E,C){const A=u.context;c.draw(A,A.gl.TRIANGLES,f,w,S,Qt.disabled,E,C,o.id,m.layoutVertexBuffer,m.indexBuffer,e,o.paint,u.transform.zoom,m.programConfigurations.get(o.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Du(m,e,o,u){const c=m.context,f=c.gl,w=ir.disabled,S=new Tr([f.ONE,f.ONE],d.aM.transparent,[!0,!0,!0,!0]),E=e.getBucket(o);if(!E)return;const C=u.key;let A=o.heatmapFbos.get(C);A||(A=sa(c,e.tileSize,e.tileSize),o.heatmapFbos.set(C,A)),c.bindFramebuffer.set(A.framebuffer),c.viewport.set([0,0,e.tileSize,e.tileSize]),c.clear({color:d.aM.transparent});const M=E.programConfigurations.get(o.id),F=m.useProgram("heatmap",M),V=m.style.map.terrain.getTerrainData(u);F.draw(c,f.TRIANGLES,Ct.disabled,w,S,Qt.disabled,kn(u.posMatrix,e,m.transform.zoom,o.paint.get("heatmap-intensity")),V,o.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,o.paint,m.transform.zoom,M)}function Rs(m,e,o){const u=m.context,c=u.gl;u.setColorMode(m.colorModeForRenderPass());const f=oa(u,e),w=o.key,S=e.heatmapFbos.get(w);S&&(u.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,S.colorAttachment.get()),u.activeTexture.set(c.TEXTURE1),f.bind(c.LINEAR,c.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(u,c.TRIANGLES,Ct.disabled,ir.disabled,m.colorModeForRenderPass(),Qt.disabled,Ga(m,e,0,1),null,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,m.transform.zoom),S.destroy(),e.heatmapFbos.delete(w))}function sa(m,e,o){var u,c;const f=m.gl,w=f.createTexture();f.bindTexture(f.TEXTURE_2D,w),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR);const S=(u=m.HALF_FLOAT)!==null&&u!==void 0?u:f.UNSIGNED_BYTE,E=(c=m.RGBA16F)!==null&&c!==void 0?c:f.RGBA;f.texImage2D(f.TEXTURE_2D,0,E,e,o,0,f.RGBA,S,null);const C=m.createFramebuffer(e,o,!1,!1);return C.colorAttachment.set(w),C}function oa(m,e){return e.colorRampTexture||(e.colorRampTexture=new pt(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function so(m,e,o,u,c){if(!o||!u||!u.imageAtlas)return;const f=u.imageAtlas.patternPositions;let w=f[o.to.toString()],S=f[o.from.toString()];if(!w&&S&&(w=S),!S&&w&&(S=w),!w||!S){const E=c.getPaintProperty(e);w=f[E],S=f[E]}w&&S&&m.setConstantPatternPositions(w,S)}function aa(m,e,o,u,c,f,w){const S=m.context.gl,E="fill-pattern",C=o.paint.get(E),A=C&&C.constantOr(1),M=o.getCrossfadeParameters();let F,V,$,K,Y;w?(V=A&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=S.LINES):(V=A?"fillPattern":"fill",F=S.TRIANGLES);const Q=C.constantOr(null);for(const ne of u){const W=e.getTile(ne);if(A&&!W.patternsLoaded())continue;const le=W.getBucket(o);if(!le)continue;const de=le.programConfigurations.get(o.id),ge=m.useProgram(V,de),Ee=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ne);A&&(m.context.activeTexture.set(S.TEXTURE0),W.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),de.updatePaintBuffers(M)),so(de,E,Q,W,o);const ze=Ee?ne:null,Ve=m.translatePosMatrix(ze?ze.posMatrix:ne.posMatrix,W,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(w){K=le.indexBuffer2,Y=le.segments2;const Ge=[S.drawingBufferWidth,S.drawingBufferHeight];$=V==="fillOutlinePattern"&&A?xh(Ve,m,M,W,Ge):Gp(Ve,Ge)}else K=le.indexBuffer,Y=le.segments,$=A?_h(Ve,m,M,W):to(Ve);ge.draw(m.context,F,c,m.stencilModeForClipping(ne),f,Qt.disabled,$,Ee,o.id,le.layoutVertexBuffer,K,Y,o.paint,m.transform.zoom,de)}}function rl(m,e,o,u,c,f,w){const S=m.context,E=S.gl,C="fill-extrusion-pattern",A=o.paint.get(C),M=A.constantOr(1),F=o.getCrossfadeParameters(),V=o.paint.get("fill-extrusion-opacity"),$=A.constantOr(null);for(const K of u){const Y=e.getTile(K),Q=Y.getBucket(o);if(!Q)continue;const ne=m.style.map.terrain&&m.style.map.terrain.getTerrainData(K),W=Q.programConfigurations.get(o.id),le=m.useProgram(M?"fillExtrusionPattern":"fillExtrusion",W);M&&(m.context.activeTexture.set(E.TEXTURE0),Y.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),W.updatePaintBuffers(F)),so(W,C,$,Y,o);const de=m.translatePosMatrix(K.posMatrix,Y,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),ge=o.paint.get("fill-extrusion-vertical-gradient"),Ee=M?Ha(de,m,ge,V,K,F,Y):Qo(de,m,ge,V);le.draw(S,S.gl.TRIANGLES,c,f,w,Qt.backCCW,Ee,ne,o.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,o.paint,m.transform.zoom,W,m.style.map.terrain&&Q.centroidVertexBuffer)}}function oo(m,e,o,u,c,f,w){const S=m.context,E=S.gl,C=o.fbo;if(!C)return;const A=m.useProgram("hillshade"),M=m.style.map.terrain&&m.style.map.terrain.getTerrainData(e);S.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,C.colorAttachment.get()),A.draw(S,E.TRIANGLES,c,f,w,Qt.disabled,((F,V,$,K)=>{const Y=$.paint.get("hillshade-shadow-color"),Q=$.paint.get("hillshade-highlight-color"),ne=$.paint.get("hillshade-accent-color");let W=$.paint.get("hillshade-illumination-direction")*(Math.PI/180);$.paint.get("hillshade-illumination-anchor")==="viewport"&&(W-=F.transform.angle);const le=!F.options.moving;return{u_matrix:K?K.posMatrix:F.transform.calculatePosMatrix(V.tileID.toUnwrapped(),le),u_image:0,u_latrange:Wa(0,V.tileID),u_light:[$.paint.get("hillshade-exaggeration"),W],u_shadow:Y,u_highlight:Q,u_accent:ne}})(m,o,u,M?e:null),M,u.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function ao(m,e,o,u,c,f){const w=m.context,S=w.gl,E=e.dem;if(E&&E.data){const C=E.dim,A=E.stride,M=E.getPixels();if(w.activeTexture.set(S.TEXTURE1),w.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||m.getTileTexture(A),e.demTexture){const V=e.demTexture;V.update(M,{premultiply:!1}),V.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else e.demTexture=new pt(w,M,S.RGBA,{premultiply:!1}),e.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);w.activeTexture.set(S.TEXTURE0);let F=e.fbo;if(!F){const V=new pt(w,{width:C,height:C,data:null},S.RGBA);V.bind(S.LINEAR,S.CLAMP_TO_EDGE),F=e.fbo=w.createFramebuffer(C,C,!0,!1),F.colorAttachment.set(V.texture)}w.bindFramebuffer.set(F.framebuffer),w.viewport.set([0,0,C,C]),m.useProgram("hillshadePrepare").draw(w,S.TRIANGLES,u,c,f,Qt.disabled,((V,$)=>{const K=$.stride,Y=d.H();return d.aP(Y,0,d.X,-d.X,0,0,1),d.J(Y,Y,[0,-d.X,0]),{u_matrix:Y,u_image:1,u_dimension:[K,K],u_zoom:V.overscaledZ,u_unpack:$.getUnpackVector()}})(e.tileID,E),null,o.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Fh(m,e,o,u,c,f){const w=u.paint.get("raster-fade-duration");if(!f&&w>0){const S=q.now(),E=(S-m.timeAdded)/w,C=e?(S-e.timeAdded)/w:-1,A=o.getSource(),M=c.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),F=!e||Math.abs(e.tileID.overscaledZ-M)>Math.abs(m.tileID.overscaledZ-M),V=F&&m.refreshedUponExpiration?1:d.ac(F?E:1-C,0,1);return m.refreshedUponExpiration&&E>=1&&(m.refreshedUponExpiration=!1),e?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}const Lu=new d.aM(1,0,0,1),Ut=new d.aM(0,1,0,1),nl=new d.aM(0,0,1,1),uf=new d.aM(1,0,1,1),Oh=new d.aM(0,1,1,1);function lo(m,e,o,u){il(m,0,e+o/2,m.transform.width,o,u)}function Bh(m,e,o,u){il(m,e-o/2,0,o,m.transform.height,u)}function il(m,e,o,u,c,f){const w=m.context,S=w.gl;S.enable(S.SCISSOR_TEST),S.scissor(e*m.pixelRatio,o*m.pixelRatio,u*m.pixelRatio,c*m.pixelRatio),w.clear({color:f}),S.disable(S.SCISSOR_TEST)}function Nh(m,e,o){const u=m.context,c=u.gl,f=o.posMatrix,w=m.useProgram("debug"),S=Ct.disabled,E=ir.disabled,C=m.colorModeForRenderPass(),A="$debug",M=m.style.map.terrain&&m.style.map.terrain.getTerrainData(o);u.activeTexture.set(c.TEXTURE0);const F=e.getTileByID(o.key).latestRawTileData,V=Math.floor((F&&F.byteLength||0)/1024),$=e.getTile(o).tileSize,K=512/Math.min($,512)*(o.overscaledZ/m.transform.zoom)*.5;let Y=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Y+=` => ${o.overscaledZ}`),function(Q,ne){Q.initDebugOverlayCanvas();const W=Q.debugOverlayCanvas,le=Q.context.gl,de=Q.debugOverlayCanvas.getContext("2d");de.clearRect(0,0,W.width,W.height),de.shadowColor="white",de.shadowBlur=2,de.lineWidth=1.5,de.strokeStyle="white",de.textBaseline="top",de.font="bold 36px Open Sans, sans-serif",de.fillText(ne,5,5),de.strokeText(ne,5,5),Q.debugOverlayTexture.update(W),Q.debugOverlayTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE)}(m,`${Y} ${V}kB`),w.draw(u,c.TRIANGLES,S,E,Tr.alphaBlended,Qt.disabled,ea(f,d.aM.transparent,K),null,A,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),w.draw(u,c.LINE_STRIP,S,E,C,Qt.disabled,ea(f,d.aM.red),M,A,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function jh(m,e,o){const u=m.context,c=u.gl,f=m.colorModeForRenderPass(),w=new Ct(c.LEQUAL,Ct.ReadWrite,m.depthRangeFor3D),S=m.useProgram("terrain"),E=e.getTerrainMesh();u.bindFramebuffer.set(null),u.viewport.set([0,0,m.width,m.height]);for(const C of o){const A=m.renderToTexture.getTexture(C),M=e.getTerrainData(C.tileID);u.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,A.texture);const F=m.transform.calculatePosMatrix(C.tileID.toUnwrapped()),V=e.getMeshFrameDelta(m.transform.zoom),$=m.transform.calculateFogMatrix(C.tileID.toUnwrapped()),K=_u(F,V,$,m.style.sky,m.transform.pitch);S.draw(u,c.TRIANGLES,w,ir.disabled,f,Qt.backCCW,K,M,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}}class sl{constructor(e,o,u){this.vertexBuffer=e,this.indexBuffer=o,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class ol{constructor(e,o){this.context=new lf(e),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=st.maxUnderzooming+st.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new gu}resize(e,o,u){if(this.width=Math.floor(e*u),this.height=Math.floor(o*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const e=this.context,o=new d.aX;o.emplaceBack(0,0),o.emplaceBack(d.X,0),o.emplaceBack(0,d.X),o.emplaceBack(d.X,d.X),this.tileExtentBuffer=e.createVertexBuffer(o,ks.members),this.tileExtentSegments=d.a0.simpleSegment(0,0,4,2);const u=new d.aX;u.emplaceBack(0,0),u.emplaceBack(d.X,0),u.emplaceBack(0,d.X),u.emplaceBack(d.X,d.X),this.debugBuffer=e.createVertexBuffer(u,ks.members),this.debugSegments=d.a0.simpleSegment(0,0,4,5);const c=new d.$;c.emplaceBack(0,0,0,0),c.emplaceBack(d.X,0,d.X,0),c.emplaceBack(0,d.X,0,d.X),c.emplaceBack(d.X,d.X,d.X,d.X),this.rasterBoundsBuffer=e.createVertexBuffer(c,gi.members),this.rasterBoundsSegments=d.a0.simpleSegment(0,0,4,2);const f=new d.aX;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(f,ks.members),this.viewportSegments=d.a0.simpleSegment(0,0,4,2);const w=new d.aZ;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(w);const S=new d.aY;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(S);const E=this.context.gl;this.stencilClearMode=new ir({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO)}clearStencil(){const e=this.context,o=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=d.H();d.aP(u,0,this.width,this.height,0,0,1),d.K(u,u,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,o.TRIANGLES,Ct.disabled,this.stencilClearMode,Tr.disabled,Qt.disabled,En(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,o){if(this.currentStencilSource===e.source||!e.isTileClipped()||!o||!o.length)return;this.currentStencilSource=e.source;const u=this.context,c=u.gl;this.nextStencilID+o.length>256&&this.clearStencil(),u.setColorMode(Tr.disabled),u.setDepthMode(Ct.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of o){const S=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(w);f.draw(u,c.TRIANGLES,Ct.disabled,new ir({func:c.ALWAYS,mask:0},S,255,c.KEEP,c.KEEP,c.REPLACE),Tr.disabled,Qt.disabled,En(w.posMatrix),E,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,o=this.context.gl;return new ir({func:o.NOTEQUAL,mask:255},e,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(e){const o=this.context.gl;return new ir({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(e){const o=this.context.gl,u=e.sort((w,S)=>S.overscaledZ-w.overscaledZ),c=u[u.length-1].overscaledZ,f=u[0].overscaledZ-c+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const w={};for(let S=0;S<f;S++)w[S+c]=new ir({func:o.GEQUAL,mask:255},S+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=f,[w,u]}return[{[c]:ir.disabled},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Tr([e.CONSTANT_COLOR,e.ONE],new d.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Tr.unblended:Tr.alphaBlended}depthModeForSublayer(e,o,u){if(!this.opaquePassEnabledForLayer())return Ct.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Ct(u||this.context.gl.LEQUAL,o,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,o){this.style=e,this.options=o,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(q.now()),this.imageManager.beginFrame();const u=this.style._order,c=this.style.sourceCaches,f={},w={},S={};for(const E in c){const C=c[E];C.used&&C.prepare(this.context),f[E]=C.getVisibleCoordinates(),w[E]=f[E].slice().reverse(),S[E]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<u.length;E++)if(this.style._layers[u[E]].is3D()){this.opaquePassCutoff=E;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const E of u){const C=this.style._layers[E];if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const A=w[C.source];(C.type==="custom"||A.length)&&this.renderLayer(this,c[C.source],C,A)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?d.aM.black:d.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(E,C){const A=E.context,M=A.gl,F=((Q,ne,W)=>({u_sky_color:Q.properties.get("sky-color"),u_horizon_color:Q.properties.get("horizon-color"),u_horizon:(ne.height/2+ne.getHorizon())*W,u_sky_horizon_blend:Q.properties.get("sky-horizon-blend")*ne.height/2*W}))(C,E.style.map.transform,E.pixelRatio),V=new Ct(M.LEQUAL,Ct.ReadWrite,[0,1]),$=ir.disabled,K=E.colorModeForRenderPass(),Y=E.useProgram("sky");if(!C.mesh){const Q=new d.aX;Q.emplaceBack(-1,-1),Q.emplaceBack(1,-1),Q.emplaceBack(1,1),Q.emplaceBack(-1,1);const ne=new d.aY;ne.emplaceBack(0,1,2),ne.emplaceBack(0,2,3),C.mesh=new sl(A.createVertexBuffer(Q,ks.members),A.createIndexBuffer(ne),d.a0.simpleSegment(0,0,Q.length,ne.length))}Y.draw(A,M.TRIANGLES,V,$,K,Qt.disabled,F,void 0,"sky",C.mesh.vertexBuffer,C.mesh.indexBuffer,C.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const E=this.style._layers[u[this.currentLayer]],C=c[E.source],A=f[E.source];this._renderTileClippingMasks(E,A),this.renderLayer(this,C,E,A)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const E=this.style._layers[u[this.currentLayer]],C=c[E.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(E))continue;const A=(E.type==="symbol"?S:w)[E.source];this._renderTileClippingMasks(E,f[E.source]),this.renderLayer(this,C,E,A)}if(this.options.showTileBoundaries){const E=function(C,A){let M=null;const F=Object.values(C._layers).flatMap(Y=>Y.source&&!Y.isHidden(A)?[C.sourceCaches[Y.source]]:[]),V=F.filter(Y=>Y.getSource().type==="vector"),$=F.filter(Y=>Y.getSource().type!=="vector"),K=Y=>{(!M||M.getSource().maxzoom<Y.getSource().maxzoom)&&(M=Y)};return V.forEach(Y=>K(Y)),M||$.forEach(Y=>K(Y)),M}(this.style,this.transform.zoom);E&&function(C,A,M){for(let F=0;F<M.length;F++)Nh(C,A,M[F])}(this,E,E.getVisibleCoordinates())}this.options.showPadding&&function(E){const C=E.transform.padding;lo(E,E.transform.height-(C.top||0),3,Lu),lo(E,C.bottom||0,3,Ut),Bh(E,C.left||0,3,nl),Bh(E,E.transform.width-(C.right||0),3,uf);const A=E.transform.centerPoint;(function(M,F,V,$){il(M,F-1,V-10,2,20,$),il(M,F-10,V-1,20,2,$)})(E,A.x,E.transform.height-A.y,Oh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let c=this.terrainFacilitator.dirty;c||(c=e?!d.a_(o,u):!d.a$(o,u)),c||(c=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),c&&(d.b0(o,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(f,w){const S=f.context,E=S.gl,C=Tr.unblended,A=new Ct(E.LEQUAL,Ct.ReadWrite,[0,1]),M=w.getTerrainMesh(),F=w.sourceCache.getRenderableTiles(),V=f.useProgram("terrainDepth");S.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),S.clear({color:d.aM.transparent,depth:1});for(const $ of F){const K=w.getTerrainData($.tileID),Y={u_matrix:f.transform.calculatePosMatrix($.tileID.toUnwrapped()),u_ele_delta:w.getMeshFrameDelta(f.transform.zoom)};V.draw(S,E.TRIANGLES,A,ir.disabled,C,Qt.backCCW,Y,K,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain),function(f,w){const S=f.context,E=S.gl,C=Tr.unblended,A=new Ct(E.LEQUAL,Ct.ReadWrite,[0,1]),M=w.getTerrainMesh(),F=w.getCoordsTexture(),V=w.sourceCache.getRenderableTiles(),$=f.useProgram("terrainCoords");S.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),S.clear({color:d.aM.transparent,depth:1}),w.coordsIndex=[];for(const K of V){const Y=w.getTerrainData(K.tileID);S.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,F.texture);const Q={u_matrix:f.transform.calculatePosMatrix(K.tileID.toUnwrapped()),u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(f.transform.zoom)};$.draw(S,E.TRIANGLES,A,ir.disabled,C,Qt.backCCW,Q,Y,"terrain",M.vertexBuffer,M.indexBuffer,M.segments),w.coordsIndex.push(K.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain))}renderLayer(e,o,u,c){if(!u.isHidden(this.transform.zoom)&&(u.type==="background"||u.type==="custom"||(c||[]).length))switch(this.id=u.id,u.type){case"symbol":(function(f,w,S,E,C){if(f.renderPass!=="translucent")return;const A=ir.disabled,M=f.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,V,$,K,Y,Q,ne,W,le){const de=V.transform,ge=Es(),Ee=Y==="map",ze=Q==="map";for(const Ve of F){const Ge=K.getTile(Ve),Be=Ge.getBucket($);if(!Be||!Be.text||!Be.text.segments.get().length)continue;const Fe=d.ag(Be.textSizeData,de.zoom),tt=At(Ge,1,V.transform.zoom),bt=Bn(Ve.posMatrix,ze,Ee,V.transform,tt),Ne=$.layout.get("icon-text-fit")!=="none"&&Be.hasIconData();if(Fe){const qe=Math.pow(2,de.zoom-Ge.tileID.overscaledZ),xt=V.style.map.terrain?(kt,Mt)=>V.style.map.terrain.getElevation(Ve,kt,Mt):null,cr=ge.translatePosition(de,Ge,ne,W);io(Be,Ee,ze,le,de,bt,Ve.posMatrix,qe,Fe,Ne,ge,cr,Ve.toUnwrapped(),xt)}}}(E,f,S,w,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),C),S.paint.get("icon-opacity").constantOr(1)!==0&&zu(f,w,S,E,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),A,M),S.paint.get("text-opacity").constantOr(1)!==0&&zu(f,w,S,E,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),A,M),w.map.showCollisionBoxes&&(na(f,w,S,E,!0),na(f,w,S,E,!1))})(e,o,u,c,this.style.placement.variableOffsets);break;case"circle":(function(f,w,S,E){if(f.renderPass!=="translucent")return;const C=S.paint.get("circle-opacity"),A=S.paint.get("circle-stroke-width"),M=S.paint.get("circle-stroke-opacity"),F=!S.layout.get("circle-sort-key").isConstant();if(C.constantOr(1)===0&&(A.constantOr(1)===0||M.constantOr(1)===0))return;const V=f.context,$=V.gl,K=f.depthModeForSublayer(0,Ct.ReadOnly),Y=ir.disabled,Q=f.colorModeForRenderPass(),ne=[];for(let W=0;W<E.length;W++){const le=E[W],de=w.getTile(le),ge=de.getBucket(S);if(!ge)continue;const Ee=ge.programConfigurations.get(S.id),ze=f.useProgram("circle",Ee),Ve=ge.layoutVertexBuffer,Ge=ge.indexBuffer,Be=f.style.map.terrain&&f.style.map.terrain.getTerrainData(le),Fe={programConfiguration:Ee,program:ze,layoutVertexBuffer:Ve,indexBuffer:Ge,uniformValues:Wp(f,le,de,S),terrainData:Be};if(F){const tt=ge.segments.get();for(const bt of tt)ne.push({segments:new d.a0([bt]),sortKey:bt.sortKey,state:Fe})}else ne.push({segments:ge.segments,sortKey:0,state:Fe})}F&&ne.sort((W,le)=>W.sortKey-le.sortKey);for(const W of ne){const{programConfiguration:le,program:de,layoutVertexBuffer:ge,indexBuffer:Ee,uniformValues:ze,terrainData:Ve}=W.state;de.draw(V,$.TRIANGLES,K,Y,Q,Qt.disabled,ze,Ve,S.id,ge,Ee,W.segments,S.paint,f.transform.zoom,le)}})(e,o,u,c);break;case"heatmap":(function(f,w,S,E){if(S.paint.get("heatmap-opacity")===0)return;const C=f.context;if(f.style.map.terrain){for(const A of E){const M=w.getTile(A);w.hasRenderableParent(A)||(f.renderPass==="offscreen"?Du(f,M,S,A):f.renderPass==="translucent"&&Rs(f,S,A))}C.viewport.set([0,0,f.width,f.height])}else f.renderPass==="offscreen"?function(A,M,F,V){const $=A.context,K=$.gl,Y=ir.disabled,Q=new Tr([K.ONE,K.ONE],d.aM.transparent,[!0,!0,!0,!0]);(function(ne,W,le){const de=ne.gl;ne.activeTexture.set(de.TEXTURE1),ne.viewport.set([0,0,W.width/4,W.height/4]);let ge=le.heatmapFbos.get(d.aU);ge?(de.bindTexture(de.TEXTURE_2D,ge.colorAttachment.get()),ne.bindFramebuffer.set(ge.framebuffer)):(ge=sa(ne,W.width/4,W.height/4),le.heatmapFbos.set(d.aU,ge))})($,A,F),$.clear({color:d.aM.transparent});for(let ne=0;ne<V.length;ne++){const W=V[ne];if(M.hasRenderableParent(W))continue;const le=M.getTile(W),de=le.getBucket(F);if(!de)continue;const ge=de.programConfigurations.get(F.id),Ee=A.useProgram("heatmap",ge),{zoom:ze}=A.transform;Ee.draw($,K.TRIANGLES,Ct.disabled,Y,Q,Qt.disabled,kn(W.posMatrix,le,ze,F.paint.get("heatmap-intensity")),null,F.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,F.paint,A.transform.zoom,ge)}$.viewport.set([0,0,A.width,A.height])}(f,w,S,E):f.renderPass==="translucent"&&function(A,M){const F=A.context,V=F.gl;F.setColorMode(A.colorModeForRenderPass());const $=M.heatmapFbos.get(d.aU);$&&(F.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,$.colorAttachment.get()),F.activeTexture.set(V.TEXTURE1),oa(F,M).bind(V.LINEAR,V.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(F,V.TRIANGLES,Ct.disabled,ir.disabled,A.colorModeForRenderPass(),Qt.disabled,Ga(A,M,0,1),null,M.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,M.paint,A.transform.zoom))}(f,S)})(e,o,u,c);break;case"line":(function(f,w,S,E){if(f.renderPass!=="translucent")return;const C=S.paint.get("line-opacity"),A=S.paint.get("line-width");if(C.constantOr(1)===0||A.constantOr(1)===0)return;const M=f.depthModeForSublayer(0,Ct.ReadOnly),F=f.colorModeForRenderPass(),V=S.paint.get("line-dasharray"),$=S.paint.get("line-pattern"),K=$.constantOr(1),Y=S.paint.get("line-gradient"),Q=S.getCrossfadeParameters(),ne=K?"linePattern":V?"lineSDF":Y?"lineGradient":"line",W=f.context,le=W.gl;let de=!0;for(const ge of E){const Ee=w.getTile(ge);if(K&&!Ee.patternsLoaded())continue;const ze=Ee.getBucket(S);if(!ze)continue;const Ve=ze.programConfigurations.get(S.id),Ge=f.context.program.get(),Be=f.useProgram(ne,Ve),Fe=de||Be.program!==Ge,tt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ge),bt=$.constantOr(null);if(bt&&Ee.imageAtlas){const xt=Ee.imageAtlas,cr=xt.patternPositions[bt.to.toString()],kt=xt.patternPositions[bt.from.toString()];cr&&kt&&Ve.setConstantPatternPositions(cr,kt)}const Ne=tt?ge:null,qe=K?ro(f,Ee,S,Q,Ne):V?Xp(f,Ee,S,V,Q,Ne):Y?vh(f,Ee,S,ze.lineClipsArray.length,Ne):Xa(f,Ee,S,Ne);if(K)W.activeTexture.set(le.TEXTURE0),Ee.imageAtlasTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),Ve.updatePaintBuffers(Q);else if(V&&(Fe||f.lineAtlas.dirty))W.activeTexture.set(le.TEXTURE0),f.lineAtlas.bind(W);else if(Y){const xt=ze.gradients[S.id];let cr=xt.texture;if(S.gradientVersion!==xt.version){let kt=256;if(S.stepInterpolant){const Mt=w.getSource().maxzoom,hr=ge.canonical.z===Mt?Math.ceil(1<<f.transform.maxZoom-ge.canonical.z):1;kt=d.ac(d.aV(ze.maxLineLength/d.X*1024*hr),256,W.maxTextureSize)}xt.gradient=d.aW({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:kt,image:xt.gradient||void 0,clips:ze.lineClipsArray}),xt.texture?xt.texture.update(xt.gradient):xt.texture=new pt(W,xt.gradient,le.RGBA),xt.version=S.gradientVersion,cr=xt.texture}W.activeTexture.set(le.TEXTURE0),cr.bind(S.stepInterpolant?le.NEAREST:le.LINEAR,le.CLAMP_TO_EDGE)}Be.draw(W,le.TRIANGLES,M,f.stencilModeForClipping(ge),F,Qt.disabled,qe,tt,S.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,S.paint,f.transform.zoom,Ve,ze.layoutVertexBuffer2),de=!1}})(e,o,u,c);break;case"fill":(function(f,w,S,E){const C=S.paint.get("fill-color"),A=S.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const M=f.colorModeForRenderPass(),F=S.paint.get("fill-pattern"),V=f.opaquePassEnabledForLayer()&&!F.constantOr(1)&&C.constantOr(d.aM.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===V){const $=f.depthModeForSublayer(1,f.renderPass==="opaque"?Ct.ReadWrite:Ct.ReadOnly);aa(f,w,S,E,$,M,!1)}if(f.renderPass==="translucent"&&S.paint.get("fill-antialias")){const $=f.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,Ct.ReadOnly);aa(f,w,S,E,$,M,!0)}})(e,o,u,c);break;case"fill-extrusion":(function(f,w,S,E){const C=S.paint.get("fill-extrusion-opacity");if(C!==0&&f.renderPass==="translucent"){const A=new Ct(f.context.gl.LEQUAL,Ct.ReadWrite,f.depthRangeFor3D);if(C!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))rl(f,w,S,E,A,ir.disabled,Tr.disabled),rl(f,w,S,E,A,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const M=f.colorModeForRenderPass();rl(f,w,S,E,A,ir.disabled,M)}}})(e,o,u,c);break;case"hillshade":(function(f,w,S,E){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const C=f.context,A=f.depthModeForSublayer(0,Ct.ReadOnly),M=f.colorModeForRenderPass(),[F,V]=f.renderPass==="translucent"?f.stencilConfigForOverlap(E):[{},E];for(const $ of V){const K=w.getTile($);K.needsHillshadePrepare!==void 0&&K.needsHillshadePrepare&&f.renderPass==="offscreen"?ao(f,K,S,A,ir.disabled,M):f.renderPass==="translucent"&&oo(f,$,K,S,A,F[$.overscaledZ],M)}C.viewport.set([0,0,f.width,f.height])})(e,o,u,c);break;case"raster":(function(f,w,S,E){if(f.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!E.length)return;const C=f.context,A=C.gl,M=w.getSource(),F=f.useProgram("raster"),V=f.colorModeForRenderPass(),[$,K]=M instanceof Qn?[{},E]:f.stencilConfigForOverlap(E),Y=K[K.length-1].overscaledZ,Q=!f.options.moving;for(const ne of K){const W=f.depthModeForSublayer(ne.overscaledZ-Y,S.paint.get("raster-opacity")===1?Ct.ReadWrite:Ct.ReadOnly,A.LESS),le=w.getTile(ne);le.registerFadeDuration(S.paint.get("raster-fade-duration"));const de=w.findLoadedParent(ne,0),ge=w.findLoadedSibling(ne),Ee=Fh(le,de||ge||null,w,S,f.transform,f.style.map.terrain);let ze,Ve;const Ge=S.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;C.activeTexture.set(A.TEXTURE0),le.texture.bind(Ge,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(A.TEXTURE1),de?(de.texture.bind(Ge,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),ze=Math.pow(2,de.tileID.overscaledZ-le.tileID.overscaledZ),Ve=[le.tileID.canonical.x*ze%1,le.tileID.canonical.y*ze%1]):le.texture.bind(Ge,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),le.texture.useMipmap&&C.extTextureFilterAnisotropic&&f.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);const Be=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ne),Fe=Be?ne:null,tt=Fe?Fe.posMatrix:f.transform.calculatePosMatrix(ne.toUnwrapped(),Q),bt=Kp(tt,Ve||[0,0],ze||1,Ee,S);M instanceof Qn?F.draw(C,A.TRIANGLES,W,ir.disabled,V,Qt.disabled,bt,Be,S.id,M.boundsBuffer,f.quadTriangleIndexBuffer,M.boundsSegments):F.draw(C,A.TRIANGLES,W,$[ne.overscaledZ],V,Qt.disabled,bt,Be,S.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}})(e,o,u,c);break;case"background":(function(f,w,S,E){const C=S.paint.get("background-color"),A=S.paint.get("background-opacity");if(A===0)return;const M=f.context,F=M.gl,V=f.transform,$=V.tileSize,K=S.paint.get("background-pattern");if(f.isPatternMissing(K))return;const Y=!K&&C.a===1&&A===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==Y)return;const Q=ir.disabled,ne=f.depthModeForSublayer(0,Y==="opaque"?Ct.ReadWrite:Ct.ReadOnly),W=f.colorModeForRenderPass(),le=f.useProgram(K?"backgroundPattern":"background"),de=E||V.coveringTiles({tileSize:$,terrain:f.style.map.terrain});K&&(M.activeTexture.set(F.TEXTURE0),f.imageManager.bind(f.context));const ge=S.getCrossfadeParameters();for(const Ee of de){const ze=E?Ee.posMatrix:f.transform.calculatePosMatrix(Ee.toUnwrapped()),Ve=K?wu(ze,A,f,K,{tileID:Ee,tileSize:$},ge):Ka(ze,A,C),Ge=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Ee);le.draw(M,F.TRIANGLES,ne,Q,W,Qt.disabled,Ve,Ge,S.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}})(e,0,u,c);break;case"custom":(function(f,w,S){const E=f.context,C=S.implementation;if(f.renderPass==="offscreen"){const A=C.prerender;A&&(f.setCustomLayerDefaults(),E.setColorMode(f.colorModeForRenderPass()),A.call(C,E.gl,f.transform.customLayerMatrix()),E.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),E.setColorMode(f.colorModeForRenderPass()),E.setStencilMode(ir.disabled);const A=C.renderingMode==="3d"?new Ct(f.context.gl.LEQUAL,Ct.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Ct.ReadOnly);E.setDepthMode(A),C.render(E.gl,f.transform.customLayerMatrix(),{farZ:f.transform.farZ,nearZ:f.transform.nearZ,fov:f.transform._fov,modelViewProjectionMatrix:f.transform.modelViewProjectionMatrix,projectionMatrix:f.transform.projectionMatrix}),E.setDirty(),f.setBaseState(),E.bindFramebuffer.set(null)}})(e,0,u)}}translatePosMatrix(e,o,u,c,f){if(!u[0]&&!u[1])return e;const w=f?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(w){const C=Math.sin(w),A=Math.cos(w);u=[u[0]*A-u[1]*C,u[0]*C+u[1]*A]}const S=[f?u[0]:At(o,u[0],this.transform.zoom),f?u[1]:At(o,u[1],this.transform.zoom),0],E=new Float32Array(16);return d.J(E,e,S),E}saveTileTexture(e){const o=this._tileTextures[e.size[0]];o?o.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const o=this._tileTextures[e];return o&&o.length>0?o.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const o=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!o||!u}useProgram(e,o){this.cache=this.cache||{};const u=e+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new xu(this.context,hs[e],o,bu[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new pt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:o}=this.context.gl;return this.width!==e||this.height!==o}}class uo{constructor(e,o){this.points=e,this.planes=o}static fromInvProjectionMatrix(e,o,u){const c=Math.pow(2,u),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const E=1/(S=d.af([],S,e))[3]/o*c;return d.b1(S,S,[E,E,1/S[3],E])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const E=function(F,V){var $=V[0],K=V[1],Y=V[2],Q=$*$+K*K+Y*Y;return Q>0&&(Q=1/Math.sqrt(Q)),F[0]=V[0]*Q,F[1]=V[1]*Q,F[2]=V[2]*Q,F}([],function(F,V,$){var K=V[0],Y=V[1],Q=V[2],ne=$[0],W=$[1],le=$[2];return F[0]=Y*le-Q*W,F[1]=Q*ne-K*le,F[2]=K*W-Y*ne,F}([],Oe([],f[S[0]],f[S[1]]),Oe([],f[S[2]],f[S[1]]))),C=-((A=E)[0]*(M=f[S[1]])[0]+A[1]*M[1]+A[2]*M[2]);var A,M;return E.concat(C)});return new uo(f,w)}}class co{constructor(e,o){this.min=e,this.max=o,this.center=function(u,c,f){return u[0]=.5*c[0],u[1]=.5*c[1],u[2]=.5*c[2],u}([],function(u,c,f){return u[0]=c[0]+f[0],u[1]=c[1]+f[1],u[2]=c[2]+f[2],u}([],this.min,this.max))}quadrant(e){const o=[e%2==0,e<2],u=De(this.min),c=De(this.max);for(let f=0;f<o.length;f++)u[f]=o[f]?this.min[f]:this.center[f],c[f]=o[f]?this.center[f]:this.max[f];return c[2]=this.max[2],new co(u,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let c=0;c<e.planes.length;c++){const f=e.planes[c];let w=0;for(let S=0;S<o.length;S++)d.b2(f,o[S])>=0&&w++;if(w===0)return 0;w!==o.length&&(u=!1)}if(u)return 2;for(let c=0;c<3;c++){let f=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let S=0;S<e.points.length;S++){const E=e.points[S][c]-this.min[c];f=Math.min(f,E),w=Math.max(w,E)}if(w<0||f>this.max[c]-this.min[c])return 0}return 1}}class ho{constructor(e=0,o=0,u=0,c=0){if(isNaN(e)||e<0||isNaN(o)||o<0||isNaN(u)||u<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=o,this.left=u,this.right=c}interpolate(e,o,u){return o.top!=null&&e.top!=null&&(this.top=d.y.number(e.top,o.top,u)),o.bottom!=null&&e.bottom!=null&&(this.bottom=d.y.number(e.bottom,o.bottom,u)),o.left!=null&&e.left!=null&&(this.left=d.y.number(e.left,o.left,u)),o.right!=null&&e.right!=null&&(this.right=d.y.number(e.right,o.right,u)),this}getCenter(e,o){const u=d.ac((this.left+e-this.right)/2,0,e),c=d.ac((this.top+o-this.bottom)/2,0,o);return new d.P(u,c)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ho(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Fu=85.051129;class po{constructor(e,o,u,c,f){this.tileSize=512,this._renderWorldCopies=f===void 0||!!f,this._minZoom=e||0,this._maxZoom=o||22,this._minPitch=u??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ho,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new po(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const o=-d.b3(e,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=function(){var u=new d.A(4);return d.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,c,f){var w=c[0],S=c[1],E=c[2],C=c[3],A=Math.sin(f),M=Math.cos(f);u[0]=w*M+E*A,u[1]=S*M+C*A,u[2]=w*-A+E*M,u[3]=S*-A+C*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const o=d.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const o=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,o,u){this._unmodified=!1,this._edgeInsets.interpolate(e,o,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const o=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(e){const o=[new d.b4(0,e)];if(this._renderWorldCopies){const u=this.pointCoordinate(new d.P(0,0)),c=this.pointCoordinate(new d.P(this.width,0)),f=this.pointCoordinate(new d.P(this.width,this.height)),w=this.pointCoordinate(new d.P(0,this.height)),S=Math.floor(Math.min(u.x,c.x,f.x,w.x)),E=Math.floor(Math.max(u.x,c.x,f.x,w.x)),C=1;for(let A=S-C;A<=E+C;A++)A!==0&&o.push(new d.b4(A,e))}return o}coveringTiles(e){var o,u;let c=this.coveringZoomLevel(e);const f=c;if(e.minzoom!==void 0&&c<e.minzoom)return[];e.maxzoom!==void 0&&c>e.maxzoom&&(c=e.maxzoom);const w=this.pointCoordinate(this.getCameraPoint()),S=d.Z.fromLngLat(this.center),E=Math.pow(2,c),C=[E*w.x,E*w.y,0],A=[E*S.x,E*S.y,0],M=uo.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,c);let F=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=c);const V=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,$=W=>({aabb:new co([W*E,0,0],[(W+1)*E,E,0]),zoom:0,x:0,y:0,wrap:W,fullyVisible:!1}),K=[],Y=[],Q=c,ne=e.reparseOverscaled?f:c;if(this._renderWorldCopies)for(let W=1;W<=3;W++)K.push($(-W)),K.push($(W));for(K.push($(0));K.length>0;){const W=K.pop(),le=W.x,de=W.y;let ge=W.fullyVisible;if(!ge){const Be=W.aabb.intersects(M);if(Be===0)continue;ge=Be===2}const Ee=e.terrain?C:A,ze=W.aabb.distanceX(Ee),Ve=W.aabb.distanceY(Ee),Ge=Math.max(Math.abs(ze),Math.abs(Ve));if(W.zoom===Q||Ge>V+(1<<Q-W.zoom)-2&&W.zoom>=F){const Be=Q-W.zoom,Fe=C[0]-.5-(le<<Be),tt=C[1]-.5-(de<<Be);Y.push({tileID:new d.S(W.zoom===Q?ne:W.zoom,W.wrap,W.zoom,le,de),distanceSq:Qe([A[0]-.5-le,A[1]-.5-de]),tileDistanceToCamera:Math.sqrt(Fe*Fe+tt*tt)})}else for(let Be=0;Be<4;Be++){const Fe=(le<<1)+Be%2,tt=(de<<1)+(Be>>1),bt=W.zoom+1;let Ne=W.aabb.quadrant(Be);if(e.terrain){const qe=new d.S(bt,W.wrap,bt,Fe,tt),xt=e.terrain.getMinMaxElevation(qe),cr=(o=xt.minElevation)!==null&&o!==void 0?o:this.elevation,kt=(u=xt.maxElevation)!==null&&u!==void 0?u:this.elevation;Ne=new co([Ne.min[0],Ne.min[1],cr],[Ne.max[0],Ne.max[1],kt])}K.push({aabb:Ne,zoom:bt,x:Fe,y:tt,wrap:W.wrap,fullyVisible:ge})}}return Y.sort((W,le)=>W.distanceSq-le.distanceSq).map(W=>W.tileID)}resize(e,o){this.width=e,this.height=o,this.pixelsToGLUnits=[2/e,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const o=d.ac(e.lat,-85.051129,Fu);return new d.P(d.O(e.lng)*this.worldSize,d.Q(o)*this.worldSize)}unproject(e){return new d.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const o=this.elevation,u=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,c=this.pointLocation(this.centerPoint,e),f=e.getElevationForLngLatZoom(c,this.tileZoom);if(!(this.elevation-f))return;const w=u+o-f,S=Math.cos(this._pitch)*this.cameraToCenterDistance/w/d.b5(1,c.lat),E=this.scaleZoom(S/this.tileSize);this._elevation=f,this._center=c,this.zoom=E}setLocationAtPoint(e,o){const u=this.pointCoordinate(o),c=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(e),w=new d.Z(f.x-(u.x-c.x),f.y-(u.y-c.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,o){return o?this.coordinatePoint(this.locationCoordinate(e),o.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,o){return this.coordinateLocation(this.pointCoordinate(e,o))}locationCoordinate(e){return d.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,o){if(o){const F=o.pointCoordinate(e);if(F!=null)return F}const u=[e.x,e.y,0,1],c=[e.x,e.y,1,1];d.af(u,u,this.pixelMatrixInverse),d.af(c,c,this.pixelMatrixInverse);const f=u[3],w=c[3],S=u[1]/f,E=c[1]/w,C=u[2]/f,A=c[2]/w,M=C===A?0:(0-C)/(A-C);return new d.Z(d.y.number(u[0]/f,c[0]/w,M)/this.worldSize,d.y.number(S,E,M)/this.worldSize)}coordinatePoint(e,o=0,u=this.pixelMatrix){const c=[e.x*this.worldSize,e.y*this.worldSize,o,1];return d.af(c,c,u),new d.P(c[0]/c[3],c[1]/c[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new xe().extend(this.pointLocation(new d.P(0,e))).extend(this.pointLocation(new d.P(this.width,e))).extend(this.pointLocation(new d.P(this.width,this.height))).extend(this.pointLocation(new d.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new xe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Fu])}calculateTileMatrix(e){const o=e.canonical,u=this.worldSize/this.zoomScale(o.z),c=o.x+Math.pow(2,o.z)*e.wrap,f=d.an(new Float64Array(16));return d.J(f,f,[c*u,o.y*u,0]),d.K(f,f,[u/d.X,u/d.X,1]),f}calculatePosMatrix(e,o=!1){const u=e.key,c=o?this._alignedPosMatrixCache:this._posMatrixCache;if(c[u])return c[u];const f=this.calculateTileMatrix(e);return d.L(f,o?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,f),c[u]=new Float32Array(f),c[u]}calculateFogMatrix(e){const o=e.key,u=this._fogMatrixCache;if(u[o])return u[o];const c=this.calculateTileMatrix(e);return d.L(c,this.fogMatrix,c),u[o]=new Float32Array(c),u[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,o){o=d.ac(+o,this.minZoom,this.maxZoom);const u={center:new d.N(e.lng,e.lat),zoom:o};let c=this.lngRange;if(!this._renderWorldCopies&&c===null){const W=179.9999999999;c=[-W,W]}const f=this.tileSize*this.zoomScale(u.zoom);let w=0,S=f,E=0,C=f,A=0,M=0;const{x:F,y:V}=this.size;if(this.latRange){const W=this.latRange;w=d.Q(W[1])*f,S=d.Q(W[0])*f,S-w<V&&(A=V/(S-w))}c&&(E=d.b3(d.O(c[0])*f,0,f),C=d.b3(d.O(c[1])*f,0,f),C<E&&(C+=f),C-E<F&&(M=F/(C-E)));const{x:$,y:K}=this.project.call({worldSize:f},e);let Y,Q;const ne=Math.max(M||0,A||0);if(ne){const W=new d.P(M?(C+E)/2:$,A?(S+w)/2:K);return u.center=this.unproject.call({worldSize:f},W).wrap(),u.zoom+=this.scaleZoom(ne),u}if(this.latRange){const W=V/2;K-W<w&&(Q=w+W),K+W>S&&(Q=S-W)}if(c){const W=(E+C)/2;let le=$;this._renderWorldCopies&&(le=d.b3($,W-f/2,W+f/2));const de=F/2;le-de<E&&(Y=E+de),le+de>C&&(Y=C-de)}if(Y!==void 0||Q!==void 0){const W=new d.P(Y??$,Q??K);u.center=this.unproject.call({worldSize:f},W).wrap()}return u}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:o,zoom:u}=this.getConstrained(this.center,this.zoom);this.center=o,this.zoom=u,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,o=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=d.b5(1,this.center.lat)*this.worldSize;let c=d.an(new Float64Array(16));d.K(c,c,[this.width/2,-this.height/2,1]),d.J(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=d.an(new Float64Array(16)),d.K(c,c,[1,-1,1]),d.J(c,c,[-1,-1,0]),d.K(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const f=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),w=Math.min(this.elevation,this.minElevationForCurrentTile),S=f-w*this._pixelPerMeter/Math.cos(this._pitch),E=w<0?S:f,C=Math.PI/2+this._pitch,A=this._fov*(.5+e.y/this.height),M=Math.sin(A)*E/Math.sin(d.ac(Math.PI-C-A,.01,Math.PI-.01)),F=this.getHorizon(),V=2*Math.atan(F/this.cameraToCenterDistance)*(.5+e.y/(2*F)),$=Math.sin(V)*E/Math.sin(d.ac(Math.PI-C-V,.01,Math.PI-.01)),K=Math.min(M,$);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*K+E),this.nearZ=this.height/50,c=new Float64Array(16),d.b6(c,this._fov,this.width/this.height,this.nearZ,this.farZ),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,this.projectionMatrix=d.ae(c),d.K(c,c,[1,-1,1]),d.J(c,c,[0,0,-this.cameraToCenterDistance]),d.b7(c,c,this._pitch),d.ad(c,c,this.angle),d.J(c,c,[-o,-u,0]),this.mercatorMatrix=d.K([],c,[this.worldSize,this.worldSize,this.worldSize]),d.K(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=d.L(new Float64Array(16),this.labelPlaneMatrix,c),d.J(c,c,[0,0,-this.elevation]),this.modelViewProjectionMatrix=c,this.invModelViewProjectionMatrix=d.as([],c),this.fogMatrix=new Float64Array(16),d.b6(this.fogMatrix,this._fov,this.width/this.height,f,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,d.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),d.b7(this.fogMatrix,this.fogMatrix,this._pitch),d.ad(this.fogMatrix,this.fogMatrix,this.angle),d.J(this.fogMatrix,this.fogMatrix,[-o,-u,0]),d.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=d.L(new Float64Array(16),this.labelPlaneMatrix,c);const Y=this.width%2/2,Q=this.height%2/2,ne=Math.cos(this.angle),W=Math.sin(this.angle),le=o-Math.round(o)+ne*Y+W*Q,de=u-Math.round(u)+ne*Q+W*Y,ge=new Float64Array(c);if(d.J(ge,ge,[le>.5?le-1:le,de>.5?de-1:de,0]),this.alignedModelViewProjectionMatrix=ge,c=d.as(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new d.P(0,0)),o=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.af(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,e))}getCameraQueryGeometry(e){const o=this.getCameraPoint();if(e.length===1)return[e[0],o];{let u=o.x,c=o.y,f=o.x,w=o.y;for(const S of e)u=Math.min(u,S.x),c=Math.min(c,S.y),f=Math.max(f,S.x),w=Math.max(w,S.y);return[new d.P(u,c),new d.P(f,c),new d.P(f,w),new d.P(u,w),new d.P(u,c)]}}lngLatToCameraDepth(e,o){const u=this.locationCoordinate(e),c=[u.x*this.worldSize,u.y*this.worldSize,o,1];return d.af(c,c,this.modelViewProjectionMatrix),c[2]/c[3]}}function la(m,e){let o,u=!1,c=null,f=null;const w=()=>{c=null,u&&(m.apply(f,o),c=setTimeout(w,e),u=!1)};return(...S)=>(u=!0,f=this,o=S,c||w(),c)}class al{constructor(e){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(u=c)}),(u&&u[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,o)},this._removeHash=()=>{const o=this._getCurrentHash();if(o.length===0)return;const u=o.join("/");let c=u;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${u}`);let f=window.location.hash.replace(c,"");f.startsWith("#&")?f=f.slice(0,1)+f.slice(2):f==="#"&&(f="");let w=window.location.href.replace(/(#.+)?$/,f);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=la(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const o=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,c=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,c),w=Math.round(o.lng*f)/f,S=Math.round(o.lat*f)/f,E=this._map.getBearing(),C=this._map.getPitch();let A="";if(A+=e?`/${w}/${S}/${u}`:`${u}/${S}/${w}`,(E||C)&&(A+="/"+Math.round(10*E)/10),C&&(A+=`/${Math.round(C)}`),this._hashName){const M=this._hashName;let F=!1;const V=window.location.hash.slice(1).split("&").map($=>{const K=$.split("=")[0];return K===M?(F=!0,`${K}=${A}`):$}).filter($=>$);return F||V.push(`${M}=${A}`),`#${V.join("&")}`}return`#${A}`}}const ll={linearity:.3,easing:d.b8(0,0,.3,1)},Ou=d.e({deceleration:2500,maxSpeed:1400},ll),cf=d.e({deceleration:20,maxSpeed:1400},ll),Vh=d.e({deceleration:1e3,maxSpeed:360},ll),ul=d.e({deceleration:1e3,maxSpeed:90},ll);class Bu{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:q.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,o=q.now();for(;e.length>0&&o-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)o.zoom+=f.zoomDelta||0,o.bearing+=f.bearingDelta||0,o.pitch+=f.pitchDelta||0,f.panDelta&&o.pan._add(f.panDelta),f.around&&(o.around=f.around),f.pinchAround&&(o.pinchAround=f.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(o.pan.mag()){const f=ca(o.pan.mag(),u,d.e({},Ou,e||{}));c.offset=o.pan.mult(f.amount/o.pan.mag()),c.center=this._map.transform.center,ua(c,f)}if(o.zoom){const f=ca(o.zoom,u,cf);c.zoom=this._map.transform.zoom+f.amount,ua(c,f)}if(o.bearing){const f=ca(o.bearing,u,Vh);c.bearing=this._map.transform.bearing+d.ac(f.amount,-179,179),ua(c,f)}if(o.pitch){const f=ca(o.pitch,u,ul);c.pitch=this._map.transform.pitch+f.amount,ua(c,f)}if(c.zoom||c.bearing){const f=o.pinchAround===void 0?o.around:o.pinchAround;c.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),d.e(c,{noMoveStart:!0})}}function ua(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function ca(m,e,o){const{maxSpeed:u,linearity:c,deceleration:f}=o,w=d.ac(m*c/(e/1e3),-u,u),S=Math.abs(w)/(f*c);return{easing:o.easing,duration:1e3*S,amount:w*(S/2)}}class nn extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u,c={}){const f=U.mousePos(o.getCanvas(),u),w=o.unproject(f);super(e,d.e({point:f,lngLat:w,originalEvent:u},c)),this._defaultPrevented=!1,this.target=o}}class Ds extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u){const c=e==="touchend"?u.changedTouches:u.touches,f=U.touchPos(o.getCanvasContainer(),c),w=f.map(E=>o.unproject(E)),S=f.reduce((E,C,A,M)=>E.add(C.div(M.length)),new d.P(0,0));super(e,{points:f,point:S,lngLats:w,lngLat:o.unproject(S),originalEvent:u}),this._defaultPrevented=!1}}class Uh extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class $h{constructor(e,o){this._map=e,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Uh(e.type,this._map,e))}mousedown(e,o){return this._mousedownPos=o,this._firePreventable(new nn(e.type,this._map,e))}mouseup(e){this._map.fire(new nn(e.type,this._map,e))}click(e,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new nn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new nn(e.type,this._map,e))}mouseover(e){this._map.fire(new nn(e.type,this._map,e))}mouseout(e){this._map.fire(new nn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ds(e.type,this._map,e))}touchmove(e){this._map.fire(new Ds(e.type,this._map,e))}touchend(e){this._map.fire(new Ds(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ds(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Er{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new nn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new nn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new nn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vi{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(d.P.convert(e),this._map.terrain)}}class Un{constructor(e,o){this._map=e,this._tr=new vi(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,o){this.isEnabled()&&e.shiftKey&&e.button===0&&(U.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(e,o){if(!this._active)return;const u=o;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=u,this._box||(this._box=U.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const f=Math.min(c.x,u.x),w=Math.max(c.x,u.x),S=Math.min(c.y,u.y),E=Math.max(c.y,u.y);U.setTransform(this._box,`translate(${f}px,${S}px)`),this._box.style.width=w-f+"px",this._box.style.height=E-S+"px"}mouseupWindow(e,o){if(!this._active||e.button!==0)return;const u=this._startPos,c=o;if(this.reset(),U.suppressClick(),u.x!==c.x||u.y!==c.y)return this._map.fire(new d.k("boxzoomend",{originalEvent:e})),{cameraAnimation:f=>f.fitScreenCoordinates(u,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(U.remove(this._box),this._box=null),U.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,o){return this._map.fire(new d.k(e,{originalEvent:o}))}}function ha(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);const o={};for(let u=0;u<m.length;u++)o[m[u].identifier]=e[u];return o}class Nu{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,o,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=function(c){const f=new d.P(0,0);for(const w of c)f._add(w);return f.div(c.length)}(o),this.touches=ha(u,o)))}touchmove(e,o,u){if(this.aborted||!this.centroid)return;const c=ha(u,o);for(const f in this.touches){const w=c[f];(!w||w.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(e,o,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class cl{constructor(e){this.singleTap=new Nu(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,o,u){this.singleTap.touchstart(e,o,u)}touchmove(e,o,u){this.singleTap.touchmove(e,o,u)}touchend(e,o,u){const c=this.singleTap.touchend(e,o,u);if(c){const f=e.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(c)<30;if(f&&w||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class fo{constructor(e){this._tr=new vi(e),this._zoomIn=new cl({numTouches:1,numTaps:2}),this._zoomOut=new cl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,o,u){this._zoomIn.touchstart(e,o,u),this._zoomOut.touchstart(e,o,u)}touchmove(e,o,u){this._zoomIn.touchmove(e,o,u),this._zoomOut.touchmove(e,o,u)}touchend(e,o,u){const c=this._zoomIn.touchend(e,o,u),f=this._zoomOut.touchend(e,o,u),w=this._tr;return c?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(c)},{originalEvent:e})}):f?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(f)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ji{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const o=this._moveFunction(...e);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(e,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,o){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const c=o.length?o[0]:o;return!this._moved&&c.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(u,c))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&U.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ju={0:1,2:2};class hl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const o=U.mouseButton(e);this._eventButton=o}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(o,u){const c=ju[u];return o.buttons===void 0||(o.buttons&c)!==c}(e,this._eventButton)}isValidEndEvent(e){return U.mouseButton(e)===this._eventButton}}class Vu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const dl=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}},Uu=({enable:m,clickTolerance:e,bearingDegreesPerPixelMoved:o=.8})=>{const u=new hl({checkCorrectEvent:c=>U.mouseButton(c)===0&&c.ctrlKey||U.mouseButton(c)===2});return new Ji({clickTolerance:e,move:(c,f)=>({bearingDelta:(f.x-c.x)*o}),moveStateManager:u,enable:m,assignEvents:dl})},$u=({enable:m,clickTolerance:e,pitchDegreesPerPixelMoved:o=-.5})=>{const u=new hl({checkCorrectEvent:c=>U.mouseButton(c)===0&&c.ctrlKey||U.mouseButton(c)===2});return new Ji({clickTolerance:e,move:(c,f)=>({pitchDelta:(f.y-c.y)*o}),moveStateManager:u,enable:m,assignEvents:dl})};class Ls{constructor(e,o){this._clickTolerance=e.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,o,u){return this._calculateTransform(e,o,u)}touchmove(e,o,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,o,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,o,u){this._calculateTransform(e,o,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,o,u){u.length>0&&(this._active=!0);const c=ha(u,o),f=new d.P(0,0),w=new d.P(0,0);let S=0;for(const C in c){const A=c[C],M=this._touches[C];M&&(f._add(A),w._add(A.sub(M)),S++,c[C]=A)}if(this._touches=c,this._shouldBePrevented(S)||!w.mag())return;const E=w.div(S);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(S),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,o,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([o[0],o[1]]))}touchmove(e,o,u){if(!this._firstTwoTouches)return;e.preventDefault();const[c,f]=this._firstTwoTouches,w=da(u,o,c),S=da(u,o,f);if(!w||!S)return;const E=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],E,e)}touchend(e,o,u){if(!this._firstTwoTouches)return;const[c,f]=this._firstTwoTouches,w=da(u,o,c),S=da(u,o,f);w&&S||(this._active&&U.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function da(m,e,o){for(let u=0;u<m.length;u++)if(m[u].identifier===o)return e[u]}function qu(m,e){return Math.log(m/e)/Math.LN2}class Zu extends pl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,o){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(qu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:qu(this._distance,u),pinchAround:o}}}function Hu(m,e){return 180*m.angleWith(e)/Math.PI}class Gu extends pl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,o,u){const c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Hu(this._vector,c),pinchAround:o}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const o=25/(Math.PI*this._minDiameter)*360,u=Hu(e,this._startVector);return Math.abs(u)<o}}function fl(m){return Math.abs(m.y)>Math.abs(m.x)}class pa extends pl{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,o,u){super.touchstart(e,o,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,fl(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,o,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=e[0].sub(this._lastPoints[0]),f=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,f,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(c.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(e,o,u){if(this._valid!==void 0)return this._valid;const c=e.mag()>=2,f=o.mag()>=2;if(!c&&!f)return;if(!c||!f)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const w=e.y>0==o.y>0;return fl(e)&&fl(o)&&w}}const qh={panStep:100,bearingStep:15,pitchStep:10};class ri{constructor(e){this._tr=new vi(e);const o=qh;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let o=0,u=0,c=0,f=0,w=0;switch(e.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),f=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),f=1);break;case 38:e.shiftKey?c=1:(e.preventDefault(),w=-1);break;case 40:e.shiftKey?c=-1:(e.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(u=0,c=0),{cameraAnimation:S=>{const E=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:Fi,zoom:o?Math.round(E.zoom)+o*(e.shiftKey?2:1):E.zoom,bearing:E.bearing+u*this._bearingStep,pitch:E.pitch+c*this._pitchStep,offset:[-f*this._panStep,-w*this._panStep],center:E.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Fi(m){return m*(2-m)}const Wu=4.000244140625;class wi{constructor(e,o){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new vi(e),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let o=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=q.now(),c=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,o!==0&&o%Wu==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(c*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),e.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=e,this._delta-=o,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=U.mousePos(this._map.getCanvas(),e),u=this._tr;this._around=o.y>u.transform.height/2-u.transform.getHorizon()?d.N.convert(this._aroundCenter?u.center:u.unproject(o)):d.N.convert(u.center),this._aroundPoint=u.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>Wu?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&C!==0&&(C=1/C);const A=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(A*C))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,u=this._startZoom,c=this._easing;let f,w=!1;const S=q.now()-this._lastWheelEventTime;if(this._type==="wheel"&&u&&c&&S){const E=Math.min(S/200,1),C=c(E);f=d.y.number(u,o,C),E<1?this._frameId||(this._frameId=!0):w=!0}else f=o,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:f-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let o=d.b9;if(this._prevEase){const u=this._prevEase,c=(q.now()-u.start)/u.duration,f=u.easing(c+.01)-u.easing(c),w=.27/Math.sqrt(f*f+1e-4)*.01,S=Math.sqrt(.0729-w*w);o=d.b8(w,S,.25,1)}return this._prevEase={start:q.now(),duration:e,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Fs{constructor(e,o){this._clickZoom=e,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hf{constructor(e){this._tr=new vi(e),this.reset()}reset(){this._active=!1}dblclick(e,o){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class df{constructor(){this._tap=new cl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,o,u){if(!this._swipePoint)if(this._tapTime){const c=o[0],f=e.timeStamp-this._tapTime<500,w=this._tapPoint.dist(c)<30;f&&w?u.length>0&&(this._swipePoint=c,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,o,u)}touchmove(e,o,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const c=o[0],f=c.y-this._swipePoint.y;return this._swipePoint=c,e.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(e,o,u)}touchend(e,o,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const c=this._tap.touchend(e,o,u);c&&(this._tapTime=e.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zh{constructor(e,o,u){this._el=e,this._mousePan=o,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Hh{constructor(e,o,u){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=o,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Xu{constructor(e,o,u,c){this._el=e,this._touchZoom=o,this._touchRotate=u,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class mo{constructor(e,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=U.create("div","maplibregl-cooperative-gesture-screen",e);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=o,this._container.appendChild(c);const f=document.createElement("div");f.className="maplibregl-mobile-message",f.textContent=u,this._container.appendChild(f),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(U.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,o){this._enabled&&(this._map.fire(new d.k("cooperativegestureprevented",{gestureType:e,originalEvent:o})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ni=m=>m.zoom||m.drag||m.pitch||m.rotate;class Je extends d.k{}function ml(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Ku{constructor(e,o){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,f)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=c.type==="renderFrame"?void 0:c,S={needsRenderFrame:!1},E={},C={},A=c.touches,M=A?this._getMapTouches(A):void 0,F=M?U.touchPos(this._map.getCanvas(),M):U.mousePos(this._map.getCanvas(),c);for(const{handlerName:K,handler:Y,allowed:Q}of this._handlers){if(!Y.isEnabled())continue;let ne;this._blockedByActive(C,Q,K)?Y.reset():Y[f||c.type]&&(ne=Y[f||c.type](c,F,M),this.mergeHandlerResult(S,E,ne,K,w),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||Y.isActive())&&(C[K]=Y)}const V={};for(const K in this._previousActiveHandlers)C[K]||(V[K]=w);this._previousActiveHandlers=C,(Object.keys(V).length||ml(S))&&(this._changes.push([S,E,V]),this._triggerRenderFrame()),(Object.keys(C).length||ml(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=S;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Bu(e),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,f,w]of this._listeners)U.addEventListener(c,f,c===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[e,o,u]of this._listeners)U.removeEventListener(e,o,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const o=this._map,u=o.getCanvasContainer();this._add("mapEvent",new $h(o,e));const c=o.boxZoom=new Un(o,e);this._add("boxZoom",c),e.interactive&&e.boxZoom&&c.enable();const f=o.cooperativeGestures=new mo(o,e.cooperativeGestures);this._add("cooperativeGestures",f),e.cooperativeGestures&&f.enable();const w=new fo(o),S=new hf(o);o.doubleClickZoom=new Fs(S,w),this._add("tapZoom",w),this._add("clickZoom",S),e.interactive&&e.doubleClickZoom&&o.doubleClickZoom.enable();const E=new df;this._add("tapDragZoom",E);const C=o.touchPitch=new pa(o);this._add("touchPitch",C),e.interactive&&e.touchPitch&&o.touchPitch.enable(e.touchPitch);const A=Uu(e),M=$u(e);o.dragRotate=new Hh(e,A,M),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]),e.interactive&&e.dragRotate&&o.dragRotate.enable();const F=(({enable:ne,clickTolerance:W})=>{const le=new hl({checkCorrectEvent:de=>U.mouseButton(de)===0&&!de.ctrlKey});return new Ji({clickTolerance:W,move:(de,ge)=>({around:ge,panDelta:ge.sub(de)}),activateOnStart:!0,moveStateManager:le,enable:ne,assignEvents:dl})})(e),V=new Ls(e,o);o.dragPan=new Zh(u,F,V),this._add("mousePan",F),this._add("touchPan",V,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&o.dragPan.enable(e.dragPan);const $=new Gu,K=new Zu;o.touchZoomRotate=new Xu(u,K,$,E),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&o.touchZoomRotate.enable(e.touchZoomRotate);const Y=o.scrollZoom=new wi(o,()=>this._triggerRenderFrame());this._add("scrollZoom",Y,["mousePan"]),e.interactive&&e.scrollZoom&&o.scrollZoom.enable(e.scrollZoom);const Q=o.keyboard=new ri(o);this._add("keyboard",Q),e.interactive&&e.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new Er(o))}_add(e,o,u){this._handlers.push({handlerName:e,handler:o,allowed:u}),this._handlersById[e]=o}stop(e){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ni(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,o,u){for(const c in e)if(c!==u&&(!o||o.indexOf(c)<0))return!0;return!1}_getMapTouches(e){const o=[];for(const u of e)this._el.contains(u.target)&&o.push(u);return o}mergeHandlerResult(e,o,u,c,f){if(!u)return;d.e(e,u);const w={handlerName:c,originalEvent:u.originalEvent||f};u.zoomDelta!==void 0&&(o.zoom=w),u.panDelta!==void 0&&(o.drag=w),u.pitchDelta!==void 0&&(o.pitch=w),u.bearingDelta!==void 0&&(o.rotate=w)}_applyChanges(){const e={},o={},u={};for(const[c,f,w]of this._changes)c.panDelta&&(e.panDelta=(e.panDelta||new d.P(0,0))._add(c.panDelta)),c.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(e.around=c.around),c.pinchAround!==void 0&&(e.pinchAround=c.pinchAround),c.noInertia&&(e.noInertia=c.noInertia),d.e(o,f),d.e(u,w);this._updateMapTransform(e,o,u),this._changes=[]}_updateMapTransform(e,o,u){const c=this._map,f=c._getTransformForUpdate(),w=c.terrain;if(!(ml(e)||w&&this._terrainMovement))return this._fireEvents(o,u,!0);let{panDelta:S,zoomDelta:E,bearingDelta:C,pitchDelta:A,around:M,pinchAround:F}=e;F!==void 0&&(M=F),c._stop(!0),M=M||c.transform.centerPoint;const V=f.pointLocation(S?M.sub(S):M);C&&(f.bearing+=C),A&&(f.pitch+=A),E&&(f.zoom+=E),w?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?f.center=f.pointLocation(f.centerPoint.sub(S)):f.setLocationAtPoint(V,M):(this._terrainMovement=!0,this._map._elevationFreeze=!0,f.setLocationAtPoint(V,M)):f.setLocationAtPoint(V,M),c._applyUpdatedTransform(f),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(o,u,!0)}_fireEvents(e,o,u){const c=ni(this._eventsInProgress),f=ni(e),w={};for(const M in e){const{originalEvent:F}=e[M];this._eventsInProgress[M]||(w[`${M}start`]=F),this._eventsInProgress[M]=e[M]}!c&&f&&this._fireEvent("movestart",f.originalEvent);for(const M in w)this._fireEvent(M,w[M]);f&&this._fireEvent("move",f.originalEvent);for(const M in e){const{originalEvent:F}=e[M];this._fireEvent(M,F)}const S={};let E;for(const M in this._eventsInProgress){const{handlerName:F,originalEvent:V}=this._eventsInProgress[M];this._handlersById[F].isActive()||(delete this._eventsInProgress[M],E=o[F]||V,S[`${M}end`]=E)}for(const M in S)this._fireEvent(M,S[M]);const C=ni(this._eventsInProgress),A=(c||f)&&!C;if(A&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const M=this._map._getTransformForUpdate();M.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(M)}if(u&&A){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;!M||!M.essential&&q.prefersReducedMotion?(this._map.fire(new d.k("moveend",{originalEvent:E})),F(this._map.getBearing())&&this._map.resetNorth()):(F(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(e,o){this._map.fire(new d.k(e,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Je("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Gh extends d.E{constructor(e,o){super(),this._renderFrameCallback=()=>{const u=Math.min((q.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new d.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,o){return this.jumpTo({center:e},o)}panBy(e,o,u){return e=d.P.convert(e).mult(-1),this.panTo(this.transform.center,d.e({offset:e},o),u)}panTo(e,o,u){return this.easeTo(d.e({center:e},o),u)}getZoom(){return this.transform.zoom}setZoom(e,o){return this.jumpTo({zoom:e},o),this}zoomTo(e,o,u){return this.easeTo(d.e({zoom:e},o),u)}zoomIn(e,o){return this.zoomTo(this.getZoom()+1,e,o),this}zoomOut(e,o){return this.zoomTo(this.getZoom()-1,e,o),this}getBearing(){return this.transform.bearing}setBearing(e,o){return this.jumpTo({bearing:e},o),this}getPadding(){return this.transform.padding}setPadding(e,o){return this.jumpTo({padding:e},o),this}rotateTo(e,o,u){return this.easeTo(d.e({bearing:e},o),u)}resetNorth(e,o){return this.rotateTo(0,d.e({duration:1e3},e),o),this}resetNorthPitch(e,o){return this.easeTo(d.e({bearing:0,pitch:0,duration:1e3},e),o),this}snapToNorth(e,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,o):this}getPitch(){return this.transform.pitch}setPitch(e,o){return this.jumpTo({pitch:e},o),this}cameraForBounds(e,o){e=xe.convert(e).adjustAntiMeridian();const u=o&&o.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,o)}_cameraForBoxAndBearing(e,o,u,c){const f={top:0,bottom:0,right:0,left:0};if(typeof(c=d.e({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const Be=c.padding;c.padding={top:Be,bottom:Be,right:Be,left:Be}}c.padding=d.e(f,c.padding);const w=this.transform,S=w.padding,E=new xe(e,o),C=w.project(E.getNorthWest()),A=w.project(E.getNorthEast()),M=w.project(E.getSouthEast()),F=w.project(E.getSouthWest()),V=d.ba(-u),$=C.rotate(V),K=A.rotate(V),Y=M.rotate(V),Q=F.rotate(V),ne=new d.P(Math.max($.x,K.x,Q.x,Y.x),Math.max($.y,K.y,Q.y,Y.y)),W=new d.P(Math.min($.x,K.x,Q.x,Y.x),Math.min($.y,K.y,Q.y,Y.y)),le=ne.sub(W),de=(w.width-(S.left+S.right+c.padding.left+c.padding.right))/le.x,ge=(w.height-(S.top+S.bottom+c.padding.top+c.padding.bottom))/le.y;if(ge<0||de<0)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ee=Math.min(w.scaleZoom(w.scale*Math.min(de,ge)),c.maxZoom),ze=d.P.convert(c.offset),Ve=new d.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(d.ba(u)),Ge=ze.add(Ve).mult(w.scale/w.zoomScale(Ee));return{center:w.unproject(C.add(M).div(2).sub(Ge)),zoom:Ee,bearing:u}}fitBounds(e,o,u){return this._fitInternal(this.cameraForBounds(e,o),o,u)}fitScreenCoordinates(e,o,u,c,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.P.convert(e)),this.transform.pointLocation(d.P.convert(o)),u,c),c,f)}_fitInternal(e,o,u){return e?(delete(o=d.e(e,o)).padding,o.linear?this.easeTo(o,u):this.flyTo(o,u)):this}jumpTo(e,o){this.stop();const u=this._getTransformForUpdate();let c=!1,f=!1,w=!1;return"zoom"in e&&u.zoom!==+e.zoom&&(c=!0,u.zoom=+e.zoom),e.center!==void 0&&(u.center=d.N.convert(e.center)),"bearing"in e&&u.bearing!==+e.bearing&&(f=!0,u.bearing=+e.bearing),"pitch"in e&&u.pitch!==+e.pitch&&(w=!0,u.pitch=+e.pitch),e.padding==null||u.isPaddingEqual(e.padding)||(u.padding=e.padding),this._applyUpdatedTransform(u),this.fire(new d.k("movestart",o)).fire(new d.k("move",o)),c&&this.fire(new d.k("zoomstart",o)).fire(new d.k("zoom",o)).fire(new d.k("zoomend",o)),f&&this.fire(new d.k("rotatestart",o)).fire(new d.k("rotate",o)).fire(new d.k("rotateend",o)),w&&this.fire(new d.k("pitchstart",o)).fire(new d.k("pitch",o)).fire(new d.k("pitchend",o)),this.fire(new d.k("moveend",o))}calculateCameraOptionsFromTo(e,o,u,c=0){const f=d.Z.fromLngLat(e,o),w=d.Z.fromLngLat(u,c),S=w.x-f.x,E=w.y-f.y,C=w.z-f.z,A=Math.hypot(S,E,C);if(A===0)throw new Error("Can't calculate camera options with same From and To");const M=Math.hypot(S,E),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/A/this.transform.tileSize),V=180*Math.atan2(S,-E)/Math.PI;let $=180*Math.acos(M/A)/Math.PI;return $=C<0?90-$:90+$,{center:w.toLngLat(),zoom:F,pitch:$,bearing:V}}easeTo(e,o){var u;this._stop(!1,e.easeId),((e=d.e({offset:[0,0],duration:500,easing:d.b9},e)).animate===!1||!e.essential&&q.prefersReducedMotion)&&(e.duration=0);const c=this._getTransformForUpdate(),f=c.zoom,w=c.bearing,S=c.pitch,E=c.padding,C="bearing"in e?this._normalizeBearing(e.bearing,w):w,A="pitch"in e?+e.pitch:S,M="padding"in e?e.padding:c.padding,F=d.P.convert(e.offset);let V=c.centerPoint.add(F);const $=c.pointLocation(V),{center:K,zoom:Y}=c.getConstrained(d.N.convert(e.center||$),(u=e.zoom)!==null&&u!==void 0?u:f);this._normalizeCenter(K,c);const Q=c.project($),ne=c.project(K).sub(Q),W=c.zoomScale(Y-f);let le,de;e.around&&(le=d.N.convert(e.around),de=c.locationPoint(le));const ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Y!==f,this._rotating=this._rotating||w!==C,this._pitching=this._pitching||A!==S,this._padding=!c.isPaddingEqual(M),this._easeId=e.easeId,this._prepareEase(o,e.noMoveStart,ge),this.terrain&&this._prepareElevation(K),this._ease(Ee=>{if(this._zooming&&(c.zoom=d.y.number(f,Y,Ee)),this._rotating&&(c.bearing=d.y.number(w,C,Ee)),this._pitching&&(c.pitch=d.y.number(S,A,Ee)),this._padding&&(c.interpolatePadding(E,M,Ee),V=c.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ee),le)c.setLocationAtPoint(le,de);else{const ze=c.zoomScale(c.zoom-f),Ve=Y>f?Math.min(2,W):Math.max(.5,W),Ge=Math.pow(Ve,1-Ee),Be=c.unproject(Q.add(ne.mult(Ee*Ge)).mult(ze));c.setLocationAtPoint(c.renderWorldCopies?Be.wrap():Be,V)}this._applyUpdatedTransform(c),this._fireMoveEvents(o)},Ee=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o,Ee)},e),this}_prepareEase(e,o,u={}){this._moving=!0,o||u.moving||this.fire(new d.k("movestart",e)),this._zooming&&!u.zooming&&this.fire(new d.k("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new d.k("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new d.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&o!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(o-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=o}this.transform.elevation=d.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const o=e.getCameraPosition(),u=this.terrain.getElevationForLngLatZoom(o.lngLat,e.zoom);if(o.altitude<u){const c=this.calculateCameraOptionsFromTo(o.lngLat,u,e.center,e.elevation);return{pitch:c.pitch,zoom:c.zoom}}return{}}_applyUpdatedTransform(e){const o=[];if(this.terrain&&o.push(c=>this._elevateCameraIfInsideTerrain(c)),this.transformCameraUpdate&&o.push(c=>this.transformCameraUpdate(c)),!o.length)return;const u=e.clone();for(const c of o){const f=u.clone(),{center:w,zoom:S,pitch:E,bearing:C,elevation:A}=c(f);w&&(f.center=w),S!==void 0&&(f.zoom=S),E!==void 0&&(f.pitch=E),C!==void 0&&(f.bearing=C),A!==void 0&&(f.elevation=A),u.apply(f)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new d.k("move",e)),this._zooming&&this.fire(new d.k("zoom",e)),this._rotating&&this.fire(new d.k("rotate",e)),this._pitching&&this.fire(new d.k("pitch",e))}_afterEase(e,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const u=this._zooming,c=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new d.k("zoomend",e)),c&&this.fire(new d.k("rotateend",e)),f&&this.fire(new d.k("pitchend",e)),this.fire(new d.k("moveend",e))}flyTo(e,o){var u;if(!e.essential&&q.prefersReducedMotion){const qe=d.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(qe,o)}this.stop(),e=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.b9},e);const c=this._getTransformForUpdate(),f=c.zoom,w=c.bearing,S=c.pitch,E=c.padding,C="bearing"in e?this._normalizeBearing(e.bearing,w):w,A="pitch"in e?+e.pitch:S,M="padding"in e?e.padding:c.padding,F=d.P.convert(e.offset);let V=c.centerPoint.add(F);const $=c.pointLocation(V),{center:K,zoom:Y}=c.getConstrained(d.N.convert(e.center||$),(u=e.zoom)!==null&&u!==void 0?u:f);this._normalizeCenter(K,c);const Q=c.zoomScale(Y-f),ne=c.project($),W=c.project(K).sub(ne);let le=e.curve;const de=Math.max(c.width,c.height),ge=de/Q,Ee=W.mag();if("minZoom"in e){const qe=d.ac(Math.min(e.minZoom,f,Y),c.minZoom,c.maxZoom),xt=de/c.zoomScale(qe-f);le=Math.sqrt(xt/Ee*2)}const ze=le*le;function Ve(qe){const xt=(ge*ge-de*de+(qe?-1:1)*ze*ze*Ee*Ee)/(2*(qe?ge:de)*ze*Ee);return Math.log(Math.sqrt(xt*xt+1)-xt)}function Ge(qe){return(Math.exp(qe)-Math.exp(-qe))/2}function Be(qe){return(Math.exp(qe)+Math.exp(-qe))/2}const Fe=Ve(!1);let tt=function(qe){return Be(Fe)/Be(Fe+le*qe)},bt=function(qe){return de*((Be(Fe)*(Ge(xt=Fe+le*qe)/Be(xt))-Ge(Fe))/ze)/Ee;var xt},Ne=(Ve(!0)-Fe)/le;if(Math.abs(Ee)<1e-6||!isFinite(Ne)){if(Math.abs(de-ge)<1e-6)return this.easeTo(e,o);const qe=ge<de?-1:1;Ne=Math.abs(Math.log(ge/de))/le,bt=()=>0,tt=xt=>Math.exp(qe*le*xt)}return e.duration="duration"in e?+e.duration:1e3*Ne/("screenSpeed"in e?+e.screenSpeed/le:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=w!==C,this._pitching=A!==S,this._padding=!c.isPaddingEqual(M),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(K),this._ease(qe=>{const xt=qe*Ne,cr=1/tt(xt);c.zoom=qe===1?Y:f+c.scaleZoom(cr),this._rotating&&(c.bearing=d.y.number(w,C,qe)),this._pitching&&(c.pitch=d.y.number(S,A,qe)),this._padding&&(c.interpolatePadding(E,M,qe),V=c.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(qe);const kt=qe===1?K:c.unproject(ne.add(W.mult(bt(xt))).mult(cr));c.setLocationAtPoint(c.renderWorldCopies?kt.wrap():kt,V),this._applyUpdatedTransform(c),this._fireMoveEvents(o)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,o){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,o)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,o,u){u.animate===!1||u.duration===0?(e(1),o()):(this._easeStart=q.now(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,o){e=d.b3(e,-180,180);const u=Math.abs(e-o);return Math.abs(e-360-o)<u&&(e-=360),Math.abs(e+360-o)<u&&(e+=360),e}_normalizeCenter(e,o){if(!o.renderWorldCopies||o.lngRange)return;const u=e.lng-o.center.lng;e.lng+=u>180?-360:u<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(d.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const go={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class yo{constructor(e=go){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=U.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=U.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){U.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,o){const u=this._map._getUIString(`AttributionControl.${o}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const o=this._map.style.sourceCaches;for(const c in o){const f=o[c];if(f.used||f.usedForTerrain){const w=f.getSource();w.attribution&&e.indexOf(w.attribution)<0&&e.push(w.attribution)}}e=e.filter(c=>String(c).trim()),e.sort((c,f)=>c.length-f.length),e=e.filter((c,f)=>{for(let w=f+1;w<e.length;w++)if(e[w].indexOf(c)>=0)return!1;return!0});const u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ju{constructor(e={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const u=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=U.create("div","maplibregl-ctrl");const o=U.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){U.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class zt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const o=++this._id;return this._queue.push({callback:e,id:o,cancelled:!1}),o}remove(e){const o=this._currentlyRunning,u=o?this._queue.concat(o):this._queue;for(const c of u)if(c.id===e)return void(c.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const u of o)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Yu=d.Y([{name:"a_pos3d",type:"Int16",components:3}]);class pf extends d.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,o){this.sourceCache.update(e,o),this._renderableTilesKeys=[];const u={};for(const c of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))u[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),d.aP(c.posMatrix,0,d.X,0,d.X,0,1),this._tiles[c.key]=new Nr(c,this.tileSize));for(const c in this._tiles)u[c]||delete this._tiles[c]}freeRtt(e){for(const o in this._tiles){const u=this._tiles[o];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const o={};for(const u of this._renderableTilesKeys){const c=this._tiles[u].tileID;if(c.canonical.equals(e.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16),d.aP(f.posMatrix,0,d.X,0,d.X,0,1),o[u]=f}else if(c.canonical.isChildOf(e.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16);const w=c.canonical.z-e.canonical.z,S=c.canonical.x-(c.canonical.x>>w<<w),E=c.canonical.y-(c.canonical.y>>w<<w),C=d.X>>w;d.aP(f.posMatrix,0,C,0,C,0,1),d.J(f.posMatrix,f.posMatrix,[-S*C,-E*C,0]),o[u]=f}else if(e.canonical.isChildOf(c.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16);const w=e.canonical.z-c.canonical.z,S=e.canonical.x-(e.canonical.x>>w<<w),E=e.canonical.y-(e.canonical.y>>w<<w),C=d.X>>w;d.aP(f.posMatrix,0,d.X,0,d.X,0,1),d.J(f.posMatrix,f.posMatrix,[S*C,E*C,0]),d.K(f.posMatrix,f.posMatrix,[1/2**w,1/2**w,0]),o[u]=f}}return o}getSourceTile(e,o){const u=this.sourceCache._source;let c=e.overscaledZ-this.deltaZoom;if(c>u.maxzoom&&(c=u.maxzoom),c<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(c).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!f||!f.dem)&&o)for(;c>=u.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(e.scaledTo(c--).key);return f}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=e)}}class Qu{constructor(e,o,u){this.painter=e,this.sourceCache=new pf(o),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,o,u,c=d.X){var f;if(!(o>=0&&o<c&&u>=0&&u<c))return 0;const w=this.getTerrainData(e),S=(f=w.tile)===null||f===void 0?void 0:f.dem;if(!S)return 0;const E=function($,K,Y){var Q=K[0],ne=K[1];return $[0]=Y[0]*Q+Y[4]*ne+Y[12],$[1]=Y[1]*Q+Y[5]*ne+Y[13],$}([],[o/c*d.X,u/c*d.X],w.u_terrain_matrix),C=[E[0]*S.dim,E[1]*S.dim],A=Math.floor(C[0]),M=Math.floor(C[1]),F=C[0]-A,V=C[1]-M;return S.get(A,M)*(1-F)*(1-V)+S.get(A+1,M)*F*(1-V)+S.get(A,M+1)*(1-F)*V+S.get(A+1,M+1)*F*V}getElevationForLngLatZoom(e,o){if(!d.bb(o,e.wrap()))return 0;const{tileID:u,mercatorX:c,mercatorY:f}=this._getOverscaledTileIDFromLngLatZoom(e,o);return this.getElevation(u,c%d.X,f%d.X,d.X)}getElevation(e,o,u,c=d.X){return this.getDEMElevation(e,o,u,c)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const c=this.painter.context,f=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new pt(c,f,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new pt(c,new d.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.an([])}const o=this.sourceCache.getSourceTile(e,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const c=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new pt(c,o.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),o.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const u=o&&o+o.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const c=this.sourceCache.sourceCache._source.maxzoom;let f=e.canonical.z-o.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=c?f=e.canonical.z-c:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=e.canonical.x-(e.canonical.x>>f<<f),S=e.canonical.y-(e.canonical.y>>f<<f),E=d.bc(new Float64Array(16),[1/(d.X<<f),1/(d.X<<f),0]);d.J(E,E,[w*d.X,S*d.X,0]),this._demMatrixCache[e.key]={matrix:E,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(e){const o=this.painter,u=o.width/devicePixelRatio,c=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new pt(o.context,{width:u,height:c,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new pt(o.context,{width:u,height:c,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(u,c,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,u,c))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,w=0;f<this._coordsTextureSize;f++)for(let S=0;S<this._coordsTextureSize;S++,w+=4)o[w+0]=255&S,o[w+1]=255&f,o[w+2]=S>>8<<4|f>>8,o[w+3]=0;const u=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),c=new pt(e,u,e.gl.RGBA,{premultiply:!1});return c.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),u=this.painter.context,c=u.gl,f=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(f,S-w-1,1,1,c.RGBA,c.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null);const E=o[0]+(o[2]>>4<<8),C=o[1]+((15&o[2])<<8),A=this.coordsIndex[255-o[3]],M=A&&this.sourceCache.getTileByID(A);if(!M)return null;const F=this._coordsTextureSize,V=(1<<M.tileID.canonical.z)*F;return new d.Z((M.tileID.canonical.x*F+E)/V+M.tileID.wrap,(M.tileID.canonical.y*F+C)/V,this.getElevation(M.tileID,E,C,F))}depthAtPoint(e){const o=new Uint8Array(4),u=this.painter.context,c=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,o=new d.bd,u=new d.aY,c=this.meshSize,f=d.X/c,w=c*c;for(let M=0;M<=c;M++)for(let F=0;F<=c;F++)o.emplaceBack(F*f,M*f,0);for(let M=0;M<w;M+=c+1)for(let F=0;F<c;F++)u.emplaceBack(F+M,c+F+M+1,c+F+M+2),u.emplaceBack(F+M,c+F+M+2,F+M+1);const S=o.length,E=S+2*(c+1);for(const M of[0,1])for(let F=0;F<=c;F++)for(const V of[0,1])o.emplaceBack(F*f,M*d.X,V);for(let M=0;M<2*c;M+=2)u.emplaceBack(E+M,E+M+1,E+M+3),u.emplaceBack(E+M,E+M+3,E+M+2),u.emplaceBack(S+M,S+M+3,S+M+1),u.emplaceBack(S+M,S+M+2,S+M+3);const C=o.length,A=C+2*(c+1);for(const M of[0,1])for(let F=0;F<=c;F++)for(const V of[0,1])o.emplaceBack(M*d.X,F*f,V);for(let M=0;M<2*c;M+=2)u.emplaceBack(C+M,C+M+1,C+M+3),u.emplaceBack(C+M,C+M+3,C+M+2),u.emplaceBack(A+M,A+M+3,A+M+1),u.emplaceBack(A+M,A+M+2,A+M+3);return this._mesh=new sl(e.createVertexBuffer(o,Yu.members),e.createIndexBuffer(u),d.a0.simpleSegment(0,0,o.length,u.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*d.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,o){var u;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(e,o);return(u=this.getMinMaxElevation(c).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){const o=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return o&&o.dem&&(u.minElevation=o.dem.min*this.exaggeration,u.maxElevation=o.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,o){const u=d.Z.fromLngLat(e.wrap()),c=(1<<o)*d.X,f=u.x*c,w=u.y*c,S=Math.floor(f/d.X),E=Math.floor(w/d.X);return{tileID:new d.S(o,0,o,S,E),mercatorX:f,mercatorY:w}}}class ff{constructor(e,o,u){this._context=e,this._size=o,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new pt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(u.texture),{id:e,fbo:o,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>e.id!==o),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const _o={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Wh{constructor(e,o){this.painter=e,this.terrain=o,this.pool=new ff(e.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(u=>!e._layers[u].isHidden(o)),this._coordsDescendingInv={};for(const u in e.sourceCaches){this._coordsDescendingInv[u]={};const c=e.sourceCaches[u].getVisibleCoordinates();for(const f of c){const w=this.terrain.sourceCache.getTerrainCoords(f);for(const S in w)this._coordsDescendingInv[u][S]||(this._coordsDescendingInv[u][S]=[]),this._coordsDescendingInv[u][S].push(w[S])}}this._coordsDescendingInvStr={};for(const u of e._order){const c=e._layers[u],f=c.source;if(_o[c.type]&&!this._coordsDescendingInvStr[f]){this._coordsDescendingInvStr[f]={};for(const w in this._coordsDescendingInv[f])this._coordsDescendingInvStr[f][w]=this._coordsDescendingInv[f][w].map(S=>S.key).sort().join()}}for(const u of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const f=this._coordsDescendingInvStr[c][u.tileID.key];f&&f!==u.rttCoords[c]&&(u.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const o=e.type,u=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(_o[o]&&(this._prevType&&_o[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(e.id),!c))return!0;if(_o[this._prevType]||_o[o]&&c){this._prevType=o;const f=this._stacks.length-1,w=this._stacks[f]||[];for(const S of this._renderableTiles){if(this.pool.isFull()&&(jh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(S),S.rtt[f]){const C=this.pool.getObjectForId(S.rtt[f].id);if(C.stamp===S.rtt[f].stamp){this.pool.useObject(C);continue}}const E=this.pool.getOrCreateFreeObject();this.pool.useObject(E),this.pool.stampObject(E),S.rtt[f]={id:E.id,stamp:E.stamp},u.context.bindFramebuffer.set(E.fbo.framebuffer),u.context.clear({color:d.aM.transparent,stencil:0}),u.currentStencilSource=void 0;for(let C=0;C<w.length;C++){const A=u.style._layers[w[C]],M=A.source?this._coordsDescendingInv[A.source][S.tileID.key]:[S.tileID];u.context.viewport.set([0,0,E.fbo.width,E.fbo.height]),u._renderTileClippingMasks(A,M),u.renderLayer(u,u.style.sourceCaches[A.source],A,M),A.source&&(S.rttCoords[A.source]=this._coordsDescendingInvStr[A.source][S.tileID.key])}}return jh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),_o[o]}return!1}}const ec={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Xh=N,mf={hash:!1,interactive:!0,bearingSnap:7,attributionControl:go,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},tc=m=>{m.touchstart=m.dragStart,m.touchmoveWindow=m.dragMove,m.touchend=m.dragEnd},gf={showCompass:!0,showZoom:!0,visualizePitch:!1};class yf{constructor(e,o,u=!1){this.mousedown=w=>{this.startMouse(d.e({},w,{ctrlKey:!0,preventDefault:()=>w.preventDefault()}),U.mousePos(this.element,w)),U.addEventListener(window,"mousemove",this.mousemove),U.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=w=>{this.moveMouse(w,U.mousePos(this.element,w))},this.mouseup=w=>{this.mouseRotate.dragEnd(w),this.mousePitch&&this.mousePitch.dragEnd(w),this.offTemp()},this.touchstart=w=>{w.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=U.touchPos(this.element,w.targetTouches)[0],this.startTouch(w,this._startPos),U.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.addEventListener(window,"touchend",this.touchend))},this.touchmove=w=>{w.targetTouches.length!==1?this.reset():(this._lastPos=U.touchPos(this.element,w.targetTouches)[0],this.moveTouch(w,this._lastPos))},this.touchend=w=>{w.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=e.dragRotate._mouseRotate.getClickTolerance(),f=e.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=Uu({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:w,clickTolerance:S,bearingDegreesPerPixelMoved:E=.8})=>{const C=new Vu;return new Ji({clickTolerance:S,move:(A,M)=>({bearingDelta:(M.x-A.x)*E}),moveStateManager:C,enable:w,assignEvents:tc})})({clickTolerance:c,enable:!0}),this.map=e,u&&(this.mousePitch=$u({clickTolerance:f,enable:!0}),this.touchPitch=(({enable:w,clickTolerance:S,pitchDegreesPerPixelMoved:E=-.5})=>{const C=new Vu;return new Ji({clickTolerance:S,move:(A,M)=>({pitchDelta:(M.y-A.y)*E}),moveStateManager:C,enable:w,assignEvents:tc})})({clickTolerance:f,enable:!0})),U.addEventListener(o,"mousedown",this.mousedown),U.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),U.addEventListener(o,"touchcancel",this.reset)}startMouse(e,o){this.mouseRotate.dragStart(e,o),this.mousePitch&&this.mousePitch.dragStart(e,o),U.disableDrag()}startTouch(e,o){this.touchRotate.dragStart(e,o),this.touchPitch&&this.touchPitch.dragStart(e,o),U.disableDrag()}moveMouse(e,o){const u=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(e,o)||{};if(c&&u.setBearing(u.getBearing()+c),this.mousePitch){const{pitchDelta:f}=this.mousePitch.dragMove(e,o)||{};f&&u.setPitch(u.getPitch()+f)}}moveTouch(e,o){const u=this.map,{bearingDelta:c}=this.touchRotate.dragMove(e,o)||{};if(c&&u.setBearing(u.getBearing()+c),this.touchPitch){const{pitchDelta:f}=this.touchPitch.dragMove(e,o)||{};f&&u.setPitch(u.getPitch()+f)}}off(){const e=this.element;U.removeEventListener(e,"mousedown",this.mousedown),U.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend),U.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){U.enableDrag(),U.removeEventListener(window,"mousemove",this.mousemove),U.removeEventListener(window,"mouseup",this.mouseup),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend)}}let $n;function ur(m,e,o){const u=new d.N(m.lng,m.lat);if(m=new d.N(m.lng,m.lat),e){const c=new d.N(m.lng-360,m.lat),f=new d.N(m.lng+360,m.lat),w=o.locationPoint(m).distSqr(e);o.locationPoint(c).distSqr(e)<w?m=c:o.locationPoint(f).distSqr(e)<w&&(m=f)}for(;Math.abs(m.lng-o.center.lng)>180;){const c=o.locationPoint(m);if(c.x>=0&&c.y>=0&&c.x<=o.width&&c.y<=o.height)break;m.lng>o.center.lng?m.lng-=360:m.lng+=360}return m.lng!==u.lng&&o.locationPoint(m).y>o.height/2-o.getHorizon()?m:u}const xo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function gl(m,e,o){const u=m.classList;for(const c in xo)u.remove(`maplibregl-${o}-anchor-${c}`);u.add(`maplibregl-${o}-anchor-${e}`)}class yl extends d.E{constructor(e){if(super(),this._onKeyPress=o=>{const u=o.code,c=o.charCode||o.keyCode;u!=="Space"&&u!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=o=>{const u=o.originalEvent.target,c=this._element;this._popup&&(u===c||c.contains(u))&&this.togglePopup()},this._update=o=>{var u;if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();((o==null?void 0:o.type)==="terrain"||(o==null?void 0:o.type)==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?ur(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||o&&o.type!=="moveend"||(this._pos=this._pos.round()),U.setTransform(this._element,`${xo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${w} ${f}`),q.frameAsync(new AbortController).then(()=>{this._updateOpacity(o&&o.type==="moveend")}).catch(()=>{})},this._onMove=o=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.k("dragstart"))),this.fire(new d.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=d.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=U.create("div");const o=U.createNS("http://www.w3.org/2000/svg","svg"),u=41,c=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${u}px`),o.setAttributeNS(null,"width",`${c}px`),o.setAttributeNS(null,"viewBox",`0 0 ${c} ${u}`);const f=U.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const w=U.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const S=U.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Q of E){const ne=U.createNS("http://www.w3.org/2000/svg","ellipse");ne.setAttributeNS(null,"opacity","0.04"),ne.setAttributeNS(null,"cx","10.5"),ne.setAttributeNS(null,"cy","5.80029008"),ne.setAttributeNS(null,"rx",Q.rx),ne.setAttributeNS(null,"ry",Q.ry),S.appendChild(ne)}const C=U.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const A=U.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(A);const M=U.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const F=U.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(F);const V=U.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(6.0, 7.0)"),V.setAttributeNS(null,"fill","#FFFFFF");const $=U.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(8.0, 8.0)");const K=U.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#000000"),K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962");const Y=U.createNS("http://www.w3.org/2000/svg","circle");Y.setAttributeNS(null,"fill","#FFFFFF"),Y.setAttributeNS(null,"cx","5.5"),Y.setAttributeNS(null,"cy","5.5"),Y.setAttributeNS(null,"r","5.4999962"),$.appendChild(K),$.appendChild(Y),w.appendChild(S),w.appendChild(C),w.appendChild(M),w.appendChild(V),w.appendChild($),o.appendChild(w),o.setAttributeNS(null,"height",u*this._scale+"px"),o.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(o),this._offset=d.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),gl(this._element,this._anchor,"marker"),e&&e.className)for(const o of e.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),U.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const c=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var o,u;if(!(!((o=this._map)===null||o===void 0)&&o.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const c=this._map,f=c.terrain.depthAtPoint(this._pos),w=c.terrain.getElevationForLngLatZoom(this._lngLat,c.transform.tileZoom);if(c.transform.lngLatToCameraDepth(this._lngLat,w)-f<.006)return void(this._element.style.opacity=this._opacity);const S=-this._offset.y/c.transform._pixelPerMeter,E=Math.sin(c.getPitch()*Math.PI/180)*S,C=c.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),A=c.transform.lngLatToCameraDepth(this._lngLat,w+E)-C>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&A&&this._popup.remove(),this._element.style.opacity=A?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=d.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,o){return e===void 0&&o===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const Kh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let fa=0,ma=!1;const Oi={maxWidth:100,unit:"metric"};function ga(m,e,o){const u=o&&o.maxWidth||100,c=m._container.clientHeight/2,f=m.unproject([0,c]),w=m.unproject([u,c]),S=f.distanceTo(w);if(o&&o.unit==="imperial"){const E=3.2808*S;E>5280?et(e,u,E/5280,m._getUIString("ScaleControl.Miles")):et(e,u,E,m._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?et(e,u,S/1852,m._getUIString("ScaleControl.NauticalMiles")):S>=1e3?et(e,u,S/1e3,m._getUIString("ScaleControl.Kilometers")):et(e,u,S,m._getUIString("ScaleControl.Meters"))}function et(m,e,o,u){const c=function(f){const w=Math.pow(10,`${Math.floor(f)}`.length-1);let S=f/w;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(E){const C=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*C)/C}(S),w*S}(o);m.style.width=e*(c/o)+"px",m.innerHTML=`${c}&nbsp;${u}`}const dt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},_l=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function xl(m){if(m){if(typeof m=="number"){const e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,m),"top-left":new d.P(e,e),"top-right":new d.P(-e,e),bottom:new d.P(0,-m),"bottom-left":new d.P(e,-e),"bottom-right":new d.P(-e,-e),left:new d.P(m,0),right:new d.P(-m,0)}}if(m instanceof d.P||Array.isArray(m)){const e=d.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.P.convert(m.center||[0,0]),top:d.P.convert(m.top||[0,0]),"top-left":d.P.convert(m["top-left"]||[0,0]),"top-right":d.P.convert(m["top-right"]||[0,0]),bottom:d.P.convert(m.bottom||[0,0]),"bottom-left":d.P.convert(m["bottom-left"]||[0,0]),"bottom-right":d.P.convert(m["bottom-right"]||[0,0]),left:d.P.convert(m.left||[0,0]),right:d.P.convert(m.right||[0,0])}}return xl(new d.P(0,0))}const rc=N;v.AJAXError=d.bh,v.Evented=d.E,v.LngLat=d.N,v.MercatorCoordinate=d.Z,v.Point=d.P,v.addProtocol=d.bi,v.config=d.a,v.removeProtocol=d.bj,v.AttributionControl=yo,v.BoxZoomHandler=Un,v.CanvasSource=Tt,v.CooperativeGesturesHandler=mo,v.DoubleClickZoomHandler=Fs,v.DragPanHandler=Zh,v.DragRotateHandler=Hh,v.EdgeInsets=ho,v.FullscreenControl=class extends d.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=o==null?void 0:o.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){U.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=U.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);U.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},v.GeoJSONSource=Ts,v.GeolocateControl=class extends d.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new d.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const o=new d.N(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,c=this._map.getBearing(),f=d.e({bearing:c},this.options.fitBoundsOptions),w=xe.fromLngLat(o,u);this._map.fitBounds(w,f,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const o=new d.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&ma)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=U.create("button","maplibregl-ctrl-geolocate",this._container),U.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new yl({element:this._dotElement}),this._circleElement=U.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new yl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.k("trackuserlocationend")),this.fire(new d.k("userlocationlostfocus")))})}},this.options=d.e({},Kh,m)}onAdd(m){return this._map=m,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return d._(this,arguments,void 0,function*(e=!1){if($n!==void 0&&!e)return $n;if(window.navigator.permissions===void 0)return $n=!!window.navigator.geolocation,$n;try{$n=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{$n=!!window.navigator.geolocation}return $n})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),U.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,fa=0,ma=!1}_isOutOfMapMaxBounds(m){const e=this._map.getMaxBounds(),o=m.coords;return e&&(o.longitude<e.getWest()||o.longitude>e.getEast()||o.latitude<e.getSouth()||o.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const m=this._map.getBounds(),e=m.getSouthEast(),o=m.getNorthEast(),u=e.distanceTo(o),c=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":fa--,ma=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.k("trackuserlocationstart")),this.fire(new d.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),fa++,fa>1?(m={maximumAge:6e5,timeout:0},ma=!0):(m=this.options.positionOptions,ma=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},v.Hash=al,v.ImageSource=Qn,v.KeyboardHandler=ri,v.LngLatBounds=xe,v.LogoControl=Ju,v.Map=class extends Gh{constructor(m){d.bf.mark(d.bg.create);const e=Object.assign(Object.assign({},mf),m);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new po(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new zt,this._controls=[],this._mapId=d.a4(),this._contextLost=o=>{o.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.k("webglcontextlost",{originalEvent:o}))},this._contextRestored=o=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.k("webglcontextrestored",{originalEvent:o}))},this._onMapScroll=o=>{if(o.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},ec),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ce.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ce(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let o=!1;const u=la(c=>{this._trackResize&&!this._removed&&(this.resize(c),this.redraw())},50);this._resizeObserver=new ResizeObserver(c=>{o?u(c):o=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ku(this,e),this._hash=e.hash&&new al(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,d.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new yo(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Ju,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new d.k(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new d.k(`${o.dataType}dataloading`,o))}),this.on("dataabort",o=>{this.fire(new d.k("sourcedataabort",o))})}_getMapId(){return this._mapId}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new d.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=m.onAdd(this);this._controls.push(m);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new d.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,e,o,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,o,u)}resize(m){var e;const o=this._containerDimensions(),u=o[0],c=o[1],f=this._getClampedPixelRatio(u,c);if(this._resizeCanvas(u,c,f),this.painter.resize(u,c,f),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const E=this._getClampedPixelRatio(u,c);this._resizeCanvas(u,c,E),this.painter.resize(u,c,E)}this.transform.resize(u,c),(e=this._requestedCameraState)===null||e===void 0||e.resize(u,c);const w=!this._moving;return w&&(this.stop(),this.fire(new d.k("movestart",m)).fire(new d.k("move",m))),this.fire(new d.k("resize",m)),w&&this.fire(new d.k("moveend",m)),this}_getClampedPixelRatio(m,e){const{0:o,1:u}=this._maxCanvasSize,c=this.getPixelRatio(),f=m*c,w=e*c;return Math.min(f>o?o/f:1,w>u?u/w:1)*c}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(xe.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(d.N.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.pointLocation(d.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,o){if(m==="mouseenter"||m==="mouseover"){let u=!1;return{layers:e,listener:o,delegates:{mousemove:f=>{const w=e.filter(E=>this.getLayer(E)),S=w.length!==0?this.queryRenderedFeatures(f.point,{layers:w}):[];S.length?u||(u=!0,o.call(this,new nn(m,this,f.originalEvent,{features:S}))):u=!1},mouseout:()=>{u=!1}}}}if(m==="mouseleave"||m==="mouseout"){let u=!1;return{layers:e,listener:o,delegates:{mousemove:w=>{const S=e.filter(E=>this.getLayer(E));(S.length!==0?this.queryRenderedFeatures(w.point,{layers:S}):[]).length?u=!0:u&&(u=!1,o.call(this,new nn(m,this,w.originalEvent)))},mouseout:w=>{u&&(u=!1,o.call(this,new nn(m,this,w.originalEvent)))}}}}{const u=c=>{const f=e.filter(S=>this.getLayer(S)),w=f.length!==0?this.queryRenderedFeatures(c.point,{layers:f}):[];w.length&&(c.features=w,o.call(this,c),delete c.features)};return{layers:e,listener:o,delegates:{[m]:u}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,o){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const u=this._delegatedListeners[m];for(let c=0;c<u.length;c++){const f=u[c];if(f.listener===o&&f.layers.length===e.length&&f.layers.every(w=>e.includes(w))){for(const w in f.delegates)this.off(w,f.delegates[w]);return void u.splice(c,1)}}}on(m,e,o){if(o===void 0)return super.on(m,e);const u=this._createDelegatedListener(m,typeof e=="string"?[e]:e,o);this._saveDelegatedListener(m,u);for(const c in u.delegates)this.on(c,u.delegates[c]);return this}once(m,e,o){if(o===void 0)return super.once(m,e);const u=typeof e=="string"?[e]:e,c=this._createDelegatedListener(m,u,o);for(const f in c.delegates){const w=c.delegates[f];c.delegates[f]=(...S)=>{this._removeDelegatedListener(m,u,o),w(...S)}}this._saveDelegatedListener(m,c);for(const f in c.delegates)this.once(f,c.delegates[f]);return this}off(m,e,o){return o===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,o),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let o;const u=m instanceof d.P||Array.isArray(m),c=u?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:m)||{},c instanceof d.P||typeof c[0]=="number")o=[d.P.convert(c)];else{const f=d.P.convert(c[0]),w=d.P.convert(c[1]);o=[f,new d.P(w.x,f.y),w,new d.P(f.x,w.y),f]}return this.style.queryRenderedFeatures(o,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,e));const o=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new qa(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,o):this.style.loadJSON(m,e,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new qa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){const o=this._requestManager.transformRequest(m,"Style");d.h(o,new AbortController).then(u=>{this._updateDiff(u.data,e)}).catch(u=>{u&&this.fire(new d.j(u))})}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(o){d.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){const e=this.style&&this.style.sourceCaches[m];if(e!==void 0)return e.loaded();this.fire(new d.j(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const e=this.style.sourceCaches[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(const o in this.style._layers){const u=this.style._layers[o];u.type==="hillshade"&&u.source===m.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Qu(this.painter,e,m),this.painter.renderToTexture=new Wh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==m.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new d.k("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const e in m){const o=m[e]._tiles;for(const u in o){const c=o[u];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,e,o={}){const{pixelRatio:u=1,sdf:c=!1,stretchX:f,stretchY:w,content:S,textFitWidth:E,textFitHeight:C}=o;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||d.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:M,data:F}=e,V=e;return this.style.addImage(m,{data:new d.R({width:A,height:M},new Uint8Array(F)),pixelRatio:u,stretchX:f,stretchY:w,content:S,textFitWidth:E,textFitHeight:C,sdf:c,version:0,userImage:V}),V.onAdd&&V.onAdd(this,m),this}}{const{width:A,height:M,data:F}=q.getImageData(e);this.style.addImage(m,{data:new d.R({width:A,height:M},F),pixelRatio:u,stretchX:f,stretchY:w,content:S,textFitWidth:E,textFitHeight:C,sdf:c,version:0})}}updateImage(m,e){const o=this.style.getImage(m);if(!o)return this.fire(new d.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||d.b(e)?q.getImageData(e):e,{width:c,height:f,data:w}=u;if(c===void 0||f===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==o.data.width||f!==o.data.height)return this.fire(new d.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(e instanceof HTMLImageElement||d.b(e));return o.data.replace(w,S),this.style.updateImage(m,o),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new d.j(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return ce.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,o){return this.style.setLayerZoomRange(m,e,o),this._update(!0)}setFilter(m,e,o={}){return this.style.setFilter(m,e,o),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,o,u={}){return this.style.setPaintProperty(m,e,o,u),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,o,u={}){return this.style.setLayoutProperty(m,e,o,u),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,o,u=>{u||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,o=>{o||this._update(!0)}),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m){return this._lazyInitEmptyStyle(),this.style.setSky(m),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const e=this._canvasContainer=U.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=U.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),u=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],u);const c=this._controlContainer=U.create("div","maplibregl-control-container",m),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{f[w]=U.create("div",`maplibregl-ctrl-${w} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,o){this._canvas.width=Math.floor(o*m),this._canvas.height=Math.floor(o*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const m={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{e={requestedAttributes:m},u&&(e.statusMessage=u.statusMessage,e.type=u.type)},{once:!0});const o=this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m);if(!o){const u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new ol(o,this.transform),ke.testSupport(o)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,f=q.now();this.style.zoomHistory.update(c,f);const w=new d.z(c,{now:f,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),S=w.crossFadingFactor();S===1&&S===this._crossFadingFactor||(o=!0,this._crossFadingFactor=S),this.style.update(w)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new d.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.bf.mark(d.bg.load),this.fire(new d.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const u=this._sourcesDirty||this._styleDirty||this._placementDirty;return u||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.k("idle")),!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,d.bf.mark(d.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ce.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),U.remove(this._canvasContainer),U.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),d.bf.clearMetrics(),this._removed=!0,this.fire(new d.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,q.frameAsync(this._frameRequest).then(m=>{d.bf.frame(m),this._frameRequest=null,this._render(m)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Xh}getCameraTargetElevation(){return this.transform.elevation}},v.MapMouseEvent=nn,v.MapTouchEvent=Ds,v.MapWheelEvent=Uh,v.Marker=yl,v.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const e=this._map.getZoom(),o=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,o)=>{const u=this._map._getUIString(`NavigationControl.${o}`);e.title=u,e.setAttribute("aria-label",u)},this.options=d.e({},gf,m),this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),U.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),U.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=U.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new yf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){U.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){const o=U.create("button",m,this._container);return o.type="button",o.addEventListener("click",e),o}},v.Popup=class extends d.E{constructor(m){super(),this.remove=()=>(this._content&&U.remove(this._content),this._container&&(U.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var o;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=U.create("div","maplibregl-popup",this._map.getContainer()),this._tip=U.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const S of this.options.className.split(" "))this._container.classList.add(S);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?ur(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._trackPointer&&!e)return;const u=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let c=this.options.anchor;const f=xl(this.options.offset);if(!c){const S=this._container.offsetWidth,E=this._container.offsetHeight;let C;C=u.y+f.bottom.y<E?["top"]:u.y>this._map.transform.height-E?["bottom"]:[],u.x<S/2?C.push("left"):u.x>this._map.transform.width-S/2&&C.push("right"),c=C.length===0?"bottom":C.join("-")}let w=u.add(f[c]);this.options.subpixelPositioning||(w=w.round()),U.setTransform(this._container,`${xo[c]} translate(${w.x}px,${w.y}px)`),gl(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(dt),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=d.N.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const e=document.createDocumentFragment(),o=document.createElement("body");let u;for(o.innerHTML=m;u=o.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=U.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=U.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(_l);m&&m.focus()}},v.RasterDEMTileSource=gr,v.RasterTileSource=Ft,v.ScaleControl=class{constructor(m){this._onMove=()=>{ga(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,ga(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Oi),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){U.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},v.ScrollZoomHandler=wi,v.Style=qa,v.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=U.create("button","maplibregl-ctrl-terrain",this._container),U.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){U.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},v.TwoFingersTouchPitchHandler=pa,v.TwoFingersTouchRotateHandler=Gu,v.TwoFingersTouchZoomHandler=Zu,v.TwoFingersTouchZoomRotateHandler=Xu,v.VectorTileSource=cs,v.VideoSource=it,v.addSourceType=(m,e)=>d._(void 0,void 0,void 0,function*(){if(ut(m))throw new Error(`A source type called "${m}" already exists.`);((o,u)=>{Ht[o]=u})(m,e)}),v.clearPrewarmedResources=function(){const m=Pr;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(mr),Pr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},v.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},v.getRTLTextPluginStatus=function(){return lr().getRTLTextPluginStatus()},v.getVersion=function(){return rc},v.getWorkerCount=function(){return Cr.workerCount},v.getWorkerUrl=function(){return d.a.WORKER_URL},v.importScriptInWorkers=function(m){return Jn().broadcast("IS",m)},v.prewarm=function(){Wi().acquire(mr)},v.setMaxParallelImageRequests=function(m){d.a.MAX_PARALLEL_IMAGE_REQUESTS=m},v.setRTLTextPlugin=function(m,e){return lr().setRTLTextPlugin(m,e)},v.setWorkerCount=function(m){Cr.workerCount=m},v.setWorkerUrl=function(m){d.a.WORKER_URL=m}});var T=l;return T})})(nw);var GT=nw.exports;const qc=qv(GT);function sw(r,s){return function(){return r.apply(s,arguments)}}const{toString:WT}=Object.prototype,{getPrototypeOf:Ay}=Object,{iterator:jp,toStringTag:ow}=Symbol,Vp=(r=>s=>{const l=WT.call(s);return r[l]||(r[l]=l.slice(8,-1).toLowerCase())})(Object.create(null)),ls=r=>(r=r.toLowerCase(),s=>Vp(s)===r),Up=r=>s=>typeof s===r,{isArray:pu}=Array,uu=Up("undefined");function ph(r){return r!==null&&!uu(r)&&r.constructor!==null&&!uu(r.constructor)&&pi(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const aw=ls("ArrayBuffer");function XT(r){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(r):s=r&&r.buffer&&aw(r.buffer),s}const KT=Up("string"),pi=Up("function"),lw=Up("number"),fh=r=>r!==null&&typeof r=="object",JT=r=>r===!0||r===!1,Kd=r=>{if(Vp(r)!=="object")return!1;const s=Ay(r);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(ow in r)&&!(jp in r)},YT=r=>{if(!fh(r)||ph(r))return!1;try{return Object.keys(r).length===0&&Object.getPrototypeOf(r)===Object.prototype}catch{return!1}},QT=ls("Date"),eE=ls("File"),tE=ls("Blob"),rE=ls("FileList"),nE=r=>fh(r)&&pi(r.pipe),iE=r=>{let s;return r&&(typeof FormData=="function"&&r instanceof FormData||pi(r.append)&&((s=Vp(r))==="formdata"||s==="object"&&pi(r.toString)&&r.toString()==="[object FormData]"))},sE=ls("URLSearchParams"),[oE,aE,lE,uE]=["ReadableStream","Request","Response","Headers"].map(ls),cE=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function mh(r,s,{allOwnKeys:l=!1}={}){if(r===null||typeof r>"u")return;let p,_;if(typeof r!="object"&&(r=[r]),pu(r))for(p=0,_=r.length;p<_;p++)s.call(null,r[p],p,r);else{if(ph(r))return;const T=l?Object.getOwnPropertyNames(r):Object.keys(r),v=T.length;let d;for(p=0;p<v;p++)d=T[p],s.call(null,r[d],d,r)}}function uw(r,s){if(ph(r))return null;s=s.toLowerCase();const l=Object.keys(r);let p=l.length,_;for(;p-- >0;)if(_=l[p],s===_.toLowerCase())return _;return null}const Ma=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,cw=r=>!uu(r)&&r!==Ma;function zg(){const{caseless:r,skipUndefined:s}=cw(this)&&this||{},l={},p=(_,T)=>{if(T==="__proto__"||T==="constructor"||T==="prototype")return;const v=r&&uw(l,T)||T;Kd(l[v])&&Kd(_)?l[v]=zg(l[v],_):Kd(_)?l[v]=zg({},_):pu(_)?l[v]=_.slice():(!s||!uu(_))&&(l[v]=_)};for(let _=0,T=arguments.length;_<T;_++)arguments[_]&&mh(arguments[_],p);return l}const hE=(r,s,l,{allOwnKeys:p}={})=>(mh(s,(_,T)=>{l&&pi(_)?Object.defineProperty(r,T,{value:sw(_,l),writable:!0,enumerable:!0,configurable:!0}):Object.defineProperty(r,T,{value:_,writable:!0,enumerable:!0,configurable:!0})},{allOwnKeys:p}),r),dE=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),pE=(r,s,l,p)=>{r.prototype=Object.create(s.prototype,p),Object.defineProperty(r.prototype,"constructor",{value:r,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(r,"super",{value:s.prototype}),l&&Object.assign(r.prototype,l)},fE=(r,s,l,p)=>{let _,T,v;const d={};if(s=s||{},r==null)return s;do{for(_=Object.getOwnPropertyNames(r),T=_.length;T-- >0;)v=_[T],(!p||p(v,r,s))&&!d[v]&&(s[v]=r[v],d[v]=!0);r=l!==!1&&Ay(r)}while(r&&(!l||l(r,s))&&r!==Object.prototype);return s},mE=(r,s,l)=>{r=String(r),(l===void 0||l>r.length)&&(l=r.length),l-=s.length;const p=r.indexOf(s,l);return p!==-1&&p===l},gE=r=>{if(!r)return null;if(pu(r))return r;let s=r.length;if(!lw(s))return null;const l=new Array(s);for(;s-- >0;)l[s]=r[s];return l},yE=(r=>s=>r&&s instanceof r)(typeof Uint8Array<"u"&&Ay(Uint8Array)),_E=(r,s)=>{const p=(r&&r[jp]).call(r);let _;for(;(_=p.next())&&!_.done;){const T=_.value;s.call(r,T[0],T[1])}},xE=(r,s)=>{let l;const p=[];for(;(l=r.exec(s))!==null;)p.push(l);return p},vE=ls("HTMLFormElement"),wE=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(l,p,_){return p.toUpperCase()+_}),Iv=(({hasOwnProperty:r})=>(s,l)=>r.call(s,l))(Object.prototype),bE=ls("RegExp"),hw=(r,s)=>{const l=Object.getOwnPropertyDescriptors(r),p={};mh(l,(_,T)=>{let v;(v=s(_,T,r))!==!1&&(p[T]=v||_)}),Object.defineProperties(r,p)},SE=r=>{hw(r,(s,l)=>{if(pi(r)&&["arguments","caller","callee"].indexOf(l)!==-1)return!1;const p=r[l];if(pi(p)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+l+"'")})}})},TE=(r,s)=>{const l={},p=_=>{_.forEach(T=>{l[T]=!0})};return pu(r)?p(r):p(String(r).split(s)),l},EE=()=>{},kE=(r,s)=>r!=null&&Number.isFinite(r=+r)?r:s;function IE(r){return!!(r&&pi(r.append)&&r[ow]==="FormData"&&r[jp])}const CE=r=>{const s=new Array(10),l=(p,_)=>{if(fh(p)){if(s.indexOf(p)>=0)return;if(ph(p))return p;if(!("toJSON"in p)){s[_]=p;const T=pu(p)?[]:{};return mh(p,(v,d)=>{const N=l(v,_+1);!uu(N)&&(T[d]=N)}),s[_]=void 0,T}}return p};return l(r,0)},PE=ls("AsyncFunction"),AE=r=>r&&(fh(r)||pi(r))&&pi(r.then)&&pi(r.catch),dw=((r,s)=>r?setImmediate:s?((l,p)=>(Ma.addEventListener("message",({source:_,data:T})=>{_===Ma&&T===l&&p.length&&p.shift()()},!1),_=>{p.push(_),Ma.postMessage(l,"*")}))(`axios@${Math.random()}`,[]):l=>setTimeout(l))(typeof setImmediate=="function",pi(Ma.postMessage)),ME=typeof queueMicrotask<"u"?queueMicrotask.bind(Ma):typeof process<"u"&&process.nextTick||dw,zE=r=>r!=null&&pi(r[jp]),be={isArray:pu,isArrayBuffer:aw,isBuffer:ph,isFormData:iE,isArrayBufferView:XT,isString:KT,isNumber:lw,isBoolean:JT,isObject:fh,isPlainObject:Kd,isEmptyObject:YT,isReadableStream:oE,isRequest:aE,isResponse:lE,isHeaders:uE,isUndefined:uu,isDate:QT,isFile:eE,isBlob:tE,isRegExp:bE,isFunction:pi,isStream:nE,isURLSearchParams:sE,isTypedArray:yE,isFileList:rE,forEach:mh,merge:zg,extend:hE,trim:cE,stripBOM:dE,inherits:pE,toFlatObject:fE,kindOf:Vp,kindOfTest:ls,endsWith:mE,toArray:gE,forEachEntry:_E,matchAll:xE,isHTMLForm:vE,hasOwnProperty:Iv,hasOwnProp:Iv,reduceDescriptors:hw,freezeMethods:SE,toObjectSet:TE,toCamelCase:wE,noop:EE,toFiniteNumber:kE,findKey:uw,global:Ma,isContextDefined:cw,isSpecCompliantForm:IE,toJSONObject:CE,isAsyncFn:PE,isThenable:AE,setImmediate:dw,asap:ME,isIterable:zE};let Et=class pw extends Error{static from(s,l,p,_,T,v){const d=new pw(s.message,l||s.code,p,_,T);return d.cause=s,d.name=s.name,v&&Object.assign(d,v),d}constructor(s,l,p,_,T){super(s),this.name="AxiosError",this.isAxiosError=!0,l&&(this.code=l),p&&(this.config=p),_&&(this.request=_),T&&(this.response=T,this.status=T.status)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:be.toJSONObject(this.config),code:this.code,status:this.status}}};Et.ERR_BAD_OPTION_VALUE="ERR_BAD_OPTION_VALUE";Et.ERR_BAD_OPTION="ERR_BAD_OPTION";Et.ECONNABORTED="ECONNABORTED";Et.ETIMEDOUT="ETIMEDOUT";Et.ERR_NETWORK="ERR_NETWORK";Et.ERR_FR_TOO_MANY_REDIRECTS="ERR_FR_TOO_MANY_REDIRECTS";Et.ERR_DEPRECATED="ERR_DEPRECATED";Et.ERR_BAD_RESPONSE="ERR_BAD_RESPONSE";Et.ERR_BAD_REQUEST="ERR_BAD_REQUEST";Et.ERR_CANCELED="ERR_CANCELED";Et.ERR_NOT_SUPPORT="ERR_NOT_SUPPORT";Et.ERR_INVALID_URL="ERR_INVALID_URL";const RE=null;function Rg(r){return be.isPlainObject(r)||be.isArray(r)}function fw(r){return be.endsWith(r,"[]")?r.slice(0,-2):r}function Cv(r,s,l){return r?r.concat(s).map(function(_,T){return _=fw(_),!l&&T?"["+_+"]":_}).join(l?".":""):s}function DE(r){return be.isArray(r)&&!r.some(Rg)}const LE=be.toFlatObject(be,{},null,function(s){return/^is[A-Z]/.test(s)});function $p(r,s,l){if(!be.isObject(r))throw new TypeError("target must be an object");s=s||new FormData,l=be.toFlatObject(l,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_e,Pe){return!be.isUndefined(Pe[_e])});const p=l.metaTokens,_=l.visitor||te,T=l.dots,v=l.indexes,N=(l.Blob||typeof Blob<"u"&&Blob)&&be.isSpecCompliantForm(s);if(!be.isFunction(_))throw new TypeError("visitor must be a function");function Z(ue){if(ue===null)return"";if(be.isDate(ue))return ue.toISOString();if(be.isBoolean(ue))return ue.toString();if(!N&&be.isBlob(ue))throw new Et("Blob is not supported. Use a Buffer instead.");return be.isArrayBuffer(ue)||be.isTypedArray(ue)?N&&typeof Blob=="function"?new Blob([ue]):Buffer.from(ue):ue}function te(ue,_e,Pe){let oe=ue;if(ue&&!Pe&&typeof ue=="object"){if(be.endsWith(_e,"{}"))_e=p?_e:_e.slice(0,-2),ue=JSON.stringify(ue);else if(be.isArray(ue)&&DE(ue)||(be.isFileList(ue)||be.endsWith(_e,"[]"))&&(oe=be.toArray(ue)))return _e=fw(_e),oe.forEach(function(ce,Ce){!(be.isUndefined(ce)||ce===null)&&s.append(v===!0?Cv([_e],Ce,T):v===null?_e:_e+"[]",Z(ce))}),!1}return Rg(ue)?!0:(s.append(Cv(Pe,_e,T),Z(ue)),!1)}const q=[],U=Object.assign(LE,{defaultVisitor:te,convertValue:Z,isVisitable:Rg});function ke(ue,_e){if(!be.isUndefined(ue)){if(q.indexOf(ue)!==-1)throw Error("Circular reference detected in "+_e.join("."));q.push(ue),be.forEach(ue,function(oe,re){(!(be.isUndefined(oe)||oe===null)&&_.call(s,oe,be.isString(re)?re.trim():re,_e,U))===!0&&ke(oe,_e?_e.concat(re):[re])}),q.pop()}}if(!be.isObject(r))throw new TypeError("data must be an object");return ke(r),s}function Pv(r){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(p){return s[p]})}function My(r,s){this._pairs=[],r&&$p(r,this,s)}const mw=My.prototype;mw.append=function(s,l){this._pairs.push([s,l])};mw.toString=function(s){const l=s?function(p){return s.call(this,p,Pv)}:Pv;return this._pairs.map(function(_){return l(_[0])+"="+l(_[1])},"").join("&")};function FE(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function gw(r,s,l){if(!s)return r;const p=l&&l.encode||FE,_=be.isFunction(l)?{serialize:l}:l,T=_&&_.serialize;let v;if(T?v=T(s,_):v=be.isURLSearchParams(s)?s.toString():new My(s,_).toString(p),v){const d=r.indexOf("#");d!==-1&&(r=r.slice(0,d)),r+=(r.indexOf("?")===-1?"?":"&")+v}return r}class Av{constructor(){this.handlers=[]}use(s,l,p){return this.handlers.push({fulfilled:s,rejected:l,synchronous:p?p.synchronous:!1,runWhen:p?p.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){be.forEach(this.handlers,function(p){p!==null&&s(p)})}}const zy={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1,legacyInterceptorReqResOrdering:!0},OE=typeof URLSearchParams<"u"?URLSearchParams:My,BE=typeof FormData<"u"?FormData:null,NE=typeof Blob<"u"?Blob:null,jE={isBrowser:!0,classes:{URLSearchParams:OE,FormData:BE,Blob:NE},protocols:["http","https","file","blob","url","data"]},Ry=typeof window<"u"&&typeof document<"u",Dg=typeof navigator=="object"&&navigator||void 0,VE=Ry&&(!Dg||["ReactNative","NativeScript","NS"].indexOf(Dg.product)<0),UE=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",$E=Ry&&window.location.href||"http://localhost",qE=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ry,hasStandardBrowserEnv:VE,hasStandardBrowserWebWorkerEnv:UE,navigator:Dg,origin:$E},Symbol.toStringTag,{value:"Module"})),Fn={...qE,...jE};function ZE(r,s){return $p(r,new Fn.classes.URLSearchParams,{visitor:function(l,p,_,T){return Fn.isNode&&be.isBuffer(l)?(this.append(p,l.toString("base64")),!1):T.defaultVisitor.apply(this,arguments)},...s})}function HE(r){return be.matchAll(/\w+|\[(\w*)]/g,r).map(s=>s[0]==="[]"?"":s[1]||s[0])}function GE(r){const s={},l=Object.keys(r);let p;const _=l.length;let T;for(p=0;p<_;p++)T=l[p],s[T]=r[T];return s}function yw(r){function s(l,p,_,T){let v=l[T++];if(v==="__proto__")return!0;const d=Number.isFinite(+v),N=T>=l.length;return v=!v&&be.isArray(_)?_.length:v,N?(be.hasOwnProp(_,v)?_[v]=[_[v],p]:_[v]=p,!d):((!_[v]||!be.isObject(_[v]))&&(_[v]=[]),s(l,p,_[v],T)&&be.isArray(_[v])&&(_[v]=GE(_[v])),!d)}if(be.isFormData(r)&&be.isFunction(r.entries)){const l={};return be.forEachEntry(r,(p,_)=>{s(HE(p),_,l,0)}),l}return null}function WE(r,s,l){if(be.isString(r))try{return(s||JSON.parse)(r),be.trim(r)}catch(p){if(p.name!=="SyntaxError")throw p}return(l||JSON.stringify)(r)}const gh={transitional:zy,adapter:["xhr","http","fetch"],transformRequest:[function(s,l){const p=l.getContentType()||"",_=p.indexOf("application/json")>-1,T=be.isObject(s);if(T&&be.isHTMLForm(s)&&(s=new FormData(s)),be.isFormData(s))return _?JSON.stringify(yw(s)):s;if(be.isArrayBuffer(s)||be.isBuffer(s)||be.isStream(s)||be.isFile(s)||be.isBlob(s)||be.isReadableStream(s))return s;if(be.isArrayBufferView(s))return s.buffer;if(be.isURLSearchParams(s))return l.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let d;if(T){if(p.indexOf("application/x-www-form-urlencoded")>-1)return ZE(s,this.formSerializer).toString();if((d=be.isFileList(s))||p.indexOf("multipart/form-data")>-1){const N=this.env&&this.env.FormData;return $p(d?{"files[]":s}:s,N&&new N,this.formSerializer)}}return T||_?(l.setContentType("application/json",!1),WE(s)):s}],transformResponse:[function(s){const l=this.transitional||gh.transitional,p=l&&l.forcedJSONParsing,_=this.responseType==="json";if(be.isResponse(s)||be.isReadableStream(s))return s;if(s&&be.isString(s)&&(p&&!this.responseType||_)){const v=!(l&&l.silentJSONParsing)&&_;try{return JSON.parse(s,this.parseReviver)}catch(d){if(v)throw d.name==="SyntaxError"?Et.from(d,Et.ERR_BAD_RESPONSE,this,null,this.response):d}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Fn.classes.FormData,Blob:Fn.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};be.forEach(["delete","get","head","post","put","patch"],r=>{gh.headers[r]={}});const XE=be.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),KE=r=>{const s={};let l,p,_;return r&&r.split(`
`).forEach(function(v){_=v.indexOf(":"),l=v.substring(0,_).trim().toLowerCase(),p=v.substring(_+1).trim(),!(!l||s[l]&&XE[l])&&(l==="set-cookie"?s[l]?s[l].push(p):s[l]=[p]:s[l]=s[l]?s[l]+", "+p:p)}),s},Mv=Symbol("internals");function Ac(r){return r&&String(r).trim().toLowerCase()}function Jd(r){return r===!1||r==null?r:be.isArray(r)?r.map(Jd):String(r)}function JE(r){const s=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let p;for(;p=l.exec(r);)s[p[1]]=p[2];return s}const YE=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Rm(r,s,l,p,_){if(be.isFunction(p))return p.call(this,s,l);if(_&&(s=l),!!be.isString(s)){if(be.isString(p))return s.indexOf(p)!==-1;if(be.isRegExp(p))return p.test(s)}}function QE(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,l,p)=>l.toUpperCase()+p)}function ek(r,s){const l=be.toCamelCase(" "+s);["get","set","has"].forEach(p=>{Object.defineProperty(r,p+l,{value:function(_,T,v){return this[p].call(this,s,_,T,v)},configurable:!0})})}let fi=class{constructor(s){s&&this.set(s)}set(s,l,p){const _=this;function T(d,N,Z){const te=Ac(N);if(!te)throw new Error("header name must be a non-empty string");const q=be.findKey(_,te);(!q||_[q]===void 0||Z===!0||Z===void 0&&_[q]!==!1)&&(_[q||N]=Jd(d))}const v=(d,N)=>be.forEach(d,(Z,te)=>T(Z,te,N));if(be.isPlainObject(s)||s instanceof this.constructor)v(s,l);else if(be.isString(s)&&(s=s.trim())&&!YE(s))v(KE(s),l);else if(be.isObject(s)&&be.isIterable(s)){let d={},N,Z;for(const te of s){if(!be.isArray(te))throw TypeError("Object iterator must return a key-value pair");d[Z=te[0]]=(N=d[Z])?be.isArray(N)?[...N,te[1]]:[N,te[1]]:te[1]}v(d,l)}else s!=null&&T(l,s,p);return this}get(s,l){if(s=Ac(s),s){const p=be.findKey(this,s);if(p){const _=this[p];if(!l)return _;if(l===!0)return JE(_);if(be.isFunction(l))return l.call(this,_,p);if(be.isRegExp(l))return l.exec(_);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,l){if(s=Ac(s),s){const p=be.findKey(this,s);return!!(p&&this[p]!==void 0&&(!l||Rm(this,this[p],p,l)))}return!1}delete(s,l){const p=this;let _=!1;function T(v){if(v=Ac(v),v){const d=be.findKey(p,v);d&&(!l||Rm(p,p[d],d,l))&&(delete p[d],_=!0)}}return be.isArray(s)?s.forEach(T):T(s),_}clear(s){const l=Object.keys(this);let p=l.length,_=!1;for(;p--;){const T=l[p];(!s||Rm(this,this[T],T,s,!0))&&(delete this[T],_=!0)}return _}normalize(s){const l=this,p={};return be.forEach(this,(_,T)=>{const v=be.findKey(p,T);if(v){l[v]=Jd(_),delete l[T];return}const d=s?QE(T):String(T).trim();d!==T&&delete l[T],l[d]=Jd(_),p[d]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const l=Object.create(null);return be.forEach(this,(p,_)=>{p!=null&&p!==!1&&(l[_]=s&&be.isArray(p)?p.join(", "):p)}),l}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,l])=>s+": "+l).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...l){const p=new this(s);return l.forEach(_=>p.set(_)),p}static accessor(s){const p=(this[Mv]=this[Mv]={accessors:{}}).accessors,_=this.prototype;function T(v){const d=Ac(v);p[d]||(ek(_,v),p[d]=!0)}return be.isArray(s)?s.forEach(T):T(s),this}};fi.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);be.reduceDescriptors(fi.prototype,({value:r},s)=>{let l=s[0].toUpperCase()+s.slice(1);return{get:()=>r,set(p){this[l]=p}}});be.freezeMethods(fi);function Dm(r,s){const l=this||gh,p=s||l,_=fi.from(p.headers);let T=p.data;return be.forEach(r,function(d){T=d.call(l,T,_.normalize(),s?s.status:void 0)}),_.normalize(),T}function _w(r){return!!(r&&r.__CANCEL__)}let yh=class extends Et{constructor(s,l,p){super(s??"canceled",Et.ERR_CANCELED,l,p),this.name="CanceledError",this.__CANCEL__=!0}};function xw(r,s,l){const p=l.config.validateStatus;!l.status||!p||p(l.status)?r(l):s(new Et("Request failed with status code "+l.status,[Et.ERR_BAD_REQUEST,Et.ERR_BAD_RESPONSE][Math.floor(l.status/100)-4],l.config,l.request,l))}function tk(r){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return s&&s[1]||""}function rk(r,s){r=r||10;const l=new Array(r),p=new Array(r);let _=0,T=0,v;return s=s!==void 0?s:1e3,function(N){const Z=Date.now(),te=p[T];v||(v=Z),l[_]=N,p[_]=Z;let q=T,U=0;for(;q!==_;)U+=l[q++],q=q%r;if(_=(_+1)%r,_===T&&(T=(T+1)%r),Z-v<s)return;const ke=te&&Z-te;return ke?Math.round(U*1e3/ke):void 0}}function nk(r,s){let l=0,p=1e3/s,_,T;const v=(Z,te=Date.now())=>{l=te,_=null,T&&(clearTimeout(T),T=null),r(...Z)};return[(...Z)=>{const te=Date.now(),q=te-l;q>=p?v(Z,te):(_=Z,T||(T=setTimeout(()=>{T=null,v(_)},p-q)))},()=>_&&v(_)]}const Sp=(r,s,l=3)=>{let p=0;const _=rk(50,250);return nk(T=>{const v=T.loaded,d=T.lengthComputable?T.total:void 0,N=v-p,Z=_(N),te=v<=d;p=v;const q={loaded:v,total:d,progress:d?v/d:void 0,bytes:N,rate:Z||void 0,estimated:Z&&d&&te?(d-v)/Z:void 0,event:T,lengthComputable:d!=null,[s?"download":"upload"]:!0};r(q)},l)},zv=(r,s)=>{const l=r!=null;return[p=>s[0]({lengthComputable:l,total:r,loaded:p}),s[1]]},Rv=r=>(...s)=>be.asap(()=>r(...s)),ik=Fn.hasStandardBrowserEnv?((r,s)=>l=>(l=new URL(l,Fn.origin),r.protocol===l.protocol&&r.host===l.host&&(s||r.port===l.port)))(new URL(Fn.origin),Fn.navigator&&/(msie|trident)/i.test(Fn.navigator.userAgent)):()=>!0,sk=Fn.hasStandardBrowserEnv?{write(r,s,l,p,_,T,v){if(typeof document>"u")return;const d=[`${r}=${encodeURIComponent(s)}`];be.isNumber(l)&&d.push(`expires=${new Date(l).toUTCString()}`),be.isString(p)&&d.push(`path=${p}`),be.isString(_)&&d.push(`domain=${_}`),T===!0&&d.push("secure"),be.isString(v)&&d.push(`SameSite=${v}`),document.cookie=d.join("; ")},read(r){if(typeof document>"u")return null;const s=document.cookie.match(new RegExp("(?:^|; )"+r+"=([^;]*)"));return s?decodeURIComponent(s[1]):null},remove(r){this.write(r,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function ok(r){return typeof r!="string"?!1:/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function ak(r,s){return s?r.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):r}function vw(r,s,l){let p=!ok(s);return r&&(p||l==!1)?ak(r,s):s}const Dv=r=>r instanceof fi?{...r}:r;function ja(r,s){s=s||{};const l={};function p(Z,te,q,U){return be.isPlainObject(Z)&&be.isPlainObject(te)?be.merge.call({caseless:U},Z,te):be.isPlainObject(te)?be.merge({},te):be.isArray(te)?te.slice():te}function _(Z,te,q,U){if(be.isUndefined(te)){if(!be.isUndefined(Z))return p(void 0,Z,q,U)}else return p(Z,te,q,U)}function T(Z,te){if(!be.isUndefined(te))return p(void 0,te)}function v(Z,te){if(be.isUndefined(te)){if(!be.isUndefined(Z))return p(void 0,Z)}else return p(void 0,te)}function d(Z,te,q){if(q in s)return p(Z,te);if(q in r)return p(void 0,Z)}const N={url:T,method:T,data:T,baseURL:v,transformRequest:v,transformResponse:v,paramsSerializer:v,timeout:v,timeoutMessage:v,withCredentials:v,withXSRFToken:v,adapter:v,responseType:v,xsrfCookieName:v,xsrfHeaderName:v,onUploadProgress:v,onDownloadProgress:v,decompress:v,maxContentLength:v,maxBodyLength:v,beforeRedirect:v,transport:v,httpAgent:v,httpsAgent:v,cancelToken:v,socketPath:v,responseEncoding:v,validateStatus:d,headers:(Z,te,q)=>_(Dv(Z),Dv(te),q,!0)};return be.forEach(Object.keys({...r,...s}),function(te){if(te==="__proto__"||te==="constructor"||te==="prototype")return;const q=be.hasOwnProp(N,te)?N[te]:_,U=q(r[te],s[te],te);be.isUndefined(U)&&q!==d||(l[te]=U)}),l}const ww=r=>{const s=ja({},r);let{data:l,withXSRFToken:p,xsrfHeaderName:_,xsrfCookieName:T,headers:v,auth:d}=s;if(s.headers=v=fi.from(v),s.url=gw(vw(s.baseURL,s.url,s.allowAbsoluteUrls),r.params,r.paramsSerializer),d&&v.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),be.isFormData(l)){if(Fn.hasStandardBrowserEnv||Fn.hasStandardBrowserWebWorkerEnv)v.setContentType(void 0);else if(be.isFunction(l.getHeaders)){const N=l.getHeaders(),Z=["content-type","content-length"];Object.entries(N).forEach(([te,q])=>{Z.includes(te.toLowerCase())&&v.set(te,q)})}}if(Fn.hasStandardBrowserEnv&&(p&&be.isFunction(p)&&(p=p(s)),p||p!==!1&&ik(s.url))){const N=_&&T&&sk.read(T);N&&v.set(_,N)}return s},lk=typeof XMLHttpRequest<"u",uk=lk&&function(r){return new Promise(function(l,p){const _=ww(r);let T=_.data;const v=fi.from(_.headers).normalize();let{responseType:d,onUploadProgress:N,onDownloadProgress:Z}=_,te,q,U,ke,ue;function _e(){ke&&ke(),ue&&ue(),_.cancelToken&&_.cancelToken.unsubscribe(te),_.signal&&_.signal.removeEventListener("abort",te)}let Pe=new XMLHttpRequest;Pe.open(_.method.toUpperCase(),_.url,!0),Pe.timeout=_.timeout;function oe(){if(!Pe)return;const ce=fi.from("getAllResponseHeaders"in Pe&&Pe.getAllResponseHeaders()),De={data:!d||d==="text"||d==="json"?Pe.responseText:Pe.response,status:Pe.status,statusText:Pe.statusText,headers:ce,config:r,request:Pe};xw(function(Oe){l(Oe),_e()},function(Oe){p(Oe),_e()},De),Pe=null}"onloadend"in Pe?Pe.onloadend=oe:Pe.onreadystatechange=function(){!Pe||Pe.readyState!==4||Pe.status===0&&!(Pe.responseURL&&Pe.responseURL.indexOf("file:")===0)||setTimeout(oe)},Pe.onabort=function(){Pe&&(p(new Et("Request aborted",Et.ECONNABORTED,r,Pe)),Pe=null)},Pe.onerror=function(Ce){const De=Ce&&Ce.message?Ce.message:"Network Error",Ue=new Et(De,Et.ERR_NETWORK,r,Pe);Ue.event=Ce||null,p(Ue),Pe=null},Pe.ontimeout=function(){let Ce=_.timeout?"timeout of "+_.timeout+"ms exceeded":"timeout exceeded";const De=_.transitional||zy;_.timeoutErrorMessage&&(Ce=_.timeoutErrorMessage),p(new Et(Ce,De.clarifyTimeoutError?Et.ETIMEDOUT:Et.ECONNABORTED,r,Pe)),Pe=null},T===void 0&&v.setContentType(null),"setRequestHeader"in Pe&&be.forEach(v.toJSON(),function(Ce,De){Pe.setRequestHeader(De,Ce)}),be.isUndefined(_.withCredentials)||(Pe.withCredentials=!!_.withCredentials),d&&d!=="json"&&(Pe.responseType=_.responseType),Z&&([U,ue]=Sp(Z,!0),Pe.addEventListener("progress",U)),N&&Pe.upload&&([q,ke]=Sp(N),Pe.upload.addEventListener("progress",q),Pe.upload.addEventListener("loadend",ke)),(_.cancelToken||_.signal)&&(te=ce=>{Pe&&(p(!ce||ce.type?new yh(null,r,Pe):ce),Pe.abort(),Pe=null)},_.cancelToken&&_.cancelToken.subscribe(te),_.signal&&(_.signal.aborted?te():_.signal.addEventListener("abort",te)));const re=tk(_.url);if(re&&Fn.protocols.indexOf(re)===-1){p(new Et("Unsupported protocol "+re+":",Et.ERR_BAD_REQUEST,r));return}Pe.send(T||null)})},ck=(r,s)=>{const{length:l}=r=r?r.filter(Boolean):[];if(s||l){let p=new AbortController,_;const T=function(Z){if(!_){_=!0,d();const te=Z instanceof Error?Z:this.reason;p.abort(te instanceof Et?te:new yh(te instanceof Error?te.message:te))}};let v=s&&setTimeout(()=>{v=null,T(new Et(`timeout of ${s}ms exceeded`,Et.ETIMEDOUT))},s);const d=()=>{r&&(v&&clearTimeout(v),v=null,r.forEach(Z=>{Z.unsubscribe?Z.unsubscribe(T):Z.removeEventListener("abort",T)}),r=null)};r.forEach(Z=>Z.addEventListener("abort",T));const{signal:N}=p;return N.unsubscribe=()=>be.asap(d),N}},hk=function*(r,s){let l=r.byteLength;if(l<s){yield r;return}let p=0,_;for(;p<l;)_=p+s,yield r.slice(p,_),p=_},dk=async function*(r,s){for await(const l of pk(r))yield*hk(l,s)},pk=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const s=r.getReader();try{for(;;){const{done:l,value:p}=await s.read();if(l)break;yield p}}finally{await s.cancel()}},Lv=(r,s,l,p)=>{const _=dk(r,s);let T=0,v,d=N=>{v||(v=!0,p&&p(N))};return new ReadableStream({async pull(N){try{const{done:Z,value:te}=await _.next();if(Z){d(),N.close();return}let q=te.byteLength;if(l){let U=T+=q;l(U)}N.enqueue(new Uint8Array(te))}catch(Z){throw d(Z),Z}},cancel(N){return d(N),_.return()}},{highWaterMark:2})},Fv=64*1024,{isFunction:Od}=be,fk=(({Request:r,Response:s})=>({Request:r,Response:s}))(be.global),{ReadableStream:Ov,TextEncoder:Bv}=be.global,Nv=(r,...s)=>{try{return!!r(...s)}catch{return!1}},mk=r=>{r=be.merge.call({skipUndefined:!0},fk,r);const{fetch:s,Request:l,Response:p}=r,_=s?Od(s):typeof fetch=="function",T=Od(l),v=Od(p);if(!_)return!1;const d=_&&Od(Ov),N=_&&(typeof Bv=="function"?(ue=>_e=>ue.encode(_e))(new Bv):async ue=>new Uint8Array(await new l(ue).arrayBuffer())),Z=T&&d&&Nv(()=>{let ue=!1;const _e=new l(Fn.origin,{body:new Ov,method:"POST",get duplex(){return ue=!0,"half"}}).headers.has("Content-Type");return ue&&!_e}),te=v&&d&&Nv(()=>be.isReadableStream(new p("").body)),q={stream:te&&(ue=>ue.body)};_&&["text","arrayBuffer","blob","formData","stream"].forEach(ue=>{!q[ue]&&(q[ue]=(_e,Pe)=>{let oe=_e&&_e[ue];if(oe)return oe.call(_e);throw new Et(`Response type '${ue}' is not supported`,Et.ERR_NOT_SUPPORT,Pe)})});const U=async ue=>{if(ue==null)return 0;if(be.isBlob(ue))return ue.size;if(be.isSpecCompliantForm(ue))return(await new l(Fn.origin,{method:"POST",body:ue}).arrayBuffer()).byteLength;if(be.isArrayBufferView(ue)||be.isArrayBuffer(ue))return ue.byteLength;if(be.isURLSearchParams(ue)&&(ue=ue+""),be.isString(ue))return(await N(ue)).byteLength},ke=async(ue,_e)=>{const Pe=be.toFiniteNumber(ue.getContentLength());return Pe??U(_e)};return async ue=>{let{url:_e,method:Pe,data:oe,signal:re,cancelToken:ce,timeout:Ce,onDownloadProgress:De,onUploadProgress:Ue,responseType:Oe,headers:Qe,withCredentials:_t="same-origin",fetchOptions:mt}=ww(ue),pt=s||fetch;Oe=Oe?(Oe+"").toLowerCase():"text";let Xt=ck([re,ce&&ce.toAbortSignal()],Ce),Dt=null;const Lt=Xt&&Xt.unsubscribe&&(()=>{Xt.unsubscribe()});let fr;try{if(Ue&&Z&&Pe!=="get"&&Pe!=="head"&&(fr=await ke(Qe,oe))!==0){let wt=new l(_e,{method:"POST",body:oe,duplex:"half"}),Pt;if(be.isFormData(oe)&&(Pt=wt.headers.get("content-type"))&&Qe.setContentType(Pt),wt.body){const[ar,mr]=zv(fr,Sp(Rv(Ue)));oe=Lv(wt.body,Fv,ar,mr)}}be.isString(_t)||(_t=_t?"include":"omit");const nr=T&&"credentials"in l.prototype,Or={...mt,signal:Xt,method:Pe.toUpperCase(),headers:Qe.normalize().toJSON(),body:oe,duplex:"half",credentials:nr?_t:void 0};Dt=T&&new l(_e,Or);let Ze=await(T?pt(Dt,mt):pt(_e,Or));const ft=te&&(Oe==="stream"||Oe==="response");if(te&&(De||ft&&Lt)){const wt={};["status","statusText","headers"].forEach(Cr=>{wt[Cr]=Ze[Cr]});const Pt=be.toFiniteNumber(Ze.headers.get("content-length")),[ar,mr]=De&&zv(Pt,Sp(Rv(De),!0))||[];Ze=new p(Lv(Ze.body,Fv,ar,()=>{mr&&mr(),Lt&&Lt()}),wt)}Oe=Oe||"text";let gt=await q[be.findKey(q,Oe)||"text"](Ze,ue);return!ft&&Lt&&Lt(),await new Promise((wt,Pt)=>{xw(wt,Pt,{data:gt,headers:fi.from(Ze.headers),status:Ze.status,statusText:Ze.statusText,config:ue,request:Dt})})}catch(nr){throw Lt&&Lt(),nr&&nr.name==="TypeError"&&/Load failed|fetch/i.test(nr.message)?Object.assign(new Et("Network Error",Et.ERR_NETWORK,ue,Dt,nr&&nr.response),{cause:nr.cause||nr}):Et.from(nr,nr&&nr.code,ue,Dt,nr&&nr.response)}}},gk=new Map,bw=r=>{let s=r&&r.env||{};const{fetch:l,Request:p,Response:_}=s,T=[p,_,l];let v=T.length,d=v,N,Z,te=gk;for(;d--;)N=T[d],Z=te.get(N),Z===void 0&&te.set(N,Z=d?new Map:mk(s)),te=Z;return Z};bw();const Dy={http:RE,xhr:uk,fetch:{get:bw}};be.forEach(Dy,(r,s)=>{if(r){try{Object.defineProperty(r,"name",{value:s})}catch{}Object.defineProperty(r,"adapterName",{value:s})}});const jv=r=>`- ${r}`,yk=r=>be.isFunction(r)||r===null||r===!1;function _k(r,s){r=be.isArray(r)?r:[r];const{length:l}=r;let p,_;const T={};for(let v=0;v<l;v++){p=r[v];let d;if(_=p,!yk(p)&&(_=Dy[(d=String(p)).toLowerCase()],_===void 0))throw new Et(`Unknown adapter '${d}'`);if(_&&(be.isFunction(_)||(_=_.get(s))))break;T[d||"#"+v]=_}if(!_){const v=Object.entries(T).map(([N,Z])=>`adapter ${N} `+(Z===!1?"is not supported by the environment":"is not available in the build"));let d=l?v.length>1?`since :
`+v.map(jv).join(`
`):" "+jv(v[0]):"as no adapter specified";throw new Et("There is no suitable adapter to dispatch the request "+d,"ERR_NOT_SUPPORT")}return _}const Sw={getAdapter:_k,adapters:Dy};function Lm(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new yh(null,r)}function Vv(r){return Lm(r),r.headers=fi.from(r.headers),r.data=Dm.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),Sw.getAdapter(r.adapter||gh.adapter,r)(r).then(function(p){return Lm(r),p.data=Dm.call(r,r.transformResponse,p),p.headers=fi.from(p.headers),p},function(p){return _w(p)||(Lm(r),p&&p.response&&(p.response.data=Dm.call(r,r.transformResponse,p.response),p.response.headers=fi.from(p.response.headers))),Promise.reject(p)})}const Tw="1.13.5",qp={};["object","boolean","number","function","string","symbol"].forEach((r,s)=>{qp[r]=function(p){return typeof p===r||"a"+(s<1?"n ":" ")+r}});const Uv={};qp.transitional=function(s,l,p){function _(T,v){return"[Axios v"+Tw+"] Transitional option '"+T+"'"+v+(p?". "+p:"")}return(T,v,d)=>{if(s===!1)throw new Et(_(v," has been removed"+(l?" in "+l:"")),Et.ERR_DEPRECATED);return l&&!Uv[v]&&(Uv[v]=!0,console.warn(_(v," has been deprecated since v"+l+" and will be removed in the near future"))),s?s(T,v,d):!0}};qp.spelling=function(s){return(l,p)=>(console.warn(`${p} is likely a misspelling of ${s}`),!0)};function xk(r,s,l){if(typeof r!="object")throw new Et("options must be an object",Et.ERR_BAD_OPTION_VALUE);const p=Object.keys(r);let _=p.length;for(;_-- >0;){const T=p[_],v=s[T];if(v){const d=r[T],N=d===void 0||v(d,T,r);if(N!==!0)throw new Et("option "+T+" must be "+N,Et.ERR_BAD_OPTION_VALUE);continue}if(l!==!0)throw new Et("Unknown option "+T,Et.ERR_BAD_OPTION)}}const Yd={assertOptions:xk,validators:qp},Vi=Yd.validators;let Da=class{constructor(s){this.defaults=s||{},this.interceptors={request:new Av,response:new Av}}async request(s,l){try{return await this._request(s,l)}catch(p){if(p instanceof Error){let _={};Error.captureStackTrace?Error.captureStackTrace(_):_=new Error;const T=_.stack?_.stack.replace(/^.+\n/,""):"";try{p.stack?T&&!String(p.stack).endsWith(T.replace(/^.+\n.+\n/,""))&&(p.stack+=`
`+T):p.stack=T}catch{}}throw p}}_request(s,l){typeof s=="string"?(l=l||{},l.url=s):l=s||{},l=ja(this.defaults,l);const{transitional:p,paramsSerializer:_,headers:T}=l;p!==void 0&&Yd.assertOptions(p,{silentJSONParsing:Vi.transitional(Vi.boolean),forcedJSONParsing:Vi.transitional(Vi.boolean),clarifyTimeoutError:Vi.transitional(Vi.boolean),legacyInterceptorReqResOrdering:Vi.transitional(Vi.boolean)},!1),_!=null&&(be.isFunction(_)?l.paramsSerializer={serialize:_}:Yd.assertOptions(_,{encode:Vi.function,serialize:Vi.function},!0)),l.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?l.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:l.allowAbsoluteUrls=!0),Yd.assertOptions(l,{baseUrl:Vi.spelling("baseURL"),withXsrfToken:Vi.spelling("withXSRFToken")},!0),l.method=(l.method||this.defaults.method||"get").toLowerCase();let v=T&&be.merge(T.common,T[l.method]);T&&be.forEach(["delete","get","head","post","put","patch","common"],ue=>{delete T[ue]}),l.headers=fi.concat(v,T);const d=[];let N=!0;this.interceptors.request.forEach(function(_e){if(typeof _e.runWhen=="function"&&_e.runWhen(l)===!1)return;N=N&&_e.synchronous;const Pe=l.transitional||zy;Pe&&Pe.legacyInterceptorReqResOrdering?d.unshift(_e.fulfilled,_e.rejected):d.push(_e.fulfilled,_e.rejected)});const Z=[];this.interceptors.response.forEach(function(_e){Z.push(_e.fulfilled,_e.rejected)});let te,q=0,U;if(!N){const ue=[Vv.bind(this),void 0];for(ue.unshift(...d),ue.push(...Z),U=ue.length,te=Promise.resolve(l);q<U;)te=te.then(ue[q++],ue[q++]);return te}U=d.length;let ke=l;for(;q<U;){const ue=d[q++],_e=d[q++];try{ke=ue(ke)}catch(Pe){_e.call(this,Pe);break}}try{te=Vv.call(this,ke)}catch(ue){return Promise.reject(ue)}for(q=0,U=Z.length;q<U;)te=te.then(Z[q++],Z[q++]);return te}getUri(s){s=ja(this.defaults,s);const l=vw(s.baseURL,s.url,s.allowAbsoluteUrls);return gw(l,s.params,s.paramsSerializer)}};be.forEach(["delete","get","head","options"],function(s){Da.prototype[s]=function(l,p){return this.request(ja(p||{},{method:s,url:l,data:(p||{}).data}))}});be.forEach(["post","put","patch"],function(s){function l(p){return function(T,v,d){return this.request(ja(d||{},{method:s,headers:p?{"Content-Type":"multipart/form-data"}:{},url:T,data:v}))}}Da.prototype[s]=l(),Da.prototype[s+"Form"]=l(!0)});let vk=class Ew{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let l;this.promise=new Promise(function(T){l=T});const p=this;this.promise.then(_=>{if(!p._listeners)return;let T=p._listeners.length;for(;T-- >0;)p._listeners[T](_);p._listeners=null}),this.promise.then=_=>{let T;const v=new Promise(d=>{p.subscribe(d),T=d}).then(_);return v.cancel=function(){p.unsubscribe(T)},v},s(function(T,v,d){p.reason||(p.reason=new yh(T,v,d),l(p.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const l=this._listeners.indexOf(s);l!==-1&&this._listeners.splice(l,1)}toAbortSignal(){const s=new AbortController,l=p=>{s.abort(p)};return this.subscribe(l),s.signal.unsubscribe=()=>this.unsubscribe(l),s.signal}static source(){let s;return{token:new Ew(function(_){s=_}),cancel:s}}};function wk(r){return function(l){return r.apply(null,l)}}function bk(r){return be.isObject(r)&&r.isAxiosError===!0}const Lg={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Lg).forEach(([r,s])=>{Lg[s]=r});function kw(r){const s=new Da(r),l=sw(Da.prototype.request,s);return be.extend(l,Da.prototype,s,{allOwnKeys:!0}),be.extend(l,s,null,{allOwnKeys:!0}),l.create=function(_){return kw(ja(r,_))},l}const Fr=kw(gh);Fr.Axios=Da;Fr.CanceledError=yh;Fr.CancelToken=vk;Fr.isCancel=_w;Fr.VERSION=Tw;Fr.toFormData=$p;Fr.AxiosError=Et;Fr.Cancel=Fr.CanceledError;Fr.all=function(s){return Promise.all(s)};Fr.spread=wk;Fr.isAxiosError=bk;Fr.mergeConfig=ja;Fr.AxiosHeaders=fi;Fr.formToJSON=r=>yw(be.isHTMLForm(r)?new FormData(r):r);Fr.getAdapter=Sw.getAdapter;Fr.HttpStatusCode=Lg;Fr.default=Fr;const{Axios:jk,AxiosError:Vk,CanceledError:Uk,isCancel:$k,CancelToken:qk,VERSION:Zk,all:Hk,Cancel:Gk,isAxiosError:Wk,spread:Xk,toFormData:Kk,AxiosHeaders:Jk,HttpStatusCode:Yk,formToJSON:Qk,getAdapter:eI,mergeConfig:tI}=Fr;function Sk({data:r,visible:s}){const l=We.useRef(null),p=We.useRef(null),_=We.useRef(null),[T,v]=We.useState(!1),[d,N]=We.useState(!1),[Z,te]=We.useState(0),[q,U]=We.useState(0);return We.useEffect(()=>{if(!(!s||!l.current||p.current))return p.current=new qc.Map({container:l.current,style:"https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json",center:[-79.4,43.85],zoom:11,pitch:0,interactive:!1,attributionControl:!1}),p.current.on("load",()=>{var ke,ue,_e,Pe,oe,re;(ke=p.current)==null||ke.addSource("race-dijkstra",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}}}),(ue=p.current)==null||ue.addLayer({id:"race-dijkstra-line",type:"line",source:"race-dijkstra",paint:{"line-color":"#00f0ff","line-width":3.5,"line-opacity":.95}}),(_e=p.current)==null||_e.addSource("race-bmsssp",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}}}),(Pe=p.current)==null||Pe.addLayer({id:"race-bmsssp-line",type:"line",source:"race-bmsssp",paint:{"line-color":"#ff00ff","line-width":3.5,"line-opacity":.95}}),(oe=p.current)==null||oe.addSource("race-closures",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),(re=p.current)==null||re.addLayer({id:"race-closures-circle",type:"circle",source:"race-closures",paint:{"circle-radius":6,"circle-color":"#ff4444","circle-stroke-color":"#ffffff","circle-stroke-width":2,"circle-opacity":.9}})}),()=>{var ke;(ke=p.current)==null||ke.remove(),p.current=null}},[s]),We.useEffect(()=>{var Qe;if(!r||!p.current||!p.current.loaded())return;v(!1),N(!1),te(r.dijkstraExecMs),U(r.bmssspExecMs);const ke=[...r.dijkstraCoords,...r.bmssspCoords];if(ke.length>0){const _t=ke.map(Xt=>Xt[0]),mt=ke.map(Xt=>Xt[1]),pt=new qc.LngLatBounds([Math.min(..._t)-.005,Math.min(...mt)-.005],[Math.max(..._t)+.005,Math.max(...mt)+.005]);p.current.fitBounds(pt,{padding:20,duration:0})}const ue=r.closurePoints.map(([_t,mt])=>({type:"Feature",properties:{},geometry:{type:"Point",coordinates:[_t,mt]}})),_e=(Qe=p.current)==null?void 0:Qe.getSource("race-closures");_e&&_e.setData({type:"FeatureCollection",features:ue});const Pe=3e3,oe=Math.max(r.dijkstraExecMs,r.bmssspExecMs,1),re=r.dijkstraExecMs/oe*Pe,ce=r.bmssspExecMs/oe*Pe,Ce=performance.now();let De=!1,Ue=!1;const Oe=()=>{var mt,pt;const _t=performance.now()-Ce;if(!De){const Xt=Math.min(1,_t/re),Dt=Math.floor(Xt*r.dijkstraCoords.length),Lt=r.dijkstraCoords.slice(0,Math.max(2,Dt)),fr=(mt=p.current)==null?void 0:mt.getSource("race-dijkstra");fr&&Lt.length>=2&&fr.setData({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:Lt}}),Xt>=1&&(De=!0,v(!0))}if(!Ue){const Xt=Math.min(1,_t/ce),Dt=Math.floor(Xt*r.bmssspCoords.length),Lt=r.bmssspCoords.slice(0,Math.max(2,Dt)),fr=(pt=p.current)==null?void 0:pt.getSource("race-bmsssp");fr&&Lt.length>=2&&fr.setData({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:Lt}}),Xt>=1&&(Ue=!0,N(!0))}(!De||!Ue)&&(_.current=requestAnimationFrame(Oe))};return _.current=requestAnimationFrame(Oe),()=>{_.current!=null&&(cancelAnimationFrame(_.current),_.current=null)}},[r]),s?he.jsxs("div",{className:"absolute bottom-20 right-4 z-[60] w-[300px] h-[220px] rounded-xl overflow-hidden border border-white/20 shadow-[0_0_40px_rgba(0,0,0,0.6)] bg-black/40 backdrop-blur-xl",children:[he.jsx("div",{className:"absolute top-0 left-0 right-0 z-10 px-3 py-1.5 bg-gradient-to-b from-black/90 to-transparent",children:he.jsxs("div",{className:"flex items-center justify-between",children:[he.jsx("span",{className:"text-[9px] font-mono font-bold text-white/80 tracking-widest uppercase",children:" Algorithm Race"}),he.jsx("span",{className:"text-[8px] font-mono text-gray-400",children:"LIVE"})]})}),he.jsx("div",{ref:l,className:"w-full h-full"}),he.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-10 px-3 py-2 bg-gradient-to-t from-black/95 via-black/80 to-transparent",children:he.jsxs("div",{className:"flex justify-between items-end gap-2",children:[he.jsxs("div",{className:"flex items-center gap-1.5",children:[he.jsx("div",{className:`w-2 h-2 rounded-full ${T?"bg-[#00f0ff] shadow-[0_0_8px_#00f0ff]":"bg-[#00f0ff]/40 animate-pulse"}`}),he.jsxs("div",{children:[he.jsx("div",{className:"text-[8px] font-mono font-bold text-[#00f0ff] tracking-wider",children:"DIJKSTRA"}),he.jsx("div",{className:"text-[9px] font-mono text-white/70",children:T?`${Z.toFixed(0)}ms `:"Computing..."})]})]}),he.jsx("div",{className:"flex flex-col items-center",children:he.jsx("div",{className:"text-[8px] font-mono text-red-400 animate-pulse",children:" CLOSURE"})}),he.jsxs("div",{className:"flex items-center gap-1.5",children:[he.jsx("div",{className:`w-2 h-2 rounded-full ${d?"bg-[#ff00ff] shadow-[0_0_8px_#ff00ff]":"bg-[#ff00ff]/40 animate-pulse"}`}),he.jsxs("div",{children:[he.jsx("div",{className:"text-[8px] font-mono font-bold text-[#ff00ff] tracking-wider",children:"DUAN-MAO"}),he.jsx("div",{className:"text-[9px] font-mono text-white/70",children:d?`${q.toFixed(0)}ms `:"Computing..."})]})]})]})})]}):null}const Fm={},Ea=Fr.create({baseURL:(Fm==null?void 0:Fm.VITE_API_BASE)||""});function Tk(r,s){const l=s[0]-r[0],p=s[1]-r[1];return(Math.atan2(l,p)*180/Math.PI+360)%360}function Ek(r,s,l){return Math.max(s,Math.min(l,r))}function Om(r){const s=Math.max(0,Math.floor(r)),l=Math.floor(s/60),p=s%60;return`${l}:${p.toString().padStart(2,"0")}`}function kk(r,s){let l=1;for(;l<r.length&&r[l]<s;)l++;return l}function Bm(r,s,l,p){const _=Math.max(0,r.totalDist-s),T=Math.max(0,r.totalTime-l);let v="--",d="Proceed",N=0;const Z=r.steps||[];if(Z.length){const te=Z.find(U=>s>=U.start_distance_m&&s<U.end_distance_m)||Z[0];v=(te==null?void 0:te.street)||"--";const q=Z.find(U=>U.maneuver!=="depart"&&U.start_distance_m>s)||(_<15?void 0:te);q?(d=q.instruction,N=Math.max(0,q.start_distance_m-s)):(d="Arrive at destination",N=0)}return{distance_to_next_m:N,next_instruction:d,current_street:v,eta_remaining_s:T,remaining_distance_m:_,algorithm:r.algorithm,total_distance_m:r.totalDist,total_time_s:r.totalTime,sim_speedup:p}}const Ik={CARDIAC_ARREST:{title:"CARDIAC ARREST // UNIT 992",isRedAlert:!0,start:{lat:43.858,lng:-79.54},end:{lat:43.871,lng:-79.444},aiPrompt:"URGENT: 65yo Male, Cardiac Arrest at Major Mackenzie and Jane. CPR in progress. Route to Mackenzie Health immediately via optimized Duan-Mao pivots.",vitals:{hr:0,bp:"0/0",o2:45},roadClosures:[[43.862,-79.5],[43.865,-79.48]]},MVA_TRAUMA:{title:"MVA TRAUMA // HWY 404",isRedAlert:!0,start:{lat:43.86,lng:-79.37},end:{lat:43.722,lng:-79.376},aiPrompt:"CRITICAL: Multi-vehicle accident on Hwy 404. Multiple trauma patients. Route to Sunnybrook Trauma Centre. Avoid 404 congestion using side-street pivots.",vitals:{hr:115,bp:"90/60",o2:92},roadClosures:[[43.82,-79.38],[43.79,-79.38]]},ROUTINE_PATROL:{title:"ROUTINE PATROL // ZONE B",isRedAlert:!1,start:{lat:43.864,lng:-79.4},end:{lat:43.88,lng:-79.4},aiPrompt:"Unit 992, proceed with routine patrol of Richmond Hill Zone B. Maintain low-latency uplink with mission control.",vitals:{hr:72,bp:"120/80",o2:98}}};function Ck({activeScenario:r,onNavUpdate:s,onScenarioInject:l}){var gi,Qn;const p=We.useRef(null),_=We.useRef(null),T=We.useRef(null),v=We.useRef(null),[d,N]=We.useState([]),[Z,te]=We.useState(null),[q,U]=We.useState(""),[ke,ue]=We.useState(null),[_e,Pe]=We.useState(!0),oe=We.useRef("dijkstra"),[re,ce]=We.useState({}),[Ce,De]=We.useState(!1),[Ue,Oe]=We.useState(!1),[Qe,_t]=We.useState(!1),[mt,pt]=We.useState(null),[Xt,Dt]=We.useState(!1),[Lt,fr]=We.useState(!1),[nr,Or]=We.useState(null),[Ze,ft]=We.useState(!1),[gt,wt]=We.useState([]),[Pt,ar]=We.useState(!1),mr=We.useRef(null),Cr=We.useRef(null),Yt=We.useRef(null),Pr=We.useRef(0),Sn=We.useRef(!0),Wi=We.useRef(null),Hr=We.useRef(s),Jn=We.useRef(null),Br=We.useRef(null);We.useEffect(()=>{Sn.current=_e},[_e]),We.useEffect(()=>{Wi.current=r},[r]),We.useEffect(()=>{Hr.current=s},[s]),We.useEffect(()=>{if(_.current||!p.current)return;_.current=new qc.Map({container:p.current,style:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",center:[-79.2578,43.8334],zoom:16,pitch:70});const it=document.createElement("div");it.className="ambulance-marker",it.style.width="40px",it.style.height="40px",it.style.display="flex",it.style.alignItems="center",it.style.justifyContent="center",it.style.willChange="transform",it.innerHTML=`
      <svg id="veh" width="40" height="40" viewBox="0 0 64 64" style="filter: drop-shadow(0 0 10px #00f0ff);">
        <!-- body -->
        <rect x="8" y="18" width="48" height="26" rx="6" fill="#1e293b" stroke="#00f0ff" stroke-width="2"/>
        <!-- cab -->
        <path d="M44 18 L56 18 Q58 18 58 20 L58 38 L44 38 Z" fill="#0f172a" stroke="#00f0ff" stroke-width="1.5"/>
        <!-- windshield -->
        <path d="M46 22 L54 22 Q55 22 55 23 L55 32 L46 32 Z" fill="#38bdf8" opacity="0.5"/>
        <!-- red cross -->
        <rect x="20" y="29" width="12" height="3" rx="1" fill="#ef4444"/>
        <rect x="24.5" y="25" width="3" height="11" rx="1" fill="#ef4444"/>
        <!-- siren -->
        <rect x="24" y="13" width="8" height="6" rx="2" fill="#ef4444" opacity="0.9"/>
        <rect x="24" y="13" width="8" height="6" rx="2" fill="#ef4444" opacity="0.5">
          <animate attributeName="opacity" values="0.3;1;0.3" dur="0.8s" repeatCount="indefinite"/>
        </rect>
        <!-- wheels -->
        <circle cx="18" cy="44" r="5" fill="#334155" stroke="#00f0ff" stroke-width="1.5"/>
        <circle cx="18" cy="44" r="2" fill="#00f0ff"/>
        <circle cx="46" cy="44" r="5" fill="#334155" stroke="#00f0ff" stroke-width="1.5"/>
        <circle cx="46" cy="44" r="2" fill="#00f0ff"/>
      </svg>
    `,T.current=new qc.Marker({element:it}).setLngLat([-79.2578,43.8334]).addTo(_.current),_.current.on("load",()=>{var Tt,Ht,ut,Ie,Vt;(Tt=_.current)==null||Tt.addSource("aegis-route",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),(Ht=_.current)==null||Ht.addLayer({id:"aegis-route-line",type:"line",source:"aegis-route",layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":6,"line-color":"#00f0ff","line-opacity":.85}}),(ut=_.current)==null||ut.addSource("road-closures",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),(Ie=_.current)==null||Ie.addLayer({id:"road-closures-circle",type:"circle",source:"road-closures",paint:{"circle-radius":10,"circle-color":"#ff4444","circle-stroke-color":"#ffffff","circle-stroke-width":2.5,"circle-opacity":.9}}),(Vt=_.current)==null||Vt.addLayer({id:"road-closures-label",type:"symbol",source:"road-closures",layout:{"text-field":"","text-size":14,"text-allow-overlap":!0},paint:{"text-color":"#ffffff"}}),setTimeout(()=>{var Me,yt,st,_r;const Ot=(Me=_.current)==null?void 0:Me.getStyle();if(!Ot)return;const lr=Ot.sources||{},Nr=lr.openmaptiles?"openmaptiles":lr.carto?"carto":null;if(Nr){const Ar=(st=(yt=Ot.layers)==null?void 0:yt.find(ht=>ht.type==="symbol"&&ht.layout&&ht.layout["text-field"]))==null?void 0:st.id;(_r=_.current)==null||_r.addLayer({id:"3d-buildings",source:Nr,"source-layer":"building",type:"fill-extrusion",minzoom:15,paint:{"fill-extrusion-color":"#333","fill-extrusion-height":["get","render_height"],"fill-extrusion-base":["get","render_min_height"],"fill-extrusion-opacity":.6}},Ar)}},1e3)})},[]),We.useEffect(()=>{var Ht,ut;if(!((Ht=_.current)!=null&&Ht.loaded()))return;const it=(r==null?void 0:r.roadClosures)||[],Tt=(ut=_.current)==null?void 0:ut.getSource("road-closures");if(Tt){const Ie=it.map(([Vt,Ot])=>({type:"Feature",properties:{},geometry:{type:"Point",coordinates:[Ot,Vt]}}));Tt.setData({type:"FeatureCollection",features:Ie})}if(r!=null&&r.isRedAlert&&it.length>0?Xi(r):(ft(!1),Or(null)),r!=null&&r.end){const Ie={lat:r.end.lat,lng:r.end.lng};ue(Ie),r.start&&T.current&&T.current.setLngLat([r.start.lng,r.start.lat]),Yn(Ie,!0,it);return}},[r]);const Yn=async(it,Tt=!1,Ht)=>{var ut,Ie,Vt,Ot,lr,Nr,Me,yt,st,_r,Ar,ht;try{_t(!0),pt(null),Dt(!1),Yt.current!=null&&(cancelAnimationFrame(Yt.current),Yt.current=null);const Gt=(ut=T.current)==null?void 0:ut.getLngLat(),Tn=Gt?{lat:Gt.lat,lng:Gt.lng}:{lat:43.8334,lng:-79.2578};Jn.current&&Jn.current.abort();const Bn=new AbortController;Jn.current=Bn;const fn={start:Tn,end:it??ke,scenario_type:(r==null?void 0:r.title)||"ROUTINE",algorithm:oe.current};Ht&&Ht.length>0&&(fn.blocked_edges=Ht);const G=await Ea.post("/api/algo/calculate",fn,{signal:Bn.signal}),R=((Ie=G.data)==null?void 0:Ie.path_coordinates)||[],D=((Vt=G.data)==null?void 0:Vt.cum_distance_m)||[],B=((Ot=G.data)==null?void 0:Ot.cum_time_s)||[],H=Number(((lr=G.data)==null?void 0:lr.total_distance_m)??(D.length?D[D.length-1]:0)),ie=Number(((Nr=G.data)==null?void 0:Nr.total_time_s)??(B.length?B[B.length-1]:0)),ae=((Me=G.data)==null?void 0:Me.steps)||[];if(!R.length||!D.length||!B.length)throw new Error("Route meta missing (coords/cumDist/cumTime). Check backend /calculate response.");const pe=G.data.snapped_start;pe&&T.current?T.current.setLngLat(pe):T.current&&T.current.setLngLat(R[0]);const ee={exec_ms:Number(G.data.execution_time_ms??0),eta_s:ie,dist_m:H};if(ce(Xe=>({...Xe,[oe.current]:ee})),Br.current={coords:R,cumDist:D,cumTime:B,totalDist:H,totalTime:ie,steps:ae,algorithm:G.data.algorithm},_.current){v.current&&v.current.remove();const Xe=document.createElement("div");Xe.style.width="32px",Xe.style.height="32px",Xe.style.display="flex",Xe.style.alignItems="center",Xe.style.justifyContent="center",Xe.innerHTML=`
          <svg width="32" height="32" viewBox="0 0 24 24" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));">
            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" fill="#ef4444" stroke="white" stroke-width="1.2"/>
            <circle cx="12" cy="9" r="2.5" fill="white"/>
          </svg>
        `;const lt=G.data.snapped_end||R[R.length-1];v.current=new qc.Marker({element:Xe,anchor:"bottom"}).setLngLat(lt).addTo(_.current)}const ve={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:R}}]},Te=(yt=_.current)==null?void 0:yt.getSource("aegis-route");Te&&Te.setData(ve),(st=_.current)==null||st.jumpTo({center:pe||R[0]});const Re=Bm({totalDist:H,totalTime:ie,steps:ae,algorithm:G.data.algorithm},0,0,8);(_r=Hr.current)==null||_r.call(Hr,Re),Tt?N(R):Dt(!0)}catch(Gt){if((Gt==null?void 0:Gt.name)==="CanceledError"||(Gt==null?void 0:Gt.code)==="ERR_CANCELED")return;console.error("Route fetch failed",Gt),pt(((ht=(Ar=Gt==null?void 0:Gt.response)==null?void 0:Ar.data)==null?void 0:ht.detail)||(Gt==null?void 0:Gt.message)||"Route fetch failed. Is the backend running on http://127.0.0.1:8000 ?")}finally{_t(!1)}},mi=()=>{Br.current&&(Dt(!1),fr(!0),N(Br.current.coords))},us=()=>{var Tt;Jn.current&&(Jn.current.abort(),Jn.current=null),Yt.current!=null&&(cancelAnimationFrame(Yt.current),Yt.current=null),N([]),Dt(!1),fr(!1),_t(!1),U(""),ue(null),pt(null),wt([]),ar(!1),Br.current=null,v.current&&(v.current.remove(),v.current=null);const it=(Tt=_.current)==null?void 0:Tt.getSource("aegis-route");it&&it.setData({type:"FeatureCollection",features:[]})},xe=async()=>{var ut;Oe(!0);const it=(ut=T.current)==null?void 0:ut.getLngLat(),Ht={start:it?{lat:it.lat,lng:it.lng}:{lat:43.8334,lng:-79.2578},end:ke,scenario_type:(r==null?void 0:r.title)||"ROUTINE"};try{const[Ie,Vt]=await Promise.all([Ea.post("/api/algo/calculate",{...Ht,algorithm:"dijkstra"}),Ea.post("/api/algo/calculate",{...Ht,algorithm:"bmsssp"})]);ce({dijkstra:{exec_ms:Number(Ie.data.execution_time_ms??0),eta_s:Number(Ie.data.total_time_s??0),dist_m:Number(Ie.data.total_distance_m??0)},bmsssp:{exec_ms:Number(Vt.data.execution_time_ms??0),eta_s:Number(Vt.data.total_time_s??0),dist_m:Number(Vt.data.total_distance_m??0)}})}catch(Ie){console.error("Failed to fetch comparison stats",Ie)}finally{Oe(!1)}},Xi=async it=>{try{ft(!0);const Tt=it.start||{lat:43.8334,lng:-79.2578},Ht=it.end||ke,ut=it.roadClosures||[],Ie={start:Tt,end:Ht,scenario_type:it.title||"ROUTINE",blocked_edges:ut},[Vt,Ot]=await Promise.all([Ea.post("/api/algo/calculate",{...Ie,algorithm:"dijkstra"}),Ea.post("/api/algo/calculate",{...Ie,algorithm:"bmsssp"})]),lr=ut.map(([Nr,Me])=>[Me,Nr]);Or({dijkstraCoords:Vt.data.path_coordinates||[],dijkstraExecMs:Number(Vt.data.execution_time_ms??100),bmssspCoords:Ot.data.path_coordinates||[],bmssspExecMs:Number(Ot.data.execution_time_ms??100),closurePoints:lr})}catch(Tt){console.error("Algorithm race fetch failed",Tt),ft(!1)}},cs=async()=>{var it,Tt,Ht;if(q.trim())try{_t(!0),pt(null);const Ie=((it=(await Ea.get("/api/algo/autocomplete",{params:{q:q.trim()}})).data)==null?void 0:it.results)||[];if(!Ie.length){pt("No addresses found in York Region. Try a more specific query."),_t(!1);return}const Vt=Ie[0];U(Vt.display_name);const Ot={lat:Vt.lat,lng:Vt.lng};ue(Ot),await Yn(Ot)}catch(ut){console.error("Geocode failed",ut),pt(((Ht=(Tt=ut==null?void 0:ut.response)==null?void 0:Tt.data)==null?void 0:Ht.detail)||(ut==null?void 0:ut.message)||"Geocode failed. Try a more specific address in York Region."),_t(!1)}},Ft=We.useCallback(async it=>{var Ht;if(it.trim().length<3){wt([]),ar(!1);return}Cr.current&&Cr.current.abort();const Tt=new AbortController;Cr.current=Tt;try{const Ie=((Ht=(await Ea.get("/api/algo/autocomplete",{params:{q:it.trim()},signal:Tt.signal})).data)==null?void 0:Ht.results)||[];wt(Ie),ar(Ie.length>0)}catch(ut){if((ut==null?void 0:ut.name)==="CanceledError"||(ut==null?void 0:ut.code)==="ERR_CANCELED")return;wt([]),ar(!1)}},[]),gr=it=>{U(it),mr.current&&clearTimeout(mr.current),mr.current=setTimeout(()=>Ft(it),1100)},Ts=async it=>{U(it.display_name),wt([]),ar(!1);const Tt={lat:it.lat,lng:it.lng};ue(Tt),await Yn(Tt)};return We.useEffect(()=>{if(!d.length)return;Yt.current!=null&&(cancelAnimationFrame(Yt.current),Yt.current=null);const it=Br.current;if(!it)return;Pr.current=performance.now(),te(it.coords[0]),fr(!0);const Tt=8,Ht=()=>{var pe,ee,ve,Te;const ut=Br.current;if(!ut||!T.current||!_.current)return;const Vt=(performance.now()-Pr.current)/1e3*Tt,Ot=ut.totalTime||ut.cumTime[ut.cumTime.length-1];if(Vt>=Ot){const ye=ut.coords[ut.coords.length-1];T.current.setLngLat(ye),te(ye),fr(!1);const Re=(pe=_.current)==null?void 0:pe.getSource("aegis-route");Re&&Re.setData({type:"FeatureCollection",features:[]});const Xe=Bm({totalDist:ut.totalDist,totalTime:Ot,steps:ut.steps,algorithm:ut.algorithm},ut.totalDist,Ot,Tt);(ee=Hr.current)==null||ee.call(Hr,Xe);return}const lr=Ek(kk(ut.cumTime,Vt),1,ut.cumTime.length-1),Nr=ut.cumTime[lr-1],Me=ut.cumTime[lr],yt=Me===Nr?0:(Vt-Nr)/(Me-Nr),st=ut.coords[lr-1],_r=ut.coords[lr],Ar=[st[0]+(_r[0]-st[0])*yt,st[1]+(_r[1]-st[1])*yt];T.current.setLngLat(Ar),te(Ar);const ht=[Ar,...ut.coords.slice(lr)],Gt=(ve=_.current)==null?void 0:ve.getSource("aegis-route");Gt&&Gt.setData({type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:ht}}]});const Tn=ut.cumDist[lr-1],Bn=ut.cumDist[lr],fn=Tn+(Bn-Tn)*yt,G=Bm({totalDist:ut.totalDist,totalTime:Ot,steps:ut.steps,algorithm:ut.algorithm},fn,Vt,Tt);(Te=Hr.current)==null||Te.call(Hr,G);const R=Tk(st,_r),D=16,B=18.5,H=100;let ie=D;if(G.distance_to_next_m<H&&(G.next_instruction.toLowerCase().includes("turn")||G.next_instruction.toLowerCase().includes("onto"))){const ye=1-G.distance_to_next_m/H;ie=D+(B-D)*ye}Sn.current&&_.current.easeTo({center:Ar,bearing:R,zoom:ie,duration:120,easing:ye=>ye,essential:!0}),Yt.current=requestAnimationFrame(Ht)};return Yt.current=requestAnimationFrame(Ht),()=>{Yt.current!=null&&cancelAnimationFrame(Yt.current),Yt.current=null}},[d]),he.jsxs("div",{className:"w-full h-full relative",children:[he.jsx("div",{ref:p,className:"w-full h-full rounded-2xl overflow-hidden border border-white/10"}),he.jsx("div",{className:"absolute top-4 left-4 flex flex-col gap-2",children:he.jsxs("div",{className:"bg-black/80 backdrop-blur-xl p-3 rounded-lg border border-cyan-500/30 flex flex-col gap-1 min-w-[220px]",children:[he.jsxs("div",{className:"flex items-center gap-2",children:[he.jsx("div",{className:`w-2 h-2 rounded-full ${r!=null&&r.isRedAlert?"bg-red-500 animate-pulse":"bg-cyan-400"}`}),he.jsx("span",{className:"text-cyan-400 text-[10px] font-mono font-bold uppercase tracking-tighter",children:(r==null?void 0:r.title)||"SYSTEM IDLE"})]}),he.jsxs("div",{className:"text-[9px] text-gray-500 font-mono",children:["UNIT 992 // ",Z?`${Z[0].toFixed(5)}, ${Z[1].toFixed(5)}`:"--, --"]}),((gi=Br.current)==null?void 0:gi.totalDist)!=null&&((Qn=Br.current)==null?void 0:Qn.totalTime)!=null&&he.jsxs("div",{className:"text-[9px] text-gray-500 font-mono",children:["ROUTE // ",(Br.current.totalDist/1e3).toFixed(2)," km // ETA ",Om(Br.current.totalTime)]}),mt&&he.jsx("div",{className:"text-[10px] text-red-300 font-mono mt-1 max-w-[300px]",children:mt})]})}),he.jsx("div",{className:"absolute top-4 right-4 z-50",children:he.jsxs("div",{className:"bg-black/80 backdrop-blur-xl p-3 rounded-lg border border-white/10 flex gap-2 items-center",children:[he.jsxs("div",{className:"relative",children:[he.jsx("input",{value:q,onChange:it=>gr(it.target.value),placeholder:"Enter address in York Region",className:"bg-black/40 border border-white/10 rounded px-2 py-1 text-xs text-white w-64 outline-none focus:border-cyan-500/50 transition-colors",onKeyDown:it=>{if(it.key==="Enter"){if(ar(!1),Xt){mi();return}cs()}it.key==="Escape"&&ar(!1)},onFocus:()=>{gt.length>0&&ar(!0)},onBlur:()=>{setTimeout(()=>ar(!1),200)}}),Pt&&gt.length>0&&he.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-black/95 backdrop-blur-xl border border-cyan-500/30 rounded-lg overflow-hidden shadow-[0_8px_32px_rgba(0,240,255,0.15)]",children:gt.map((it,Tt)=>he.jsxs("button",{className:"w-full text-left px-3 py-2 text-[11px] text-gray-300 hover:bg-cyan-500/15 hover:text-cyan-200 transition-colors border-b border-white/5 last:border-b-0 flex items-start gap-2",onMouseDown:Ht=>Ht.preventDefault(),onClick:()=>Ts(it),children:[he.jsx("span",{className:"text-cyan-500 mt-px shrink-0",children:""}),he.jsx("span",{className:"line-clamp-2 leading-tight",children:it.display_name})]},Tt))})]}),he.jsx("button",{onClick:()=>{ar(!1),Xt?mi():cs()},disabled:Qe||Lt,className:`px-3 py-1 rounded border text-xs font-mono ${Qe||Lt?"bg-white/5 border-white/10 text-gray-400 cursor-not-allowed":Xt?"bg-green-500/20 border-green-400/40 text-green-300 hover:bg-green-500/30 animate-pulse":"bg-cyan-500/20 border-cyan-400/40 text-cyan-300 hover:bg-cyan-500/30"}`,children:Qe?"...":Lt?"MOVING":Xt?" GO":"GO"}),he.jsx("button",{onClick:()=>Pe(it=>!it),className:`px-2 py-1 rounded border text-xs font-mono ${_e?"border-cyan-400/50 text-cyan-300":"border-white/10 text-gray-400"}`,children:_e?"FOLLOW":"FREE"}),(Lt||Qe)&&he.jsx("button",{onClick:us,className:"px-2 py-1 rounded border text-xs font-mono bg-red-500/20 border-red-400/40 text-red-300 hover:bg-red-500/30 transition-colors",title:"Cancel route",children:""})]})}),he.jsxs("div",{className:"absolute bottom-4 left-4 z-50 flex flex-col items-start gap-2",children:[Ce&&he.jsxs("div",{className:"bg-black/90 backdrop-blur-xl p-4 rounded-lg border border-cyan-500/30 min-w-[300px] flex flex-col gap-3 shadow-[0_0_30px_rgba(0,240,255,0.1)]",children:[he.jsxs("div",{children:[he.jsx("div",{className:"text-[10px] text-cyan-400 font-mono font-bold uppercase tracking-wider mb-2",children:"Algorithm Comparison"}),Ue?he.jsx("div",{className:"text-[9px] text-gray-400 font-mono animate-pulse",children:"Fetching both routes..."}):he.jsxs("div",{className:"grid grid-cols-3 gap-1 text-[9px] font-mono",children:[he.jsx("div",{className:"text-gray-500"}),he.jsx("div",{className:"text-cyan-300 text-center",children:"DIJKSTRA"}),he.jsx("div",{className:"text-purple-300 text-center",children:"DUAN-MAO"}),he.jsx("div",{className:"text-gray-500",children:"EXEC"}),he.jsx("div",{className:"text-cyan-200 text-center",children:re.dijkstra?`${re.dijkstra.exec_ms.toFixed(0)}ms`:""}),he.jsx("div",{className:"text-purple-200 text-center",children:re.bmsssp?`${re.bmsssp.exec_ms.toFixed(0)}ms`:""}),he.jsx("div",{className:"text-gray-500",children:"ETA"}),he.jsx("div",{className:"text-cyan-200 text-center",children:re.dijkstra?Om(re.dijkstra.eta_s):""}),he.jsx("div",{className:"text-purple-200 text-center",children:re.bmsssp?Om(re.bmsssp.eta_s):""}),he.jsx("div",{className:"text-gray-500",children:"DIST"}),he.jsx("div",{className:"text-cyan-200 text-center",children:re.dijkstra?`${(re.dijkstra.dist_m/1e3).toFixed(2)}km`:""}),he.jsx("div",{className:"text-purple-200 text-center",children:re.bmsssp?`${(re.bmsssp.dist_m/1e3).toFixed(2)}km`:""})]})]}),he.jsx("div",{className:"border-t border-white/10"}),he.jsxs("div",{children:[he.jsx("div",{className:"text-[10px] text-cyan-500/60 font-mono font-bold uppercase tracking-wider mb-2",children:"Tactical Injections"}),he.jsx("div",{className:"flex flex-col gap-1.5",children:Object.entries(Ik).map(([it,Tt])=>he.jsx("button",{onClick:()=>l==null?void 0:l(Tt),className:`w-full text-left px-3 py-2 text-[10px] font-mono font-bold rounded-lg border transition-all duration-300 hover:scale-[1.02] active:scale-95 ${Tt.isRedAlert?"border-red-500/40 text-red-500 bg-red-500/5 hover:bg-red-500 hover:text-white shadow-[0_0_15px_rgba(239,68,68,0.15)]":"border-cyan-500/40 text-cyan-400 bg-cyan-500/5 hover:bg-cyan-500 hover:text-white shadow-[0_0_15px_rgba(0,240,255,0.15)]"}`,children:it.replace(/_/g," ")},it))})]})]}),he.jsx("button",{onClick:()=>{const it=!Ce;De(it),it&&xe()},className:`px-3 py-1.5 rounded-lg border text-xs font-mono font-bold transition-all duration-300 ${Ce?"bg-cyan-500/30 border-cyan-400/50 text-cyan-300 shadow-[0_0_15px_rgba(0,240,255,0.2)]":"bg-black/80 backdrop-blur-xl border-white/10 text-gray-400 hover:text-cyan-300 hover:border-cyan-500/30"}`,children:Ce?" DEV":" DEV"})]}),he.jsx(Sk,{data:nr,visible:Ze})]})}const Pk=We.forwardRef(({className:r},s)=>{const[l,p]=We.useState(""),[_,T]=We.useState([{role:"ai",text:"AEGIS SYSTEM ONLINE. READY FOR TRIAGE SUPPORT.",timestamp:"NOW"}]),[v,d]=We.useState(!1),[N,Z]=We.useState(!0),te=We.useRef(null),q=We.useRef(null);We.useImperativeHandle(s,()=>({injectSystemMessage:async(ue,_e=!0)=>{const Pe={role:"ai",text:ue,timestamp:new Date().toLocaleTimeString([],{hour12:!1})};T(oe=>[...oe,Pe]),N&&_e?await U(ue):console.log("AEGIS LOG: Scenario local audio active. ElevenLabs API bypassed.")}})),We.useEffect(()=>{te.current&&(te.current.scrollTop=te.current.scrollHeight)},[_]),We.useEffect(()=>()=>{q.current&&(q.current.pause(),URL.revokeObjectURL(q.current.src))},[]);const U=async ue=>{if(N)try{q.current&&(q.current.pause(),URL.revokeObjectURL(q.current.src));const _e=await Fr.post("/api/ai/speak",{message:ue},{responseType:"blob"}),Pe=URL.createObjectURL(_e.data);q.current=new Audio(Pe),q.current.play()}catch(_e){console.error("ElevenLabs Integration Error:",_e)}},ke=async()=>{if(!l.trim()||v)return;const ue={role:"user",text:l.toUpperCase(),timestamp:new Date().toLocaleTimeString([],{hour12:!1})};T(_e=>[..._e,ue]),p(""),d(!0);try{const Pe=(await Fr.post("/api/ai/chat",{message:ue.text})).data.response,oe={role:"ai",text:Pe,timestamp:new Date().toLocaleTimeString([],{hour12:!1})};T(re=>[...re,oe]),N&&await U(Pe)}catch{T(Pe=>[...Pe,{role:"ai",text:"ERROR: NEURAL UPLINK FAILED.",timestamp:"ERR"}])}finally{d(!1)}};return he.jsxs("div",{className:`bg-black/40 backdrop-blur-md border border-white/10 rounded-xl flex flex-col overflow-hidden ${r}`,children:[he.jsxs("div",{className:"p-3 border-b border-white/10 bg-white/5 flex justify-between items-center",children:[he.jsxs("div",{className:"flex items-center gap-2",children:[he.jsx("h2",{className:"text-cyan-400 font-mono text-sm tracking-widest uppercase",children:"AEGIS AI // TRIAGE"}),he.jsx("div",{className:`w-2 h-2 rounded-full ${v?"bg-yellow-400 animate-ping":"bg-green-500"}`})]}),he.jsxs("button",{onClick:()=>Z(!N),className:`text-[10px] font-mono px-2 py-0.5 rounded border transition-colors ${N?"bg-cyan-500/20 border-cyan-500 text-cyan-400":"bg-gray-800 border-gray-600 text-gray-500"}`,children:["VOICE: ",N?"ON":"OFF"]})]}),he.jsxs("div",{ref:te,className:"flex-1 overflow-y-auto p-4 space-y-4 font-mono text-xs scrollbar-thin scrollbar-thumb-cyan-900",children:[_.map((ue,_e)=>he.jsxs("div",{className:`flex flex-col ${ue.role==="user"?"items-end":"items-start"}`,children:[he.jsx("div",{className:`max-w-[90%] p-2 rounded border ${ue.role==="user"?"bg-cyan-950/30 border-cyan-500/50 text-cyan-100":"bg-black/50 border-white/20 text-gray-300"}`,children:ue.text.split(`
`).map((Pe,oe)=>he.jsx("p",{className:"mb-1 leading-relaxed",children:Pe},oe))}),he.jsx("span",{className:"text-[9px] text-gray-600 mt-1",children:ue.timestamp})]},_e)),v&&he.jsx("div",{className:"text-cyan-400 animate-pulse font-mono text-[10px] uppercase",children:"Analyzing medical parameters..."})]}),he.jsxs("div",{className:"p-2 border-t border-white/10 bg-black/50 flex gap-2",children:[he.jsx("input",{type:"text",value:l,onChange:ue=>p(ue.target.value),onKeyDown:ue=>ue.key==="Enter"&&ke(),placeholder:"ENTER PROTOCOL QUERY...",className:"flex-1 bg-transparent border-none outline-none text-cyan-400 font-mono text-xs placeholder-gray-700",disabled:v}),he.jsx("button",{onClick:ke,disabled:v,className:`px-3 py-1 font-mono text-xs transition-all ${v?"bg-gray-800 text-gray-600 border border-gray-700 cursor-not-allowed":"bg-cyan-900/40 border border-cyan-500/30 text-cyan-400 hover:bg-cyan-800/50 hover:border-cyan-400 shadow-[0_0_10px_rgba(0,240,255,0.1)]"}`,children:v?"...":"SEND"})]})]})});function Ak({className:r,scenarioData:s}){const[l,p]=We.useState(75),[_,T]=We.useState(98),[v,d]=We.useState({sys:120,dia:80}),[N,Z]=We.useState(new Array(50).fill(50));return We.useEffect(()=>{s&&(p(s.hr),T(s.spO2),d(s.bp))},[s]),We.useEffect(()=>{const te=setInterval(()=>{p(q=>q===0?0:q+(Math.floor(Math.random()*3)-1)),T(q=>Math.min(100,q+(Math.floor(Math.random()*2)-.5))),d(q=>({sys:q.sys===0?0:q.sys+(Math.floor(Math.random()*3)-1),dia:q.dia===0?0:q.dia+(Math.floor(Math.random()*3)-1)})),Z(q=>{const U=[...q.slice(1)],ke=Date.now();if(l===0)U.push(50+(Math.random()*2-1));else{const ue=6e4/l;ke%ue<100?U.push(10):ke%ue<200?U.push(90):U.push(50+(Math.random()*10-5))}return U})},100);return()=>clearInterval(te)},[l]),he.jsxs("div",{className:`bg-black/40 backdrop-blur-md border border-white/10 rounded-xl p-4 flex flex-col ${r}`,children:[he.jsxs("div",{className:"flex justify-between items-center border-b border-white/5 pb-2 mb-2",children:[he.jsx("h2",{className:"text-cyan-400 font-mono text-sm tracking-widest uppercase",children:"PATIENT VITALS"}),he.jsxs("div",{className:"flex items-center gap-2",children:[he.jsx("span",{className:"text-[10px] text-gray-500 font-mono",children:"CONNECTION: STABLE"}),he.jsx("div",{className:`w-2 h-2 rounded-full animate-pulse ${l===0?"bg-red-500 shadow-[0_0_10px_#ff0000]":"bg-green-500 shadow-[0_0_10px_#00ff00]"}`})]})]}),he.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[he.jsxs("div",{className:`border p-2 rounded relative overflow-hidden transition-colors ${l===0?"bg-red-950/40 border-red-500":"bg-red-950/20 border-red-900/30"}`,children:[he.jsx("div",{className:"text-red-500 text-[10px] font-mono",children:"HEART RATE (BPM)"}),he.jsx("div",{className:"text-4xl text-red-500 font-bold font-mono",children:Math.round(l)}),l>0&&he.jsx("div",{className:"absolute top-2 right-2 text-red-500/50 text-xs animate-ping",children:""})]}),he.jsxs("div",{className:"bg-blue-950/20 border border-blue-900/30 p-2 rounded",children:[he.jsx("div",{className:"text-blue-400 text-[10px] font-mono",children:"SpO2 (%)"}),he.jsxs("div",{className:"text-4xl text-blue-400 font-bold font-mono",children:[Math.round(_),"%"]})]})]}),he.jsxs("div",{className:"flex justify-between items-end mb-4 bg-white/5 p-2 rounded",children:[he.jsxs("div",{children:[he.jsx("div",{className:"text-gray-400 text-[10px] font-mono",children:"BLOOD PRESSURE"}),he.jsxs("div",{className:"text-2xl text-white font-mono",children:[Math.round(v.sys),"/",Math.round(v.dia)," ",he.jsx("span",{className:"text-xs text-gray-500",children:"mmHg"})]})]}),he.jsxs("div",{className:"text-right",children:[he.jsx("div",{className:"text-[10px] text-gray-500",children:"PATIENT ID"}),he.jsx("div",{className:"text-xs text-cyan-400 font-mono",children:"#992-AX-YORK"})]})]}),he.jsxs("div",{className:"flex-1 bg-black/50 rounded border border-white/10 relative overflow-hidden flex items-center",children:[he.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:"linear-gradient(#00f0ff 1px, transparent 1px), linear-gradient(90deg, #00f0ff 1px, transparent 1px)",backgroundSize:"10px 10px"}}),he.jsx("svg",{className:"w-full h-full",preserveAspectRatio:"none",children:he.jsx("polyline",{points:N.map((te,q)=>`${q/50*100},${te}`).join(" "),fill:"none",stroke:l===0?"#ff0000":"#00f0ff",strokeWidth:"2",vectorEffect:"non-scaling-stroke",className:"drop-shadow-[0_0_5px_rgba(0,240,255,0.8)]"})}),he.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400/10 to-transparent w-full h-full animate-scan"})]})]})}function Mk(r){const s=Math.max(0,Math.floor(r)),l=Math.floor(s/60),p=s%60;return`${l}:${p.toString().padStart(2,"0")}`}function zk(r){return r>=1e3?{value:(r/1e3).toFixed(1),unit:"km"}:{value:Math.round(r).toString(),unit:"m"}}function Rk({className:r,activeScenario:s,navData:l}){const p=l?l.distance_to_next_m:0,_=zk(p),T=(l==null?void 0:l.next_instruction)||"AWAITING ROUTE",v=(l==null?void 0:l.current_street)||"--",d=l?Mk(l.eta_remaining_s):"--:--",N=l?(l.remaining_distance_m/1e3).toFixed(2):"--";l!=null&&l.algorithm;const Z=l?`SIM x${l.sim_speedup}`:"",te=T.toUpperCase().includes("U-TURN")||T.toUpperCase().includes("U TURN")?"":T.toUpperCase().includes("RIGHT")?"":T.toUpperCase().includes("LEFT")?"":"";return he.jsxs("div",{className:`bg-black/40 backdrop-blur-md border border-white/10 rounded-xl p-4 flex flex-col justify-between ${r}`,children:[he.jsx("h2",{className:"text-cyan-400 font-mono text-sm tracking-widest uppercase border-b border-white/5 pb-1",children:"NAV-COM // MISSION_STATE"}),he.jsxs("div",{className:"flex flex-col items-center justify-center my-4",children:[he.jsxs("div",{className:"text-6xl text-white font-bold tracking-tighter drop-shadow-[0_0_15px_rgba(0,240,255,0.3)]",children:[_.value,he.jsx("span",{className:"text-2xl text-gray-500 ml-1",children:_.unit})]}),he.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[he.jsx("div",{className:"text-4xl text-cyan-400 font-bold",children:te}),he.jsx("div",{className:"text-base text-cyan-300 font-mono font-bold text-center max-w-[220px] leading-tight",children:T})]})]}),he.jsx("div",{className:"space-y-2",children:he.jsxs("div",{className:"bg-white/5 rounded p-2 border border-white/10 flex justify-between items-center",children:[he.jsxs("div",{children:[he.jsx("div",{className:"text-[10px] text-gray-500 font-mono uppercase",children:"Current Road"}),he.jsx("div",{className:"text-sm text-white font-mono font-bold",children:v}),he.jsxs("div",{className:"text-[9px] text-gray-500 font-mono mt-1",children:["Remaining: ",N," km"]})]}),he.jsxs("div",{className:"text-right",children:[he.jsx("div",{className:"text-[10px] text-gray-500 font-mono",children:"ETA"}),he.jsx("div",{className:`text-xl font-mono font-bold ${s!=null&&s.isRedAlert?"text-red-400":"text-green-400"} animate-pulse`,children:d}),he.jsx("div",{className:"text-[9px] text-gray-500 font-mono mt-1",children:Z})]})]})})]})}const $v=[{time:"00:00",sender:"DISPATCH",msg:"UNIT 992: RESPOND CODE 4 - CARDIAC ARREST"},{time:"00:01",sender:"SYSTEM",msg:"ROUTE CALCULATED: DUAN-MAO OPTIMIZED"},{time:"00:02",sender:"DISPATCH",msg:"FIRE SERVICES EN ROUTE. ETA 2 MINS."},{time:"00:04",sender:"992",msg:"COPY. EN ROUTE. TRAFFIC HEAVY ON MAJOR MAC."},{time:"00:05",sender:"SYSTEM",msg:"V2X SIGNAL: GREEN WAVE REQUESTED [APPROVED]"},{time:"00:08",sender:"POLICE",msg:"ON SCENE. SCENE SECURE. STARTING CPR."},{time:"00:12",sender:"DISPATCH",msg:"UPDATE: PATIENT IS 60M. NO PULSE."},{time:"00:15",sender:"SYSTEM",msg:"AI ADVISORY: PREP LUCAS DEVICE & EPI"}];function Dk({className:r}){const[s,l]=We.useState([]),p=We.useRef(null);return We.useEffect(()=>{let _=0;const T=setInterval(()=>{_<$v.length&&(l(v=>[...v,{...$v[_],time:new Date().toLocaleTimeString([],{hour12:!1})}]),_++)},2500);return()=>clearInterval(T)},[]),We.useEffect(()=>{p.current&&(p.current.scrollTop=p.current.scrollHeight)},[s]),he.jsxs("div",{className:`bg-black/40 backdrop-blur-md border border-white/10 rounded-xl flex flex-col overflow-hidden ${r}`,children:[he.jsxs("h2",{className:"p-3 text-cyan-400 font-mono text-sm tracking-widest uppercase border-b border-white/5 bg-white/5 flex justify-between",children:[he.jsx("span",{children:"LIVE UPDATES // DISPATCH"}),he.jsx("span",{className:"text-[10px] text-green-500 animate-pulse",children:" LIVE RF-900"})]}),he.jsxs("div",{ref:p,className:"flex-1 overflow-y-auto p-3 space-y-2 font-mono text-xs",children:[s.length===0&&he.jsx("div",{className:"text-gray-600 italic",children:"CONNECTING TO CAD NETWORK..."}),s.map((_,T)=>he.jsxs("div",{className:"flex gap-2 border-b border-white/5 pb-1",children:[he.jsxs("span",{className:"text-gray-500 shrink-0",children:["[",_.time,"]"]}),he.jsxs("span",{className:`font-bold shrink-0 w-16 ${_.sender==="DISPATCH"?"text-yellow-400":_.sender==="SYSTEM"?"text-cyan-400":"text-blue-400"}`,children:[_.sender,":"]}),he.jsx("span",{className:"text-gray-300",children:_.msg})]},T))]})]})}const Lk=({forceOpen:r,isRedAlert:s})=>{const[l,p]=We.useState(!1);return We.useEffect(()=>{r&&p(!0)},[r]),he.jsxs("div",{onClick:()=>p(!l),className:`bg-black/60 backdrop-blur-xl border rounded-xl transition-all duration-500 ease-in-out cursor-pointer overflow-hidden flex flex-col 
        ${l?"h-80":"h-12 hover:bg-white/5"} 
        ${s?"border-red-500 shadow-[0_0_20px_rgba(239,68,68,0.2)]":"border-white/10"}`,children:[he.jsxs("div",{className:"h-12 shrink-0 flex items-center justify-between px-4 border-b border-white/5",children:[he.jsxs("h2",{className:"text-cyan-400 font-mono text-sm tracking-widest uppercase flex items-center gap-2",children:[he.jsx("div",{className:`w-2 h-2 rounded-full ${l?"bg-cyan-400 shadow-[0_0_10px_#00f0ff]":"bg-green-500"}`}),"EQUIPMENT DIAGNOSTICS"]}),he.jsx("span",{className:"text-gray-500 text-[10px] font-mono",children:l?"":""})]}),he.jsxs("div",{className:`flex-1 p-3 grid grid-cols-2 gap-2 transition-opacity duration-300 ${l?"opacity-100":"opacity-0"}`,children:[he.jsxs("div",{className:"bg-white/5 rounded p-2 border border-white/10",children:[he.jsx("div",{className:"text-gray-400 text-[9px] font-mono uppercase",children:"O2 Main Pressure"}),he.jsxs("div",{className:"text-lg text-green-400 font-mono font-bold leading-tight",children:["2200 ",he.jsx("span",{className:"text-[10px] font-normal",children:"PSI"})]}),he.jsx("div",{className:"w-full bg-gray-800 h-1 mt-1 rounded-full overflow-hidden",children:he.jsx("div",{className:"bg-green-500 h-full w-[95%]"})})]}),he.jsxs("div",{className:"bg-white/5 rounded p-2 border border-white/10",children:[he.jsx("div",{className:"text-gray-400 text-[9px] font-mono uppercase",children:"LUCAS Battery"}),he.jsx("div",{className:"text-lg text-cyan-400 font-mono font-bold leading-tight",children:"88%"}),he.jsx("div",{className:"w-full bg-gray-800 h-1 mt-1 rounded-full overflow-hidden",children:he.jsx("div",{className:"bg-cyan-500 h-full w-[88%]"})})]}),he.jsxs("div",{className:"bg-white/5 rounded p-2 border border-white/10",children:[he.jsx("div",{className:"text-gray-400 text-[9px] font-mono uppercase",children:"Defib Status"}),he.jsx("div",{className:"text-base text-green-400 font-mono font-bold uppercase",children:s?"Charging":"Ready"})]}),he.jsxs("div",{className:"bg-white/5 rounded p-2 border border-white/10",children:[he.jsx("div",{className:"text-gray-400 text-[9px] font-mono uppercase",children:"Drug Safe"}),he.jsx("div",{className:"text-base text-yellow-500 font-mono font-bold uppercase text-center",children:"Biometric Locked"})]}),he.jsxs("div",{className:"bg-white/5 rounded p-2 border border-white/10",children:[he.jsx("div",{className:"text-gray-400 text-[9px] font-mono uppercase",children:"Tire Pressure"}),he.jsxs("div",{className:"text-lg text-white font-mono font-bold leading-tight",children:["35 ",he.jsx("span",{className:"text-[10px] font-normal text-gray-400",children:"PSI"})]})]}),he.jsxs("div",{className:"bg-white/5 rounded p-2 border border-white/10",children:[he.jsx("div",{className:"text-gray-400 text-[9px] font-mono uppercase",children:"Engine Temp"}),he.jsx("div",{className:"text-lg text-green-400 font-mono font-bold leading-tight",children:"NORMAL"})]})]})]})};function Fk(){const[r,s]=We.useState(!1),[l,p]=We.useState(null),[_,T]=We.useState(null),[v,d]=We.useState(new Date),[N,Z]=We.useState(!1),te=We.useRef(null);We.useEffect(()=>{const U=setInterval(()=>d(new Date),1e3);return()=>clearInterval(U)},[]),We.useEffect(()=>{document.body.classList.toggle("red-alert",r)},[r]);const q=U=>{s(U.isRedAlert),p(U);const ue=`/audio/${U.title.includes("ARREST")?"arrest.mp3":U.title.includes("TRAUMA")?"trauma.mp3":"routine.mp3"}`,_e=new Audio(ue);_e.volume=1,_e.play().then(()=>{console.log(`AEGIS V-SYNC: Playing local file ${ue}`),Z(!1)}).catch(Pe=>{console.error("VOICE ERROR: Audio blocked. Click the header button to prime audio.",Pe),Z(!0)}),te.current&&te.current.injectSystemMessage(U.aiPrompt,!1)};return he.jsxs("div",{className:`w-screen h-screen overflow-hidden flex flex-col transition-all duration-700 ${r?"bg-red-950/20":"bg-[#050505]"}`,children:[he.jsxs("header",{className:"h-14 shrink-0 border-b border-white/10 bg-black/50 backdrop-blur-lg flex items-center justify-between px-6 z-50",children:[he.jsxs("div",{className:"flex items-center gap-4",children:[he.jsxs("h1",{className:"text-2xl font-bold tracking-tighter text-white uppercase",children:["AEGIS ",he.jsx("span",{className:"text-cyan-400 text-sm font-normal tracking-widest ml-2",children:"// MISSION_CONTROL"})]}),N&&he.jsx("div",{className:"px-2 py-0.5 bg-red-900/40 border border-red-500 rounded text-red-400 text-[10px] font-mono animate-pulse",children:"AUDIO_BLOCKED: CLICK 'ROUTINE PATROL' TO UNLOCK"})]}),he.jsxs("div",{className:"flex items-center gap-6",children:[he.jsxs("div",{className:"text-right",children:[he.jsx("div",{className:"text-white font-mono text-sm",children:v.toLocaleTimeString([],{hour12:!1})}),he.jsx("div",{className:"text-gray-500 text-[10px] font-mono uppercase",children:v.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),he.jsx("button",{onClick:()=>{new Audio().play().catch(()=>{}),s(!r),Z(!1)},className:`px-4 py-1 rounded border font-mono text-xs transition-all ${r?"bg-red-600 text-white border-red-500 animate-pulse shadow-[0_0_15px_rgba(220,38,38,0.5)]":"bg-transparent text-gray-400 border-gray-700 hover:border-white"}`,children:r?" CRITICAL TRAUMA":"ROUTINE PATROL"})]})]}),he.jsxs("main",{className:"flex-1 min-h-0 p-4 grid grid-cols-12 gap-4 relative z-10",children:[he.jsxs("div",{className:"col-span-3 flex flex-col gap-4 h-full min-h-0",children:[he.jsx(Dk,{className:"h-48 shrink-0"}),he.jsx(Pk,{ref:te,className:`flex-1 min-h-0 transition-all duration-500 border-cyan-500/30 shadow-[0_0_40px_rgba(0,240,255,0.2)] ${r?"shadow-[0_0_60px_rgba(239,68,68,0.3)]":""}`}),he.jsx(Lk,{forceOpen:l==null?void 0:l.isRedAlert,isRedAlert:r})]}),he.jsxs("div",{className:"col-span-6 h-full relative rounded-2xl overflow-hidden border border-white/10 shadow-2xl bg-black/20",children:[he.jsx(Ck,{activeScenario:l,onNavUpdate:T,onScenarioInject:q}),he.jsx("div",{className:"absolute top-0 left-0 w-full h-24 bg-gradient-to-b from-black/80 to-transparent pointer-events-none"}),he.jsx("div",{className:"absolute bottom-0 left-0 w-full h-24 bg-gradient-to-t from-black/80 to-transparent pointer-events-none"})]}),he.jsxs("div",{className:"col-span-3 flex flex-col gap-4 h-full min-h-0",children:[he.jsx(Rk,{className:"h-1/3 shrink-0",activeScenario:l,navData:_}),he.jsx(Ak,{className:"flex-1 min-h-0",scenarioData:l==null?void 0:l.vitals})]})]}),he.jsx("div",{className:"absolute inset-0 z-0 pointer-events-none opacity-5",style:{backgroundImage:"linear-gradient(#333 1px, transparent 1px), linear-gradient(90deg, #333 1px, transparent 1px)",backgroundSize:"40px 40px"}})]})}Nm.createRoot(document.getElementById("root")).render(he.jsx(L2.StrictMode,{children:he.jsx(Fk,{})}));
